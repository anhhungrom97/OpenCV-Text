'Option Strict Off
'Imports System
'Imports NXOpen
'Imports NXOpen.UF
'Imports NXOpen.Assemblies
'Imports System.IO
'Imports NXOpen.Utilities
'Imports System.DateTime
'Imports System.Data
'Imports System.Collections.Generic
'Imports System.Data.Common
'Imports System.Diagnostics
'Imports System.Threading
'Imports System.Data.OleDb
'Imports NXOpen.Features
'Imports System.Drawing
'Imports System.Windows.Forms

''NML42734270
''NML42808173

'Module Main_ver3_2                                              'Add thêm step tính Menatsu và tạo Zentaizu
'    Dim theUFSession As UFSession = UFSession.GetUFSession()
'    'Dim partLoadStatus1 As PartLoadStatus, partLoadStatus2 As PartLoadStatus
'    Dim lw As ListingWindow
'    Dim objExcel = CreateObject("Excel.Application")
'    Const ExcelOut As String = "D:\nxcad\scratch\VehiclePlanMacro\2022_DB_069\DB0締結の断面自動作成.xlsm"
'    Dim objWorkbook, objWsIn, objWorksheetThick, objWorksheetTemp, objWsUser, objWsTool, ObjWsOut, ObjWsThickWaring
'    Dim dtFuncNo As String = "Function No", dtFuncShuuhen As String = "Function Shuuhen", dtAssyDanmen As String = "AssyDanmen"
'    Dim dtPrtNo As String = "Part No", dtPrtName As String = "Part Name", dtPrtTag As String = "PartTag"
'    Dim dtX1 As String = "X1", dtY1 As String = "Y1", dtZ1 As String = "Z1"
'    Dim dtX2 As String = "X2", dtY2 As String = "Y2", dtZ2 As String = "Z2"
'    Dim dtFunc As String = "Function", dtType As String = "Type"
'    Dim dtOrgX As String = "Origin X", dtOrgY As String = "Origin Y", dtOrgZ As String = "Origin Z"
'    Dim iCheckTrans As Boolean
'    Dim dist(1) As Double, junk(2) As Double, trash As Double
'    Dim position As Point3d, basePoint1 As NXOpen.Point3d = New Point3d(0.0, 0.0, 0.0)
'    Dim matrix As Matrix3x3, orientation1 As Matrix3x3
'    Dim ChuviObl As Double = 1200, ChuviHole As Double = 1000, ChuviOblSquare As Double = 1500
'    Dim OwningComp As Component, component1 As Assemblies.Component, theComponent As Assemblies.Component = Nothing
'    Dim iBody As NXOpen.Body
'    Const xlDown As Long = -4121
'    Dim basePart1 As BasePart, part1 As Part
'    Dim BodyCheck As Boolean, CoverZ As Boolean
'    Dim CheckExist As String = "D:\nxcad\scratch\VehiclePlanMacro\2022_DB_069\締結位置検知チェック.txt"
'    Dim iMessage As String = "「①データ収集(User)」のシートにデータを確認してImportボタンを押してください"
'    Dim iMessage1 As String = "「Output」のシートにデータを確認してImportボタンを押してください"
'    Dim iCheckCorrect As Boolean = True
'    Dim iPathDBBoltNut As String = "D:\nxcad\scratch\VehiclePlanMacro\2022_DB_069\締結DATABASE.csv"
'    'Dim iPathDBBoltNut As String = "D:\nxcad\scratch\DRG-LIST.csv"
'    Dim iDataBaseBoltNut As DataTable
'    Dim dtMenatsu As DataTable, iRowdtMentasu As Long = 3, iBangouMenatsu() As String, idemBangouMenatsu As Integer
'    Dim dtExcelOut As New DataTable
'    Dim iCheckBolt_Washer As Boolean = False, iCheckNut_Washer As Boolean = False        'Mặc định bolt k phải là rokkaku, nếu là rokkaku thì set true lên
'    'Dim iDimH As Double         'Kích thước H của Bolt Washer : 軸太径 (Đường kính trục)
'    Dim iDemMenNo As Integer
'    Dim iCheckExist As Boolean = False      'Biến check xem đã từng chạy menatsu chưa
'    '''Zentaizu
'    Dim OK_Color As Integer = 108, NG_Color As Integer = 186, CA_Color As Integer = 77, Other_Color As Integer = 103
'    Const ExcelLinkInput As String = "D:\nxcad\scratch\VehiclePlanMacro\2022_DB_069\締結チェックまとめファイル.xlsm"
'    Dim objExcelIn



'    Sub Main()

'        Dim theSession As Session = Session.GetSession()
'        lw = theSession.ListingWindow
'        Dim workpart As Part = theSession.Parts.Work
'        lw.Open()
'        Dim iRootNo As String = workpart.FullPath.ToString
'        Dim iRootPart As Part = workpart
'        Dim iFuncCount As Integer = 1

'        Dim iCheckAccount As Boolean
'        Try
'            CheckAccount(iCheckAccount)
'            If iCheckAccount = False Then
'                Exit Sub
'            End If
'        Catch ex As Exception

'        End Try

'        objWorkbook = objExcel.Workbooks.Open(ExcelOut)
'        objExcel.visible = True
'        objWsIn = objWorkbook.worksheets("Input")
'        objWsTool = objWorkbook.worksheets("①データ収集(Tool)")
'        objWsUser = objWorkbook.worksheets("①データ収集(User)")
'        ObjWsOut = objWorkbook.worksheets("Output")
'        ObjWsThickWaring = objWorkbook.worksheets("板厚付けWaring")
'        Dim InputInfor As String = objWorkbook.worksheets("Input").cells(6, 5).value

'        If InputInfor = "①データ収集" Then
'            'If CheckExcelImport(CheckExist, iMessage) = False Then Exit Sub
'            'Call C001_データ収集()

'        ElseIf InputInfor = "②締結位置検知" Then
'            'Call C001_データ収集()
'            'Call S010_締結位置検知()

'        ElseIf InputInfor = "③板厚付け" Then
'            'Call S010_締結位置検知()
'            Call C007_板厚付け()
'            Call C001_データ収集_板厚付け()
'            Call C001_データ収集_断面作成()

'        ElseIf InputInfor = "④断面作成" Then

'        ElseIf InputInfor = "⑤寸法測定" Then

'        ElseIf InputInfor = "⑥判定" Then

'        ElseIf InputInfor = "⑦データ収集のみ" Then
'            Call C001_データ収集()

'        ElseIf InputInfor = "⑧締結位置検知のみ" Then
'            'If CheckExcelImport(CheckExist, iMessage) = False Then Exit Sub
'            Call S010_締結位置検知()

'        ElseIf InputInfor = "⑨板厚付けのみ" Then
'            'If CheckExcelImport(CheckExist, iMessage) = False Then Exit Sub

'            Call C007_板厚付け()
'            Call C001_データ収集_板厚付け()
'            Call C001_データ収集_断面作成()


'        ElseIf InputInfor = "⑩断面作成のみ" Then
'            'If CheckExcelImport(CheckExist, iMessage1) = False Then Exit Sub
'            Call C000_断面作成_NewForm()

'        ElseIf InputInfor = "⑪寸法測定のみ" Then

'            Call D000_寸法測AndPMIづけ()

'        ElseIf InputInfor = "⑫判断のみ" Then

'            Call Take_Picture()

'        ElseIf InputInfor = "⑬面圧のみ" Then

'            Call GetDatabaseBoltNut(iPathDBBoltNut, iDataBaseBoltNut)
'            Call Create_Menatsu()

'        ElseIf InputInfor = "⑭全体図作成のみ" Then

'            Call Create_Zentaizu()

'        End If


'    End Sub

'    Sub CheckAccount(ByRef icheck As Boolean)
'        Dim theSession As Session = Session.GetSession()
'        lw = theSession.ListingWindow
'        lw.Open()
'        Dim ComputerName As String
'        'ComputerName = System.Environment.SystemDirectory
'        ComputerName = System.Environment.UserName
'        If InStr(ComputerName, "KNT") > 0 Then
'            'Dim oExUsr As Outlook.ExchangeUser
'            'Dim oApp As Outlook.Application
'            Dim objOutlook As Object
'            Dim objNamespace As Object
'            Dim objFolder As Object
'            Dim objMAil As Object

'            'OUTLOOL操作用オブジェクト
'            objOutlook = CreateObject("Outlook.Application")
'            objNamespace = objOutlook.GetNamespace("MAPI")

'            'デフォルトのフォルダを表示（OUTLOOK起動用）
'            objFolder = objNamespace.GetDefaultFolder(6)

'            'メールアイテムの作成
'            objMAil = objOutlook.CreateItem(0)

'            objMAil.To = ComputerName
'            'objMAil.To = "KNT07686"
'            'objMAil.CC = ToMaleCC
'            'objMAil.Subject = Kenmei
'            Dim GetDepartment As String
'            'GetDepartment = Split(objMAil.AddressEntry.GetExchangeUser.Department, ")")(0)
'            For Each oRecp As Object In objMAil.Recipients
'                'lw.WriteLine()
'                GetDepartment = Split(oRecp.AddressEntry.GetExchangeUser.Department, ")")(0)
'            Next
'            'lw.WriteLine(System.DateTime.Now.ToString("yyyy/MM/dd"))
'            If GetDepartment = "2VB" Then
'                icheck = True
'            ElseIf GetDepartment = "2VS" Or GetDepartment = "2VC" Then
'                'If System.DateTime.Now.ToString("yyyy/MM/dd") > System.DateTime.Parse("2023/05/31") Then
'                '    MsgBox("ツールトライアル期間を超えるので使用不可", vbExclamation)
'                '    icheck = False
'                '    Exit Sub
'                'Else
'                icheck = True
'                'End If

'            Else
'                MsgBox("ツール使用権限がない", vbExclamation)
'                icheck = False
'                Exit Sub
'            End If
'            objMAil = Nothing
'            objFolder = Nothing
'            objNamespace = Nothing
'            objOutlook = Nothing
'        Else
'            icheck = False
'            Exit Sub
'        End If
'    End Sub
'    ''' ModuleTa tạo độ dày 
'    ''Module tạo độ dày
'    Sub C007_板厚付け()

'        Call CreateNewWindow("Offset Data")

'        Dim theSession As Session = Session.GetSession()
'        Dim workpart As Part = theSession.Parts.Work
'        Dim dispPart As Part = theSession.Parts.Display

'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        Dim iRootcomp As Component = workpart.ComponentAssembly.RootComponent


'        'lw.WriteLine("top: " & workpart.GetStringAttribute("DB_PART_NO").ToString)
'        Dim iRootNo As String = workpart.GetStringAttribute("DB_PART_NO").ToString

'        Dim FuncS_Name As String
'        Dim AssyOut_No As String
'        Dim FuncS_No As String

'        Dim Op_Comp As Assemblies.Component
'        Dim OffsetList As New List(Of String)

'        objWsIn = objWorkbook.worksheets("Input")
'        Dim i As Integer, ii As Integer

'        Dim iSeachComp As String = "COMPONENT @DB/"
'        Dim iFunction As String

'        Dim iListDataSecret As New List(Of String)
'        Call DataBaseSecret(iListDataSecret)
'        Dim dtThickWaring As New DataTable
'        Call CreateThickWaringDatatable(dtThickWaring)


'        For i = 4 To 10000
'            If objWsUser.cells(i, "C").value = "" Then Exit For
'            If objWsUser.cells(i, "C").value = "A_車体" And Len(objWsUser.cells(i, "H").value) = 0 Then  '  Chỉ Offset 車体
'                iFunction = objWsUser.cells(i, "D").value
'                Try
'                    FuncS_Name = Left(Split(iFunction, "_")(1), 6)
'                Catch ex As Exception
'                    FuncS_Name = iFunction
'                End Try

'                theUFSession.Ui.SetPrompt("Offset Function: " & iFunction)
'                Dim iFuncThickName As String
'                Dim iFuncThickRev As String
'                Dim iFuncThickNo As String
'                If Left(iFunction, 1).ToUpper = "T" Then
'                    Dim iRev1 As String = GetRev(iFunction)
'                    Dim iVar As String = Split(iFunction, "_")(2)


'                    'FuncS_Name = FuncS_Name & "_" & iVar & "_" & iRev1

'                    Call GetPartName(iFunction, iFuncThickName)         'Lấy tên Function trực tiếp từ PDM 

'                    iFuncThickRev = GetRev(iFunction) 'Lấy tên Rev trực tiếp từ PDM 

'                    iFuncThickNo = iFunction.Replace("T", "") & "_" & iFuncThickRev & "#Thick_Test1"
'                Else
'                    Dim iRev1 As String = GetRev(iFunction)
'                    'Dim iVar As String = Split(iFunction, "_")(2)


'                    'FuncS_Name = FuncS_Name & "_" & iVar & "_" & iRev1

'                    Call GetPartName(iFunction, iFuncThickName)         'Lấy tên Function trực tiếp từ PDM 

'                    iFuncThickRev = GetRev(iFunction) 'Lấy tên Rev trực tiếp từ PDM 

'                    iFuncThickNo = iFunction & "_" & iFuncThickRev & "#Thick_Test1"

'                End If


'                'lw.WriteLine(iFuncThickNo.ToString)

'                If GetRev(iFuncThickNo) = "" Then

'                    Call CreateAssyNewLv2(FuncS_Name, Op_Comp)

'                    FuncS_No = Op_Comp.GetStringAttribute("DB_PART_NO").ToString & "/AA"

'                    Try
'                        AddComponentByNoPDM(FuncS_No, iFunction.ToString & "/" & GetRev(iFunction.ToString))
'                    Catch
'                        AddComponentByNoASSY(FuncS_No, iFunction.ToString & "/" & GetRev(iFunction.ToString))
'                    End Try

'                    theUFSession.Ui.SetPrompt("Load Data: " & Op_Comp.GetStringAttribute("DB_PART_NO").ToString)
'                    Call LoadAssyComponent(Op_Comp)
'                    Call HideCsys()
'                    Dim iThickAssy As Component
'                    Call CreateAssyNewLv2(FuncS_Name & "#Thick", iThickAssy)
'                    Call CopyThickPart(Op_Comp, dtThickWaring)

'                    workpart = theSession.Parts.Work
'                    dispPart = theSession.Parts.Display

'                    iSeachComp = "COMPONENT @DB/" & Op_Comp.GetStringAttribute("DB_PART_NO").ToString & "/AA 1"
'                    Dim component1 As NXOpen.Assemblies.Component = CType(dispPart.ComponentAssembly.RootComponent.FindObject(iSeachComp), NXOpen.Assemblies.Component)
'                    iSeachComp = "COMPONENT @DB/" & iThickAssy.GetStringAttribute("DB_PART_NO").ToString & "/AA 1"
'                    Dim component2 As NXOpen.Assemblies.Component = CType(component1.FindObject(iSeachComp), NXOpen.Assemblies.Component)



'                    'Tạo độ dày

'                    For Each Child As Component In iThickAssy.GetChildren
'                        Dim inamePart As String = Child.GetStringAttribute("DB_PART_NAME")
'                        Dim iPartNo As String = Child.GetStringAttribute("DB_PART_NO")
'                        Dim iRev As String
'                        Dim iCheckSecretData As Boolean = False
'                        For Each CheckSecretData As String In iListDataSecret

'                            If InStr(iPartNo, CheckSecretData) > 0 Then
'                                iCheckSecretData = True

'                            End If
'                        Next
'                        If iCheckSecretData = False Then
'                            Try
'                                iRev = Child.GetStringAttribute("DB_PART_REV")
'                            Catch ex As Exception
'                                iRev = ""
'                            End Try
'                            Dim tmpPartNo As String = iPartNo & "_#Thick_" & iRev



'                            If GetRev(tmpPartNo) <> "" Then

'                                'Dim tmpRev As String = "/" & GetRev(tmpPartNo)

'                                Try
'                                    Try
'                                        Call AddThickComponentByNoPDM(iThickAssy.GetStringAttribute("DB_PART_NO").ToString & "/AA", tmpPartNo & "/" & GetRev(tmpPartNo), Child)
'                                    Catch ex As Exception
'                                        Call AddThickComponentByNoASSY(iThickAssy.GetStringAttribute("DB_PART_NO").ToString & "/AA", tmpPartNo & "/" & GetRev(tmpPartNo), Child)
'                                    End Try

'                                    Dim markId21 As NXOpen.Session.UndoMarkId = Nothing
'                                    markId21 = theSession.SetUndoMark(NXOpen.Session.MarkVisibility.Visible, "Delete")
'                                    Dim objects1(0) As NXOpen.NXObject
'                                    objects1(0) = Child
'                                    Dim nErrs11 As Integer = Nothing
'                                    nErrs11 = theSession.UpdateManager.AddToDeleteList(objects1)
'                                    Dim notifyOnDelete21 As Boolean = Nothing
'                                    notifyOnDelete21 = theSession.Preferences.Modeling.NotifyOnDelete
'                                    Dim nErrs21 As Integer = Nothing
'                                    nErrs21 = theSession.UpdateManager.DoUpdate(markId21)
'                                Catch ex As Exception
'                                    lw.WriteLine(ex.ToString)
'                                End Try

'                            Else
'                                iSeachComp = "COMPONENT @DB/" & Child.GetStringAttribute("DB_PART_NO").ToString & "/" & iRev & " 1"
'                                Dim component3 As NXOpen.Assemblies.Component = CType(component2.FindObject(iSeachComp), NXOpen.Assemblies.Component)
'                                theSession.Parts.SetWorkComponent(component3, NXOpen.PartCollection.RefsetOption.Entire, NXOpen.PartCollection.WorkComponentOption.Visible, partLoadStatus1)
'                                workpart = theSession.Parts.Work ' G90010
'                                partLoadStatus1.Dispose()
'                                theUFSession.Ui.SetPrompt("Offset: " & Child.GetStringAttribute("DB_PART_NO").ToString)
'                                Call CreatePartOffset(Child, dtThickWaring)
'                                Call SaveData()
'                            End If
'                        End If

'                    Next

'                    theSession.Parts.SetWorkComponent(component2, NXOpen.PartCollection.RefsetOption.Entire, NXOpen.PartCollection.WorkComponentOption.Visible, partLoadStatus1)
'                    Try
'                        Dim DelNonThickPart() As NXOpen.NXObject
'                        Dim iCount As Integer = 0
'                        Dim markId2 As NXOpen.Session.UndoMarkId = Nothing
'                        markId2 = theSession.SetUndoMark(NXOpen.Session.MarkVisibility.Visible, "Delete")
'                        For Each iChil As Component In iThickAssy.GetChildren
'                            If InStr(iChil.GetStringAttribute("DB_PART_NO").ToString.ToUpper, "THICK") = 0 Then
'                                ReDim Preserve DelNonThickPart(iCount)
'                                DelNonThickPart(iCount) = iChil
'                                iCount = iCount + 1
'                            End If
'                        Next

'                        'objWorksheetIn.cells(i, "D").value = Now.ToString
'                        Dim nErrs1 As Integer = Nothing
'                        nErrs1 = theSession.UpdateManager.AddToDeleteList(DelNonThickPart)
'                        Dim notifyOnDelete2 As Boolean = Nothing
'                        notifyOnDelete2 = theSession.Preferences.Modeling.NotifyOnDelete
'                        Dim nErrs2 As Integer = Nothing
'                        nErrs2 = theSession.UpdateManager.DoUpdate(markId2)
'                    Catch ex As Exception

'                    End Try


'                    workpart = theSession.Parts.Work ' G90010
'                    partLoadStatus1.Dispose()


'                    Call SaveData()

'                    Call SaveAsNewNamePart(iFuncThickName, iFuncThickNo)
'                    objWsUser.cells(i, "H").value = iThickAssy.GetStringAttribute("DB_PART_NO").ToString
'                    Call SaveData()
'                    '' ''Exit Sub

'                    theSession.Parts.SetWorkComponent(iRootcomp, partLoadStatus1)
'                    partLoadStatus1.Dispose()
'                    'Call SaveData()

'                    'Call CloseComponent(Op_Comp)
'                Else

'                    Try
'                        AddComponentByNoPDM(iRootNo & "/AA", iFuncThickNo & "/" & GetRev(iFuncThickNo))

'                    Catch
'                        AddComponentByNoASSY(iRootNo & "/AA", iFuncThickNo & "/" & GetRev(iFuncThickNo))
'                    End Try

'                    objWsUser.cells(i, "H").value = iFuncThickNo
'                    'iFuncThickNo
'                    'Exit Sub
'                End If
'            End If
'        Next

'        theUFSession.Ui.SetPrompt("Offset 完成")

'        Dim j As Integer
'        For i = 4 To 10000
'            If objWsTool.cells(i, "D").value = "" Then Exit For
'            For j = 4 To 1000
'                If objWsUser.cells(j, "D").value = "" Then Exit For
'                If objWsTool.cells(i, "D").value = objWsUser.cells(j, "D").value Then
'                    objWsTool.cells(i, "I").value = objWsUser.cells(j, "H").value
'                    Exit For
'                End If
'            Next

'        Next
'        Call PrintThickWaring(dtThickWaring)

'    End Sub
'    ''Module tập hợp Data cắt Danmen
'    Sub C001_データ収集_断面作成()
'        Dim i As Integer, j As Integer, k As Integer

'        Dim theSession As Session = Session.GetSession()
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing

'        Call CreateNewWindow("Create Sect")

'        'Dim workPart = theSession.Parts.Work

'        Dim iCreateSectData As Component, iCarData As Component, iThickAssyData As Component

'        CreatTopAssyLv1("Create Sect Data", iCreateSectData)

'        Call CreateAssyNewLv2("Kakunou Data", iCarData)

'        theSession.Parts.SetWorkComponent(iCreateSectData, partLoadStatus1)

'        Call CreateAssyNewLv2("Kakunou Thick Data", iThickAssyData)
'        theSession.Parts.SetWorkComponent(iCreateSectData, partLoadStatus1)

'        Dim iThickAssy As String = iThickAssyData.GetStringAttribute("DB_PART_NO").ToString & "/AA"
'        Dim iKakuno As String = iCarData.GetStringAttribute("DB_PART_NO").ToString & "/AA"


'        Dim iAssyShuuhen As Component

'        For i = 4 To 10000
'            If objWsUser.cells(i, "D").value = "" Then Exit For
'            theUFSession.Ui.SetPrompt("データ収集: " & objWsUser.cells(i, "D").value)



'            Dim iOffsetNo As String = objWsUser.cells(i, "H").value
'            Dim iUserData As String = objWsUser.cells(i, "F").value
'            Dim iFunctionNo As String = objWsUser.cells(i, "D").value
'            Dim iHitoku As String = objWsUser.cells(i, "E").value

'            If objWsUser.cells(i, "H").value <> "" Then
'                Call AddCompoToAssy(iThickAssy, iOffsetNo)
'            End If

'            If iUserData <> "" Then
'                If iHitoku <> "" Then
'                    Try
'                        Call AddCompoToAssy(iKakuno, iFunctionNo)
'                        Call AddCompoToAssy(iKakuno, iUserData)
'                    Catch ex As Exception
'                        objWsUser.cells(i, "I") = iFunctionNo

'                    End Try

'                Else
'                    Try
'                        Call AddCompoToAssy(iKakuno, iUserData)
'                    Catch ex As Exception
'                        objWsUser.cells(i, "I") = iUserData
'                    End Try

'                End If

'            Else
'                lw.WriteLine("i: " & i & "  - Data: " & objWsUser.cells(i, "D").value)
'                Try
'                    Call AddCompoToAssy(iKakuno, iFunctionNo)
'                Catch ex As Exception

'                End Try

'            End If

'        Next
'        'Dim workPart = theSession.Parts.Work

'        'theUFSession.Assem.SetWorkOccurrence(Tag.Null)





'    End Sub
'    ''Module tập hợp data tạo độ dày
'    Sub C001_データ収集_板厚付け()
'        Dim i As Integer, j As Integer, k As Integer

'        Call CreateNewWindow("Tap hop Data co do day")
'        Dim iAssyShuuhen As Component

'        For i = 4 To 10000
'            If objWsTool.cells(i, "D").value = "" Then Exit For
'            theUFSession.Ui.SetPrompt("データ収集: 車体" & objWsTool.cells(i, "G").value & " 周辺: " & objWsTool.cells(i, "D").value)

'            Dim iOffsetNo As String = objWsTool.cells(i, "I").value
'            Dim iUserData As String = objWsTool.cells(i, "F").value
'            Dim iFunctionNo As String = objWsTool.cells(i, "D").value
'            Dim iHitoku As String = objWsTool.cells(i, "E").value


'            If objWsTool.cells(i, "C").value = "A_車体" Then

'                CreatTopAssyLv1(objWsTool.cells(i, "G").value, iAssyShuuhen)
'                objWsTool.cells(i, "J").value = iAssyShuuhen.GetStringAttribute("DB_PART_NO").ToString
'                Dim FuncS_No As String = iAssyShuuhen.GetStringAttribute("DB_PART_NO").ToString & "/AA"


'                If iUserData <> "" Then

'                    If iOffsetNo <> "" Then
'                        Call AddCompoToAssy(FuncS_No, iOffsetNo)
'                    End If

'                    If iHitoku <> "" Then
'                        Call AddCompoToAssy(FuncS_No, iUserData)
'                        Call AddCompoToAssy(FuncS_No, iFunctionNo)
'                    Else
'                        Call AddCompoToAssy(FuncS_No, iUserData)
'                    End If

'                Else
'                    Try
'                        Call AddCompoToAssy(FuncS_No, iFunctionNo)
'                    Catch ex As Exception
'                        objWsTool.cells(i, "C").value = "データ無"
'                    End Try

'                    If iOffsetNo <> "" Then
'                        Call AddCompoToAssy(FuncS_No, iOffsetNo)
'                    End If

'                End If

'            Else
'                Dim FuncS_No As String = iAssyShuuhen.GetStringAttribute("DB_PART_NO").ToString & "/AA"


'                If iUserData <> "" Then

'                    If iOffsetNo <> "" Then
'                        Call AddCompoToAssy(FuncS_No, iOffsetNo)
'                    End If

'                    If iHitoku <> "" Then
'                        Call AddCompoToAssy(FuncS_No, iUserData)
'                        Call AddCompoToAssy(FuncS_No, iFunctionNo)
'                    Else
'                        Call AddCompoToAssy(FuncS_No, iUserData)
'                    End If

'                Else
'                    Try
'                        Call AddCompoToAssy(FuncS_No, iFunctionNo)
'                    Catch ex As Exception
'                        objWsTool.cells(i, "C").value = "データ無"
'                    End Try


'                    If iOffsetNo <> "" Then
'                        Call AddCompoToAssy(FuncS_No, iOffsetNo)
'                    End If

'                End If
'            End If

'        Next


'        For i = 4 To 10000

'            If objWsTool.cells(i, "D").value = "" Then Exit For
'            If objWsTool.cells(i, "C").value = "A_車体" Then

'                For j = 4 To 10000
'                    If objWsTool.cells(i, "D").value = objWsUser.cells(j, "D").value Then
'                        objWsUser.cells(j, "G").value = objWsTool.cells(i, "J").value
'                        Exit For
'                    End If
'                Next
'            End If

'        Next
'    End Sub
'    ''Module tập hợp data
'    Sub C001_データ収集()
'        Dim theSession As Session = Session.GetSession()
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        Dim workpart As Part = theSession.Parts.Work
'        Dim iRootNo As String = workpart.FullPath.ToString
'        Dim iRootPart As Part = workpart
'        Dim iRootcomp As Component = workpart.ComponentAssembly.RootComponent

'        If System.IO.File.Exists("D:\nxcad\scratch\VehiclePlanMacro\2022_DB_069\締結位置検知チェック.txt") Then
'            Kill("D:\nxcad\scratch\VehiclePlanMacro\2022_DB_069\締結位置検知チェック.txt")
'        Else
'            MsgBox("「①データ収集(User)」のシートにデータを確認してImportボタンを押してください", vbExclamation)
'            Exit Sub
'        End If

'        Dim i As Integer, j As Integer, k As Integer

'        Call CreateNewWindow("Tap hop Data")
'        Dim iAssyShuuhen As Component

'        For i = 4 To 10000
'            If objWsTool.cells(i, "D").value = "" Then Exit For
'            theUFSession.Ui.SetPrompt("データ収集: 車体" & objWsTool.cells(i, "G").value & " 周辺: " & objWsTool.cells(i, "D").value)

'            If objWsTool.cells(i, "C").value = "A_車体" Then
'                CreatTopAssyLv1(objWsTool.cells(i, "G").value, iAssyShuuhen)


'                objWsTool.cells(i, "H").value = iAssyShuuhen.GetStringAttribute("DB_PART_NO").ToString

'                Dim FuncS_No As String = iAssyShuuhen.GetStringAttribute("DB_PART_NO").ToString & "/AA"


'                If objWsTool.cells(i, "F").value = "" Then
'                    Try
'                        AddComponentByNoPDM(FuncS_No, objWsTool.cells(i, "D").value.ToString & "/" & GetRev(objWsTool.cells(i, "D").value.ToString))
'                    Catch
'                        AddComponentByNoASSY(FuncS_No, objWsTool.cells(i, "D").value.ToString & "/" & GetRev(objWsTool.cells(i, "D").value.ToString))
'                    End Try

'                ElseIf objWsTool.cells(i, "F").value <> "" Then
'                    If objWsTool.cells(i, "E").value <> "" Then
'                        Try
'                            AddComponentByNoPDM(FuncS_No, objWsTool.cells(i, "D").value.ToString & "/" & GetRev(objWsTool.cells(i, "D").value.ToString))
'                        Catch
'                            AddComponentByNoASSY(FuncS_No, objWsTool.cells(i, "D").value.ToString & "/" & GetRev(objWsTool.cells(i, "D").value.ToString))
'                        End Try

'                        Try
'                            AddComponentByNoPDM(FuncS_No, objWsTool.cells(i, "F").value.ToString & "/" & GetRev(objWsTool.cells(i, "F").value.ToString))
'                        Catch
'                            AddComponentByNoASSY(FuncS_No, objWsTool.cells(i, "F").value.ToString & "/" & GetRev(objWsTool.cells(i, "F").value.ToString))
'                        End Try
'                    Else
'                        Try
'                            AddComponentByNoPDM(FuncS_No, objWsTool.cells(i, "F").value.ToString & "/" & GetRev(objWsTool.cells(i, "F").value.ToString))
'                        Catch
'                            AddComponentByNoASSY(FuncS_No, objWsTool.cells(i, "F").value.ToString & "/" & GetRev(objWsTool.cells(i, "F").value.ToString))
'                        End Try
'                    End If
'                End If

'            Else

'                Dim FuncS_No As String = iAssyShuuhen.GetStringAttribute("DB_PART_NO").ToString & "/AA"
'                If objWsTool.cells(i, "F").value = "" Then
'                    Try
'                        AddComponentByNoPDM(FuncS_No, objWsTool.cells(i, "D").value.ToString & "/" & GetRev(objWsTool.cells(i, "D").value.ToString))
'                    Catch
'                        AddComponentByNoASSY(FuncS_No, objWsTool.cells(i, "D").value.ToString & "/" & GetRev(objWsTool.cells(i, "D").value.ToString))
'                    End Try

'                ElseIf objWsTool.cells(i, "F").value <> "" Then
'                    If objWsTool.cells(i, "E").value <> "" Then
'                        Try
'                            AddComponentByNoPDM(FuncS_No, objWsTool.cells(i, "D").value.ToString & "/" & GetRev(objWsTool.cells(i, "D").value.ToString))
'                        Catch
'                            AddComponentByNoASSY(FuncS_No, objWsTool.cells(i, "D").value.ToString & "/" & GetRev(objWsTool.cells(i, "D").value.ToString))
'                        End Try

'                        Try
'                            AddComponentByNoPDM(FuncS_No, objWsTool.cells(i, "F").value.ToString & "/" & GetRev(objWsTool.cells(i, "F").value.ToString))
'                        Catch
'                            AddComponentByNoASSY(FuncS_No, objWsTool.cells(i, "F").value.ToString & "/" & GetRev(objWsTool.cells(i, "F").value.ToString))
'                        End Try
'                    Else
'                        Try
'                            AddComponentByNoPDM(FuncS_No, objWsTool.cells(i, "F").value.ToString & "/" & GetRev(objWsTool.cells(i, "F").value.ToString))
'                        Catch
'                            AddComponentByNoASSY(FuncS_No, objWsTool.cells(i, "F").value.ToString & "/" & GetRev(objWsTool.cells(i, "F").value.ToString))
'                        End Try
'                    End If
'                End If

'            End If

'        Next

'        For i = 4 To 10000
'            If objWsTool.cells(i, "D").value = "" Then Exit For
'            If objWsTool.cells(i, "H").value <> "" Then
'                For j = 4 To 10000
'                    If objWsTool.cells(i, "D").value = objWsUser.cells(j, "D").value Then
'                        objWsUser.cells(j, "G").value = objWsTool.cells(i, "H").value
'                        Exit For
'                    End If
'                Next
'            End If
'        Next
'        theSession.Parts.SetWorkComponent(iRootcomp, partLoadStatus1)
'    End Sub

'    Sub S010_締結位置検知()

'        'lw.WriteLine("Tim vi tri")
'        Dim theSession As Session = Session.GetSession()
'        Dim workpart As Part = theSession.Parts.Work
'        Dim iRootNo As String = workpart.FullPath.ToString
'        Dim iRootPart As Part = workpart
'        Dim iRootcomp As Component = workpart.ComponentAssembly.RootComponent
'        Dim dtFunctionIn As DataTable, dtFunctionShuuhen As DataTable, dtFunctionOffset As DataTable, dtGroupIn As DataTable
'        Dim iAfterNameThick As String

'        'Dim objWorksheetOut = objWorkbook.worksheets("断面作成")
'        Dim objWorksheetIn = objWorkbook.worksheets("Input")


'        Dim dtDanmenOut As DataTable, dtGroupOut As DataTable, dtGrOutLock As DataTable
'        'Call GetInput_CreateSect(dtFunctionIn)

'        '/////////// Tạo DataTable matome thông tin  締結 và DataTable vị trí Cắt↓↓↓↓↓↓↓
'        Call CreatePositionDataTable(dtGroupIn, dtDanmenOut)
'        dtGroupIn.AcceptChanges()

'        '///////////  load Function Input, lấy thông tin Csys và thông tin lỗ ↓↓↓↓↓↓↓

'        'lw.WriteLine("Vao function")
'        Call InforCsHole(dtGroupIn)


'        theUFSession.Ui.SetPrompt("CreateCsysGroup")
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        Dim status1 As NXOpen.PartCollection.SdpsStatus = Nothing
'        status1 = theSession.Parts.SetDisplay(iRootPart, False, True, partLoadStatus1)

'        '/////////// nhóm những tọa độ có khoảng cách 15 thành 1 nhóm ↓↓↓↓↓↓↓
'        'lw.WriteLine("Thoi gian bat dau Grouping : " & Now)
'        Call CreateCsysGroup(dtGroupIn, dtGroupOut)
'        dtGroupOut.AcceptChanges()
'        'lw.WriteLine("Thoi gian Ket thuc Grouping : " & Now)
'        Call FindHoleLock(dtGroupOut, dtGrOutLock)
'        dtGrOutLock.AcceptChanges()
'        '/////////// In bảng sau khi nhóm ra Excel ↓↓↓↓↓↓↓
'        Call iPrintDtGroupingOut(dtGrOutLock)
'        Call CopyPositionToSheetDanmenOut(dtGrOutLock, dtDanmenOut)
'        Call iPrintDanmenOut(dtDanmenOut)

'        '/////////// tạo Assy PMI Vị trí cắt ↓↓↓↓↓↓↓
'        Dim iAssyPMI As Component
'        Call CreatTopAssyLv1("PMIAssy Data", iAssyPMI)
'        theSession.Parts.SetWorkComponent(iAssyPMI, partLoadStatus1)
'        Call CreateAssyPositionInfor(dtDanmenOut, iAssyPMI)

'        status1 = theSession.Parts.SetDisplay(iRootPart, False, True, partLoadStatus1)
'        partLoadStatus1.Dispose()



'    End Sub

'    Sub C000_断面作成_NewForm()

'        Dim theSession As Session = Session.GetSession()

'        Dim nullNXOpen_Assemblies_Component As NXOpen.Assemblies.Component = Nothing
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        theSession.Parts.SetWorkComponent(nullNXOpen_Assemblies_Component, NXOpen.PartCollection.RefsetOption.Entire, NXOpen.PartCollection.WorkComponentOption.Visible, partLoadStatus1)
'        Dim workpart As Part = theSession.Parts.Work
'        Dim iRootNo As String = workpart.FullPath.ToString
'        Dim dtFunctionIn As DataTable, dtFunctionShuuhen As DataTable, dtFunctionOffset As DataTable, dtGroupIn As DataTable
'        Dim iAfterNameThick As String

'        Dim objWorksheetOut = objWorkbook.worksheets("Output")
'        Dim iRootPart As Part = workpart
'        Dim iRootcomp As Component = workpart.ComponentAssembly.RootComponent
'        Dim iSectionCheck As Boolean = False
'        Dim iSectionAuto As Component
'        Dim iCreateSectData As Component

'        Call ExpandComp(iRootcomp)

'        Call ExpandComp(iRootcomp)
'        'Call SetZenPart(iRootcomp)
'        Dim dtBox As DataTable
'        Dim dtBoxOut As DataTable
'        theUFSession.Ui.SetPrompt("CreateDataTableBox")
'        Call CreateDataTableBox(dtBox)

'        Dim llc() As Double = {5000000, 5000000, 5000000}
'        Dim urc() As Double = {-5000000, -5000000, -5000000}
'        Dim abs As CartesianCoordinateSystem = theSession.Parts.Work.CoordinateSystems.CreateCoordinateSystem(New Point3d(0, 0, 0), New Vector3d(1, 0, 0), New Vector3d(0, 1, 0))

'        theUFSession.Ui.SetPrompt("CalculateBoundingBox")
'        Call CalculateBoundingBox(iRootcomp, llc, urc, abs, dtBox, dtBoxOut)
'        dtBoxOut.AcceptChanges()
'        'Call PrintBoxWaring(dtBoxOut)

'        theUFSession.Obj.DeleteObject(abs.Tag)
'        Dim iCheckCreateSectData As Boolean = False
'        For Each iChild As Component In workpart.ComponentAssembly.RootComponent.GetChildren
'            If iChild.GetStringAttribute("DB_PART_NAME").ToString = "Create Sect Data" Then
'                iCheckCreateSectData = True
'                Exit For
'            End If

'        Next

'        theUFSession.Ui.SetPrompt("Start")

'        If iCheckCreateSectData = False Then
'            MsgBox("Create Sect Dataがない" & vbCrLf & "Create Sect Dataを作成ください", MsgBoxStyle.Exclamation)
'            Exit Sub
'        End If

'        For Each iChild As Component In iRootcomp.GetChildren
'            If iChild.GetStringAttribute("DB_PART_NAME").ToString = "Section Auto" Then
'                theSession.Parts.SetWorkComponent(iChild, partLoadStatus1)
'                iSectionAuto = CType(iChild, Component)
'                iSectionCheck = True
'            End If
'        Next

'        If iSectionCheck = False Then
'            theUFSession.Ui.SetPrompt("Create Section Auto")
'            Call CreateAssyNewLv2("Section Auto", iSectionAuto)
'            theUFSession.Assem.SetWorkOccurrence(iRootcomp.Tag)

'            theUFSession.Ui.SetPrompt("Create Section Auto Complete")
'        End If
'        theUFSession.Assem.SetWorkOccurrence(iSectionAuto.Tag)

'        Dim objWorksheetGr = objWorkbook.worksheets("締結グルーピング")

'        Dim icountdem As String = 1
'        Dim iSectCount As String = 0

'        Dim i As Integer, j As Integer
'        Dim iPreList As New List(Of String)

'        Dim iAssyList As New List(Of String)
'        theUFSession.Ui.SetPrompt("Cat Danmen")

'        Dim iListDataSecret As New List(Of String)

'        Call DataBaseSecret(iListDataSecret)
'        Dim iListDataDone As New List(Of String)


'        For i = 26 To 10000
'            If Len(objWorksheetOut.cells(i, "C").value) = 0 Then Exit Sub
'            If Len(objWorksheetOut.cells(i, "M").value) = 0 Then

'                Dim iFunction As String
'                theUFSession.Ui.SetPrompt("断面作成: " & objWorksheetOut.cells(i, "C").value)

'                iFunction = Left(Split(objWorksheetOut.cells(i, "D").value, "_")(1), 6)

'                Dim iNowList As New List(Of String)
'                If iSectCount = 0 Then
'                    theUFSession.Ui.SetPrompt("断面作成: " & objWorksheetOut.cells(i, "C").value & "Load Data")

'                    Try
'                        FindBoxNearArr(objWorksheetOut.cells(i, "F").value, objWorksheetOut.cells(i, "G").value, objWorksheetOut.cells(i, "H").value, iFunction, iNowList, dtBoxOut)
'                        iPreList = iNowList
'                        Call FindAndLoadArrPart(iSectionAuto.Tag, iNowList, iListDataSecret, iListDataDone)
'                        iSectCount = iSectCount + 1

'                    Catch ex As Exception

'                        lw.WriteLine("Loi: ")
'                        lw.WriteLine(ex.ToString)
'                        Exit Sub
'                    End Try

'                Else

'                    theUFSession.Ui.SetPrompt("断面作成: " & objWorksheetOut.cells(i, "C").value & "Load Data")
'                    FindBoxNearArr(objWorksheetOut.cells(i, "F").value, objWorksheetOut.cells(i, "G").value, objWorksheetOut.cells(i, "H").value, iFunction, iNowList, dtBoxOut)
'                    Call GetIntersectList(iPreList, iNowList, iSectionAuto.Tag, iListDataSecret, iListDataDone)
'                    iPreList = iNowList
'                    iSectCount = iSectCount + 1
'                End If

'                Call HideCsys()
'                Dim iSectDanmen As Component
'                Dim OutCs As Features.Feature
'                Dim ipoint1 As NXOpen.Point
'                Dim tmpCs As CartesianCoordinateSystem


'                Dim iPtStr As String
'                Dim xDirect As String, yDirect As String, OutCsysName As String, OutCsysLabel As String

'                iPtStr = CType(objWorksheetOut.cells(i, "F").value, Double) & "," & CType(objWorksheetOut.cells(i, "G").value, Double) & "," & CType(objWorksheetOut.cells(i, "H").value, Double)
'                xDirect = objWorksheetOut.cells(i, "K").value
'                yDirect = objWorksheetOut.cells(i, "L").value

'                Dim iSectName As String = "Sect_" & iFunction & "_" & objWorksheetOut.cells(i, "C").value
'                'lw.WriteLine("Bat dau tao mat cat: " & Now.ToString)

'                Call CreateAssyNewLv2(iSectName, iSectDanmen)

'                Call CreateCsysOutput(iPtStr, xDirect, yDirect, iSectName, iSectDanmen, Nothing)

'                Try
'                    CutDanmenNew(iSectName, iSectDanmen, iPtStr, xDirect, yDirect, OutCsysName, OutCs)
'                Catch ex As Exception

'                End Try
'                theUFSession.Assem.SetWorkOccurrence(iSectDanmen.Tag)

'                Call SaveData()
'                Try
'                    Call CloseComponent(iSectDanmen)
'                Catch ex As Exception
'                    Try
'                        Call ClosePart(iSectDanmen)
'                    Catch ex1 As Exception

'                    End Try
'                End Try
'                objWorksheetOut.cells(i, "B").value = Now.ToString
'                objWorksheetOut.cells(i, "M").value = iSectDanmen.GetStringAttribute("DB_PART_NO").ToString
'                theUFSession.Assem.SetWorkOccurrence(iSectionAuto.Tag)

'                'Exit Sub
'                Call SaveData()

'                Dim EIWToolLibrary = System.Reflection.Assembly.LoadFile("D:\nxcad\scratch\VehiclePlanMacro\VPG-Sysytem.dll")
'                Dim VPGToolList = System.Activator.CreateInstance(EIWToolLibrary.GetExportedTypes(0))

'                Try
'                    VPGToolList.VPG_System_Check()
'                Catch ex As Exception
'                    MsgBox("VPG-System.dllがありません", vbExclamation)
'                    Exit Sub
'                End Try
'                VPGToolList.aCountAAA("184")
'                'lw.WriteLine("")
'            End If
'        Next
'    End Sub

'    Sub D000_寸法測AndPMIづけ()
'        Dim theSession As Session = Session.GetSession()
'        Dim workpart As Part = theSession.Parts.Work
'        Dim iRootComp As Component = workpart.ComponentAssembly.RootComponent
'        Dim ObjWsOut = objWorkbook.worksheets("Output")
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing

'        Dim i As Integer
'        For i = 26 To 10000
'            Dim iGroup As String = ObjWsOut.cells(i, "C").value
'            If iGroup = "" Then Exit For
'            For Each iChild As Component In workpart.ComponentAssembly.RootComponent.GetChildren
'                If Right(iChild.GetStringAttribute("DB_PART_NAME").ToString, 6) = Right(iGroup, 6) Then

'                    theSession.Parts.SetWorkComponent(iChild, partLoadStatus1)
'                    Dim dtInforLineOut As New DataTable
'                    Call CreateInforLineDataTable(dtInforLineOut)
'                    Dim tmpCsys As NXOpen.CartesianCoordinateSystem
'                    'Lấy thông tin các curve trong Group
'                    Call TakeInforLine(dtInforLineOut, tmpCsys, iChild)

'                    'Call DelDuplicateCurve(dtInforLineOut)
'                    Dim iGroupTagList As New List(Of String)

'                    'Tìm các đường song song với trục Z của Csys
'                    Call FindLineNearCsys(dtInforLineOut, iGroupTagList)
'                    dtInforLineOut.AcceptChanges()

'                    'Tạo Datatable những đường song song với trục Z của Csys
'                    Dim iGrNameList As New List(Of String)
'                    Dim iGrSectList As New List(Of String)
'                    Dim iGrTagList As New List(Of String)
'                    'Lấy tên các GroupName

'                    Dim tmpDt As DataTable = dtInforLineOut
'                    Dim dtView3 As New DataView(tmpDt)
'                    dtView3.Sort = "d1"
'                    tmpDt = dtView3.ToTable
'                    For Each row As DataRow In tmpDt.Rows
'                        If iGrNameList.Contains(row("GroupName").ToString) = False Then
'                            iGrNameList.Add(row("GroupName").ToString)
'                        End If
'                        If iGrSectList.Contains(row("Sect").ToString) = False Then
'                            iGrSectList.Add(row("Sect").ToString)
'                        End If
'                        If iGrTagList.Contains(row("Group Tag").ToString) = False Then
'                            iGrTagList.Add(row("Group Tag").ToString)
'                        End If
'                    Next
'                    Try
'                        Call XoaTrung(iGrSectList, dtInforLineOut, iGrNameList)
'                    Catch ex As Exception

'                    End Try
'                    '''đo kích thước
'                    Dim iText As String
'                    'Call iPrintInforLine(dtInforLineOut.DefaultView.ToTable)
'                    Call 締結物確定(iGrSectList, iGrNameList, dtInforLineOut, dtInforLineOut, iText, tmpCsys, iGrTagList)
'                    'Call iPrintInforLine(dtInforLineOut.DefaultView.ToTable)
'                    'Exit Sub
'                    '''gắn PMI đo kích thước
'                    Call DimentionPMI_CreateCtrLine(iGrSectList, dtInforLineOut, tmpCsys, iChild, iText)
'                    ' '''Eport thông tin ra Excel
'                    Call ExportDirtoOutPut(dtInforLineOut, i)
'                    Call iPrintInforLine(dtInforLineOut.DefaultView.ToTable)

'                    Dim EIWToolLibrary = System.Reflection.Assembly.LoadFile("D:\nxcad\scratch\VehiclePlanMacro\VPG-Sysytem.dll")
'                    Dim VPGToolList = System.Activator.CreateInstance(EIWToolLibrary.GetExportedTypes(0))

'                    Try
'                        VPGToolList.VPG_System_Check()
'                    Catch ex As Exception
'                        MsgBox("VPG-System.dllがありません", vbExclamation)
'                        Exit Sub
'                    End Try
'                    VPGToolList.aCountAAA("183")



'                End If
'            Next
'        Next

'    End Sub

'    ''''Do Kich Thuoc Gan PMI

'    Sub GetGroupInfor(ByVal iGroup As Group, ByVal dtInforLineOut As DataTable, ByVal tmpCsys As CartesianCoordinateSystem, ByVal Object1Tag As Long, ByVal iChild As Component)
'        Dim TheUFsession As UFSession = UFSession.GetUFSession()
'        Dim NULLTAG As Tag = NXOpen.Tag.Null
'        Dim objectTag As Tag = NXOpen.Tag.Null
'        Dim group_count As Integer = 0
'        Dim group_list() As Group
'        Dim group_member_list() As Tag
'        Dim member_count As Integer
'        Dim iGroupLen As Double
'        Dim iSectName As String = iChild.GetStringAttribute("DB_PART_NAME").ToString

'        TheUFsession.Group.AskGroupData(iGroup.Tag, group_member_list, member_count)

'        For Each iTag As Tag In group_member_list
'            Dim iObj As NXObject = Nothing
'            iObj = NXObjectManager.Get(iTag)
'            Dim iCurve As Curve = CType(iObj, Curve)
'            iGroupLen = iCurve.GetLength

'            Dim StartPoint(2) As Double
'            Dim midPt(2) As Double
'            Dim EndPoint(2) As Double
'            TheUFsession.Modl.AskCurveProps(iCurve.Tag, 0, StartPoint, junk, junk, junk, trash, trash)
'            TheUFsession.Modl.AskCurveProps(iCurve.Tag, 0.5, midPt, junk, junk, junk, trash, trash)
'            TheUFsession.Modl.AskCurveProps(iCurve.Tag, 1, EndPoint, junk, junk, junk, trash, trash)

'            Dim iPt3dMid As New Point3d(midPt(0), midPt(1), midPt(2))
'            Dim iPt3dStr As New Point3d(StartPoint(0), StartPoint(1), StartPoint(2))
'            Dim iPt3dEnd As New Point3d(EndPoint(0), EndPoint(1), EndPoint(2))

'            Dim guess1(2) As Double
'            Dim guess2(2) As Double
'            Dim pt1(2) As Double
'            Dim pt2(2) As Double
'            Dim minDist As Double
'            Dim itypeLine As String = Split(iCurve.GetType.ToString, ".")(1)

'            TheUFsession.Modl.AskMinimumDist(iCurve.Tag, Object1Tag, 0, guess1, 0, guess2, minDist, pt1, pt2)
'            If InStr(iGroup.Name, "%") > 0 Then
'                'iGroup.SetName = Replace(iGroup.Name, "%", "^")

'                'iGroup.SetName = "aaa" ' Replace(iGroup.Name, "%", "^")

'                iGroup.SetName(Replace(iGroup.Name, "%", "^"))

'            End If
'            Call InsertToInforLineDataTable(iSectName, iGroup.Name, iGroup.Tag, iTag.ToString, iGroupLen, iPt3dStr, iPt3dEnd, iPt3dMid, itypeLine, minDist, 0, dtInforLineOut, tmpCsys)
'        Next

'    End Sub

'    Sub 締結物確定(ByVal iSectList As List(Of String), ByVal iGrNameList As List(Of String), ByVal dtInforLineOut As DataTable, ByRef InDt As DataTable, ByRef 締結タイプ As String, ByVal tmpCsys As CartesianCoordinateSystem, ByVal iGrTagList As List(Of String))
'        Dim i As Integer, j As Integer
'        Dim tmpScale As Double
'        Dim iGrCount As Integer = 1
'        ''''Xac dinh Bolt Nut Weld
'        Dim iCheckBolt As Boolean = False, iCheckXBT As Boolean = False, iCheckYBT As Boolean = False
'        Dim iCheckNut As Boolean = False, iCheckX As Boolean = False, iCheckY As Boolean = False
'        Dim iCheckScrew As Boolean = False, iCheckXSCR As Boolean = False, iCheckYSCR As Boolean = False
'        Dim iCheckClip As Boolean = False, iCheckXCL As Boolean = False, iCheckYCL As Boolean = False
'        Dim iCheckPin As Boolean = False, iCheckXPin As Boolean = False, iCheckYPin As Boolean = False
'        Dim iCheckRivet As Boolean = False, iCheckXRivet As Boolean = False, iCheckYRivet As Boolean = False
'        Dim iCheckGrom As Boolean = False, iCheckXGrom As Boolean = False, iCheckYGrom As Boolean = False
'        Dim iCheckPlug As Boolean = False, iCheckXPlug As Boolean = False, iCheckYPlug As Boolean = False
'        For Each iCheckRow As DataRow In dtInforLineOut.Rows
'            Dim itempThick As String
'            Try
'                itempThick = Split(iCheckRow("GroupName").ToString, "$")(3)
'            Catch ex As Exception
'            End Try
'            '''Check loại teiketsu là gì
'            ''' Check trong Data có Nut
'            If InStr(iCheckRow("GroupName").ToUpper, "NUT") > 0 And InStr(iCheckRow("GroupName").ToUpper, "CAP") = 0 And Len(itempThick) < 2 And iCheckRow("d1") < 10 And iCheckRow("a1") = "1" Then

'                If Right(iCheckRow("Sect").ToString, 1) = "X" Then
'                    iCheckX = True
'                ElseIf Right(iCheckRow("Sect").ToString, 1) = "Y" Then
'                    iCheckY = True
'                End If
'                '''Check trong Data có Nut ở 2 mặt X,Y
'                If iCheckX = True And iCheckY = True Then

'                    iCheckNut = True
'                    '''Check trong Data có Nutweld
'                    If InStr(iCheckRow("GroupName").ToUpper, "WELD") > 0 Then
'                        ''' Xác định Nut Bolt Weld 
'                        For Each iCheckB As DataRow In dtInforLineOut.Rows
'                            Dim itempThick1 As String
'                            Try
'                                itempThick1 = Split(iCheckB("GroupName").ToString, "$")(3)
'                            Catch ex As Exception
'                            End Try
'                            If InStr(iCheckB("GroupName").ToUpper, "BOLT") > 0 Or InStr(iCheckB("GroupName").ToUpper, "STUD-BALL") > 0 Then

'                                iCheckBolt = True
'                                iCheckB("Hole Type") = "BOLT"
'                                '締結タイプ = "BOLT_NUT-WELD"
'                                ''' Xác định Nut Screw Weld 
'                            ElseIf InStr(iCheckB("GroupName").ToUpper, "SCREW") > 0 Or InStr(iCheckRow("GroupName").ToUpper, "SCR") > 0 Then

'                                iCheckScrew = True
'                                iCheckB("Hole Type") = "SCREW"
'                                '締結タイプ = "SCREW_NUT-WELD"
'                            ElseIf InStr(iCheckB("GroupName").ToUpper, "NUT") > 0 And InStr(iCheckB("GroupName").ToUpper, "CAP") = 0 And Len(itempThick1) < 2 And iCheckB("d1") < 10 And iCheckB("a1") = "1" Then
'                                iCheckB("Hole Type") = "WELD_NUT"
'                            End If
'                        Next


'                    Else
'                        For Each iCheckB As DataRow In dtInforLineOut.Rows
'                            Dim itempThick1 As String
'                            Try
'                                itempThick1 = Split(iCheckB("GroupName").ToString, "$")(3)
'                            Catch ex As Exception
'                            End Try

'                            If InStr(iCheckB("GroupName").ToUpper, "BOLT") > 0 Or InStr(iCheckB("GroupName").ToUpper, "STUD-BALL") > 0 Then

'                                If InStr(iCheckB("GroupName").ToUpper, "WELD") > 0 Then

'                                    iCheckB("Hole Type") = "WELD_BOLT"
'                                    '締結タイプ = "BOLT-WELD_NUT"

'                                End If
'                                iCheckBolt = True
'                            ElseIf InStr(iCheckB("GroupName").ToUpper, "NUT") > 0 And InStr(iCheckB("GroupName").ToUpper, "CAP") = 0 And Len(itempThick1) < 2 And iCheckB("d1") < 10 And iCheckB("a1") = "1" Then
'                                iCheckB("Hole Type") = "NUT"

'                            End If
'                        Next
'                        'iCheckRow("Hole Type") = "NUT"

'                    End If
'                End If
'                '''Check trong Data có BOLT
'            ElseIf InStr(iCheckRow("GroupName").ToUpper, "BOLT") > 0 And iCheckRow("d1") < 15 Or InStr(iCheckRow("GroupName").ToUpper, "STUD-BALL") > 0 And iCheckRow("d1") < 15 Then
'                Dim iCheckDirBolt As Boolean
'                Call CheckDirCsysWithMono(iCheckRow("GroupName").ToString, dtInforLineOut, iCheckDirBolt)
'                If iCheckDirBolt = True Then
'                    If Right(iCheckRow("Sect").ToString, 1) = "X" Then
'                        iCheckXBT = True
'                    ElseIf Right(iCheckRow("Sect").ToString, 1) = "Y" Then
'                        iCheckYBT = True
'                    End If

'                    If iCheckXBT = True And iCheckYBT = True Then

'                        For Each iCheckB As DataRow In dtInforLineOut.Rows
'                            Dim itempThick1 As String
'                            Try
'                                itempThick1 = Split(iCheckB("GroupName").ToString, "$")(3)
'                            Catch ex As Exception
'                            End Try
'                            If InStr(iCheckB("GroupName").ToUpper, "NUT") > 0 And InStr(iCheckB("GroupName").ToUpper, "CAP") = 0 And Len(itempThick1) < 2 And iCheckB("d1") < 15 Then

'                            Else

'                                If InStr(iCheckB("GroupName").ToUpper, "WELD") > 0 And InStr(iCheckB("GroupName").ToUpper, "BOLT") > 0 Then
'                                    iCheckB("Hole Type") = "BOLT"
'                                ElseIf InStr(iCheckB("GroupName").ToUpper, "BOLT") > 0 Or InStr(iCheckB("GroupName").ToUpper, "STUD-BALL") > 0 Then
'                                    iCheckB("Hole Type") = "BOLT"
'                                End If
'                                iCheckBolt = True

'                            End If
'                        Next

'                    End If
'                End If


'            ElseIf InStr(iCheckRow("GroupName").ToUpper, "CLIP") > 0 Then
'                Dim iCheckDirCLIP As Boolean
'                Call CheckDirCsysWithMono(iCheckRow("GroupName").ToString, dtInforLineOut, iCheckDirCLIP)
'                If iCheckDirCLIP = True Then
'                    If Right(iCheckRow("Sect").ToString, 1) = "X" Then
'                        iCheckXCL = True
'                    ElseIf Right(iCheckRow("Sect").ToString, 1) = "Y" Then
'                        iCheckYCL = True
'                    End If

'                    If iCheckXCL = True And iCheckYCL = True Then

'                        iCheckClip = True
'                        For Each iCheckB As DataRow In dtInforLineOut.Rows
'                            If InStr(iCheckB("GroupName").ToUpper, "CLIP") > 0 Then

'                                iCheckB("Hole Type") = "CLIP"

'                            ElseIf InStr(iCheckB("GroupName").ToUpper, "BOLT") > 0 Then

'                                If InStr(iCheckB("GroupName").ToUpper, "WELD") > 0 Then

'                                    iCheckB("Hole Type") = "WELD_BOLT"
'                                    '締結タイプ = "BOLT-WELD_CLIP"

'                                End If
'                                iCheckBolt = True

'                            End If
'                        Next

'                    End If
'                End If


'            ElseIf InStr(iCheckRow("GroupName").ToUpper, "SCREW") > 0 Or InStr(iCheckRow("GroupName").ToUpper, "SCR") > 0 Then
'                If InStr(iCheckRow("GroupName").ToUpper, "GROMMET") = 0 Or InStr(iCheckRow("GroupName").ToUpper, "GROM") = 0 Then
'                    Dim iCheckDirSCR As Boolean
'                    Call CheckDirCsysWithMono(iCheckRow("GroupName").ToString, dtInforLineOut, iCheckDirSCR)
'                    If iCheckDirSCR = True Then
'                        If Right(iCheckRow("Sect").ToString, 1) = "X" Then
'                            iCheckXSCR = True
'                        ElseIf Right(iCheckRow("Sect").ToString, 1) = "Y" Then
'                            iCheckYSCR = True
'                        End If

'                        If iCheckXSCR = True And iCheckYSCR = True Then

'                            iCheckScrew = True
'                            For Each iCheckB As DataRow In dtInforLineOut.Rows
'                                If InStr(iCheckB("GroupName").ToUpper, "SCREW") > 0 Or InStr(iCheckB("GroupName").ToUpper, "SCR") > 0 Then
'                                    If InStr(iCheckB("GroupName").ToUpper, "GROMMET") = 0 Or InStr(iCheckB("GroupName").ToUpper, "GROM") = 0 Then
'                                        iCheckB("Hole Type") = "SCREW"
'                                    Else
'                                        iCheckB("Hole Type") = "GROM"
'                                    End If

'                                End If
'                            Next

'                        End If
'                    End If
'                End If



'            ElseIf InStr(iCheckRow("GroupName").ToUpper, "PIN") > 0 Or Left(iCheckRow("GroupName").ToString.ToUpper, 3) = "PIN" Then
'                Dim iCheckDirPin As Boolean
'                Call CheckDirCsysWithMono(iCheckRow("GroupName").ToString, dtInforLineOut, iCheckDirPin)
'                If iCheckDirPin = True Then
'                    If Right(iCheckRow("Sect").ToString, 1) = "X" Then
'                        iCheckXPin = True
'                    ElseIf Right(iCheckRow("Sect").ToString, 1) = "Y" Then
'                        iCheckYPin = True
'                    End If

'                    If iCheckXPin = True And iCheckYPin = True Then

'                        iCheckPin = True
'                        For Each iCheckB As DataRow In dtInforLineOut.Rows
'                            If InStr(iCheckB("GroupName").ToUpper, "PIN") > 0 Or Left(iCheckB("GroupName").ToString.ToUpper, 3) = "PIN" Then
'                                iCheckB("Hole Type") = "PIN"
'                            End If
'                        Next

'                    End If
'                End If
'            ElseIf InStr(iCheckRow("GroupName").ToUpper, "RIVET") > 0 Then
'                Dim iCheckDirRivet As Boolean
'                Call CheckDirCsysWithMono(iCheckRow("GroupName").ToString, dtInforLineOut, iCheckDirRivet)
'                If iCheckDirRivet = True Then
'                    If Right(iCheckRow("Sect").ToString, 1) = "X" Then
'                        iCheckXRivet = True
'                    ElseIf Right(iCheckRow("Sect").ToString, 1) = "Y" Then
'                        iCheckYRivet = True
'                    End If

'                    If iCheckXRivet = True And iCheckYRivet = True Then

'                        iCheckRivet = True
'                        For Each iCheckB As DataRow In dtInforLineOut.Rows
'                            If InStr(iCheckB("GroupName").ToUpper, "RIVET") > 0 Then
'                                iCheckB("Hole Type") = "RIVET"
'                            End If
'                        Next

'                    End If
'                End If
'            ElseIf InStr(iCheckRow("GroupName").ToUpper, "GROM") > 0 Or InStr(iCheckRow("GroupName").ToUpper, "GROMMET") > 0 Then
'                Dim iCheckDirGrom As Boolean
'                Call CheckDirCsysWithMono(iCheckRow("GroupName").ToString, dtInforLineOut, iCheckDirGrom)
'                If iCheckDirGrom = True Then
'                    If Right(iCheckRow("Sect").ToString, 1) = "X" Then
'                        iCheckXGrom = True
'                    ElseIf Right(iCheckRow("Sect").ToString, 1) = "Y" Then
'                        iCheckYGrom = True
'                    End If

'                    If iCheckXGrom = True And iCheckYGrom = True Then
'                        iCheckGrom = True
'                        For Each iCheckB As DataRow In dtInforLineOut.Rows
'                            If InStr(iCheckB("GroupName").ToUpper, "GROM") > 0 Or InStr(iCheckB("GroupName").ToUpper, "GROMMET") > 0 Then
'                                iCheckB("Hole Type") = "GROM"
'                            End If
'                        Next

'                    End If
'                End If

'            ElseIf InStr(iCheckRow("GroupName").ToUpper, "PLUG") > 0 Then
'                Dim iCheckDirPlug As Boolean
'                Call CheckDirCsysWithMono(iCheckRow("GroupName").ToString, dtInforLineOut, iCheckDirPlug)
'                If iCheckDirPlug = True Then
'                    If Right(iCheckRow("Sect").ToString, 1) = "X" Then
'                        iCheckXPlug = True
'                    ElseIf Right(iCheckRow("Sect").ToString, 1) = "Y" Then
'                        iCheckYPlug = True
'                    End If

'                    If iCheckXPlug = True And iCheckYPlug = True Then

'                        iCheckPlug = True
'                        For Each iCheckB As DataRow In dtInforLineOut.Rows
'                            If InStr(iCheckB("GroupName").ToUpper, "PLUG") > 0 Then
'                                iCheckB("Hole Type") = "PLUG"
'                            End If
'                        Next

'                    End If
'                End If
'            End If
'        Next
'        Call FindBoltNoName(iSectList, iGrNameList, dtInforLineOut, tmpCsys)
'        Dim iGroupNameListNew As New List(Of String)
'        For Each row As DataRow In dtInforLineOut.Rows
'            If iGroupNameListNew.Contains(row("GroupName").ToString) = False Then
'                iGroupNameListNew.Add(row("GroupName").ToString)
'            End If
'        Next
'        iGrNameList = iGroupNameListNew

'        '''''''BOLT NUT
'        If iCheckBolt = True And iCheckNut = True Then
'            締結タイプ = "BOLT_NUT"
'            Try
'                Call FindCtrLine(iSectList, iGrNameList, dtInforLineOut)
'            Catch ex As Exception

'            End Try
'            '''' tìm 2 đường của Nut gần Cs Song song với Trục Z
'            For Each iGrName As String In iGrNameList
'                Dim itempThick As String
'                Try
'                    itempThick = Split(iGrName, "$")(3)
'                Catch ex As Exception
'                End Try
'                If InStr(iGrName.ToUpper, "NUT") > 0 And InStr(iGrName.ToUpper, "CAP") = 0 And Len(itempThick) < 2 Then
'                    Try
'                        Call TakeInfor2Line(iGrName, dtInforLineOut, True)
'                    Catch ex As Exception
'                    End Try
'                End If
'            Next

'            '''' tìm 2 đường gần Cs Song song với Trục Z
'            Call FineInfor2LineNearCsys(iGrNameList, dtInforLineOut)
'            '''' Xác định Danmen Bolt Nut không có tên theo quy chuẩn(Trim data)
'            Try
'                Call FindDataTrim(iGrNameList, dtInforLineOut)
'            Catch ex As Exception
'            End Try
'            '''XÁC ĐỊNH BUHIN A,B
'            Dim icheckWeld As Boolean = False
'            For Each dtGr As DataRow In dtInforLineOut.Rows
'                If dtGr("Xg") <> 0 And dtGr("Hole Size").ToString = "WELD_NUT" And Right(dtGr("Sect").ToString, 1) = "X" Then
'                    Call FindABCData(dtInforLineOut, 3, "X", dtGr, "WELD_NUT")
'                    icheckWeld = True
'                ElseIf dtGr("Xg") <> 0 And dtGr("Hole Size").ToString = "WELD_NUT" And Right(dtGr("Sect").ToString, 1) = "Y" Then
'                    Call FindABCData(dtInforLineOut, 4, "Y", dtGr, "WELD_NUT")
'                    icheckWeld = True
'                ElseIf dtGr("Xg") <> 0 And dtGr("Hole Size").ToString = "WELD_BOLT" And Right(dtGr("Sect").ToString, 1) = "X" Then
'                    Call FindABCData(dtInforLineOut, 5, "X", dtGr, "WELD_BOLT")
'                    icheckWeld = True
'                ElseIf dtGr("Xg") <> 0 And dtGr("Hole Size").ToString = "WELD_BOLT" And Right(dtGr("Sect").ToString, 1) = "Y" Then
'                    Call FindABCData(dtInforLineOut, 6, "Y", dtGr, "WELD_BOLT")
'                    icheckWeld = True
'                End If
'            Next
'            If icheckWeld = False Then
'                Dim iCheckHex As Boolean = False
'                For Each iSect As String In iSectList
'                    For Each dtGr As DataRow In dtInforLineOut.Rows
'                        If InStr(dtGr("Hole Type").ToString, "BOLT") > 0 Then
'                            If InStr(dtGr("GroupName").ToString, "HEX") > 0 Or InStr(dtGr("GroupName").ToString, "FLG") > 0 Then
'                                For Each dtGr1 As DataRow In dtInforLineOut.Rows
'                                    If InStr(dtGr1("Hole Type").ToString, "NUT") > 0 And dtGr1("Xg") <> 0 And dtGr1("Sect").ToString = iSect And Right(dtGr1("Sect").ToString, 1) = "X" Then
'                                        Call FindABCData(dtInforLineOut, 3, "X", dtGr1, "WELD_NUT")
'                                        iCheckHex = True
'                                    ElseIf InStr(dtGr1("Hole Type").ToString, "NUT") > 0 And dtGr1("Xg") <> 0 And dtGr1("Sect").ToString = iSect And Right(dtGr1("Sect").ToString, 1) = "Y" Then
'                                        Call FindABCData(dtInforLineOut, 4, "Y", dtGr1, "WELD_NUT")
'                                        iCheckHex = True

'                                    End If
'                                Next
'                                Exit For
'                            End If
'                        ElseIf InStr(dtGr("Hole Type").ToString, "NUT") > 0 Then
'                            If InStr(dtGr("GroupName").ToString, "HEX") > 0 Or InStr(dtGr("GroupName").ToString, "FLG") > 0 Then
'                                For Each dtGr1 As DataRow In dtInforLineOut.Rows
'                                    If InStr(dtGr1("Hole Type").ToString, "NUT") > 0 And dtGr1("Xg") <> 0 And dtGr1("Sect").ToString = iSect And Right(dtGr1("Sect").ToString, 1) = "X" Then
'                                        Call FindABCData(dtInforLineOut, 3, "X", dtGr1, "WELD_BOLT")
'                                        iCheckHex = True
'                                    ElseIf InStr(dtGr1("Hole Type").ToString, "NUT") > 0 And dtGr1("Xg") <> 0 And dtGr1("Sect").ToString = iSect And Right(dtGr1("Sect").ToString, 1) = "Y" Then
'                                        Call FindABCData(dtInforLineOut, 4, "Y", dtGr1, "WELD_BOLT")
'                                        iCheckHex = True
'                                    End If
'                                Next
'                                Exit For
'                            End If
'                        End If
'                    Next
'                Next
'                If iCheckHex = False Then
'                    For Each iSect As String In iSectList
'                        For Each dtGr As DataRow In dtInforLineOut.Rows
'                            If dtGr("Hole Size").ToString <> "" And dtGr("Xg") = 0 And dtGr("Sect").ToString = iSect And Right(dtGr("Sect").ToString, 1) = "X" Then
'                                Call FindABCData(dtInforLineOut, 3, "X", dtGr, "EMTRY")
'                                Exit For
'                            ElseIf dtGr("Hole Size").ToString <> "" And dtGr("Xg") = 0 And dtGr("Sect").ToString = iSect And Right(dtGr("Sect").ToString, 1) = "Y" Then
'                                Call FindABCData(dtInforLineOut, 4, "Y", dtGr, "EMTRY")
'                                Exit For
'                            End If
'                        Next
'                    Next
'                End If

'            End If
'            '''''Do kích thước bước ren
'            'Call DirThreadDim(iSectList, iGrNameList, dtInforLineOut, tmpCsys)
'            Try
'                Call DirThreadDim(iSectList, iGrNameList, dtInforLineOut, tmpCsys)
'            Catch ex As Exception
'            End Try

'            '''' xac dinh lo tron hay obl

'            'Call iPrintInforLine(dtInforLineOut)
'            Call FindTypeHole(iSectList, iGrNameList, dtInforLineOut)


'            '''' Tìm khoảng cách Bolt đến chi tiết xung quanh 
'            Call FindLineBoltCL(iSectList, dtInforLineOut, iGrNameList, tmpCsys)

'            '''''''Có mình Nut
'        ElseIf iCheckBolt = False And iCheckNut = True And iCheckScrew = False Then

'            '''' tìm 2 đường gần Cs Song song với Trục Z
'            Try
'                Call FindCtrLine(iSectList, iGrNameList, dtInforLineOut)
'            Catch ex As Exception

'            End Try

'            For Each iGrName As String In iGrNameList
'                Dim itempThick As String
'                Try
'                    itempThick = Split(iGrName, "$")(3)
'                Catch ex As Exception
'                End Try
'                If InStr(iGrName.ToUpper, "NUT") > 0 And InStr(iGrName.ToUpper, "CAP") = 0 And Len(itempThick) < 2 Then
'                    Try
'                        Call TakeInfor2Line(iGrName, dtInforLineOut, True)
'                    Catch ex As Exception
'                    End Try
'                End If
'            Next

'            Call FineInfor2LineNearCsys(iGrNameList, dtInforLineOut)
'            '''' Xác định Danmen Bolt Nut không có tên theo quy chuẩn(Trim data)
'            Try
'                Call FindDataTrim(iGrNameList, dtInforLineOut)
'            Catch ex As Exception
'            End Try
'            '''XÁC ĐỊNH BUHIN A,B
'            Dim icheckWeld As Boolean = False
'            For Each iSect As String In iSectList
'                For Each dtGr As DataRow In dtInforLineOut.Rows
'                    If InStr(dtGr("Hole Type").ToString, "NUT") > 0 And Right(dtGr("Sect").ToString, 1) = "X" And dtGr("Sect").ToString = iSect Then
'                        If InStr(dtGr("GroupName").ToString, "WELD") > 0 Then
'                            If dtGr("Xg") <> 0 Then
'                                Call FindABCData(dtInforLineOut, 3, "X", dtGr, "WELD_NUT")
'                                icheckWeld = True
'                                Exit For
'                            End If

'                        ElseIf InStr(dtGr("GroupName").ToString, "WELD") = 0 Then
'                            Call FindABCData(dtInforLineOut, 3, "X", dtGr, "NUT")
'                            icheckWeld = True
'                            'dtGr("Hole Size") = "NUT"
'                            Exit For
'                        End If

'                    ElseIf InStr(dtGr("Hole Type").ToString, "NUT") > 0 And Right(dtGr("Sect").ToString, 1) = "Y" And dtGr("Sect").ToString = iSect Then
'                        If InStr(dtGr("GroupName").ToString, "WELD") > 0 Then
'                            If dtGr("Xg") <> 0 Then
'                                Call FindABCData(dtInforLineOut, 4, "Y", dtGr, "WELD_NUT")
'                                icheckWeld = True
'                                Exit For
'                            End If
'                        ElseIf InStr(dtGr("GroupName").ToString, "WELD") = 0 Then
'                            Call FindABCData(dtInforLineOut, 4, "Y", dtGr, "NUT")
'                            icheckWeld = True
'                            Exit For
'                        End If

'                    End If
'                Next
'            Next
'            If icheckWeld = False Then
'                For Each iSect As String In iSectList
'                    For Each dtGr As DataRow In dtInforLineOut.Rows
'                        If dtGr("Hole Size").ToString <> "" And dtGr("Xg") = 0 And dtGr("Sect").ToString = iSect And Right(dtGr("Sect").ToString, 1) = "X" Then
'                            Call FindABCData(dtInforLineOut, 3, "X", dtGr, "EMTRY")
'                            Exit For
'                        ElseIf dtGr("Hole Size").ToString <> "" And dtGr("Xg") = 0 And dtGr("Sect").ToString = iSect And Right(dtGr("Sect").ToString, 1) = "Y" Then
'                            Call FindABCData(dtInforLineOut, 4, "Y", dtGr, "EMTRY")
'                            Exit For
'                        End If
'                    Next
'                Next

'            End If
'            '''' xac dinh lo tron hay obl
'            Call FindTypeHole(iSectList, iGrNameList, dtInforLineOut)

'            '''''''Có mình Bolt
'        ElseIf iCheckScrew = True And iCheckNut = True Then
'            締結タイプ = "BOLT_NUT"
'            '''' tìm 2 đường gần Cs Song song với Trục Z

'            '''' tìm 2 đường gần Cs Song song với Trục Z
'            Try
'                Call FindCtrLine(iSectList, iGrNameList, dtInforLineOut)
'            Catch ex As Exception

'            End Try

'            For Each iGrName As String In iGrNameList
'                Dim itempThick As String
'                Try
'                    itempThick = Split(iGrName, "$")(3)
'                Catch ex As Exception
'                End Try
'                If InStr(iGrName.ToUpper, "NUT") > 0 And InStr(iGrName.ToUpper, "CAP") = 0 And Len(itempThick) < 2 Then
'                    Try
'                        Call TakeInfor2Line(iGrName, dtInforLineOut, True)
'                    Catch ex As Exception
'                    End Try
'                End If
'            Next

'            Call FineInfor2LineNearCsys(iGrNameList, dtInforLineOut)
'            '''' Xác định Danmen Bolt Nut không có tên theo quy chuẩn(Trim data)
'            Try
'                Call FindDataTrim(iGrNameList, dtInforLineOut)
'            Catch ex As Exception
'            End Try
'            '''XÁC ĐỊNH BUHIN A,B
'            ''' 
'            Dim icheckWeld As Boolean = False
'            For Each iSect As String In iSectList
'                For Each dtGr As DataRow In dtInforLineOut.Rows
'                    If InStr(dtGr("Hole Type").ToString, "NUT") > 0 And Right(dtGr("Sect").ToString, 1) = "X" And dtGr("Sect").ToString = iSect Then
'                        If dtGr("Xg") <> 0 Then
'                            Call FindABCData(dtInforLineOut, 3, "X", dtGr, "WELD_NUT")
'                            icheckWeld = True
'                            Exit For
'                        End If
'                    ElseIf InStr(dtGr("Hole Type").ToString, "NUT") > 0 And Right(dtGr("Sect").ToString, 1) = "Y" And dtGr("Sect").ToString = iSect Then
'                        If dtGr("Xg") <> 0 Then
'                            Call FindABCData(dtInforLineOut, 4, "Y", dtGr, "WELD_NUT")
'                            icheckWeld = True
'                            Exit For
'                        End If
'                    End If
'                Next
'            Next
'            If icheckWeld = False Then
'                For Each iSect As String In iSectList
'                    For Each dtGr As DataRow In dtInforLineOut.Rows
'                        If dtGr("Hole Size").ToString <> "" And dtGr("Xg") = 0 And dtGr("Sect").ToString = iSect And Right(dtGr("Sect").ToString, 1) = "X" Then
'                            Call FindABCData(dtInforLineOut, 3, "X", dtGr, "EMTRY")
'                            Exit For
'                        ElseIf dtGr("Hole Size").ToString <> "" And dtGr("Xg") = 0 And dtGr("Sect").ToString = iSect And Right(dtGr("Sect").ToString, 1) = "Y" Then
'                            Call FindABCData(dtInforLineOut, 4, "Y", dtGr, "EMTRY")
'                            Exit For
'                        End If
'                    Next
'                Next

'            End If


'            Try
'                Call DirThreadDim(iSectList, iGrNameList, dtInforLineOut, tmpCsys)
'            Catch ex As Exception
'            End Try

'            '''' xac dinh lo tron hay obl
'            Call FindTypeHole(iSectList, iGrNameList, dtInforLineOut)

'            '''' Tìm khoảng cách Bolt đến chi tiết xung quanh 
'            Call FindLineBoltCL(iSectList, dtInforLineOut, iGrNameList, tmpCsys)


'            '''''''Có mình Pin
'        ElseIf iCheckBolt = True And iCheckNut = False And iCheckClip = False Then
'            '''' tìm 2 đường gần Cs Song song với Trục Z
'            Try
'                Call FindCtrLine(iSectList, iGrNameList, dtInforLineOut)
'            Catch ex As Exception

'            End Try


'            Call FineInfor2LineNearCsys(iGrNameList, dtInforLineOut)
'            '''' Xác định Danmen Bolt Nut không có tên theo quy chuẩn(Trim data)
'            Try
'                Call FindDataTrim(iGrNameList, dtInforLineOut)
'            Catch ex As Exception
'            End Try
'            '''XÁC ĐỊNH BUHIN A,B
'            For Each iSect As String In iSectList
'                For Each dtGr As DataRow In dtInforLineOut.Rows
'                    If InStr(dtGr("Hole Type").ToString, "BOLT") > 0 And Right(dtGr("Sect").ToString, 1) = "X" And dtGr("Sect").ToString = iSect Then
'                        If InStr(dtGr("Hole Type").ToString, "WELD") > 0 Then
'                            Call FindABCData(dtInforLineOut, 3, "X", dtGr, "BOLT")
'                            dtGr("Hole Size") = "BOLT"
'                            Exit For
'                        Else
'                            Call FindABCData(dtInforLineOut, 3, "X", dtGr, "BOLT")
'                            dtGr("Hole Size") = "BOLT"
'                            Exit For
'                        End If

'                        Exit For
'                    ElseIf InStr(dtGr("Hole Type").ToString, "BOLT") > 0 And Right(dtGr("Sect").ToString, 1) = "Y" And dtGr("Sect").ToString = iSect Then
'                        If InStr(dtGr("Hole Type").ToString, "WELD") > 0 Then
'                            Call FindABCData(dtInforLineOut, 4, "Y", dtGr, "BOLT")
'                            dtGr("Hole Size") = "BOLT"
'                            Exit For
'                        Else
'                            Call FindABCData(dtInforLineOut, 4, "Y", dtGr, "BOLT")
'                            dtGr("Hole Size") = "BOLT"
'                            Exit For
'                        End If

'                    End If
'                Next
'            Next

'            '''' xac dinh lo tron hay obl
'            Call FindTypeHole(iSectList, iGrNameList, dtInforLineOut)

'            '''' Tìm khoảng cách Bolt đến chi tiết xung quanh 
'            Call FindLineBoltCL(iSectList, dtInforLineOut, iGrNameList, tmpCsys)
'            '''''''Có mình screw
'        ElseIf iCheckScrew = True And iCheckGrom = False And iCheckNut = False Then
'            '''' tìm 2 đường gần Cs Song song với Trục Z

'            Try
'                Call FindCtrLine(iSectList, iGrNameList, dtInforLineOut)
'            Catch ex As Exception

'            End Try


'            Call FineInfor2LineNearCsys(iGrNameList, dtInforLineOut)
'            '''' Xác định Danmen Bolt Nut không có tên theo quy chuẩn(Trim data)
'            Try
'                Call FindDataTrim(iGrNameList, dtInforLineOut)
'            Catch ex As Exception
'            End Try
'            '''XÁC ĐỊNH BUHIN A,B
'            For Each iSect As String In iSectList
'                For Each dtGr As DataRow In dtInforLineOut.Rows
'                    If dtGr("Hole Type").ToString = "SCREW" And Right(dtGr("Sect").ToString, 1) = "X" And dtGr("Sect").ToString = iSect Then
'                        Call FindABCData(dtInforLineOut, 3, "X", dtGr, "SCREW")
'                        Exit For
'                    ElseIf dtGr("Hole Type").ToString = "SCREW" And Right(dtGr("Sect").ToString, 1) = "Y" And dtGr("Sect").ToString = iSect Then
'                        Call FindABCData(dtInforLineOut, 4, "Y", dtGr, "SCREW")
'                        Exit For
'                    End If
'                Next
'            Next

'            '''' xac dinh lo tron hay obl
'            Call FindTypeHole(iSectList, iGrNameList, dtInforLineOut)
'            '''' Tìm khoảng cách Bolt đến chi tiết xung quanh 
'            Call FindLineBoltCL(iSectList, dtInforLineOut, iGrNameList, tmpCsys)

'        ElseIf iCheckScrew = True And iCheckGrom = True Then
'            '''' tìm 2 đường gần Cs Song song với Trục Z

'            Try
'                Call FindCtrLine(iSectList, iGrNameList, dtInforLineOut)
'            Catch ex As Exception

'            End Try


'            Call FineInfor2LineNearCsys(iGrNameList, dtInforLineOut)
'            '''' Xác định Danmen Bolt Nut không có tên theo quy chuẩn(Trim data)
'            Try
'                Call FindDataTrim(iGrNameList, dtInforLineOut)
'            Catch ex As Exception
'            End Try
'            '''XÁC ĐỊNH BUHIN A,B
'            For Each iSect As String In iSectList
'                For Each dtGr As DataRow In dtInforLineOut.Rows
'                    If dtGr("Hole Type").ToString = "GROM" And Right(dtGr("Sect").ToString, 1) = "X" And dtGr("Sect").ToString = iSect Then
'                        Call FindABCData(dtInforLineOut, 3, "X", dtGr, "GROM")
'                        Exit For
'                    ElseIf dtGr("Hole Type").ToString = "GROM" And Right(dtGr("Sect").ToString, 1) = "Y" And dtGr("Sect").ToString = iSect Then
'                        Call FindABCData(dtInforLineOut, 4, "Y", dtGr, "GROM")
'                        Exit For
'                    End If
'                Next
'            Next

'            '''' xac dinh lo tron hay obl
'            Call FindTypeHole(iSectList, iGrNameList, dtInforLineOut)

'            '''' Tìm khoảng cách Bolt đến chi tiết xung quanh 
'            Call FindLineBoltCL(iSectList, dtInforLineOut, iGrNameList, tmpCsys)
'            '''''''Có mình Pin
'        ElseIf iCheckPin = True And iCheckGrom = False Then
'            '''' tìm 2 đường gần Cs Song song với Trục Z
'            Try
'                Call FindCtrLine(iSectList, iGrNameList, dtInforLineOut)
'            Catch ex As Exception

'            End Try


'            Call FineInfor2LineNearCsys(iGrNameList, dtInforLineOut)
'            '''' Xác định Danmen Bolt Nut không có tên theo quy chuẩn(Trim data)
'            Try
'                Call FindDataTrim(iGrNameList, dtInforLineOut)
'            Catch ex As Exception
'            End Try
'            '''XÁC ĐỊNH BUHIN A,B
'            For Each iSect As String In iSectList
'                For Each dtGr As DataRow In dtInforLineOut.Rows
'                    If dtGr("Hole Type").ToString = "PIN" And Right(dtGr("Sect").ToString, 1) = "X" And dtGr("Sect").ToString = iSect Then
'                        Call FindABCData(dtInforLineOut, 3, "X", dtGr, "PIN")
'                        Exit For
'                    ElseIf dtGr("Hole Type").ToString = "PIN" And Right(dtGr("Sect").ToString, 1) = "Y" And dtGr("Sect").ToString = iSect Then
'                        Call FindABCData(dtInforLineOut, 4, "Y", dtGr, "PIN")
'                        Exit For
'                    End If
'                Next
'            Next

'            '''' xac dinh lo tron hay obl
'            Call FindTypeHole(iSectList, iGrNameList, dtInforLineOut)
'            '''' Tìm khoảng cách Bolt đến chi tiết xung quanh 
'            Call FindLineBoltCL(iSectList, dtInforLineOut, iGrNameList, tmpCsys)
'        ElseIf iCheckRivet = True Then
'            '''' tìm 2 đường gần Cs Song song với Trục Z
'            Try
'                Call FindCtrLine(iSectList, iGrNameList, dtInforLineOut)
'            Catch ex As Exception

'            End Try


'            Call FineInfor2LineNearCsys(iGrNameList, dtInforLineOut)
'            '''' Xác định Danmen Bolt Nut không có tên theo quy chuẩn(Trim data)
'            Try
'                Call FindDataTrim(iGrNameList, dtInforLineOut)
'            Catch ex As Exception
'            End Try
'            '''XÁC ĐỊNH BUHIN A,B
'            For Each iSect As String In iSectList
'                For Each dtGr As DataRow In dtInforLineOut.Rows
'                    If dtGr("Hole Type").ToString = "RIVET" And Right(dtGr("Sect").ToString, 1) = "X" And dtGr("Sect").ToString = iSect Then
'                        Call FindABCData(dtInforLineOut, 3, "X", dtGr, "RIVET")
'                        Exit For
'                    ElseIf dtGr("Hole Type").ToString = "RIVET" And Right(dtGr("Sect").ToString, 1) = "Y" And dtGr("Sect").ToString = iSect Then
'                        Call FindABCData(dtInforLineOut, 4, "Y", dtGr, "RIVET")
'                        Exit For
'                    End If
'                Next
'            Next

'            '''' xac dinh lo tron hay obl
'            Call FindTypeHole(iSectList, iGrNameList, dtInforLineOut)



'        ElseIf iCheckGrom = True And iCheckScrew = False And iCheckPin = False Then
'            '''' tìm 2 đường gần Cs Song song với Trục Z
'            Try
'                Call FindCtrLine(iSectList, iGrNameList, dtInforLineOut)
'            Catch ex As Exception

'            End Try


'            Call FineInfor2LineNearCsys(iGrNameList, dtInforLineOut)
'            '''' Xác định Danmen Bolt Nut không có tên theo quy chuẩn(Trim data)
'            Try
'                Call FindDataTrim(iGrNameList, dtInforLineOut)
'            Catch ex As Exception
'            End Try
'            '''XÁC ĐỊNH BUHIN A,B
'            For Each iSect As String In iSectList
'                For Each dtGr As DataRow In dtInforLineOut.Rows
'                    If dtGr("Hole Type").ToString = "GROM" And Right(dtGr("Sect").ToString, 1) = "X" And dtGr("Sect").ToString = iSect Then
'                        Call FindABCData(dtInforLineOut, 3, "X", dtGr, "GROM")
'                        Exit For
'                    ElseIf dtGr("Hole Type").ToString = "GROM" And Right(dtGr("Sect").ToString, 1) = "Y" And dtGr("Sect").ToString = iSect Then
'                        Call FindABCData(dtInforLineOut, 4, "Y", dtGr, "GROM")
'                        Exit For
'                    End If
'                Next
'            Next

'            '''' xac dinh lo tron hay obl
'            Call FindTypeHole(iSectList, iGrNameList, dtInforLineOut)
'        ElseIf iCheckGrom = True And iCheckScrew = False And iCheckPin = True Then
'            '''' tìm 2 đường gần Cs Song song với Trục Z
'            Try
'                Call FindCtrLine(iSectList, iGrNameList, dtInforLineOut)
'            Catch ex As Exception

'            End Try


'            Call FineInfor2LineNearCsys(iGrNameList, dtInforLineOut)
'            '''' Xác định Danmen Bolt Nut không có tên theo quy chuẩn(Trim data)
'            Try
'                Call FindDataTrim(iGrNameList, dtInforLineOut)
'            Catch ex As Exception
'            End Try
'            'Call iPrintInforLine(dtInforLineOut.DefaultView.ToTable)
'            '''XÁC ĐỊNH BUHIN A,B
'            For Each iSect As String In iSectList
'                For Each dtGr As DataRow In dtInforLineOut.Rows
'                    If dtGr("Hole Type").ToString = "GROM" And Right(dtGr("Sect").ToString, 1) = "X" And dtGr("Sect").ToString = iSect Then
'                        Call FindABCData(dtInforLineOut, 3, "X", dtGr, "GROM")
'                        Exit For
'                    ElseIf dtGr("Hole Type").ToString = "GROM" And Right(dtGr("Sect").ToString, 1) = "Y" And dtGr("Sect").ToString = iSect Then
'                        Call FindABCData(dtInforLineOut, 4, "Y", dtGr, "GROM")
'                        Exit For
'                    End If
'                Next
'            Next

'            '''' xac dinh lo tron hay obl
'            Call FindTypeHole(iSectList, iGrNameList, dtInforLineOut)

'        ElseIf iCheckPlug = True Then
'            '''' tìm 2 đường gần Cs Song song với Trục Z
'            Try
'                Call FindCtrLine(iSectList, iGrNameList, dtInforLineOut)
'            Catch ex As Exception

'            End Try


'            Call FineInfor2LineNearCsys(iGrNameList, dtInforLineOut)
'            '''' Xác định Danmen Bolt Nut không có tên theo quy chuẩn(Trim data)
'            Try
'                Call FindDataTrim(iGrNameList, dtInforLineOut)
'            Catch ex As Exception
'            End Try
'            '''XÁC ĐỊNH BUHIN A,B
'            For Each iSect As String In iSectList
'                For Each dtGr As DataRow In dtInforLineOut.Rows
'                    If dtGr("Hole Type").ToString = "PLUG" And Right(dtGr("Sect").ToString, 1) = "X" And dtGr("Sect").ToString = iSect Then
'                        Call FindABCData(dtInforLineOut, 3, "X", dtGr, "PLUG")
'                        Exit For
'                    ElseIf dtGr("Hole Type").ToString = "PLUG" And Right(dtGr("Sect").ToString, 1) = "Y" And dtGr("Sect").ToString = iSect Then
'                        Call FindABCData(dtInforLineOut, 4, "Y", dtGr, "PLUG")
'                        Exit For
'                    End If
'                Next
'            Next

'            '''' xac dinh lo tron hay obl
'            Call FindTypeHole(iSectList, iGrNameList, dtInforLineOut)


'            '''''''Có mình Clip
'        ElseIf iCheckClip = True Then
'            '''' tìm 2 đường gần Cs Song song với Trục Z
'            Try
'                Call FindCtrLine(iSectList, iGrNameList, dtInforLineOut)
'            Catch ex As Exception

'            End Try

'            Call FineInfor2LineNearCsys(iGrNameList, dtInforLineOut)
'            '''' Xác định Danmen Bolt Nut không có tên theo quy chuẩn(Trim data)
'            Try
'                Call FindDataTrim(iGrNameList, dtInforLineOut)
'            Catch ex As Exception
'            End Try




'            '''XÁC ĐỊNH BUHIN A,B
'            For Each iSect As String In iSectList
'                For Each dtGr As DataRow In dtInforLineOut.Rows
'                    If dtGr("Hole Type").ToString = "CLIP" And Right(dtGr("Sect").ToString, 1) = "X" And dtGr("Sect").ToString = iSect Then
'                        Call FindABCData(dtInforLineOut, 3, "X", dtGr, "CLIP")
'                        Exit For
'                    ElseIf dtGr("Hole Type").ToString = "CLIP" And Right(dtGr("Sect").ToString, 1) = "Y" And dtGr("Sect").ToString = iSect Then
'                        Call FindABCData(dtInforLineOut, 4, "Y", dtGr, "CLIP")
'                        Exit For
'                    End If
'                Next
'            Next

'            '''' xac dinh lo tron hay obl
'            Call FindTypeHole(iSectList, iGrNameList, dtInforLineOut)

'            '''' Tìm khoảng cách Bolt đến chi tiết xung quanh 
'            Call FindLineBoltCL(iSectList, dtInforLineOut, iGrNameList, tmpCsys)
'            '''Không có teiketsu mono
'        ElseIf iCheckBolt = False And iCheckClip = False And iCheckNut = False And iCheckScrew = False And iCheckPin = False And iCheckGrom = False And iCheckRivet = False And iCheckPlug = False Then
'            締結タイプ = "締結無し"
'            Call FindMonoOther(iSectList, dtInforLineOut, tmpCsys)

'            Dim iGrNameListAf As New List(Of String)
'            For Each row As DataRow In dtInforLineOut.Rows
'                If iGrNameListAf.Contains(row("GroupName").ToString) = False Then
'                    iGrNameListAf.Add(row("GroupName").ToString)
'                End If
'            Next
'            Try
'                Call FindCtrLine(iSectList, iGrNameListAf, dtInforLineOut)
'            Catch ex As Exception

'            End Try


'            '''' tìm 2 đường gần Cs Song song với Trục Z
'            Call FineInfor2LineNearCsys(iGrNameListAf, dtInforLineOut)
'            '''' Xác định Danmen Bolt Nut không có tên theo quy chuẩn(Trim data)
'            Try
'                Call FindDataTrim(iGrNameListAf, dtInforLineOut)
'            Catch ex As Exception
'            End Try
'            '''XÁC ĐỊNH BUHIN A,B
'            For Each iSect As String In iSectList
'                For Each dtGr As DataRow In dtInforLineOut.Rows
'                    If Right(dtGr("Sect").ToString, 1) = "X" And dtGr("Sect").ToString = iSect And dtGr("Hole Size").ToString <> "" And dtGr("Xg") = 0 And dtGr("Hole Type").ToString <> "" Then
'                        Call FindABCData(dtInforLineOut, 3, "X", dtGr, "ENTRY")
'                        Exit For
'                    ElseIf Right(dtGr("Sect").ToString, 1) = "Y" And dtGr("Sect").ToString = iSect And dtGr("Hole Size").ToString <> "" And dtGr("Xg") = 0 And dtGr("Hole Type").ToString <> "" Then
'                        Call FindABCData(dtInforLineOut, 4, "Y", dtGr, "ENTRY")
'                        Exit For
'                    End If
'                Next
'            Next


'            '''' xac dinh lo tron hay obl
'            Try
'                Call FindTypeHole(iSectList, iGrNameList, dtInforLineOut)
'            Catch ex As Exception

'            End Try


'        End If

'        'Call FindCtrLine(iSectList, iGrNameList, dtInforLineOut)


'    End Sub

'    Sub DimentionPMI_CreateCtrLine(ByVal iGrSectList As List(Of String), ByVal dtInforLineOut As DataTable, ByVal tmpCsys As CartesianCoordinateSystem, ByVal iComp As Component, ByVal iText As String)
'        Dim theSession As Session = Session.GetSession()
'        Dim workpart As Part = theSession.Parts.Work
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        Dim iVectorPMI As Vector3d

'        'Call XoayMatPhang(tmpCsys, iSect)
'        If iText = "BOLT_NUT" Then
'            Dim iCtrNutPoint As Point3d
'            Dim icheckNut As Boolean
'            For Each dtrNut As DataRow In dtInforLineOut.Rows
'                If dtrNut("Xg") <> 0 And InStr(dtrNut("Hole Type").ToString.ToUpper, "NUT") > 0 Then
'                    iCtrNutPoint = New Point3d(dtrNut("Xg"), dtrNut("Yg"), dtrNut("Zg"))
'                    icheckNut = True
'                    Exit For
'                End If
'            Next
'            If icheckNut = True Then
'                Dim iPoint3DCS As Point3d = New Point3d(tmpCsys.Origin.X, tmpCsys.Origin.Y, tmpCsys.Origin.Z)
'                Dim iPointLine As Point3d
'                'Dim iPtCs As NXOpen.Point
'                'iPtCs = workpart.Points.CreatePoint(iPoint3DCS)
'                If Math.Round(CosOf2Vector(iPoint3DCS, iCtrNutPoint, tmpCsys.Orientation.Element.Zx, tmpCsys.Orientation.Element.Zy, tmpCsys.Orientation.Element.Zz), 0) = 1 Then
'                    iVectorPMI = New Vector3d(tmpCsys.Orientation.Element.Zx, tmpCsys.Orientation.Element.Zy, tmpCsys.Orientation.Element.Zz)
'                ElseIf Math.Round(CosOf2Vector(iPoint3DCS, iCtrNutPoint, tmpCsys.Orientation.Element.Zx, tmpCsys.Orientation.Element.Zy, tmpCsys.Orientation.Element.Zz), 0) = -1 Then
'                    iVectorPMI = New Vector3d(-tmpCsys.Orientation.Element.Zx, -tmpCsys.Orientation.Element.Zy, -tmpCsys.Orientation.Element.Zz)

'                End If
'            Else
'                iVectorPMI = New Vector3d(tmpCsys.Orientation.Element.Zx, tmpCsys.Orientation.Element.Zy, tmpCsys.Orientation.Element.Zz)
'            End If

'        Else

'            iVectorPMI = New Vector3d(tmpCsys.Orientation.Element.Zx, tmpCsys.Orientation.Element.Zy, tmpCsys.Orientation.Element.Zz)
'        End If


'        For Each iSect As String In iGrSectList


'            Dim dtView1 As New DataView(dtInforLineOut)
'            dtView1.RowFilter = String.Format("[Sect] like '%{0}'", iSect)
'            Dim tmpDtb As DataTable = dtInforLineOut.Clone
'            tmpDtb = dtView1.ToTable
'            Dim dtView2 As New DataView(tmpDtb)
'            dtView2.RowFilter = String.Format("[Result] like '%{0}'", 10)
'            tmpDtb = dtView2.ToTable

'            For Each dtR As DataRow In tmpDtb.Rows
'                If dtR("Hole Size") <> "WELD" Then
'                    dtR("DistTemp") = CType(dtR("Hole Size").ToString, Double)
'                End If
'            Next
'            Dim dtView3 As New DataView(tmpDtb)
'            dtView3.Sort = "DistTemp"
'            tmpDtb = dtView3.ToTable

'            Dim iNoChild As String
'            For Each ichild1 As Component In iComp.GetChildren
'                If ichild1.GetStringAttribute("DB_PART_NAME").ToString = iSect Then
'                    'lw.WriteLine(ichild1.GetStringAttribute("DB_PART_NAME").ToString)
'                    theSession.Parts.SetWorkComponent(ichild1, partLoadStatus1)
'                    iNoChild = ichild1.GetStringAttribute("DB_PART_NO").ToString
'                    Exit For
'                End If
'            Next
'            Dim iListABC As New List(Of String)
'            Try
'                Call CreatePMIInforABC(iSect, dtInforLineOut, iListABC)
'            Catch ex As Exception

'            End Try

'            Try
'                Call CreatePMIInforPart(iSect, iListABC)
'            Catch ex As Exception

'            End Try
'            '''' Tạo đương tâm 
'            Try
'                Call CreateCtrLine(iSect, dtInforLineOut, tmpCsys)
'            Catch ex As Exception

'            End Try

'            Try
'                Call CreateDirBoltCL(iSect, dtInforLineOut, tmpCsys, iVectorPMI)
'            Catch ex As Exception

'            End Try
'            ''''Đo kích thước lỗ,Bước Ren
'            Dim inumtemp As Double = 20
'            For Each dtr1 As DataRow In tmpDtb.Rows
'                '''' đo kích thước lỗ A,B,C,....
'                If dtr1("Result") = 10 And dtr1("Hole Type") <> "Thread Dim" Then

'                    For Each dtr2 As DataRow In tmpDtb.Rows
'                        Try
'                            If dtr2("Hole Type").ToString = dtr1("Hole Type").ToString And dtr2("Result") = 10 _
'                           And dtr2("Object Tag").ToString <> dtr1("Object Tag").ToString Then
'                                If Split(dtr2("Hole Type").ToString, "_")(2) = "C" Then
'                                    Dim iCheckHole = Split(dtr2("Hole Type").ToString, "_")(2)
'                                    Dim pt3d1d As New Point3d(dtr1("Xd"), dtr1("Yd"), dtr1("Zd"))
'                                    Dim pt3d2d As New Point3d(dtr2("Xd"), dtr2("Yd"), dtr2("Zd"))
'                                    Dim pt3d1c As New Point3d(dtr1("Xc"), dtr1("Yc"), dtr1("Zc"))
'                                    Dim pt3d2c As New Point3d(dtr2("Xc"), dtr2("Yc"), dtr2("Zc"))
'                                    Dim pt3d1 As Point3d
'                                    Dim pt3d2 As Point3d
'                                    If DirOf2Line(pt3d1d, pt3d2d, pt3d1c, pt3d2c) < 0.2 Then
'                                        If DistanceOf2Pt(pt3d1d, pt3d2c) <= DistanceOf2Pt(pt3d2d, pt3d1c) Then
'                                            pt3d1 = pt3d1d
'                                            pt3d2 = pt3d2c
'                                        Else
'                                            pt3d1 = pt3d2d
'                                            pt3d2 = pt3d1c
'                                        End If
'                                    Else
'                                        If DistanceOf2Pt(pt3d1d, pt3d2d) <= DistanceOf2Pt(pt3d1c, pt3d2c) Then
'                                            pt3d1 = pt3d1d
'                                            pt3d2 = pt3d2d
'                                        Else
'                                            pt3d1 = pt3d1c
'                                            pt3d2 = pt3d2c
'                                        End If
'                                    End If

'                                    Dim iPointDir(1) As String
'                                    iPointDir(0) = pt3d1.X & "," & pt3d1.Y & "," & pt3d1.Z
'                                    iPointDir(1) = pt3d2.X & "," & pt3d2.Y & "," & pt3d2.Z
'                                    Call PMIPointAndPointNew(iPointDir(0), iPointDir(1), Right(iSect, 1), tmpCsys, inumtemp, iCheckHole, iVectorPMI)
'                                    dtr1("Result") = 11
'                                    dtr2("Result") = 11
'                                    inumtemp += 7
'                                Else
'                                    Dim iCheckHole = Split(dtr2("Hole Type").ToString, "_")(2)
'                                    Dim pt3d1d As New Point3d(dtr1("Xd"), dtr1("Yd"), dtr1("Zd"))
'                                    Dim pt3d2d As New Point3d(dtr2("Xd"), dtr2("Yd"), dtr2("Zd"))
'                                    Dim pt3d1c As New Point3d(dtr1("Xc"), dtr1("Yc"), dtr1("Zc"))
'                                    Dim pt3d2c As New Point3d(dtr2("Xc"), dtr2("Yc"), dtr2("Zc"))
'                                    Dim pt3d1 As Point3d
'                                    Dim pt3d2 As Point3d
'                                    If DirOf2Line(pt3d1d, pt3d2d, pt3d1c, pt3d2c) < 0.2 Then
'                                        If DistanceOf2Pt(pt3d1d, pt3d2c) <= DistanceOf2Pt(pt3d2d, pt3d1c) Then
'                                            pt3d1 = pt3d1d
'                                            pt3d2 = pt3d2c
'                                        Else
'                                            pt3d1 = pt3d2d
'                                            pt3d2 = pt3d1c
'                                        End If
'                                    Else
'                                        If DistanceOf2Pt(pt3d1d, pt3d2d) <= DistanceOf2Pt(pt3d1c, pt3d2c) Then
'                                            pt3d1 = pt3d1d
'                                            pt3d2 = pt3d2d
'                                        Else
'                                            pt3d1 = pt3d1c
'                                            pt3d2 = pt3d2c
'                                        End If
'                                    End If

'                                    Dim iPointDir(1) As String
'                                    iPointDir(0) = pt3d1.X & "," & pt3d1.Y & "," & pt3d1.Z
'                                    iPointDir(1) = pt3d2.X & "," & pt3d2.Y & "," & pt3d2.Z
'                                    Call PMIPointAndPointNew(iPointDir(0), iPointDir(1), Right(iSect, 1), tmpCsys, inumtemp, iCheckHole, iVectorPMI)
'                                    dtr1("Result") = 11
'                                    dtr2("Result") = 11
'                                    inumtemp += 7
'                                End If
'                            End If
'                        Catch ex As Exception

'                        End Try

'                    Next
'                    '''' giá trị số temp layOut PMI


'                    '''' đo kích thước Bước Ren ....

'                ElseIf dtr1("Hole Type") = "Thread Dim" Then

'                    Dim iCtrNutPoint As Point3d
'                    For Each dtrNut As DataRow In dtInforLineOut.Rows
'                        If dtrNut("Xg") <> 0 And dtrNut("Sect") = iSect And InStr(dtrNut("Hole Type").ToString.ToUpper, "NUT") > 0 Then
'                            iCtrNutPoint = New Point3d(dtrNut("Xg"), dtrNut("Yg"), dtrNut("Zg"))
'                        End If
'                    Next

'                    For Each dtr2 As DataRow In tmpDtb.Rows
'                        If dtr2("Hole Type").ToString = dtr1("Hole Type").ToString And dtr2("Result") = 10 _
'                            And dtr2("Object Tag").ToString <> dtr1("Object Tag").ToString Then

'                            Dim iPointDir(1) As String
'                            Dim iPoint3D_Bolt As Point3d
'                            If InStr(dtr2("GroupName").ToString.ToUpper, "BOLT") > 0 Or InStr(dtr2("GroupName").ToString.ToUpper, "STUD-BALL") > 0 _
'                                Or InStr(dtr2("GroupName").ToString.ToUpper, "SCREW") > 0 Or InStr(dtr2("GroupName").ToString.ToUpper, "SCR") > 0 Then

'                                Dim iPoint3D_Fst As Point3d = New Point3d(dtr2("Xd"), dtr2("Yd"), dtr2("Zd"))
'                                Dim iPoint3D_End As Point3d = New Point3d(dtr2("Xc"), dtr2("Yc"), dtr2("Zc"))

'                                iPoint3D_Bolt = Diem_do_Thread(iPoint3D_Fst, iPoint3D_End, tmpCsys, iCtrNutPoint)
'                                iPointDir(1) = iPoint3D_Bolt.X & "," & iPoint3D_Bolt.Y & "," & iPoint3D_Bolt.Z

'                                Call PMILineAndPointNew(dtr1("Object Tag").ToString, iPointDir(1), Right(iSect, 1), tmpCsys, 0, iVectorPMI)
'                                dtr1("Result") = 11
'                                dtr2("Result") = 11

'                            Else
'                                Dim iPoint3D_Fst As Point3d = New Point3d(dtr1("Xd"), dtr1("Yd"), dtr1("Zd"))
'                                Dim iPoint3D_End As Point3d = New Point3d(dtr1("Xc"), dtr1("Yc"), dtr1("Zc"))

'                                iPoint3D_Bolt = Diem_do_Thread(iPoint3D_Fst, iPoint3D_End, tmpCsys, iCtrNutPoint)
'                                iPointDir(1) = iPoint3D_Bolt.X & "," & iPoint3D_Bolt.Y & "," & iPoint3D_Bolt.Z

'                                Call PMILineAndPointNew(dtr2("Object Tag").ToString, iPointDir(1), Right(iSect, 1), tmpCsys, 0, iVectorPMI)
'                                dtr1("Result") = 11
'                                dtr2("Result") = 11

'                            End If

'                        End If
'                    Next

'                End If
'            Next
'        Next
'    End Sub

'    Sub DirThreadDim(ByVal iSectList As List(Of String), ByVal iGrNameList As List(Of String), ByVal dtInforLineOut As DataTable, ByVal tmpCsys As CartesianCoordinateSystem)
'        Dim MaxDirNutTag As String
'        Dim DirBoltTag As String
'        Dim iPoint3D_Nut As Point3d
'        Dim iPoint3D_Fst As Point3d
'        Dim iPoint3D_End As Point3d
'        Dim iVectorNut As Vector3d
'        Dim iCheckSect As String
'        '''tìm cạnh Nut vuông góc và có khoảng cách xa Cs nhất
'        For Each iSect As String In iSectList
'            For Each iGrName1 As String In iGrNameList
'                Dim itempThick As String
'                Try
'                    itempThick = Split(iGrName1, "$")(3)
'                Catch ex As Exception
'                End Try
'                If InStr(iGrName1.ToUpper, "NUT") > 0 And InStr(iGrName1.ToUpper, "CAP") = 0 And Len(itempThick) < 2 Then

'                    Try
'                        Dim dtView1 As New DataView(dtInforLineOut)
'                        Dim strFill1 As String = "GroupName = " & iGrName1
'                        dtView1.RowFilter = String.Format("[GroupName] like '%{0}'", iGrName1)
'                        Dim tmpDtb As DataTable = dtInforLineOut.Clone
'                        tmpDtb = dtView1.ToTable

'                        Dim dtView11 As New DataView(tmpDtb)
'                        dtView11.RowFilter = String.Format("[Sect] like '%{0}'", iSect)
'                        tmpDtb = dtView11.ToTable

'                        Dim dtView2 As New DataView(tmpDtb)
'                        dtView2.RowFilter = String.Format("[a1] like '%{0}'", 0)
'                        tmpDtb = dtView2.ToTable
'                        tmpDtb.DefaultView.Sort = "d1 DESC"
'                        Dim dtSort As DataTable = tmpDtb.DefaultView.ToTable()
'                        dtSort.AcceptChanges()
'                        'Dim itempFill As String
'                        Dim iZCS(2) As Double
'                        Dim iMatrix As Matrix3x3 = tmpCsys.Orientation.Element
'                        iZCS(0) = iMatrix.Zx.ToString
'                        iZCS(1) = iMatrix.Zy.ToString
'                        iZCS(2) = iMatrix.Zz.ToString
'                        For Each dtRowTemp2 As DataRow In dtSort.Rows
'                            If dtRowTemp2("a1") = "0" And dtRowTemp2("Hole Size") = "" And dtRowTemp2("d1") < 20 Then

'                                Dim giatriNut As Double
'                                Dim iPointCs As Point3d = New Point3d(tmpCsys.Origin.X, tmpCsys.Origin.Y, tmpCsys.Origin.Z)
'                                Dim iVectorZ As Vector3d = New Vector3d(iZCS(0), iZCS(1), iZCS(2))
'                                Call DoKichThuocTheoPhuong(dtRowTemp2("Object Tag").ToString, iPointCs, iVectorZ, giatriNut)
'                                dtRowTemp2("DistTemp") = giatriNut
'                                dtRowTemp2("Result") = 44

'                            End If
'                        Next

'                        Dim dtView3 As New DataView(dtSort)
'                        dtView3.RowFilter = String.Format("[Result] like '%{0}'", 44)
'                        dtSort = dtView3.ToTable
'                        dtSort.DefaultView.Sort = "DistTemp DESC"
'                        Dim dtSort1 As DataTable = dtSort.DefaultView.ToTable()
'                        dtSort1.AcceptChanges()
'                        For Each dtr1 As DataRow In dtSort1.Rows
'                            MaxDirNutTag = dtr1("Object Tag").ToString
'                            Exit For
'                        Next

'                        For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                            If dtInfor3("Object Tag").ToString = MaxDirNutTag And dtInfor3("d1") < 20 Then

'                                dtInfor3("Result") = 7
'                                iPoint3D_Nut = New Point3d(dtInfor3("Xm"), dtInfor3("Ym"), dtInfor3("Zm"))
'                                iVectorNut = New Vector3d(dtInfor3("Vx"), dtInfor3("Vy"), dtInfor3("Vz"))
'                                dtInforLineOut.AcceptChanges()

'                            End If
'                        Next
'                    Catch ex As Exception
'                        lw.WriteLine(ex.ToString)

'                    End Try

'                End If
'            Next
'            '''tìm cạnh Bolt song song  và có khoảng cách gần cạnh nut vừa tìm được  nhất
'            Dim iVectorBolt As Vector3d
'            For Each iGrName1 As String In iGrNameList
'                Dim itempThick As String
'                Try
'                    itempThick = Split(iGrName1, "$")(3)
'                    If CType(Mid(itempThick, 2, 4), Double) = 0 Then
'                        itempThick = "T"
'                    End If
'                Catch ex As Exception
'                End Try
'                If InStr(iGrName1.ToUpper, "BOLT") > 0 And Len(itempThick) < 2 Or InStr(iGrName1.ToUpper, "STUD-BALL") > 0 And Len(itempThick) < 2 Then

'                    Dim dtView1 As New DataView(dtInforLineOut)
'                    Dim strFill1 As String = "GroupName = " & iGrName1
'                    dtView1.RowFilter = String.Format("[GroupName] like '%{0}'", iGrName1)
'                    Dim tmpDtb As DataTable = dtInforLineOut.Clone
'                    tmpDtb = dtView1.ToTable

'                    Dim dtView11 As New DataView(tmpDtb)
'                    dtView11.RowFilter = String.Format("[Sect] like '%{0}'", iSect)
'                    tmpDtb = dtView11.ToTable

'                    Dim dtView2 As New DataView(tmpDtb)
'                    dtView2.RowFilter = String.Format("[a1] like '%{0}'", 1)
'                    tmpDtb = dtView2.ToTable

'                    For Each dtRowTemp2 As DataRow In tmpDtb.Rows

'                        If dtRowTemp2("a1") = "1" And dtRowTemp2("Hole Size") = "" And CType(dtRowTemp2("d1").ToString, Double) < 20 Then

'                            Dim Object1Tag As Long = CType(MaxDirNutTag, Long)
'                            Dim Object2Tag As Long = CType(dtRowTemp2("Object Tag").ToString, Long)
'                            Dim guess1(2) As Double
'                            Dim guess2(2) As Double
'                            Dim pt1(2) As Double
'                            Dim pt2(2) As Double
'                            Dim minDist As Double
'                            theUFSession.Modl.AskMinimumDist(Object1Tag, Object2Tag, 0, guess1, 0, guess2, minDist, pt1, pt2)
'                            dtRowTemp2("DistTemp") = minDist
'                            dtRowTemp2("Result") = 33
'                        End If
'                    Next

'                    Dim dtView3 As New DataView(tmpDtb)
'                    dtView3.RowFilter = String.Format("[Result] like '%{0}'", 33)
'                    tmpDtb = dtView3.ToTable
'                    tmpDtb.DefaultView.Sort = "DistTemp"
'                    Dim dtSort As DataTable = tmpDtb.DefaultView.ToTable()
'                    dtSort.AcceptChanges()

'                    For Each dtr1 As DataRow In dtSort.Rows
'                        DirBoltTag = dtr1("Object Tag").ToString
'                        Exit For
'                    Next

'                    For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                        If dtInfor3("Object Tag").ToString = DirBoltTag Then

'                            dtInfor3("Result") = 8
'                            iPoint3D_Fst = New Point3d(dtInfor3("Xd"), dtInfor3("Yd"), dtInfor3("Zd"))
'                            iPoint3D_End = New Point3d(dtInfor3("Xc"), dtInfor3("Yc"), dtInfor3("Zc"))
'                            iVectorBolt = New Vector3d(dtInfor3("Vx"), dtInfor3("Vy"), dtInfor3("Vz"))
'                            dtInforLineOut.AcceptChanges()

'                        End If
'                    Next
'                ElseIf InStr(iGrName1.ToUpper, "SCREW") > 0 And Len(itempThick) < 2 Or InStr(iGrName1.ToUpper, "SCR") > 0 And Len(itempThick) < 2 Then

'                    Dim dtView1 As New DataView(dtInforLineOut)
'                    Dim strFill1 As String = "GroupName = " & iGrName1
'                    dtView1.RowFilter = String.Format("[GroupName] like '%{0}'", iGrName1)
'                    Dim tmpDtb As DataTable = dtInforLineOut.Clone
'                    tmpDtb = dtView1.ToTable

'                    Dim dtView11 As New DataView(tmpDtb)
'                    dtView11.RowFilter = String.Format("[Sect] like '%{0}'", iSect)
'                    tmpDtb = dtView11.ToTable

'                    Dim dtView2 As New DataView(tmpDtb)
'                    dtView2.RowFilter = String.Format("[a1] like '%{0}'", 1)
'                    tmpDtb = dtView2.ToTable

'                    For Each dtRowTemp2 As DataRow In tmpDtb.Rows

'                        If dtRowTemp2("a1") = "1" And dtRowTemp2("Hole Size") = "" And CType(dtRowTemp2("d1").ToString, Double) < 20 Then

'                            Dim Object1Tag As Long = CType(MaxDirNutTag, Long)
'                            Dim Object2Tag As Long = CType(dtRowTemp2("Object Tag").ToString, Long)
'                            Dim guess1(2) As Double
'                            Dim guess2(2) As Double
'                            Dim pt1(2) As Double
'                            Dim pt2(2) As Double
'                            Dim minDist As Double
'                            theUFSession.Modl.AskMinimumDist(Object1Tag, Object2Tag, 0, guess1, 0, guess2, minDist, pt1, pt2)
'                            dtRowTemp2("DistTemp") = minDist
'                            dtRowTemp2("Result") = 33
'                        End If
'                    Next

'                    Dim dtView3 As New DataView(tmpDtb)
'                    dtView3.RowFilter = String.Format("[Result] like '%{0}'", 33)
'                    tmpDtb = dtView3.ToTable
'                    tmpDtb.DefaultView.Sort = "DistTemp"
'                    Dim dtSort As DataTable = tmpDtb.DefaultView.ToTable()
'                    dtSort.AcceptChanges()

'                    For Each dtr1 As DataRow In dtSort.Rows
'                        DirBoltTag = dtr1("Object Tag").ToString
'                        Exit For
'                    Next

'                    For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                        If dtInfor3("Object Tag").ToString = DirBoltTag Then

'                            dtInfor3("Result") = 8
'                            iPoint3D_Fst = New Point3d(dtInfor3("Xd"), dtInfor3("Yd"), dtInfor3("Zd"))
'                            iPoint3D_End = New Point3d(dtInfor3("Xc"), dtInfor3("Yc"), dtInfor3("Zc"))
'                            iVectorBolt = New Vector3d(dtInfor3("Vx"), dtInfor3("Vy"), dtInfor3("Vz"))
'                            dtInforLineOut.AcceptChanges()

'                        End If
'                    Next

'                End If
'            Next
'            ''''tìm tâm Nut
'            Dim iCtrNutPoint As Point3d
'            For Each dtrNut As DataRow In dtInforLineOut.Rows
'                If dtrNut("Xg") <> 0 And dtrNut("Sect") = iSect And InStr(dtrNut("Hole Type").ToString.ToUpper, "NUT") > 0 Then
'                    iCtrNutPoint = New Point3d(dtrNut("Xg"), dtrNut("Yg"), dtrNut("Zg"))
'                End If
'            Next
'            Dim iPoint3D_Bolt As Point3d = Diem_do_Thread(iPoint3D_Fst, iPoint3D_End, tmpCsys, iCtrNutPoint)

'            Dim giatri As Double
'            Call DoKichThuocTheoPhuong(MaxDirNutTag, iPoint3D_Bolt, iVectorBolt, giatri)
'            For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                If dtInfor3("Result").ToString = "8" Then

'                    dtInfor3("Hole Size") = Math.Round(giatri, 2)
'                    dtInfor3("Hole Type") = "Thread Dim"
'                    dtInforLineOut.AcceptChanges()

'                ElseIf dtInfor3("Result").ToString = "7" Then

'                    dtInfor3("Hole Size") = Math.Round(giatri, 2)
'                    dtInfor3("Hole Type") = "Thread Dim"
'                    dtInforLineOut.AcceptChanges()

'                End If
'            Next
'        Next
'    End Sub

'    Sub CreateCtrLine(ByVal iSect As String, ByVal dtInforLineOut As DataTable, ByVal tmpCsys As CartesianCoordinateSystem)
'        Dim dtView1 As New DataView(dtInforLineOut)
'        dtView1.RowFilter = String.Format("[Sect] like '%{0}'", iSect)
'        Dim tmpDtb2 As DataTable = dtInforLineOut.Clone
'        tmpDtb2 = dtView1.ToTable
'        Dim dtView11 As New DataView(tmpDtb2)
'        dtView11.RowFilter = String.Format("[CtrLineX] like '%{0}'", 1)
'        tmpDtb2 = dtView11.ToTable
'        Dim iPtCsys As Point3d = New Point3d(tmpCsys.Origin.X, tmpCsys.Origin.Y, tmpCsys.Origin.Z)
'        Dim iZCS(2) As Double
'        Dim iMatrix As Matrix3x3 = tmpCsys.Orientation.Element

'        iZCS(0) = iMatrix.Zx.ToString
'        iZCS(1) = iMatrix.Zy.ToString
'        iZCS(2) = iMatrix.Zz.ToString
'        'Dim iCtrLineTop(100) As Line
'        Dim iTemp As Integer = 0
'        For Each dtr1 As DataRow In tmpDtb2.Rows
'            If dtr1("CtrLineX") = 1 And dtr1("Hole Type") <> "Thread Dim" Then
'                Dim icheckMONOCurve As Boolean = False
'                For Each dtr2 As DataRow In tmpDtb2.Rows
'                    If dtr2("Group Tag").ToString = dtr1("Group Tag").ToString And dtr2("CtrLineX") = 1 _
'                   And dtr2("Object Tag").ToString <> dtr1("Object Tag").ToString Then

'                        Dim newStartPoint As String
'                        Dim newEndPoint As String
'                        Dim newStartPointUp As String
'                        Dim newEndPointUp As String
'                        Dim newTGPoint As String
'                        Dim pt3d1d As New Point3d(dtr1("Xd"), dtr1("Yd"), dtr1("Zd"))
'                        Dim pt3d2d As New Point3d(dtr2("Xd"), dtr2("Yd"), dtr2("Zd"))
'                        Dim pt3d1c As New Point3d(dtr1("Xc"), dtr1("Yc"), dtr1("Zc"))
'                        Dim pt3d2c As New Point3d(dtr2("Xc"), dtr2("Yc"), dtr2("Zc"))
'                        Dim pt3d1 As Point3d
'                        Dim pt3d2 As Point3d
'                        Dim pt3c2 As Point3d
'                        If InStr(dtr2("Hole Type").ToString, "SCREW") > 0 Then
'                            If 0.9999 <= CosOf2Line(pt3d1d, pt3d2d, pt3d1c, pt3d2c) And CosOf2Line(pt3d1d, pt3d2d, pt3d1c, pt3d2c) <= 1.0001 Then
'                                If DistanceOf2Pt(pt3d1d, pt3d2d) <= DistanceOf2Pt(pt3d1c, pt3d2c) Then
'                                    pt3d1 = pt3d1d
'                                    pt3d2 = pt3d2d
'                                    pt3c2 = pt3d2c
'                                    newStartPoint = (pt3d1.X & "," & pt3d1.Y & "," & pt3d1.Z)
'                                    newEndPoint = (pt3d2.X & "," & pt3d2.Y & "," & pt3d2.Z)
'                                    newTGPoint = (pt3c2.X & "," & pt3c2.Y & "," & pt3c2.Z)
'                                Else
'                                    pt3d1 = pt3d1c
'                                    pt3d2 = pt3d2c
'                                    pt3c2 = pt3d2d
'                                    newStartPoint = (pt3d1.X & "," & pt3d1.Y & "," & pt3d1.Z)
'                                    newEndPoint = (pt3d2.X & "," & pt3d2.Y & "," & pt3d2.Z)
'                                    newTGPoint = (pt3c2.X & "," & pt3c2.Y & "," & pt3c2.Z)
'                                End If
'                            Else
'                                If DistanceOf2Pt(pt3d1d, pt3d2c) <= DistanceOf2Pt(pt3d2d, pt3d1c) Then
'                                    pt3d1 = pt3d1d
'                                    pt3d2 = pt3d2c
'                                    pt3c2 = pt3d2d
'                                    newStartPoint = (pt3d1.X & "," & pt3d1.Y & "," & pt3d1.Z)
'                                    newEndPoint = (pt3d2.X & "," & pt3d2.Y & "," & pt3d2.Z)
'                                    newTGPoint = (pt3c2.X & "," & pt3c2.Y & "," & pt3c2.Z)
'                                Else
'                                    pt3d1 = pt3d2d
'                                    pt3d2 = pt3d1c
'                                    pt3c2 = pt3d1d
'                                    newStartPoint = (pt3d1.X & "," & pt3d1.Y & "," & pt3d1.Z)
'                                    newEndPoint = (pt3d2.X & "," & pt3d2.Y & "," & pt3d2.Z)
'                                    newTGPoint = (pt3c2.X & "," & pt3c2.Y & "," & pt3c2.Z)
'                                End If
'                            End If
'                            dtr1("CtrLineX") = 22
'                            dtr2("CtrLineX") = 33
'                            dtr1("CtrLineTag") = newStartPoint.ToString & "_" & newEndPoint.ToString & "_" & newTGPoint.ToString
'                            dtr2("CtrLineTag") = newStartPoint.ToString & "_" & newEndPoint.ToString & "_" & newTGPoint.ToString
'                            iTemp += 1
'                        Else
'                            If 0.9999 <= CosOf2Line(pt3d1d, pt3d2d, pt3d1c, pt3d2c) And CosOf2Line(pt3d1d, pt3d2d, pt3d1c, pt3d2c) <= 1.0001 Then
'                                If DistanceOf2Pt(pt3d1d, pt3d2d) <= DistanceOf2Pt(pt3d1c, pt3d2c) Then
'                                    pt3d1 = pt3d1d
'                                    pt3d2 = pt3d2d
'                                    newStartPoint = (pt3d1.X & "," & pt3d1.Y & "," & pt3d1.Z)
'                                    newEndPoint = (pt3d2.X & "," & pt3d2.Y & "," & pt3d2.Z)
'                                    newStartPointUp = (pt3d1c.X & "," & pt3d1c.Y & "," & pt3d1c.Z)
'                                    newEndPointUp = (pt3d2c.X & "," & pt3d2c.Y & "," & pt3d2c.Z)
'                                Else
'                                    pt3d1 = pt3d1c
'                                    pt3d2 = pt3d2c
'                                    newStartPoint = (pt3d1.X & "," & pt3d1.Y & "," & pt3d1.Z)
'                                    newEndPoint = (pt3d2.X & "," & pt3d2.Y & "," & pt3d2.Z)
'                                    newStartPointUp = (pt3d1d.X & "," & pt3d1d.Y & "," & pt3d1d.Z)
'                                    newEndPointUp = (pt3d2d.X & "," & pt3d2d.Y & "," & pt3d2d.Z)
'                                End If
'                            Else
'                                If DistanceOf2Pt(pt3d1d, pt3d2c) <= DistanceOf2Pt(pt3d2d, pt3d1c) Then
'                                    pt3d1 = pt3d1d
'                                    pt3d2 = pt3d2c
'                                    newStartPoint = (pt3d1.X & "," & pt3d1.Y & "," & pt3d1.Z)
'                                    newEndPoint = (pt3d2.X & "," & pt3d2.Y & "," & pt3d2.Z)
'                                    newStartPointUp = (pt3d1c.X & "," & pt3d1c.Y & "," & pt3d1c.Z)
'                                    newEndPointUp = (pt3d2d.X & "," & pt3d2d.Y & "," & pt3d2d.Z)
'                                Else
'                                    pt3d1 = pt3d2d
'                                    pt3d2 = pt3d1c
'                                    newStartPoint = (pt3d1.X & "," & pt3d1.Y & "," & pt3d1.Z)
'                                    newEndPoint = (pt3d2.X & "," & pt3d2.Y & "," & pt3d2.Z)
'                                    newStartPointUp = (pt3d2c.X & "," & pt3d2c.Y & "," & pt3d2c.Z)
'                                    newEndPointUp = (pt3d1d.X & "," & pt3d1d.Y & "," & pt3d1d.Z)
'                                End If
'                            End If
'                            dtr1("CtrLineX") = 2
'                            dtr2("CtrLineX") = 3
'                            dtr1("CtrLineTag") = newStartPoint.ToString & "_" & newEndPoint.ToString & "_" & newStartPointUp.ToString & "_" & newEndPointUp.ToString
'                            dtr2("CtrLineTag") = newStartPoint.ToString & "_" & newEndPoint.ToString & "_" & newStartPointUp.ToString & "_" & newEndPointUp.ToString
'                            iTemp += 1
'                        End If

'                    End If
'                Next
'            Else

'            End If
'        Next
'        Dim CtrOK As Boolean = False
'        Dim CtrNG As Boolean = False
'        For Each dtRow As DataRow In tmpDtb2.Rows
'            If dtRow("CtrLineX") = 2 Then
'                Dim StartPointX As Double = CType(Split(Split(dtRow("CtrLineTag"), "_")(0), ",")(0), Double)
'                Dim StartPointY As Double = CType(Split(Split(dtRow("CtrLineTag"), "_")(0), ",")(1), Double)
'                Dim StartPointZ As Double = CType(Split(Split(dtRow("CtrLineTag"), "_")(0), ",")(2), Double)

'                Dim EndPointX As Double = CType(Split(Split(dtRow("CtrLineTag"), "_")(1), ",")(0), Double)
'                Dim EndPointY As Double = CType(Split(Split(dtRow("CtrLineTag"), "_")(1), ",")(1), Double)
'                Dim EndPointZ As Double = CType(Split(Split(dtRow("CtrLineTag"), "_")(1), ",")(2), Double)

'                Dim StartPoint1X As Double = CType(Split(Split(dtRow("CtrLineTag"), "_")(2), ",")(0), Double)
'                Dim StartPoint1Y As Double = CType(Split(Split(dtRow("CtrLineTag"), "_")(2), ",")(1), Double)
'                Dim StartPoint1Z As Double = CType(Split(Split(dtRow("CtrLineTag"), "_")(2), ",")(2), Double)

'                Dim EndPoint1X As Double = CType(Split(Split(dtRow("CtrLineTag"), "_")(3), ",")(0), Double)
'                Dim EndPoint1Y As Double = CType(Split(Split(dtRow("CtrLineTag"), "_")(3), ",")(1), Double)
'                Dim EndPoint1Z As Double = CType(Split(Split(dtRow("CtrLineTag"), "_")(3), ",")(2), Double)

'                Dim iPoint1 As Point3d = New Point3d(StartPointX, StartPointY, StartPointZ)
'                Dim iPoint2 As Point3d = New Point3d(EndPointX, EndPointY, EndPointZ)
'                Dim iCheckCtrOut As String

'                Call Angle2Vector(iPoint1, iPoint2, iZCS, iCheckCtrOut, iPtCsys)
'                dtRow("CtrUnmatch") = iCheckCtrOut

'                If iCheckCtrOut = "OK" Then
'                    CtrOK = True
'                ElseIf iCheckCtrOut = "NG" Then
'                    'lw.WriteLine(dtRow("GroupName").ToString)
'                    Dim ictrLine1 As Point3d = New Point3d((StartPointX + EndPointX) / 2, (StartPointY + EndPointY) / 2, (StartPointZ + EndPointZ) / 2)
'                    Dim ictrLine2 As Point3d = New Point3d((StartPoint1X + EndPoint1X) / 2, (StartPoint1Y + EndPoint1Y) / 2, (StartPoint1Z + EndPoint1Z) / 2)
'                    Dim ictrLine As Point3d = New Point3d((ictrLine1.X + ictrLine2.X) / 2, (ictrLine1.Y + ictrLine2.Y) / 2, (ictrLine1.Z + ictrLine2.Z) / 2)
'                    Dim iZx As Double = ictrLine2.X - ictrLine1.X
'                    Dim iZy As Double = ictrLine2.Y - ictrLine1.Y
'                    Dim iZz As Double = ictrLine2.Z - ictrLine1.Z
'                    Dim NewPt3d As Point3d = New Point3d(ictrLine.X + iZx, ictrLine.Y + iZy, ictrLine.Z + iZz)
'                    Dim EndPt3d As Point3d = New Point3d(ictrLine.X - iZx, ictrLine.Y - iZy, ictrLine.Z - iZz)
'                    Dim iLine As Line
'                    Call D001_CreateCenterLine(NewPt3d, EndPt3d, iLine)
'                    CtrNG = True
'                End If

'            ElseIf dtRow("CtrLineX") = 22 Then
'                Dim StartPointX As Double = CType(Split(Split(dtRow("CtrLineTag"), "_")(0), ",")(0), Double)
'                Dim StartPointY As Double = CType(Split(Split(dtRow("CtrLineTag"), "_")(0), ",")(1), Double)
'                Dim StartPointZ As Double = CType(Split(Split(dtRow("CtrLineTag"), "_")(0), ",")(2), Double)

'                Dim EndPointX As Double = CType(Split(Split(dtRow("CtrLineTag"), "_")(1), ",")(0), Double)
'                Dim EndPointY As Double = CType(Split(Split(dtRow("CtrLineTag"), "_")(1), ",")(1), Double)
'                Dim EndPointZ As Double = CType(Split(Split(dtRow("CtrLineTag"), "_")(1), ",")(2), Double)

'                Dim TGPointX As Double = CType(Split(Split(dtRow("CtrLineTag"), "_")(2), ",")(0), Double)
'                Dim TGPointY As Double = CType(Split(Split(dtRow("CtrLineTag"), "_")(2), ",")(1), Double)
'                Dim TGPointZ As Double = CType(Split(Split(dtRow("CtrLineTag"), "_")(2), ",")(2), Double)

'                Dim iPoint1 As Point3d = New Point3d(StartPointX, StartPointY, StartPointZ)
'                Dim iPoint2 As Point3d = New Point3d(EndPointX, EndPointY, EndPointZ)
'                Dim iPoint3 As Point3d = New Point3d(TGPointX, TGPointY, TGPointZ)

'                Dim iCheckCtrOut As String

'                Call Angle2line(iPoint1, iPoint2, iPoint3, iZCS, iCheckCtrOut, iPtCsys)
'                dtRow("CtrUnmatch") = iCheckCtrOut
'                If iCheckCtrOut = "OK" Then
'                    CtrOK = True
'                ElseIf iCheckCtrOut = "NG" Then
'                    'lw.WriteLine(dtRow("GroupName").ToString)
'                    Dim ictrLine1 As Point3d = New Point3d((StartPointX + EndPointX) / 2, (StartPointY + EndPointY) / 2, (StartPointZ + EndPointZ) / 2)
'                    Dim ictrLine2 As Point3d = New Point3d((StartPointX + TGPointX) / 2, (StartPointY + TGPointY) / 2, (StartPointZ + TGPointZ) / 2)
'                    Dim ictrLine As Point3d = New Point3d((ictrLine1.X + ictrLine2.X) / 2, (ictrLine1.Y + ictrLine2.Y) / 2, (ictrLine1.Z + ictrLine2.Z) / 2)
'                    Dim iZx As Double = ictrLine2.X - ictrLine1.X

'                    Dim iZy As Double = ictrLine2.Y - ictrLine1.Y
'                    Dim iZz As Double = ictrLine2.Z - ictrLine1.Z
'                    Dim NewPt3d As Point3d = New Point3d(ictrLine.X + 5 * iZx, ictrLine.Y + 5 * iZy, ictrLine.Z + 5 * iZz)
'                    Dim EndPt3d As Point3d = New Point3d(ictrLine.X - 5 * iZx, ictrLine.Y - 5 * iZy, ictrLine.Z - 5 * iZz)
'                    Dim iLine As Line
'                    Call D001_CreateCenterLine(NewPt3d, EndPt3d, iLine)
'                    CtrNG = True
'                End If
'            End If
'        Next
'        For Each dtRow As DataRow In tmpDtb2.Rows
'            If CtrNG = True Then
'                If dtRow("CtrUnmatch") <> "" Then
'                    dtRow("CtrUnmatch") = "NG"
'                End If
'            End If

'        Next
'        For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'            If dtInfor3("CtrLineX").ToString = "1" And InStr(dtInfor3("GroupName").ToString, "MONO") > 0 Then
'                dtInfor3("Hole Type") = "Mono有り"
'                dtInforLineOut.AcceptChanges()
'            End If
'        Next
'        Dim icheckX As Boolean
'        Dim icheckY As Boolean
'        Dim icheckBX As Boolean
'        Dim icheckBY As Boolean
'        If CtrOK = True Then
'            If CtrNG = True Then
'                Dim iCheckMononashi As Boolean = False
'                Dim iCheckMono As Boolean = False
'                Dim iCheckBolt As Boolean = False
'                Dim iCheckNut As Boolean = False
'                Dim iCheckALL As Boolean = False
'                For Each dtRowCheck As DataRow In dtInforLineOut.Rows
'                    If InStr(dtRowCheck("Hole Type").ToString.ToUpper, "BOLT") > 0 Or InStr(dtRowCheck("Hole Type").ToString.ToUpper, "NUT") > 0 Or
'                        InStr(dtRowCheck("Hole Type").ToString.ToUpper, "CLIP") > 0 Or InStr(dtRowCheck("Hole Type").ToString.ToUpper, "PIN") > 0 Or
'                        InStr(dtRowCheck("Hole Type").ToString.ToUpper, "RIVET") > 0 Or InStr(dtRowCheck("Hole Type").ToString.ToUpper, "GROM") > 0 Or
'                         InStr(dtRowCheck("Hole Type").ToString.ToUpper, "PLUG") > 0 Or
'                        InStr(dtRowCheck("Hole Type").ToString.ToUpper, "SCREW") > 0 Or dtRowCheck("Hole Type").ToString = "Mono有り" Then
'                        If InStr(dtRowCheck("Hole Type").ToString.ToUpper, "BOLT") > 0 Or InStr(dtRowCheck("Hole Type").ToString.ToUpper, "SCREW") > 0 Then
'                            If Right(dtRowCheck("Sect"), 1) = "X" Then
'                                icheckBX = True
'                            ElseIf Right(dtRowCheck("Sect"), 1) = "Y" Then
'                                icheckBY = True
'                            End If
'                            If icheckBX = True And icheckBY = True Then
'                                iCheckBolt = True
'                            End If

'                        ElseIf InStr(dtRowCheck("Hole Type").ToString.ToUpper, "NUT") > 0 Or InStr(dtRowCheck("Hole Type").ToString.ToUpper, "GROM") > 0 Then
'                            If Right(dtRowCheck("Sect"), 1) = "X" And dtRowCheck("a1") = "1" Then
'                                icheckX = True
'                            ElseIf Right(dtRowCheck("Sect"), 1) = "Y" And dtRowCheck("a1") = "1" Then
'                                icheckY = True
'                            End If
'                            If icheckX = True And icheckY = True Then
'                                iCheckNut = True
'                            End If

'                        Else
'                            iCheckALL = True
'                        End If



'                        If dtRowCheck("CtrLineX").ToString <> "" And dtRowCheck("Sect") = iSect Then
'                            iCheckMono = True
'                        End If
'                    ElseIf InStr(dtRowCheck("Hole Type").ToString.ToUpper, "MONO無し") > 0 Then
'                        iCheckMononashi = True
'                    End If
'                Next
'                If iCheckMono = True Then
'                    iCheckMononashi = False
'                End If

'                If iCheckMono = True Then
'                    If iCheckBolt = True And iCheckNut = True Then
'                        Call 線ズレPMI(iSect, "中心線NG", tmpCsys)
'                        For Each dtRow As DataRow In tmpDtb2.Rows
'                            If dtRow("CtrLineX") <> "" And dtRow("CtrUnmatch") = "NG" Then

'                                For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                                    If dtInfor3("Object Tag").ToString = dtRow("Object Tag").ToString Then

'                                        dtInfor3("CtrUnmatch") = "NG"

'                                        dtInforLineOut.AcceptChanges()

'                                    End If
'                                Next

'                            End If
'                        Next
'                    ElseIf iCheckBolt = True And iCheckNut = False Then
'                        Call 線ズレPMI(iSect, "中心線CA", tmpCsys)
'                        For Each dtRow As DataRow In tmpDtb2.Rows
'                            If dtRow("CtrLineX") <> "" And dtRow("CtrUnmatch") = "NG" Then

'                                For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                                    If dtInfor3("Object Tag").ToString = dtRow("Object Tag").ToString Then

'                                        dtInfor3("CtrUnmatch") = "CA"

'                                        dtInforLineOut.AcceptChanges()

'                                    End If
'                                Next

'                            End If
'                        Next
'                    ElseIf iCheckBolt = False And iCheckNut = True Then
'                        Call 線ズレPMI(iSect, "中心線CA", tmpCsys)
'                        For Each dtRow As DataRow In tmpDtb2.Rows
'                            If dtRow("CtrLineX") <> "" And dtRow("CtrUnmatch") = "NG" Then

'                                For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                                    If dtInfor3("Object Tag").ToString = dtRow("Object Tag").ToString Then

'                                        dtInfor3("CtrUnmatch") = "CA"

'                                        dtInforLineOut.AcceptChanges()

'                                    End If
'                                Next

'                            End If
'                        Next
'                    ElseIf iCheckNut = True And iCheckALL = True Then
'                        Call 線ズレPMI(iSect, "中心線NG", tmpCsys)
'                        For Each dtRow As DataRow In tmpDtb2.Rows
'                            If dtRow("CtrLineX") <> "" And dtRow("CtrUnmatch") = "NG" Then

'                                For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                                    If dtInfor3("Object Tag").ToString = dtRow("Object Tag").ToString Then

'                                        dtInfor3("CtrUnmatch") = "NG"

'                                        dtInforLineOut.AcceptChanges()

'                                    End If
'                                Next

'                            End If
'                        Next

'                    ElseIf iCheckALL = True And iCheckNut = False Then
'                        Call 線ズレPMI(iSect, "中心線NG", tmpCsys)
'                        For Each dtRow As DataRow In tmpDtb2.Rows
'                            If dtRow("CtrLineX") <> "" And dtRow("CtrUnmatch") = "NG" Then

'                                For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                                    If dtInfor3("Object Tag").ToString = dtRow("Object Tag").ToString Then

'                                        dtInfor3("CtrUnmatch") = "NG"

'                                        dtInforLineOut.AcceptChanges()

'                                    End If
'                                Next

'                            End If
'                        Next
'                    End If

'                Else
'                    If iCheckMononashi = True Then
'                        Call 線ズレPMI(iSect, "中心線CA", tmpCsys)
'                        For Each dtRow As DataRow In tmpDtb2.Rows
'                            If dtRow("CtrLineX") <> "" And dtRow("CtrUnmatch") = "NG" Then

'                                For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                                    If dtInfor3("Object Tag").ToString = dtRow("Object Tag").ToString Then

'                                        dtInfor3("CtrUnmatch") = "CA"

'                                        dtInforLineOut.AcceptChanges()

'                                    End If
'                                Next

'                            End If
'                        Next
'                    Else
'                        Call 線ズレPMI(iSect, "中心線CA", tmpCsys)
'                        For Each dtRow As DataRow In tmpDtb2.Rows
'                            If dtRow("CtrLineX") <> "" And dtRow("CtrUnmatch") = "NG" Then

'                                For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                                    If dtInfor3("Object Tag").ToString = dtRow("Object Tag").ToString Then

'                                        dtInfor3("CtrUnmatch") = "CA"

'                                        dtInforLineOut.AcceptChanges()

'                                    End If
'                                Next

'                            End If
'                        Next
'                    End If

'                End If
'                'Call 線ズレPMI(iSect, "中心線ズレ")
'                'For Each dtRow As DataRow In tmpDtb2.Rows
'                '    If dtRow("CtrLineX") <> "" And dtRow("CtrUnmatch") = "NG" Then
'                '        For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                '            If dtInfor3("Object Tag").ToString = dtRow("Object Tag").ToString Then
'                '                dtInfor3("CtrUnmatch") = "NG"
'                '                dtInforLineOut.AcceptChanges()

'                '            End If
'                '        Next

'                '    End If
'                'Next
'            Else
'                Dim iCheckMononashi As Boolean = False
'                Dim iCheckMono As Boolean = False
'                Dim iCheckBolt As Boolean = False
'                Dim iCheckNut As Boolean = False
'                Dim iCheckALL As Boolean = False
'                For Each dtRowCheck As DataRow In dtInforLineOut.Rows
'                    If InStr(dtRowCheck("Hole Type").ToString.ToUpper, "BOLT") > 0 Or InStr(dtRowCheck("Hole Type").ToString.ToUpper, "NUT") > 0 Or
'                        InStr(dtRowCheck("Hole Type").ToString.ToUpper, "CLIP") > 0 Or InStr(dtRowCheck("Hole Type").ToString.ToUpper, "PIN") > 0 Or
'                        InStr(dtRowCheck("Hole Type").ToString.ToUpper, "RIVET") > 0 Or InStr(dtRowCheck("Hole Type").ToString.ToUpper, "GROM") > 0 Or
'                         InStr(dtRowCheck("Hole Type").ToString.ToUpper, "PLUG") > 0 Or
'                        InStr(dtRowCheck("Hole Type").ToString.ToUpper, "SCREW") > 0 Or dtRowCheck("Hole Type").ToString = "Mono有り" Then
'                        If InStr(dtRowCheck("Hole Type").ToString.ToUpper, "BOLT") > 0 Or InStr(dtRowCheck("Hole Type").ToString.ToUpper, "SCREW") > 0 Then
'                            If Right(dtRowCheck("Sect"), 1) = "X" Then
'                                icheckBX = True
'                            ElseIf Right(dtRowCheck("Sect"), 1) = "Y" Then
'                                icheckBY = True
'                            End If
'                            If icheckBX = True And icheckBY = True Then
'                                iCheckBolt = True
'                            End If

'                        ElseIf InStr(dtRowCheck("Hole Type").ToString.ToUpper, "NUT") > 0 Or InStr(dtRowCheck("Hole Type").ToString.ToUpper, "GROM") > 0 Then
'                            If Right(dtRowCheck("Sect"), 1) = "X" And dtRowCheck("a1") = "1" Then
'                                icheckX = True
'                            ElseIf Right(dtRowCheck("Sect"), 1) = "Y" And dtRowCheck("a1") = "1" Then
'                                icheckY = True
'                            End If
'                            If icheckX = True And icheckY = True Then
'                                iCheckNut = True
'                            End If

'                        Else
'                            iCheckALL = True
'                        End If

'                        If dtRowCheck("CtrLineX").ToString <> "" And dtRowCheck("Sect") = iSect Then
'                            iCheckMono = True
'                        End If
'                    ElseIf dtRowCheck("Hole Type").ToString = "Mono無し" Then
'                        iCheckMononashi = True
'                    End If
'                Next
'                If iCheckMono = True Then
'                    iCheckMononashi = False
'                End If
'                If iCheckMono = True Then
'                    If iCheckBolt = True And iCheckNut = True Then
'                        Call 線ズレPMI(iSect, "中心線OK", tmpCsys)
'                        For Each dtRow As DataRow In tmpDtb2.Rows
'                            If dtRow("CtrLineX") <> "" And dtRow("CtrUnmatch") = "OK" Then

'                                For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                                    If dtInfor3("Object Tag").ToString = dtRow("Object Tag").ToString Then

'                                        dtInfor3("CtrUnmatch") = "OK"

'                                        dtInforLineOut.AcceptChanges()

'                                    End If
'                                Next

'                            End If
'                        Next
'                    ElseIf iCheckBolt = True And iCheckNut = False Then
'                        Call 線ズレPMI(iSect, "中心線CA", tmpCsys)
'                        For Each dtRow As DataRow In tmpDtb2.Rows
'                            If dtRow("CtrLineX") <> "" And dtRow("CtrUnmatch") = "OK" Then

'                                For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                                    If dtInfor3("Object Tag").ToString = dtRow("Object Tag").ToString Then

'                                        dtInfor3("CtrUnmatch") = "CA"
'                                        dtInforLineOut.AcceptChanges()

'                                    End If
'                                Next

'                            End If
'                        Next
'                    ElseIf iCheckBolt = False And iCheckNut = True Then
'                        Call 線ズレPMI(iSect, "中心線CA", tmpCsys)
'                        For Each dtRow As DataRow In tmpDtb2.Rows
'                            If dtRow("CtrLineX") <> "" And dtRow("CtrUnmatch") = "OK" Then

'                                For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                                    If dtInfor3("Object Tag").ToString = dtRow("Object Tag").ToString Then

'                                        dtInfor3("CtrUnmatch") = "CA"

'                                        dtInforLineOut.AcceptChanges()

'                                    End If
'                                Next

'                            End If
'                        Next
'                    ElseIf iCheckNut = True And iCheckALL = True Then
'                        Call 線ズレPMI(iSect, "中心線OK", tmpCsys)
'                        For Each dtRow As DataRow In tmpDtb2.Rows
'                            If dtRow("CtrLineX") <> "" And dtRow("CtrUnmatch") = "OK" Then

'                                For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                                    If dtInfor3("Object Tag").ToString = dtRow("Object Tag").ToString Then

'                                        dtInfor3("CtrUnmatch") = "OK"

'                                        dtInforLineOut.AcceptChanges()

'                                    End If
'                                Next

'                            End If
'                        Next

'                    ElseIf iCheckALL = True And iCheckNut = False Then
'                        Call 線ズレPMI(iSect, "中心線OK", tmpCsys)
'                        For Each dtRow As DataRow In tmpDtb2.Rows
'                            If dtRow("CtrLineX") <> "" And dtRow("CtrUnmatch") = "OK" Then

'                                For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                                    If dtInfor3("Object Tag").ToString = dtRow("Object Tag").ToString Then

'                                        dtInfor3("CtrUnmatch") = "OK"

'                                        dtInforLineOut.AcceptChanges()

'                                    End If
'                                Next

'                            End If
'                        Next
'                    End If

'                Else
'                    If iCheckMononashi = True Then
'                        Call 線ズレPMI(iSect, "中心線CA", tmpCsys)
'                        For Each dtRow As DataRow In tmpDtb2.Rows
'                            If dtRow("CtrLineX") <> "" And dtRow("CtrUnmatch") = "OK" Then

'                                For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                                    If dtInfor3("Object Tag").ToString = dtRow("Object Tag").ToString Then

'                                        dtInfor3("CtrUnmatch") = "CA"

'                                        dtInforLineOut.AcceptChanges()

'                                    End If
'                                Next

'                            End If
'                        Next
'                    Else
'                        Call 線ズレPMI(iSect, "中心線CA", tmpCsys)
'                        For Each dtRow As DataRow In tmpDtb2.Rows
'                            If dtRow("CtrLineX") <> "" And dtRow("CtrUnmatch") = "OK" Then

'                                For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                                    If dtInfor3("Object Tag").ToString = dtRow("Object Tag").ToString Then

'                                        dtInfor3("CtrUnmatch") = "CA"

'                                        dtInforLineOut.AcceptChanges()

'                                    End If
'                                Next

'                            End If
'                        Next
'                    End If

'                End If

'            End If
'        Else
'            If CtrNG = True Then

'                Dim iCheckMononashi As Boolean = False
'                Dim iCheckMono As Boolean = False
'                Dim iCheckBolt As Boolean = False
'                Dim iCheckNut As Boolean = False
'                Dim iCheckALL As Boolean = False
'                For Each dtRowCheck As DataRow In dtInforLineOut.Rows
'                    If InStr(dtRowCheck("Hole Type").ToString.ToUpper, "BOLT") > 0 Or InStr(dtRowCheck("Hole Type").ToString.ToUpper, "NUT") > 0 Or
'                        InStr(dtRowCheck("Hole Type").ToString.ToUpper, "CLIP") > 0 Or InStr(dtRowCheck("Hole Type").ToString.ToUpper, "PIN") > 0 Or
'                        InStr(dtRowCheck("Hole Type").ToString.ToUpper, "RIVET") > 0 Or InStr(dtRowCheck("Hole Type").ToString.ToUpper, "GROM") > 0 Or
'                         InStr(dtRowCheck("Hole Type").ToString.ToUpper, "PLUG") > 0 Or
'                        InStr(dtRowCheck("Hole Type").ToString.ToUpper, "SCREW") > 0 Or dtRowCheck("Hole Type").ToString = "Mono有り" Then
'                        If InStr(dtRowCheck("Hole Type").ToString.ToUpper, "BOLT") > 0 Or InStr(dtRowCheck("Hole Type").ToString.ToUpper, "SCREW") > 0 Then
'                            If Right(dtRowCheck("Sect"), 1) = "X" Then
'                                icheckBX = True
'                            ElseIf Right(dtRowCheck("Sect"), 1) = "Y" Then
'                                icheckBY = True
'                            End If
'                            If icheckBX = True And icheckBY = True Then
'                                iCheckBolt = True
'                            End If

'                        ElseIf InStr(dtRowCheck("Hole Type").ToString.ToUpper, "NUT") > 0 Or InStr(dtRowCheck("Hole Type").ToString.ToUpper, "GROM") > 0 Then
'                            If Right(dtRowCheck("Sect"), 1) = "X" Then
'                                icheckX = True
'                            ElseIf Right(dtRowCheck("Sect"), 1) = "Y" Then
'                                icheckY = True
'                            End If
'                            If icheckX = True And icheckY = True Then
'                                iCheckNut = True
'                            End If

'                        Else
'                            iCheckALL = True
'                        End If



'                        If dtRowCheck("CtrLineX").ToString <> "" And dtRowCheck("Sect") = iSect Then
'                            iCheckMono = True
'                        End If
'                    ElseIf InStr(dtRowCheck("Hole Type").ToString.ToUpper, "MONO無し") > 0 Then
'                        iCheckMononashi = True
'                    End If
'                Next
'                If iCheckMono = True Then
'                    iCheckMononashi = False
'                End If

'                If iCheckMono = True Then
'                    If iCheckBolt = True And iCheckNut = True Then
'                        Call 線ズレPMI(iSect, "中心線NG", tmpCsys)
'                        For Each dtRow As DataRow In tmpDtb2.Rows
'                            If dtRow("CtrLineX") <> "" And dtRow("CtrUnmatch") = "NG" Then

'                                For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                                    If dtInfor3("Object Tag").ToString = dtRow("Object Tag").ToString Then

'                                        dtInfor3("CtrUnmatch") = "NG"

'                                        dtInforLineOut.AcceptChanges()

'                                    End If
'                                Next

'                            End If
'                        Next
'                    ElseIf iCheckBolt = True And iCheckNut = False Then
'                        Call 線ズレPMI(iSect, "中心線CA", tmpCsys)
'                        For Each dtRow As DataRow In tmpDtb2.Rows
'                            If dtRow("CtrLineX") <> "" And dtRow("CtrUnmatch") = "NG" Then

'                                For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                                    If dtInfor3("Object Tag").ToString = dtRow("Object Tag").ToString Then

'                                        dtInfor3("CtrUnmatch") = "CA"

'                                        dtInforLineOut.AcceptChanges()

'                                    End If
'                                Next

'                            End If
'                        Next
'                    ElseIf iCheckBolt = False And iCheckNut = True Then
'                        Call 線ズレPMI(iSect, "中心線CA", tmpCsys)
'                        For Each dtRow As DataRow In tmpDtb2.Rows
'                            If dtRow("CtrLineX") <> "" And dtRow("CtrUnmatch") = "NG" Then

'                                For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                                    If dtInfor3("Object Tag").ToString = dtRow("Object Tag").ToString Then

'                                        dtInfor3("CtrUnmatch") = "CA"

'                                        dtInforLineOut.AcceptChanges()

'                                    End If
'                                Next

'                            End If
'                        Next
'                    ElseIf iCheckNut = True And iCheckALL = True Then
'                        Call 線ズレPMI(iSect, "中心線NG", tmpCsys)
'                        For Each dtRow As DataRow In tmpDtb2.Rows
'                            If dtRow("CtrLineX") <> "" And dtRow("CtrUnmatch") = "NG" Then

'                                For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                                    If dtInfor3("Object Tag").ToString = dtRow("Object Tag").ToString Then

'                                        dtInfor3("CtrUnmatch") = "NG"

'                                        dtInforLineOut.AcceptChanges()

'                                    End If
'                                Next

'                            End If
'                        Next

'                    ElseIf iCheckALL = True And iCheckNut = False Then
'                        Call 線ズレPMI(iSect, "中心線NG", tmpCsys)
'                        For Each dtRow As DataRow In tmpDtb2.Rows
'                            If dtRow("CtrLineX") <> "" And dtRow("CtrUnmatch") = "NG" Then

'                                For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                                    If dtInfor3("Object Tag").ToString = dtRow("Object Tag").ToString Then

'                                        dtInfor3("CtrUnmatch") = "NG"

'                                        dtInforLineOut.AcceptChanges()

'                                    End If
'                                Next

'                            End If
'                        Next
'                    End If

'                Else
'                    If iCheckMononashi = True Then
'                        Call 線ズレPMI(iSect, "中心線CA", tmpCsys)
'                        For Each dtRow As DataRow In tmpDtb2.Rows
'                            If dtRow("CtrLineX") <> "" And dtRow("CtrUnmatch") = "NG" Then

'                                For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                                    If dtInfor3("Object Tag").ToString = dtRow("Object Tag").ToString Then

'                                        dtInfor3("CtrUnmatch") = "CA"

'                                        dtInforLineOut.AcceptChanges()

'                                    End If
'                                Next

'                            End If
'                        Next
'                    Else
'                        Call 線ズレPMI(iSect, "中心線CA", tmpCsys)
'                        For Each dtRow As DataRow In tmpDtb2.Rows
'                            If dtRow("CtrLineX") <> "" And dtRow("CtrUnmatch") = "NG" Then

'                                For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                                    If dtInfor3("Object Tag").ToString = dtRow("Object Tag").ToString Then

'                                        dtInfor3("CtrUnmatch") = "CA"

'                                        dtInforLineOut.AcceptChanges()

'                                    End If
'                                Next

'                            End If
'                        Next
'                    End If

'                End If
'                'Call 線ズレPMI(iSect, "中心線ズレ")
'                'For Each dtRow As DataRow In tmpDtb2.Rows
'                '    If dtRow("CtrLineX") <> "" And dtRow("CtrUnmatch") = "NG" Then
'                '        For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                '            If dtInfor3("Object Tag").ToString = dtRow("Object Tag").ToString Then
'                '                dtInfor3("CtrUnmatch") = "NG"
'                '                dtInforLineOut.AcceptChanges()

'                '            End If
'                '        Next

'                '    End If
'                'Next
'            Else
'                Call 線ズレPMI(iSect, "中心線CA", tmpCsys)
'                For Each dtRow As DataRow In tmpDtb2.Rows
'                    If dtRow("CtrLineX") <> "" Then
'                        For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                            If dtInfor3("Object Tag").ToString = dtRow("Object Tag").ToString Then
'                                dtInfor3("CtrUnmatch") = "CA"
'                                dtInforLineOut.AcceptChanges()

'                            End If
'                        Next

'                    End If
'                Next
'            End If


'        End If
'        Call CreateCtrLineOp(tmpCsys)
'        ' ''''lay PMI
'        'Call DeleteDupliateGroup(iSect)
'    End Sub

'    Sub CreateDirBoltCL(ByVal iSect As String, ByVal dtInforLineOut As DataTable, ByVal tmpCsys As CartesianCoordinateSystem, ByVal VectorPMI As Vector3d)
'        Dim dtView1 As New DataView(dtInforLineOut)
'        dtView1.RowFilter = String.Format("[Sect] like '%{0}'", iSect)
'        Dim tmpDtb2 As DataTable = dtInforLineOut.Clone
'        tmpDtb2 = dtView1.ToTable
'        Dim dtView11 As New DataView(tmpDtb2)
'        dtView11.RowFilter = String.Format("[CtrLineY] like '%{0}'", "CL")
'        tmpDtb2 = dtView11.ToTable
'        Dim iVectorPMI As Vector3d = New Vector3d(-VectorPMI.X, -VectorPMI.Y, -VectorPMI.Z)

'        Dim iCheckBolt As Boolean = False
'        Dim icheckCLip As Boolean = False
'        For Each dtr As DataRow In tmpDtb2.Rows
'            If InStr(dtr("GroupName").ToString.ToUpper, "BOLT") > 0 And dtr("d1") < 35 Or InStr(dtr("GroupName").ToString.ToUpper, "STUD-BALL") > 0 And dtr("d1") < 35 Then
'                iCheckBolt = True
'            ElseIf InStr(dtr("GroupName").ToString.ToUpper, "CLIP") > 0 And dtr("d1") < 25 Then
'                icheckCLip = True
'            End If
'        Next
'        If iCheckBolt = True Then
'            Dim LineBoltTag As String
'            Dim LineBoltCL As String
'            For Each dtr As DataRow In tmpDtb2.Rows
'                If InStr(dtr("GroupName").ToString.ToUpper, "BOLT") > 0 Or InStr(dtr("GroupName").ToString.ToUpper, "STUD-BALL") > 0 Then
'                    LineBoltTag = dtr("Object Tag")
'                Else
'                    LineBoltCL = dtr("Object Tag")
'                End If
'            Next
'            Dim Object1Tag As Long = CType(LineBoltTag, Long)
'            Dim Object2Tag As Long = CType(LineBoltCL, Long)
'            Dim guess1(2) As Double
'            Dim guess2(2) As Double
'            Dim pt1(2) As Double
'            Dim pt2(2) As Double
'            Dim minDist As Double
'            theUFSession.Modl.AskMinimumDist(Object1Tag, Object2Tag, 0, guess1, 0, guess2, minDist, pt1, pt2)
'            Dim iPoint1 As String = pt1(0) & "," & pt1(1) & "," & pt1(2)
'            Dim iPoint2 As String = pt2(0) & "," & pt2(1) & "," & pt2(2)

'            'Call PMILineAndPoint(LineBoltTag, iPoint2, Right(iSect, 1), tmpCsys, 0)
'            If minDist < 10 Then
'                Call PMIPointAndPointNew(iPoint1, iPoint2, Right(iSect, 1), tmpCsys, 25, "CL", iVectorPMI)
'            End If

'        ElseIf icheckCLip = True Then
'            Dim LineBoltTag As String
'            Dim LineBoltCL As String
'            For Each dtr As DataRow In tmpDtb2.Rows
'                If InStr(dtr("GroupName").ToString.ToUpper, "CLIP") > 0 Then
'                    LineBoltTag = dtr("Object Tag")
'                Else
'                    LineBoltCL = dtr("Object Tag")
'                End If
'            Next
'            Dim Object1Tag As Long = CType(LineBoltTag, Long)
'            Dim Object2Tag As Long = CType(LineBoltCL, Long)
'            Dim guess1(2) As Double
'            Dim guess2(2) As Double
'            Dim pt1(2) As Double
'            Dim pt2(2) As Double
'            Dim minDist As Double
'            theUFSession.Modl.AskMinimumDist(Object1Tag, Object2Tag, 0, guess1, 0, guess2, minDist, pt1, pt2)
'            Dim iPoint1 As String = pt1(0) & "," & pt1(1) & "," & pt1(2)
'            Dim iPoint2 As String = pt2(0) & "," & pt2(1) & "," & pt2(2)

'            'Call PMILineAndPoint(LineBoltTag, iPoint2, Right(iSect, 1), tmpCsys, 0)
'            If minDist < 10 Then
'                Call PMIPointAndPointNew(iPoint1, iPoint2, Right(iSect, 1), tmpCsys, 25, "CL", iVectorPMI)
'            End If

'        End If

'    End Sub

'    Sub CreateCtrLineOp(ByVal tmpCsys As CartesianCoordinateSystem)
'        Dim NewPt3d As Point3d = New Point3d(tmpCsys.Origin.X + 10 * tmpCsys.Orientation.Element.Zx, tmpCsys.Origin.Y + 10 * tmpCsys.Orientation.Element.Zy, tmpCsys.Origin.Z + 10 * tmpCsys.Orientation.Element.Zz)

'        Dim EndPt3d As Point3d = New Point3d(tmpCsys.Origin.X - 10 * tmpCsys.Orientation.Element.Zx, tmpCsys.Origin.Y - 10 * tmpCsys.Orientation.Element.Zy, tmpCsys.Origin.Z - 10 * tmpCsys.Orientation.Element.Zz)
'        Dim iLine As Line
'        Call D001_CreateCenterLine(NewPt3d, EndPt3d, iLine)
'    End Sub

'    Sub FineInfor2LineNearCsys(ByVal iGrNameList As List(Of String), ByVal dtInforLineOut As DataTable)
'        For Each iGrName As String In iGrNameList
'            Dim itempThick As String
'            Try
'                itempThick = Split(iGrName, "$")(3)
'            Catch ex As Exception
'            End Try
'            If InStr(iGrName.ToUpper, "BOLT") > 0 Or InStr(iGrName.ToUpper, "STUD-BALL") > 0 Or InStr(iGrName.ToUpper, "NUT") > 0 Or InStr(iGrName.ToUpper, "CLIP") > 0 _
'               Or InStr(iGrName.ToUpper, "SCR") > 0 Or InStr(iGrName.ToUpper, "SCREW") > 0 Or InStr(iGrName.ToUpper, "PIN") > 0 _
'               Or InStr(iGrName.ToUpper, "RIVET") > 0 Or InStr(iGrName.ToUpper, "GROM") > 0 Or InStr(iGrName.ToUpper, "PLUG") > 0 _
'               Or InStr(iGrName.ToUpper, "MONO") > 0 Or InStr(iGrName.ToUpper, "OTHER") > 0 Then
'                ''''Truong hop ten Nut co do day
'                If Len(itempThick) < 2 Then

'                ElseIf InStr(iGrName.ToUpper, "MONO") = 0 Or InStr(iGrName.ToUpper, "OTHER") = 0 Then

'                    Try
'                        Call TakeInfor2Line(iGrName, dtInforLineOut, False)
'                    Catch ex As Exception
'                    End Try

'                End If
'            Else

'                Try
'                    Call TakeInfor2Line(iGrName, dtInforLineOut, False)
'                Catch ex As Exception
'                End Try

'            End If
'        Next
'    End Sub

'    Sub FindCtrLine(ByVal iGrTagList As List(Of String), ByVal iGrNameList As List(Of String), ByVal dtInforLineOut As DataTable)
'        Dim icheck As Boolean = False
'        For Each iNameGr As String In iGrNameList
'            Dim itempThick1 As String
'            Try
'                itempThick1 = Split(iNameGr, "$")(3)
'            Catch ex As Exception
'            End Try

'            If InStr(iNameGr.ToUpper, "BOLT") > 0 Or InStr(iNameGr.ToUpper, "STUD-BALL") > 0 Then
'                TakeInfor2LineMono(iNameGr, dtInforLineOut, False)
'                icheck = True
'            ElseIf InStr(iNameGr.ToUpper, "CLIP") > 0 Then
'                TakeInfor2LineMono(iNameGr, dtInforLineOut, False)
'                icheck = True
'            ElseIf InStr(iNameGr.ToUpper, "NUT") > 0 And Len(itempThick1) < 2 Then
'                TakeInfor2LineMono(iNameGr, dtInforLineOut, False)
'                icheck = True
'            ElseIf InStr(iNameGr.ToUpper, "PIN") > 0 Then
'                TakeInfor2LineMono(iNameGr, dtInforLineOut, False)
'                icheck = True
'            ElseIf InStr(iNameGr.ToUpper, "SCR") > 0 Or InStr(iNameGr.ToUpper, "SCREW") > 0 Then
'                TakeInfor2LineMono(iNameGr, dtInforLineOut, False)
'                icheck = True
'            ElseIf InStr(iNameGr.ToUpper, "RIVET") > 0 Then
'                TakeInfor2LineMono(iNameGr, dtInforLineOut, False)
'                icheck = True
'            ElseIf InStr(iNameGr.ToUpper, "GROM") > 0 Or InStr(iNameGr.ToUpper, "GROMMET") > 0 Then
'                TakeInfor2LineMono(iNameGr, dtInforLineOut, False)
'                icheck = True
'            ElseIf InStr(iNameGr.ToUpper, "PLUG") > 0 Then
'                TakeInfor2LineMono(iNameGr, dtInforLineOut, False)
'                icheck = True

'            End If
'        Next
'        If icheck = False Then
'            For Each iNameGr As String In iGrNameList
'                If InStr(iNameGr.ToUpper, "MONO") > 0 Then
'                    TakeInfor2LineMono(iNameGr, dtInforLineOut, False)
'                End If
'            Next
'        End If


'    End Sub

'    Sub FindTypeHole(ByVal iSectList As List(Of String), ByVal iGrNameList As List(Of String), ByVal dtInforLineOut As DataTable)
'        '''Lấy thông tin 2 đường còn lại song song + gần với trục Z nhất của metal
'        For Each iNameGr As String In iGrNameList
'            For Each dtr1 As DataRow In dtInforLineOut.Rows
'                If dtr1("GroupName").ToString = iNameGr And dtr1("Hole Size") <> "" And InStr(dtr1("Hole Type"), "Group") = 0 Then
'                    For Each dtr2 As DataRow In dtInforLineOut.Rows
'                        If dtr2("GroupName").ToString = iNameGr And dtr2("Hole Size") <> "" And InStr(dtr2("Hole Type"), "Group") > 0 And dtr2("Group Tag").ToString = dtr1("Group Tag").ToString Then
'                            dtr2("Hole Type") = dtr1("Hole Type")
'                            dtr2("Result") = 10
'                            dtr1("Result") = 10
'                            dtr2("CtrLineX") = "1"
'                            dtr1("CtrLineX") = "1"

'                        End If
'                    Next
'                ElseIf dtr1("Hole Type").ToString = "Thread Dim" Then
'                    dtr1("Result") = 10
'                End If
'            Next
'        Next
'        '''' xac dinh lo tron hay obl
'        For Each iNameGr As String In iGrNameList
'            Dim iHoleX As Double
'            Dim iHoleY As Double
'            Dim iHoleXTag(1) As String
'            Dim iHoleYTag(1) As String
'            Dim i7 As Integer = 0
'            Dim j7 As Integer = 0
'            Try
'                For Each iSect As String In iSectList
'                    Dim dtView1 As New DataView(dtInforLineOut)
'                    dtView1.RowFilter = String.Format("[Sect] like '%{0}'", iSect)
'                    Dim tmpDtb As DataTable = dtInforLineOut.Clone
'                    tmpDtb = dtView1.ToTable
'                    Dim dtView2 As New DataView(tmpDtb)
'                    dtView2.RowFilter = String.Format("[Result] like '%{0}'", 10)
'                    tmpDtb = dtView2.ToTable
'                    Dim dtView3 As New DataView(tmpDtb)
'                    dtView3.RowFilter = String.Format("[GroupName] like '%{0}'", iNameGr)
'                    tmpDtb = dtView3.ToTable
'                    For Each dtr1 As DataRow In tmpDtb.Rows
'                        If dtr1("Result") = 10 And dtr1("Hole Type") <> "Thread Dim" And Right(iSect, 1).ToString = "X" Then
'                            iHoleX = Math.Round(CType(dtr1("Hole Size").ToString, Double), 2)
'                            'lw.WriteLine("dtr1(GroupName).ToString: " & dtr1("GroupName").ToString)
'                            'lw.WriteLine("---")
'                            'lw.WriteLine("dtr1(Sect).ToString: " & dtr1("Sect").ToString)
'                            'lw.WriteLine("---")
'                            'lw.WriteLine("dtr1(Object Tag).ToString: " & dtr1("Object Tag").ToString)
'                            'lw.WriteLine("---")
'                            'lw.WriteLine("dtr1(d1).ToString: " & dtr1("d1").ToString)

'                            'lw.WriteLine("    ")
'                            iHoleXTag(i7) = dtr1("Object Tag").ToString
'                            i7 += 1
'                        ElseIf dtr1("Result") = 10 And dtr1("Hole Type") <> "Thread Dim" And Right(iSect, 1).ToString = "Y" Then
'                            iHoleY = Math.Round(CType(dtr1("Hole Size").ToString, Double), 2)
'                            iHoleYTag(j7) = dtr1("Object Tag").ToString
'                            j7 += 1
'                        End If
'                    Next

'                Next
'            Catch ex As Exception

'            End Try
'            If iHoleX = iHoleY Then
'                For Each dtr1 As DataRow In dtInforLineOut.Rows
'                    If dtr1("Object Tag").ToString = iHoleXTag(0) Then
'                        dtr1("Hole Type") = dtr1("Hole Type") & "_C"
'                    ElseIf dtr1("Object Tag").ToString = iHoleYTag(0) Then
'                        dtr1("Hole Type") = dtr1("Hole Type") & "_C"
'                    ElseIf dtr1("Object Tag").ToString = iHoleXTag(1) Then
'                        dtr1("Hole Type") = dtr1("Hole Type") & "_C"
'                    ElseIf dtr1("Object Tag").ToString = iHoleYTag(1) Then
'                        dtr1("Hole Type") = dtr1("Hole Type") & "_C"
'                    End If
'                Next
'            Else
'                For Each dtr1 As DataRow In dtInforLineOut.Rows
'                    If dtr1("Object Tag").ToString = iHoleXTag(0) Then
'                        dtr1("Hole Type") = dtr1("Hole Type") & "_H"
'                    ElseIf dtr1("Object Tag").ToString = iHoleYTag(0) Then
'                        dtr1("Hole Type") = dtr1("Hole Type") & "_H"
'                    ElseIf dtr1("Object Tag").ToString = iHoleXTag(1) Then
'                        dtr1("Hole Type") = dtr1("Hole Type") & "_H"
'                    ElseIf dtr1("Object Tag").ToString = iHoleYTag(1) Then
'                        dtr1("Hole Type") = dtr1("Hole Type") & "_H"
'                    End If
'                Next
'            End If
'        Next
'    End Sub

'    Sub FindDataTrim(ByVal iGrNameList As List(Of String), ByVal dtInforLineOut As DataTable)
'        For Each iGrName1 As String In iGrNameList
'            Dim itempThick As String
'            Try
'                itempThick = Split(iGrName1, "$")(3)
'            Catch ex As Exception

'            End Try
'            If InStr(iGrName1.ToUpper, "BOLT") > 0 Or InStr(iGrName1.ToUpper, "STUD-BALL") > 0 Or InStr(iGrName1.ToUpper, "NUT") > 0 Or InStr(iGrName1.ToUpper, "CLIP") > 0 Or Len(itempThick) > 1 _
'                    Or InStr(iGrName1.ToUpper, "SCR") > 0 Or InStr(iGrName1.ToUpper, "SCREW") > 0 Or InStr(iGrName1.ToUpper, "PIN") > 0 Or Left(iGrName1.ToUpper, 3) = "PIN" _
'                    Or InStr(iGrName1.ToUpper, "RIVET") > 0 Or InStr(iGrName1.ToUpper, "GROM") > 0 Or InStr(iGrName1.ToUpper, "PLUG") > 0 _
'                    Or InStr(iGrName1.ToUpper, "MONO") > 0 Or InStr(iGrName1.ToUpper, "OTHER") > 0 Then

'            Else

'                Dim dtView1 As New DataView(dtInforLineOut)
'                Dim strFill1 As String = "GroupName = " & iGrName1
'                dtView1.RowFilter = String.Format("[GroupName] like '%{0}'", iGrName1)
'                Dim tmpDtb As DataTable = dtInforLineOut.Clone
'                tmpDtb = dtView1.ToTable

'                Dim icheckHole As Boolean = False
'                For Each dtRowTemp As DataRow In tmpDtb.Rows
'                    If dtRowTemp("Hole Size").ToString <> "" Then
'                        icheckHole = True
'                    End If
'                Next

'                If icheckHole = True Then

'                    Dim iCheckBolt1 As Double = 1
'                    For Each dtRowTemp As DataRow In tmpDtb.Rows
'                        If dtRowTemp("Hole Size").ToString <> "" Then

'                            For Each dtRowTemp2 As DataRow In tmpDtb.Rows
'                                If dtRowTemp2("a1") = "0" And dtRowTemp2("Hole Size") = "" Then

'                                    Dim Object1Tag As Long = CType(dtRowTemp("Object Tag").ToString, Long)
'                                    Dim Object2Tag As Long = CType(dtRowTemp2("Object Tag").ToString, Long)
'                                    Dim guess1(2) As Double
'                                    Dim guess2(2) As Double
'                                    Dim pt1(2) As Double
'                                    Dim pt2(2) As Double
'                                    Dim minDist As Double
'                                    theUFSession.Modl.AskMinimumDist(Object1Tag, Object2Tag, 0, guess1, 0, guess2, minDist, pt1, pt2)
'                                    If minDist < 0.01 Then
'                                        iCheckBolt1 += 1
'                                    End If

'                                End If
'                            Next

'                        End If
'                    Next

'                    If iCheckBolt1 > 3 Then

'                    Else

'                        For Each dtRowTemp As DataRow In tmpDtb.Rows
'                            If dtRowTemp("Hole Size").ToString <> "" Then

'                                For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                                    If dtInfor3("Object Tag").ToString = dtRowTemp("Object Tag").ToString Then

'                                        dtInfor3("Hole Size") = ""
'                                        dtInfor3("Hole Type") = ""
'                                        dtInforLineOut.AcceptChanges()

'                                    End If
'                                Next

'                            End If
'                        Next

'                    End If

'                End If

'            End If
'        Next
'    End Sub

'    Sub FindABCData(ByVal dtInforLineOut As DataTable, ByVal ResultCout As Integer, ByVal DanmenXY As String, ByVal dtGr As DataRow, ByVal TypeWeld As String)
'        Dim icheckABC As Boolean = False
'        For Each dtGr1 As DataRow In dtInforLineOut.Rows
'            If InStr(dtGr1("GroupName").ToString, "BOLT") > 0 Or InStr(dtGr1("GroupName").ToString, "STUD-BALL") > 0 Or InStr(dtGr1("GroupName").ToString, "NUT") > 0 Or InStr(dtGr1("GroupName").ToString, "CLIP") > 0 _
'                    Or InStr(dtGr1("GroupName").ToString, "SCR") > 0 Or InStr(dtGr1("GroupName").ToString, "SCREW") > 0 Or InStr(dtGr1("GroupName").ToString, "PIN") > 0 _
'                    Or InStr(dtGr1("GroupName").ToString, "RIVET") > 0 Or InStr(dtGr1("GroupName").ToString, "GROM") > 0 Or InStr(dtGr1("GroupName").ToString, "PLUG") > 0 _
'                    Or InStr(dtGr1("GroupName").ToString, "MONO") > 0 Then
'            Else
'                If dtGr1("Xg") <> 0 And dtGr1("Object Tag").ToString <> dtGr("Object Tag").ToString And Right(dtGr1("Sect").ToString, 1) = DanmenXY And dtGr1("Hole Size").ToString <> "" Then

'                    Dim pt3d1 As New Point3d(dtGr1("Xg"), dtGr1("Yg"), dtGr1("Zg"))
'                    Dim pt3d2 As New Point3d(dtGr("Xg"), dtGr("Yg"), dtGr("Zg"))
'                    'If InStr(TypeWeld, "WELD") > 0 Then
'                    '    If DistanceOf2Pt(pt3d1, pt3d2) < 16 Then
'                    '        dtGr1("DistTemp") = DistanceOf2Pt(pt3d1, pt3d2)
'                    '        dtGr1("Result") = ResultCout
'                    '        icheckABC = True
'                    ''    End If
'                    'Else
'                    dtGr1("DistTemp") = DistanceOf2Pt(pt3d1, pt3d2)
'                    dtGr1("Result") = ResultCout
'                    icheckABC = True
'                    'End If


'                End If
'            End If

'        Next
'        dtInforLineOut.AcceptChanges()
'        If icheckABC = True Then
'            Dim dtView1 As New DataView(dtInforLineOut)
'            dtView1.RowFilter = String.Format("[Result] like '%{0}'", ResultCout)
'            Dim tmpDtb2 As DataTable = dtInforLineOut.Clone
'            tmpDtb2 = dtView1.ToTable

'            If TypeWeld = "WELD_BOLT" Then
'                tmpDtb2.DefaultView.Sort = "DistTemp DESC"
'            ElseIf TypeWeld = "WELD_NUT" Then
'                tmpDtb2.DefaultView.Sort = "DistTemp"
'            Else
'                For Each dtR As DataRow In tmpDtb2.Rows
'                    If dtR("Hole Size") <> "WELD" And dtR("Hole Size") <> "" Then
'                        dtR("DistTemp") = CType(dtR("Hole Size").ToString, Double)
'                    End If
'                Next
'                Dim dtView3 As New DataView(tmpDtb2)
'                dtView3.Sort = "DistTemp"
'                tmpDtb2 = dtView3.ToTable
'                tmpDtb2.AcceptChanges()
'                For Each drSize As DataRow In tmpDtb2.Rows
'                    'lw.WriteLine(drSize("DistTemp"))
'                    If drSize("DistTemp") <> 0 Then
'                        For Each drSize1 As DataRow In dtInforLineOut.Rows
'                            If InStr(drSize1("GroupName").ToString, "BOLT") > 0 Or InStr(drSize1("GroupName").ToString, "STUD-BALL") > 0 Or InStr(drSize1("GroupName").ToString, "NUT") > 0 Or InStr(drSize1("GroupName").ToString, "CLIP") > 0 _
'                                Or InStr(drSize1("GroupName").ToString, "SCR") > 0 Or InStr(drSize1("GroupName").ToString, "SCREW") > 0 Or InStr(drSize1("GroupName").ToString, "PIN") > 0 _
'                                    Or InStr(drSize1("GroupName").ToString, "RIVET") > 0 Or InStr(drSize1("GroupName").ToString, "GROM") > 0 Or InStr(drSize1("GroupName").ToString, "PLUG") > 0 _
'                                        Or InStr(drSize1("GroupName").ToString, "MONO") > 0 Then
'                            Else

'                                If drSize1("Xg") <> 0 And drSize1("Object Tag").ToString <> drSize("Object Tag").ToString And Right(drSize1("Sect").ToString, 1) = DanmenXY And drSize1("Hole Size").ToString <> "" Then

'                                    Dim pt3d3 As New Point3d(drSize1("Xg"), drSize1("Yg"), drSize1("Zg"))
'                                    Dim pt3d4 As New Point3d(drSize("Xg"), drSize("Yg"), drSize("Zg"))
'                                    drSize1("DistTemp") = DistanceOf2Pt(pt3d3, pt3d4)
'                                    drSize1("Result") = ResultCout

'                                ElseIf drSize1("Xg") <> 0 And drSize1("Object Tag").ToString = drSize("Object Tag").ToString And Right(drSize1("Sect").ToString, 1) = DanmenXY And drSize1("Hole Size").ToString <> "" Then
'                                    drSize1("DistTemp") = 0
'                                    drSize1("Result") = ResultCout
'                                End If
'                            End If
'                        Next
'                        Dim dtView11 As New DataView(dtInforLineOut)
'                        dtView11.RowFilter = String.Format("[Result] like '%{0}'", ResultCout)
'                        tmpDtb2 = dtView11.ToTable
'                        tmpDtb2.DefaultView.Sort = "DistTemp"
'                        Exit For
'                    End If
'                Next
'                'tmpDtb2.DefaultView.Sort = "DistTemp"
'            End If

'            Dim dtSort As DataTable = tmpDtb2.DefaultView.ToTable()
'            dtSort.AcceptChanges()
'            Dim iStty As Integer = 0
'            Dim Alphabet As String = ("ABCDEFGH")
'            For Each dtBui As DataRow In dtSort.Rows
'                For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                    If dtInfor3("Object Tag").ToString = dtBui("Object Tag").ToString Then

'                        dtInfor3("Hole Type") = Alphabet(iStty) & "_Dir" & DanmenXY
'                        iStty += 1
'                        dtInforLineOut.AcceptChanges()

'                    End If
'                Next
'            Next
'        End If

'    End Sub

'    Sub FindLineBoltCL(ByVal iGrSectList As List(Of String), ByVal dtInforLineOut As DataTable, ByRef iGrNameList As List(Of String), ByVal tmpCsys As CartesianCoordinateSystem)
'        Dim theSession As Session = Session.GetSession()
'        Dim workPart As Part = theSession.Parts.Work
'        For Each iGrName As String In iGrNameList

'            If InStr(iGrName.ToUpper, "BOLT") > 0 Or InStr(iGrName.ToUpper, "STUD-BALL") > 0 Or InStr(iGrName.ToUpper, "NUT") > 0 Or InStr(iGrName.ToUpper, "CLIP") > 0 _
'                    Or InStr(iGrName.ToUpper, "SCR") > 0 Or InStr(iGrName.ToUpper, "SCREW") > 0 Or InStr(iGrName.ToUpper, "PIN") > 0 Or Left(iGrName.ToUpper, 3) = "PIN" _
'                    Or InStr(iGrName.ToUpper, "RIVET") > 0 Or InStr(iGrName.ToUpper, "GROM") > 0 Or InStr(iGrName.ToUpper, "PLUG") > 0 _
'                    Or InStr(iGrName.ToUpper, "MONO") > 0 Or InStr(iGrName.ToUpper, "OTHER") > 0 Then

'            Else
'                Dim iCheckDataArr As Boolean = True
'                For Each dtr As DataRow In dtInforLineOut.Rows
'                    If dtr("GroupName") = iGrName And dtr("Hole Type") <> "" Then
'                        For Each dtr1 As DataRow In dtInforLineOut.Rows
'                            If dtr1("GroupName").ToString = dtr("GroupName").ToString Then
'                            Else
'                                Try
'                                    If Left(Split(dtr1("GroupName").ToString, "$")(1), 11) = Left(Split(dtr("GroupName").ToString, "$")(1), 11) Then
'                                        dtr1("BoltCL") = "Del"
'                                    End If
'                                Catch ex As Exception
'                                    dtr1("BoltCL") = "Del"
'                                End Try


'                            End If
'                        Next
'                        iCheckDataArr = False
'                    End If
'                Next
'                If iCheckDataArr = True Then
'                    For Each dtr As DataRow In dtInforLineOut.Rows
'                        If dtr("GroupName") = iGrName And dtr("BoltCL") = "" Then
'                            dtr("BoltCL") = "CL"
'                        End If
'                    Next
'                End If

'            End If
'        Next
'        For Each iSect As String In iGrSectList
'            Dim icheckNut As Boolean = False
'            Dim iCtrNutPoint As Point3d
'            For Each dtrNut As DataRow In dtInforLineOut.Rows
'                If dtrNut("Xg") <> 0 And dtrNut("Sect") = iSect And InStr(dtrNut("Hole Type").ToString.ToUpper, "NUT") > 0 Then
'                    iCtrNutPoint = New Point3d(dtrNut("Xg"), dtrNut("Yg"), dtrNut("Zg"))
'                    icheckNut = True
'                End If
'            Next
'            Dim iPoint3DCS As Point3d = New Point3d(tmpCsys.Origin.X, tmpCsys.Origin.Y, tmpCsys.Origin.Z)
'            Dim iPointLine As Point3d
'            Dim iPtCs As NXOpen.Point
'            iPtCs = workPart.Points.CreatePoint(iPoint3DCS)
'            Dim iVector As Vector3d = New Vector3d(iCtrNutPoint.X - tmpCsys.Origin.X, iCtrNutPoint.Y - tmpCsys.Origin.Y, iCtrNutPoint.Z - tmpCsys.Origin.Z)
'            'lw.WriteLine(iVector.ToString)
'            Create_LineEquation_From_Point_And_DirectionVector(iPoint3DCS, iVector, 100, iPointLine)
'            Dim iPoint100 As NXOpen.Point
'            iPoint100 = workPart.Points.CreatePoint(iPointLine)
'            'iPoint100.SetVisibility(SmartObject.VisibilityOption.Visible)

'            For Each iGrName As String In iGrNameList
'                If InStr(iGrName.ToUpper, "BOLT") > 0 Or InStr(iGrName.ToUpper, "STUD-BALL") > 0 Or InStr(iGrName.ToUpper, "SCREW") > 0 Or InStr(iGrName.ToUpper, "SCR") > 0 Then
'                    If icheckNut = True Then
'                        'lw.WriteLine(iGrName.ToUpper)
'                        Dim dtView1 As New DataView(dtInforLineOut)
'                        Dim strFill1 As String = "GroupName = " & iGrName
'                        dtView1.RowFilter = String.Format("[GroupName] like '%{0}'", iGrName)
'                        Dim tmpDtb As DataTable = dtInforLineOut.Clone
'                        tmpDtb = dtView1.ToTable

'                        Dim dtView11 As New DataView(tmpDtb)
'                        dtView11.RowFilter = String.Format("[Sect] like '%{0}'", iSect)
'                        tmpDtb = dtView11.ToTable

'                        Dim tmpDtb1 As DataTable = dtInforLineOut.Clone
'                        tmpDtb1 = dtView11.ToTable

'                        Dim dtView2 As New DataView(tmpDtb)
'                        dtView2.RowFilter = String.Format("[a1] like '%{0}'", 0)
'                        tmpDtb = dtView2.ToTable
'                        Dim LineBoltTag As String
'                        Dim tmpMin1 As Double = 1000
'                        Dim iLinePtd0 As Point3d
'                        Dim iLinePtc0 As Point3d
'                        For Each dtRow1 As DataRow In tmpDtb.Rows
'                            Dim minDist As Double
'                            Call MinDist2Obj(iPoint100.Tag, dtRow1("Object Tag").ToString, minDist, Nothing, Nothing)
'                            If tmpMin1 > minDist Then
'                                tmpMin1 = minDist
'                                LineBoltTag = dtRow1("Object Tag").ToString
'                                iLinePtd0 = New Point3d(dtRow1("Xd"), dtRow1("Yd"), dtRow1("Zd"))
'                                iLinePtc0 = New Point3d(dtRow1("Xc"), dtRow1("Yc"), dtRow1("Zc"))
'                            End If
'                        Next
'                        Dim dtView3 As New DataView(dtInforLineOut)
'                        dtView3.RowFilter = String.Format("[BoltCL] like '%{0}'", "CL")
'                        Dim tmpDtb3 As DataTable = dtInforLineOut.Clone
'                        tmpDtb3 = dtView3.ToTable

'                        Dim tmpI As String, tmpJ As String, tmpMin As Double
'                        tmpMin = 1000

'                        Dim iMinCL As Double
'                        Dim dtView31 As New DataView(tmpDtb3)
'                        dtView31.RowFilter = String.Format("[Sect] like '%{0}'", iSect)
'                        tmpDtb3 = dtView31.ToTable
'                        For Each dtr As DataRow In tmpDtb3.Rows
'                            Dim minDist As Double
'                            Dim ipt1 As Point3d
'                            Dim ipt2 As Point3d
'                            Call MinDist2Obj(LineBoltTag, dtr("Object Tag").ToString, minDist, ipt1, ipt2)
'                            If tmpMin > minDist Then
'                                Dim iLinePt1 As Point3d = New Point3d(ipt2.X, ipt2.Y, ipt2.Z)
'                                Dim iLinePt0 As Point3d = New Point3d(ipt1.X, ipt1.Y, ipt1.Z)
'                                Dim minDist2 As Double
'                                Call MinDist2Obj(iPtCs.Tag, dtr("Object Tag").ToString, minDist2, Nothing, Nothing)
'                                If minDist2 > minDist Then
'                                    tmpMin = minDist
'                                    tmpI = LineBoltTag
'                                    tmpJ = dtr("Object Tag")
'                                    iMinCL = minDist
'                                End If
'                            End If
'                        Next
'                        For Each dtr As DataRow In dtInforLineOut.Rows

'                            If dtr("Object Tag").ToString = tmpJ Or dtr("Object Tag").ToString = tmpI Then
'                                If dtr("Sect") = iSect Then
'                                    dtr("CtrLineY") = "CL"
'                                    dtr("BoltCL") = Math.Round(iMinCL, 2)
'                                End If

'                            ElseIf dtr("BoltCL").ToString = "CL" Or dtr("BoltCL").ToString = "Del" Then
'                                If dtr("Sect") = iSect Then
'                                    dtr("BoltCL") = ""
'                                End If
'                            End If
'                        Next
'                    Else
'                        Dim dtView1 As New DataView(dtInforLineOut)
'                        Dim strFill1 As String = "GroupName = " & iGrName
'                        dtView1.RowFilter = String.Format("[GroupName] like '%{0}'", iGrName)
'                        Dim tmpDtb As DataTable = dtInforLineOut.Clone
'                        tmpDtb = dtView1.ToTable

'                        Dim dtView11 As New DataView(tmpDtb)
'                        dtView11.RowFilter = String.Format("[Sect] like '%{0}'", iSect)
'                        tmpDtb = dtView11.ToTable

'                        Dim dtView2 As New DataView(tmpDtb)
'                        dtView2.RowFilter = String.Format("[a1] like '%{0}'", 0)
'                        tmpDtb = dtView2.ToTable

'                        Dim dtView12 As New DataView(tmpDtb)
'                        dtView12.Sort = "d1 DESC"
'                        tmpDtb = dtView12.ToTable


'                        Dim dtView3 As New DataView(dtInforLineOut)
'                        dtView3.RowFilter = String.Format("[BoltCL] like '%{0}'", "CL")
'                        Dim tmpDtb3 As DataTable = dtInforLineOut.Clone
'                        tmpDtb3 = dtView3.ToTable

'                        Dim tmpI As String, tmpJ As String, tmpMin As Double
'                        tmpMin = 1000
'                        Dim LineBoltTag As String
'                        Dim iMinCL As Double
'                        Dim dtView31 As New DataView(tmpDtb3)
'                        dtView31.RowFilter = String.Format("[Sect] like '%{0}'", iSect)
'                        tmpDtb3 = dtView31.ToTable
'                        For Each dtr1 As DataRow In tmpDtb.Rows
'                            For Each dtr As DataRow In tmpDtb3.Rows
'                                If InStr(dtr("GroupName").ToString.ToUpper, "BOLT") > 0 Or InStr(dtr("GroupName").ToString.ToUpper, "STUD-BALL") > 0 _
'                                    Or InStr(dtr("GroupName").ToString.ToUpper, "SCREW") > 0 Or InStr(dtr("GroupName").ToString.ToUpper, "SCR") > 0 Then

'                                Else
'                                    Dim iCheckMetal As String
'                                    Try

'                                        iCheckMetal = Split(dtr("GroupName").ToString, "$")(3)

'                                    Catch ex As Exception
'                                        iCheckMetal = 100
'                                    End Try
'                                    Dim minDist As Double
'                                    Call MinDist2Obj(dtr1("Object Tag").ToString, dtr("Object Tag").ToString, minDist, Nothing, Nothing)
'                                    If minDist < 0.1 Then
'                                        If Len(iCheckMetal) < 2 Then
'                                        Else
'                                            If Len(iCheckMetal) = 2 And CType(Right(iCheckMetal, 1), Double) = 0 Then
'                                            Else
'                                                If tmpMin > minDist Then
'                                                    Dim minDist2 As Double
'                                                    Call MinDist2Obj(iPtCs.Tag, dtr("Object Tag").ToString, minDist2, Nothing, Nothing)
'                                                    If minDist2 > minDist Then
'                                                        tmpMin = minDist
'                                                        tmpI = dtr1("Object Tag").ToString
'                                                        tmpJ = dtr("Object Tag")
'                                                        iMinCL = minDist
'                                                    End If
'                                                End If
'                                            End If

'                                        End If
'                                    Else
'                                        'lw.WriteLine(iCheckMetal)
'                                        If Len(iCheckMetal) < 2 Then

'                                        Else
'                                            If Len(iCheckMetal) = 2 And CType(Right(iCheckMetal, 1), Double) = 0 Then

'                                            Else
'                                                If tmpMin > minDist Then
'                                                    Dim minDist2 As Double
'                                                    Call MinDist2Obj(iPtCs.Tag, dtr("Object Tag").ToString, minDist2, Nothing, Nothing)
'                                                    If minDist2 > minDist Then
'                                                        tmpMin = minDist
'                                                        tmpI = dtr1("Object Tag").ToString
'                                                        tmpJ = dtr("Object Tag")
'                                                        iMinCL = minDist
'                                                    End If
'                                                End If
'                                            End If

'                                        End If
'                                    End If
'                                End If

'                            Next
'                        Next

'                        For Each dtr As DataRow In dtInforLineOut.Rows

'                            If dtr("Object Tag").ToString = tmpJ Or dtr("Object Tag").ToString = tmpI Then
'                                If dtr("Sect") = iSect Then
'                                    dtr("CtrLineY") = "CL"
'                                    dtr("BoltCL") = Math.Round(iMinCL, 2)
'                                End If

'                            ElseIf dtr("BoltCL").ToString = "CL" Or dtr("BoltCL").ToString = "Del" Then
'                                If dtr("Sect") = iSect Then
'                                    dtr("BoltCL") = ""
'                                End If
'                            End If
'                        Next

'                    End If


'                Else
'                    If InStr(iGrName.ToUpper, "CLIP") > 0 Then

'                        Dim iCsPoint As Point3d = New Point3d(tmpCsys.Origin.X, tmpCsys.Origin.Y, tmpCsys.Origin.Z)
'                        Dim ptObj1 As NXOpen.Point
'                        'Dim TempTable As DataTable = dtInforLineOut
'                        ptObj1 = workPart.Points.CreatePoint(iCsPoint)

'                        Dim dtView1 As New DataView(dtInforLineOut)
'                        dtView1.RowFilter = String.Format("[GroupName] like '%{0}'", iGrName)
'                        Dim tmpDtb As DataTable = dtInforLineOut.Clone
'                        tmpDtb = dtView1.ToTable

'                        Dim dtView11 As New DataView(tmpDtb)
'                        dtView11.RowFilter = String.Format("[Sect] like '%{0}'", iSect)
'                        tmpDtb = dtView11.ToTable

'                        Dim dtView12 As New DataView(tmpDtb)
'                        dtView12.Sort = "d1 DESC"
'                        tmpDtb = dtView12.ToTable
'                        Dim iCount As Integer = 0
'                        Dim iGrTagClipCheck As New List(Of String)
'                        For Each dtr As DataRow In tmpDtb.Rows
'                            If iGrTagClipCheck.Contains(dtr("Group Tag").ToString) = False Then
'                                iCount += 1
'                            End If
'                        Next
'                        If iCount > 1 Then
'                            Try
'                                Dim iGrTagClip As New List(Of String)
'                                Dim iGrtag As String
'                                For Each dtr As DataRow In tmpDtb.Rows
'                                    If iGrTagClip.Contains(dtr("Group Tag").ToString) = False Then
'                                        iGrTagClip.Add(dtr("Group Tag").ToString)
'                                        Dim tmpDtTag As DataTable = tmpDtb.Clone
'                                        Dim dtView4 As New DataView(tmpDtb)
'                                        dtView4.RowFilter = String.Format("[Group Tag] like '%{0}'", dtr("Group Tag").ToString)
'                                        tmpDtTag = dtView4.ToTable
'                                        Dim Xtt As Double = CType(tmpDtTag.Compute("Avg([Xm])", ""), Double)
'                                        Dim Ytt As Double = CType(tmpDtTag.Compute("Avg([Ym])", ""), Double)
'                                        Dim Ztt As Double = CType(tmpDtTag.Compute("Avg([Zm])", ""), Double)
'                                        Dim iTrongtam As String = Xtt & "," & Ytt & "," & Ztt
'                                        Dim iMidPoint As Point3d = New Point3d(Xtt, Ytt, Ztt)
'                                        Dim ptObj2 As NXOpen.Point
'                                        ptObj2 = workPart.Points.CreatePoint(iMidPoint)
'                                        Dim mindist As Double
'                                        Call MinDist2Obj(ptObj1.Tag, ptObj2.Tag, mindist, Nothing, Nothing)
'                                        If mindist < 10 Then
'                                            iGrtag = dtr("Group Tag").ToString
'                                        End If

'                                    End If
'                                Next

'                                Dim dtView5 As New DataView(tmpDtb)
'                                dtView5.RowFilter = String.Format("[Group Tag] like '%{0}'", iGrtag)
'                                tmpDtb = dtView5.ToTable
'                            Catch ex As Exception

'                            End Try

'                        End If

'                        Dim dtView3 As New DataView(dtInforLineOut)
'                        dtView3.RowFilter = String.Format("[BoltCL] like '%{0}'", "CL")
'                        Dim tmpDtb3 As DataTable = dtInforLineOut.Clone
'                        tmpDtb3 = dtView3.ToTable

'                        Dim tmpI As String, tmpJ As String, tmpMin As Double
'                        tmpMin = 1000
'                        Dim LineBoltTag As String
'                        Dim iMinCL As Double
'                        Dim dtView31 As New DataView(tmpDtb3)
'                        dtView31.RowFilter = String.Format("[Sect] like '%{0}'", iSect)
'                        tmpDtb3 = dtView31.ToTable
'                        For Each dtr1 As DataRow In tmpDtb.Rows
'                            For Each dtr As DataRow In tmpDtb3.Rows
'                                If InStr(dtr("GroupName").ToString.ToUpper, "CLIP") > 0 Then

'                                Else
'                                    Dim iCheckMetal As String
'                                    Try

'                                        iCheckMetal = Split(dtr("GroupName").ToString, "$")(3)

'                                    Catch ex As Exception
'                                        iCheckMetal = 100
'                                    End Try

'                                    Dim minDist As Double
'                                    Call MinDist2Obj(dtr1("Object Tag").ToString, dtr("Object Tag").ToString, minDist, Nothing, Nothing)
'                                    If minDist < 0.1 Then
'                                        If Len(iCheckMetal) < 2 Then
'                                        Else
'                                            If Len(iCheckMetal) = 2 And CType(Right(iCheckMetal, 1), Double) = 0 Then
'                                            Else
'                                                If tmpMin > minDist Then

'                                                    Dim minDist2 As Double
'                                                    Call MinDist2Obj(iPtCs.Tag, dtr("Object Tag").ToString, minDist2, Nothing, Nothing)
'                                                    If minDist2 > minDist Then
'                                                        tmpMin = minDist
'                                                        tmpI = dtr1("Object Tag").ToString
'                                                        tmpJ = dtr("Object Tag")
'                                                        iMinCL = minDist
'                                                    End If
'                                                End If
'                                            End If

'                                        End If
'                                    Else
'                                        'lw.WriteLine(iCheckMetal)
'                                        If Len(iCheckMetal) < 2 Then

'                                        Else
'                                            If Len(iCheckMetal) = 2 And CType(Right(iCheckMetal, 1), Double) = 0 Then

'                                            Else
'                                                If tmpMin > minDist Then

'                                                    Dim minDist2 As Double
'                                                    Call MinDist2Obj(iPtCs.Tag, dtr("Object Tag").ToString, minDist2, Nothing, Nothing)
'                                                    If minDist2 > minDist Then
'                                                        tmpMin = minDist
'                                                        tmpI = dtr1("Object Tag").ToString
'                                                        tmpJ = dtr("Object Tag")
'                                                        iMinCL = minDist
'                                                    End If
'                                                End If
'                                            End If

'                                        End If
'                                    End If
'                                End If

'                            Next
'                        Next

'                        For Each dtr As DataRow In dtInforLineOut.Rows

'                            If dtr("Object Tag").ToString = tmpJ Or dtr("Object Tag").ToString = tmpI Then
'                                If dtr("Sect") = iSect Then
'                                    dtr("CtrLineY") = "CL"
'                                    dtr("BoltCL") = Math.Round(iMinCL, 2)
'                                End If

'                            ElseIf dtr("BoltCL").ToString = "CL" Or dtr("BoltCL").ToString = "Del" Then
'                                If dtr("Sect") = iSect Then
'                                    dtr("BoltCL") = ""
'                                End If
'                            End If
'                        Next

'                    End If

'                End If

'            Next
'        Next

'    End Sub

'    Sub FindBoltNoName(ByVal iGrSectList As List(Of String), ByVal iGrNameList As List(Of String), ByVal dtInforLineOut As DataTable, ByVal tmpCsys As CartesianCoordinateSystem)
'        Dim iPtCsys As Point3d = New Point3d(tmpCsys.Origin.X, tmpCsys.Origin.Y, tmpCsys.Origin.Z)
'        Dim iZCS(2) As Double
'        Dim iXCS(2) As Double
'        Dim iYCS(2) As Double
'        Dim theSession As Session = Session.GetSession()
'        Dim workpart As Part = theSession.Parts.Work
'        Dim ptObj1 = workpart.Points.CreatePoint(iPtCsys)
'        Dim iMatrix As Matrix3x3 = tmpCsys.Orientation.Element

'        iZCS(0) = iMatrix.Zx.ToString
'        iZCS(1) = iMatrix.Zy.ToString
'        iZCS(2) = iMatrix.Zz.ToString

'        iXCS(0) = iMatrix.Xx.ToString
'        iXCS(1) = iMatrix.Xy.ToString
'        iXCS(2) = iMatrix.Xz.ToString

'        iYCS(0) = iMatrix.Yx.ToString
'        iYCS(1) = iMatrix.Yy.ToString
'        iYCS(2) = iMatrix.Yz.ToString


'        For Each iSect As String In iGrSectList
'            For Each iGrName As String In iGrNameList

'                If InStr(iGrName.ToUpper, "BOLT") > 0 Or InStr(iGrName.ToUpper, "STUD-BALL") > 0 Or InStr(iGrName.ToUpper, "NUT") > 0 Or InStr(iGrName.ToUpper, "CLIP") > 0 _
'                        Or InStr(iGrName.ToUpper, "SCR") > 0 Or InStr(iGrName.ToUpper, "SCREW") > 0 Or InStr(iGrName.ToUpper, "PIN") > 0 Or Left(iGrName.ToUpper, 3) = "PIN" _
'                        Or InStr(iGrName.ToUpper, "RIVET") > 0 Or InStr(iGrName.ToUpper, "GROM") > 0 Or InStr(iGrName.ToUpper, "PLUG") > 0 _
'                        Or InStr(iGrName.ToUpper, "MONO") > 0 Or InStr(iGrName.ToUpper, "OTHER") > 0 Or InStr(iGrName.ToUpper, "#THICK") > 0 Then

'                Else
'                    Dim iCheckDataArr As Boolean = True
'                    Dim dtView1 As New DataView(dtInforLineOut)
'                    dtView1.RowFilter = String.Format("[GroupName] like '%{0}'", iGrName)
'                    Dim tmpDtb As DataTable = dtInforLineOut.Clone
'                    tmpDtb = dtView1.ToTable

'                    Dim dtView11 As New DataView(tmpDtb)
'                    dtView11.RowFilter = String.Format("[Sect] like '%{0}'", iSect)
'                    tmpDtb = dtView11.ToTable

'                    Dim dtView2 As New DataView(tmpDtb)
'                    dtView2.RowFilter = String.Format("[a1] like '%{0}'", 0)
'                    tmpDtb = dtView2.ToTable

'                    Dim iGrTagList As New List(Of String)
'                    Dim iCountTag As Integer = 0
'                    For Each dtRow As DataRow In tmpDtb.Rows
'                        If iGrTagList.Contains(dtRow("Group Tag").ToString) = False Then
'                            iGrTagList.Add(dtRow("Group Tag").ToString)

'                            iCountTag += 1
'                        End If
'                    Next

'                    For Each iTag As String In iGrTagList
'                        Dim dtView4 As New DataView(tmpDtb)
'                        dtView4.RowFilter = String.Format("[Group Tag] like '%{0}'", iTag)
'                        Dim tmpDtb1 As DataTable = tmpDtb.Clone
'                        tmpDtb1 = dtView4.ToTable
'                        Dim iCoutLine As Integer = 0
'                        Dim iGroupTag As String
'                        For Each dtR As DataRow In tmpDtb1.Rows
'                            If CType(dtR("d1").ToString, Double) < 30 Then
'                                Dim StartPointX As Double = CType(dtR("Xd").ToString, Double)
'                                Dim StartPointY As Double = CType(dtR("Yd").ToString, Double)
'                                Dim StartPointZ As Double = CType(dtR("Zd").ToString, Double)

'                                Dim EndPointX As Double = CType(dtR("Xc").ToString, Double)
'                                Dim EndPointY As Double = CType(dtR("Yc").ToString, Double)
'                                Dim EndPointZ As Double = CType(dtR("Zc").ToString, Double)

'                                Dim iPoint1 As Point3d = New Point3d(StartPointX, StartPointY, StartPointZ)
'                                Dim iPoint2 As Point3d = New Point3d(EndPointX, EndPointY, EndPointZ)
'                                Dim iVector As Vector3d
'                                If Right(iSect, 1) = "Y" Then
'                                    iVector = New Vector3d(iXCS(0), iXCS(1), iXCS(2))
'                                ElseIf Right(iSect, 1) = "X" Then
'                                    iVector = New Vector3d(iYCS(0), iYCS(1), iYCS(2))
'                                End If
'                                Dim iCheckCtrOut As String
'                                Dim guess1(2) As Double
'                                Dim guess2(2) As Double
'                                Dim pt1(2) As Double
'                                Dim pt2(2) As Double
'                                Dim minDist As Double
'                                theUFSession.Modl.AskMinimumDist(ptObj1.Tag, dtR("Object Tag").ToString, 0, guess1, 0, guess2, minDist, pt1, pt2)
'                                Dim iPt2 As Point3d = New Point3d(pt2(0), pt2(1), pt2(2))
'                                Dim iCos As Double
'                                iCos = CosOf2Vector(iPoint1, iPoint2, iPtCsys.X - iPt2.X, iPtCsys.Y - iPt2.Y, iPtCsys.Z - iPt2.Z)
'                                iCos = Math.Abs(Math.Round(iCos, 4))

'                                If iCos < 0.017 Then
'                                    iCoutLine += 1
'                                    iGroupTag = dtR("Group Tag").ToString
'                                End If

'                            End If

'                        Next
'                        If iCoutLine > 1 Then
'                            For Each dtr As DataRow In dtInforLineOut.Rows
'                                If dtr("Group Tag").ToString = iGroupTag Then
'                                    dtr("GroupName") = dtr("GroupName") & "_MONO"
'                                    dtr("Hole Type") = "Mono有り"
'                                End If
'                            Next
'                        End If
'                    Next
'                End If

'            Next
'        Next

'    End Sub

'    Sub FindMonoOther(ByVal iSectList As List(Of String), ByVal dtInforLineOut As DataTable, ByVal tmpCsys As CartesianCoordinateSystem)
'        Dim theSession As Session = Session.GetSession()
'        Dim workpart As Part = theSession.Parts.Work
'        Dim iCsPoint As Point3d = New Point3d(tmpCsys.Origin.X, tmpCsys.Origin.Y, tmpCsys.Origin.Z)
'        Dim ptObj1 As NXOpen.Point
'        'Dim TempTable As DataTable = dtInforLineOut
'        ptObj1 = workPart.Points.CreatePoint(iCsPoint)
'        For Each iSect As String In iSectList
'            Dim dtView1 As New DataView(dtInforLineOut)
'            dtView1.RowFilter = String.Format("[Sect] like '%{0}'", iSect)
'            Dim tmpDtb As DataTable = dtInforLineOut.Clone
'            tmpDtb = dtView1.ToTable

'            Dim iGrTagList As New List(Of String)
'            For Each row As DataRow In tmpDtb.Rows
'                If iGrTagList.Contains(row("Group Tag").ToString) = False Then
'                    iGrTagList.Add(row("Group Tag").ToString)
'                End If
'            Next
'            Dim tmpI As String, tmpJ As String, tmpMin As Double
'            tmpMin = 1000
'            Dim icheckMono As Boolean = False
'            Dim iMinCL As Double
'            For Each iGrTag As String In iGrTagList
'                Dim dtView2 As New DataView(tmpDtb)
'                dtView2.RowFilter = String.Format("[Group Tag] like '%{0}'", iGrTag)
'                Dim tmpDtTag As DataTable = tmpDtb.Clone
'                tmpDtTag = dtView2.ToTable
'                Dim icheckMetal As Boolean = False
'                Try
'                    For Each dtrTemp As DataRow In tmpDtTag.Rows
'                        If Left(Split(dtrTemp("GroupName").ToString, "$")(1), 1).ToUpper = "S" Or Left(Split(dtrTemp("GroupName").ToString, "$")(1), 1).ToUpper = "K" Then
'                            Exit For
'                        Else
'                            If InStr(dtrTemp("GroupName").ToString, "#THICK") > 0 Then
'                                icheckMetal = True
'                            Else
'                                Call CheckMetalAndTrimNearCsys(iGrTag, tmpDtb, icheckMetal)
'                                Exit For
'                            End If


'                        End If
'                    Next
'                Catch ex As Exception
'                    For Each dtrTemp As DataRow In tmpDtTag.Rows
'                        If InStr(dtrTemp("GroupName").ToString, "#THICK") > 0 Then
'                            icheckMetal = True
'                            Exit For
'                        Else
'                            Call CheckMetalAndTrimNearCsys(iGrTag, tmpDtb, icheckMetal)
'                            Exit For
'                        End If
'                    Next
'                End Try



'                If icheckMetal = False Then
'                    Dim Xtt As Double = CType(tmpDtTag.Compute("Avg([Xm])", ""), Double)
'                    Dim Ytt As Double = CType(tmpDtTag.Compute("Avg([Ym])", ""), Double)
'                    Dim Ztt As Double = CType(tmpDtTag.Compute("Avg([Zm])", ""), Double)
'                    Dim iTrongtam As String = Xtt & "," & Ytt & "," & Ztt
'                    Dim iMidPoint As Point3d = New Point3d(Xtt, Ytt, Ztt)
'                    Dim ptObj2 As NXOpen.Point
'                    ptObj2 = workPart.Points.CreatePoint(iMidPoint)
'                    'ptObj2.SetVisibility(SmartObject.VisibilityOption.Visible)
'                    Dim Object1Tag As Long = CType(ptObj1.Tag, Long)
'                    Dim Object2Tag As Long = CType(ptObj2.Tag, Long)
'                    Dim guess1(2) As Double
'                    Dim guess2(2) As Double
'                    Dim pt1(2) As Double
'                    Dim pt2(2) As Double
'                    Dim minDist As Double
'                    theUFSession.Modl.AskMinimumDist(Object1Tag, Object2Tag, 0, guess1, 0, guess2, minDist, pt1, pt2)

'                    For Each dtrTemp As DataRow In tmpDtb.Rows

'                        If dtrTemp("Group Tag").ToString = iGrTag Then
'                            Dim iTempThick As String
'                            Try
'                                If Len(iTempThick) < 2 Then

'                                    If tmpMin > minDist Then
'                                        tmpMin = minDist

'                                        tmpJ = dtrTemp("Object Tag")
'                                        iMinCL = minDist
'                                        icheckMono = True
'                                        Exit For
'                                    End If
'                                ElseIf Left(Split(dtrTemp("GroupName").ToString, "$")(1), 1).ToUpper = "S" Or Left(Split(dtrTemp("GroupName").ToString, "$")(1), 1).ToUpper = "K" Then
'                                    If tmpMin > minDist Then
'                                        tmpMin = minDist

'                                        tmpJ = dtrTemp("Object Tag")
'                                        iMinCL = minDist
'                                        icheckMono = True
'                                        Exit For
'                                    End If
'                                End If
'                            Catch ex As Exception

'                            End Try

'                        End If
'                    Next
'                End If

'            Next
'            If icheckMono = True Then
'                Dim MonoGrTag As String
'                Dim MonoTrongtam As String
'                Dim MonoMindist As Double
'                Dim iMonoGrName As String
'                For Each dtr1 As DataRow In tmpDtb.Rows
'                    If dtr1("Object Tag") = tmpJ Then
'                        MonoGrTag = dtr1("Group Tag").ToString
'                        'MonoTrongtam = dtr1("CtrLineY").ToString
'                        MonoMindist = iMinCL
'                        iMonoGrName = dtr1("GroupName").ToString
'                        Exit For
'                    End If

'                Next

'                If MonoMindist <= 2.5 Then
'                    For Each dtInfor3 As DataRow In dtInforLineOut.Rows

'                        If dtInfor3("Group Tag").ToString = MonoGrTag Then
'                            'dtInfor3("CtrLineY") = MonoTrongtam
'                            dtInfor3("GroupName") = dtInfor3("GroupName") & "_MONO"
'                            dtInfor3("Hole Type") = "Mono有り"
'                        Else
'                            If dtInfor3("GroupName").ToString = iMonoGrName Then
'                                If dtInfor3("Sect").ToString = iSect Then
'                                    dtInfor3("GroupName") = dtInfor3("GroupName") & "_OTHER"
'                                End If

'                            End If
'                        End If
'                    Next
'                Else
'                    Dim iCheckMn As Boolean = False
'                    For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                        If dtInfor3("Sect").ToString = iSect Then
'                            Try
'                                If Left(Split(dtInfor3("GroupName").ToString, "$")(1), 1).ToUpper = "S" Or Left(Split(dtInfor3("GroupName").ToString, "$")(1), 1).ToUpper = "K" Then
'                                    If InStr(dtInfor3("GroupName").ToString.ToUpper, "MONO") = 0 And dtInfor3("d1") < 10 Then
'                                        iCheckMn = True
'                                    End If
'                                End If
'                            Catch ex As Exception

'                            End Try

'                        End If
'                    Next
'                    If iCheckMn = True Then
'                        For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                            If dtInfor3("Sect").ToString = iSect Then
'                                Try
'                                    If Left(Split(dtInfor3("GroupName").ToString, "$")(1), 1).ToUpper = "S" Or Left(Split(dtInfor3("GroupName").ToString, "$")(1), 1).ToUpper = "K" Then
'                                        If InStr(dtInfor3("GroupName").ToString.ToUpper, "MONO") = 0 Then
'                                            dtInfor3("GroupName") = dtInfor3("GroupName") & "_MONO"
'                                            dtInfor3("Hole Type") = "Mono有り"
'                                        End If

'                                    ElseIf dtInfor3("Group Tag").ToString = MonoGrTag Then
'                                        dtInfor3("Hole Type") = "Mono無し"
'                                    End If
'                                Catch ex As Exception
'                                    If dtInfor3("Group Tag").ToString = MonoGrTag Then
'                                        dtInfor3("Hole Type") = "Mono無し"
'                                    End If
'                                End Try

'                            End If

'                        Next
'                    End If

'                End If
'            End If


'        Next
'    End Sub

'    Sub FindLineNearCsys(ByVal dtInforLineOut As DataTable, ByRef iGroupTagList As List(Of String))
'        'Tìm các đường song song và có khoảng cách gần nhất với trục Z của Csys




'        For Each dtInfor As DataRow In dtInforLineOut.Rows
'            'Loại bỏ những Group không có đường thẳng song song với trục Z
'            If dtInfor("a1").ToString <> "" Then

'                Dim iGrouptag As String = dtInfor("Group Tag").ToString
'                If iGroupTagList.Contains(iGrouptag) = False Then
'                    iGroupTagList.Add(iGrouptag)
'                End If

'            End If
'        Next



'        For Each iGroupTag1 As String In iGroupTagList

'            'Lọc 
'            Dim dtView1 As New DataView(dtInforLineOut)
'            dtView1.RowFilter = String.Format("[Group Tag] like '%{0}'", iGroupTag1)
'            Dim tmpDtb As DataTable = dtInforLineOut.Clone
'            tmpDtb = dtView1.ToTable

'            Dim dtView2 As New DataView(tmpDtb)
'            dtView2.RowFilter = String.Format("[Result] like '%{0}'", 1)
'            tmpDtb = dtView2.ToTable

'            tmpDtb.DefaultView.Sort = "d1"
'            Dim dtSort As DataTable = tmpDtb.DefaultView.ToTable()
'            dtSort.AcceptChanges()
'            Dim icount As Integer = 1
'            For Each dtInfor1 As DataRow In dtSort.Rows
'                For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                    If dtInfor3("Object Tag").ToString = dtInfor1("Object Tag").ToString Then

'                        dtInfor3("Result") = "2"
'                        dtInforLineOut.AcceptChanges()
'                        Exit For

'                    End If
'                Next
'                If icount = 2 Then Exit For
'                icount += 1
'            Next
'        Next
'        dtInforLineOut.AcceptChanges()
'    End Sub

'    Sub CreatePMIInforABC(ByVal iSect As String, ByVal dtInforLineOut As DataTable, ByVal iListABC As List(Of String))
'        Dim dtView1 As New DataView(dtInforLineOut)
'        dtView1.RowFilter = String.Format("[Sect] like '%{0}'", iSect)
'        Dim tmpDtb2 As DataTable = dtInforLineOut.Clone
'        tmpDtb2 = dtView1.ToTable
'        Dim dtView11 As New DataView(tmpDtb2)
'        dtView11.RowFilter = String.Format("[Result] like '%{0}'", "10")
'        tmpDtb2 = dtView11.ToTable
'        'Dim iCtrLineTop(100) As Line
'        Dim iTemp As Integer = 0
'        For Each dtr1 As DataRow In tmpDtb2.Rows
'            If dtr1("Xg") <> 0 And dtr1("Hole Type").ToString <> "" Then
'                Dim tmpName As String
'                Dim tmpPartNo As String, tmpPartName As String
'                Try
'                    If InStr(dtr1("GroupName").ToString, "BOLT") > 0 Or InStr(dtr1("GroupName").ToString, "NUT") > 0 Then

'                        tmpName = Split(dtr1("GroupName").ToString, "$")(0) & "$" & Split(dtr1("GroupName").ToString, "$")(1)
'                    ElseIf InStr(dtr1("GroupName").ToString.ToUpper, "$") > 0 Then
'                        tmpPartNo = Split(dtr1("GroupName").ToString, "$")(1)
'                        tmpPartNo = Split(tmpPartNo, "__#")(0)
'                        tmpPartName = Split(dtr1("GroupName").ToString, "$")(0)
'                        If InStr(tmpPartName, "~") > 0 Then
'                            tmpPartName = Split(tmpPartName, "~")(1)
'                        End If
'                        If InStr(tmpPartNo, "~") > 0 Then
'                            tmpPartNo = Split(tmpPartNo, "~")(1)
'                        End If
'                        If Len(Split(dtr1("GroupName").ToString, "$")(3)) = 1 Then
'                            If Len(Split(dtr1("GroupName").ToString, "$")(2)) = 0 Then
'                                tmpName = tmpPartName & "$" & tmpPartNo
'                            Else
'                                tmpName = tmpPartName & "$" & tmpPartNo & "$" & Split(dtr1("GroupName").ToString, "$")(2)
'                            End If

'                        Else
'                            tmpName = tmpPartName & "$" & tmpPartNo & "$" & Split(dtr1("GroupName").ToString, "$")(2) & "$" & Split(dtr1("GroupName").ToString, "$")(3)
'                        End If
'                    Else
'                        tmpName = dtr1("GroupName").ToString
'                    End If
'                Catch ex As Exception

'                End Try
'                If InStr(tmpName, "^") > 0 Then
'                    tmpName = tmpName.Replace("^", "%")
'                End If

'                Try
'                    If InStr(dtr1("Hole Type"), "A_Dir") > 0 Then
'                        If iListABC.Contains(tmpName) = False Then
'                            iListABC.Add(tmpName & "_" & "部品A")
'                        End If
'                        'Dim ipt3d As Point3d = New Point3d(dtr1("Xm"), dtr1("Ym"), dtr1("Zm"))
'                        'Call CreatePMIGr(ipt3d, iSect, "部品A")
'                    ElseIf InStr(dtr1("Hole Type"), "B_Dir") > 0 Then
'                        If iListABC.Contains(tmpName) = False Then
'                            iListABC.Add(tmpName & "_" & "部品B")
'                            'lw.WriteLine(tmpName)
'                        End If
'                    ElseIf InStr(dtr1("Hole Type"), "C_Dir") > 0 Then
'                        If iListABC.Contains(tmpName) = False Then
'                            iListABC.Add(tmpName & "_" & "部品C")
'                        End If
'                    ElseIf InStr(dtr1("Hole Type"), "D_Dir") > 0 Then
'                        If iListABC.Contains(tmpName) = False Then
'                            iListABC.Add(tmpName & "_" & "部品D")
'                        End If
'                    ElseIf InStr(dtr1("Hole Type"), "E_Dir") > 0 Then
'                        If iListABC.Contains(tmpName) = False Then
'                            iListABC.Add(tmpName & "_" & "部品E")
'                        End If

'                    End If
'                Catch ex As Exception

'                End Try

'            End If
'        Next

'    End Sub

'    Sub CreatePMIGr(ByVal ipt As Point3d, ByVal iComponentName As String, ByVal iGroup As String)
'        Dim theSession As Session = Session.GetSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As Part = theSession.Parts.Display
'        Dim TheUFsession As UFSession = UFSession.GetUFSession()
'        Dim NULLTAG As Tag = NXOpen.Tag.Null
'        Dim objectTag As Tag = NXOpen.Tag.Null
'        Dim group_count As Integer = 0
'        Dim group_list() As Group
'        Dim group_member_list() As Tag
'        Dim member_count As Integer

'        'TheUFsession.Group.AskGroupData(iGroup.Tag, group_member_list, member_count)
'        'Dim midPt(2) As Double
'        'For Each iTag As Tag In group_member_list
'        '    Dim iObj As NXObject = Nothing
'        '    iObj = NXObjectManager.Get(iTag)
'        '    Dim iCurve As Curve = CType(iObj, Curve)
'        '    TheUFsession.Modl.AskCurveProps(iCurve.Tag, 0.5, midPt, junk, junk, junk, trash, trash)
'        '    Exit For
'        'Next

'        Dim tmpName As String
'        Dim tmpPartNo As String, tmpPartName As String

'        If InStr(iGroup.ToUpper, "BOLT") > 0 Or InStr(iGroup.ToUpper, "NUT") > 0 Then
'            tmpName = Split(iGroup, "$")(0) & "$" & Split(iGroup, "$")(1)

'        ElseIf InStr(iGroup.ToUpper, "$") > 0 Then

'            tmpPartNo = Split(iGroup, "$")(1)
'            tmpPartNo = Split(tmpPartNo, "__#")(0)
'            tmpPartName = Split(iGroup, "$")(0)


'            If InStr(tmpPartName, "~") > 0 Then

'                tmpPartName = Split(tmpPartName, "~")(1)


'            End If


'            If InStr(tmpPartNo, "~") > 0 Then
'                tmpPartNo = Split(tmpPartNo, "~")(1)

'            End If



'            If Len(Split(iGroup, "$")(3)) = 1 Then
'                tmpName = tmpPartName & "$" & tmpPartNo
'            Else
'                tmpName = tmpPartName & "$" & tmpPartNo & "$" & Split(iGroup, "$")(2) & "$" & Split(iGroup, "$")(3)
'            End If

'        Else

'            tmpName = iGroup
'        End If
'        Dim aContents As String = iGroup
'        Dim X0 As Double = ipt.X
'        Dim Y0 As Double = ipt.Y
'        Dim Z0 As Double = ipt.Z
'        Dim X1 As Double
'        Dim Y1 As Double
'        Dim Z1 As Double

'        Dim modelingView1 As ModelingView
'        modelingView1 = displayPart.ModelingViews.WorkView
'        Dim a1 As Double, a2 As Double, a3 As Double, b1 As Double, b2 As Double, b3 As Double, c1 As Double, c2 As Double, c3 As Double, a As Double, b As Double, c As Double
'        Dim aX As String, aY As String, aZ As String, aX1 As String, aY1 As String, aZ1 As String

'        Dim iOriPt As NXOpen.Point, iZaxis As DatumAxis, tempXdir As Vector3d, tempYdir As Vector3d, tempZdir As Vector3d
'        Call D001_SearchCsysTest(iOriPt, iZaxis, tempXdir, tempYdir, tempZdir)

'        If Right(iComponentName, 1) = "X" Then
'            a1 = tempYdir.X
'            a2 = tempYdir.Y
'            a3 = tempYdir.Z
'            b1 = tempZdir.X
'            b2 = tempZdir.Y
'            b3 = tempZdir.Z
'            c1 = tempXdir.X
'            c2 = tempXdir.Y
'            c3 = tempXdir.Z
'        Else
'            a1 = tempZdir.X
'            a2 = tempZdir.Y
'            a3 = tempZdir.Z
'            b1 = tempXdir.X
'            b2 = tempXdir.Y
'            b3 = tempXdir.Z
'            c1 = tempYdir.X
'            c2 = tempYdir.Y
'            c3 = tempYdir.Z
'        End If

'        X1 = X0 + 10 * b1
'        Y1 = Y0 + 10 * b2
'        Z1 = Z0 + 10 * b3
'        X1 = X1 + 15 * a1
'        X1 = X1 + 15 * a2
'        X1 = X1 + 15 * a3

'        Dim nullAnnotations_SimpleDraftingAid As Annotations.SimpleDraftingAid = Nothing
'        Dim pmiNoteBuilder1 As Annotations.PmiNoteBuilder
'        pmiNoteBuilder1 = workPart.Annotations.CreatePmiNoteBuilder(nullAnnotations_SimpleDraftingAid)
'        pmiNoteBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiNoteBuilder1.Origin.Anchor = Annotations.OriginBuilder.AlignmentPosition.MidCenter
'        Dim i As Integer
'        Dim aArrayA
'        aArrayA = Split(aContents, "$")
'        Dim text1(UBound(aArrayA, 1)) As String
'        For i = 0 To UBound(aArrayA, 1)
'            text1(i) = Trim(aArrayA(i))
'        Next


'        pmiNoteBuilder1.Text.TextBlock.SetText(text1)
'        pmiNoteBuilder1.TextAlignment = Annotations.DraftingNoteBuilder.TextAlign.BelowbottomExtToMax
'        Dim leaderData1 As Annotations.LeaderData
'        leaderData1 = workPart.Annotations.CreateLeaderData()
'        leaderData1.StubSize = 2.0#
'        leaderData1.Arrowhead = Annotations.LeaderData.ArrowheadType.OpenArrow
'        pmiNoteBuilder1.Leader.Leaders.Append(leaderData1)
'        leaderData1.StubSide = Annotations.LeaderSide.Inferred
'        Dim symbolscale1 As Double
'        symbolscale1 = pmiNoteBuilder1.Text.TextBlock.SymbolScale
'        Dim symbolaspectratio1 As Double
'        symbolaspectratio1 = pmiNoteBuilder1.Text.TextBlock.SymbolAspectRatio
'        pmiNoteBuilder1.Origin.Plane.PlaneMethod = Annotations.PlaneBuilder.PlaneMethodType.UserDefined
'        pmiNoteBuilder1.Origin.SetInferRelativeToGeometry(True)

'        Dim origin1 As Point3d
'        Dim xDirection1 As Vector3d
'        Dim yDirection1 As Vector3d
'        If Right(iComponentName, 1) = "Y" Then
'            origin1 = New Point3d(X0, Y0, Z0)
'            xDirection1 = New Vector3d(b1, b2, b3)
'            yDirection1 = New Vector3d(a1, a2, a3)
'        Else
'            origin1 = New Point3d(X0, Y0, Z0)
'            xDirection1 = New Vector3d(a1, a2, a3)
'            yDirection1 = New Vector3d(b1, b2, b3)
'        End If

'        Dim xform3 As Xform
'        xform3 = workPart.Xforms.CreateXform(origin1, xDirection1, yDirection1, SmartObject.UpdateOption.AfterModeling, 1.0#)

'        'Dim cartesianCoordinateSystem1 As CartesianCoordinateSystem
'        'cartesianCoordinateSystem1 = workPart.CoordinateSystems.CreateCoordinateSystem(xform3, SmartObject.UpdateOption.AfterModeling)
'        pmiNoteBuilder1.Origin.Plane.UserDefinedPlane = xform3
'        pmiNoteBuilder1.Origin.SetInferRelativeToGeometry(True)
'        Dim coordinates1 As Point3d = New Point3d(X0, Y0, Z0)
'        Dim point1 As NXOpen.Point
'        point1 = workPart.Points.CreatePoint(coordinates1)
'        Dim point2 As Point3d = New Point3d(X0, Y0, Z0)
'        Try
'            leaderData1.Leader.SetValue(point1, displayPart.ModelingViews.WorkView, point2)
'        Catch
'            leaderData1.Leader.SetValue(point1, workPart.ModelingViews.WorkView, point2)
'        End Try

'        Dim assocOrigin1 As Annotations.Annotation.AssociativeOriginData
'        assocOrigin1.OriginType = Annotations.AssociativeOriginType.Drag
'        Dim nullView As NXOpen.View = Nothing
'        assocOrigin1.View = nullView
'        assocOrigin1.ViewOfGeometry = nullView
'        Dim nullPoint As NXOpen.Point = Nothing
'        assocOrigin1.PointOnGeometry = nullPoint
'        Dim nullAnnotations_Annotation As Annotations.Annotation = Nothing
'        assocOrigin1.OffsetAlignmentPosition = Annotations.AlignmentPosition.TopLeft
'        assocOrigin1.XOffsetFactor = 0.0#
'        assocOrigin1.YOffsetFactor = 0.0#
'        assocOrigin1.StackAlignmentPosition = Annotations.StackAlignmentPosition.Above
'        pmiNoteBuilder1.Origin.SetAssociativeOrigin(assocOrigin1)
'        pmiNoteBuilder1.Style.LetteringStyle.GeneralTextAspectRatio = 0.6
'        pmiNoteBuilder1.Style.LetteringStyle.GeneralTextCharSpaceFactor = 0.6
'        pmiNoteBuilder1.Style.LetteringStyle.GeneralTextSize = 3
'        pmiNoteBuilder1.Style.LineArrowStyle.ArrowheadLength = 3

'        Dim point3 As Point3d = New Point3d(X1, Y1, Z1)
'        pmiNoteBuilder1.Origin.Origin.SetValue(Nothing, nullView, point3)
'        pmiNoteBuilder1.Origin.SetInferRelativeToGeometry(True)
'        leaderData1.StubSide = Annotations.LeaderSide.Left
'        Dim nXObject1 As NXObject
'        nXObject1 = pmiNoteBuilder1.Commit()
'        pmiNoteBuilder1.Destroy()
'    End Sub

'    Sub XoaTrung(ByVal iGrSectList As List(Of String), ByVal dtInforLineOut As DataTable, ByRef iGroupTagList As List(Of String))

'        For Each iSect As String In iGrSectList
'            For Each iGrName As String In iGroupTagList

'                Dim dtView1 As New DataView(dtInforLineOut)
'                Dim strFill1 As String = "GroupName = " & iGrName
'                dtView1.RowFilter = String.Format("[GroupName] like '%{0}'", iGrName)
'                Dim tmpDtb As DataTable = dtInforLineOut.Clone
'                tmpDtb = dtView1.ToTable

'                Dim dtView11 As New DataView(tmpDtb)
'                dtView11.RowFilter = String.Format("[Sect] like '%{0}'", iSect)
'                tmpDtb = dtView11.ToTable

'                Dim dtView2 As New DataView(tmpDtb)
'                dtView2.RowFilter = String.Format("[a1] like '%{0}'", 1)
'                tmpDtb = dtView2.ToTable
'                tmpDtb.DefaultView.Sort = "d1"
'                Dim dtSort As DataTable = tmpDtb.DefaultView.ToTable()
'                dtSort.AcceptChanges()
'                Dim iLineLenght As Double
'                For Each dtr1 As DataRow In dtSort.Rows
'                    iLineLenght = dtr1("Line length")
'                    Exit For
'                Next

'                Dim iTrungGr As Boolean = False
'                Dim i1 As Integer, i2 As Integer
'                For i1 = 0 To dtSort.Rows.Count - 1
'                    Try
'                        If dtSort.Rows(i1).Item("Line length") / iLineLenght >= 0.99 And dtSort.Rows(i1).Item("Line length") / iLineLenght <= 1.01 Then
'                            For i2 = i1 + 1 To dtSort.Rows.Count - 1
'                                If dtSort.Rows(i2).Item("Line length") / iLineLenght >= 0.99 And dtSort.Rows(i2).Item("Line length") / iLineLenght <= 1.01 Then
'                                    If dtSort.Rows(i1).Item("Group Tag").ToString <> dtSort.Rows(i2).Item("Group Tag").ToString Then
'                                        dtSort.Rows(i2).Item("Result") = "22"
'                                        For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                                            If dtInfor3("Group Tag").ToString = dtSort.Rows(i2).Item("Group Tag").ToString Then
'                                                dtInfor3("Result") = "22"
'                                                dtInforLineOut.AcceptChanges()
'                                                'Exit For
'                                            End If
'                                        Next
'                                        iTrungGr = True
'                                    End If
'                                End If
'                            Next
'                            Exit For
'                        End If
'                    Catch ex As Exception

'                    End Try

'                Next
'                Try
'                    If iTrungGr = True Then
'                        For idel As Integer = dtSort.Rows.Count - 1 To 0 Step -1
'                            Dim irow As DataRow = dtSort.Rows.Item(idel)
'                            If irow("Result").ToString = "22" Then
'                                dtSort.Rows.Remove(irow)
'                            End If
'                        Next
'                    End If
'                Catch ex As Exception

'                End Try

'                Dim icoutLine As Integer = 0
'                Dim i As Integer, j As Integer, jj As Integer
'                For i = 0 To dtSort.Rows.Count - 1
'                    Try
'                        Dim ScaleLengthi As Double = dtSort.Rows(i).Item("Line length")
'                        If dtSort.Rows(i).Item("Result").ToString <> "22" Then
'                            Dim icheckTrung As Integer = 0
'                            For jj = i + 1 To dtSort.Rows.Count - 1
'                                If jj > dtSort.Rows.Count - 1 Then Exit For
'                                Dim ScaleLength As Double = dtSort.Rows(jj).Item("Line length") / ScaleLengthi
'                                'Dim ScaleD1 As Double = dtSort.Rows(jj).Item("d1") / dtSort.Rows(i).Item("d1")
'                                If dtSort.Rows(i).Item("Group Tag").ToString = dtSort.Rows(jj).Item("Group Tag").ToString Then
'                                    If ScaleLength >= 0.99 And ScaleLength <= 1.01 Then
'                                        icoutLine += 1
'                                        Dim guess1(2) As Double
'                                        Dim guess2(2) As Double
'                                        Dim pt1(2) As Double
'                                        Dim pt2(2) As Double
'                                        Dim minDist As Double
'                                        theUFSession.Modl.AskMinimumDist(dtSort.Rows(jj).Item("Object Tag").ToString, dtSort.Rows(i).Item("Object Tag").ToString, 0, guess1, 0, guess2, minDist, pt1, pt2)

'                                        'lw.WriteLine(dtSort.Rows(i).Item("Object Tag").ToString & " : " & minDist)
'                                        'lw.WriteLine(dtSort.Rows(j).Item("Object Tag").ToString & "_2: " & minDist)
'                                        If minDist < 0.4 Then
'                                            dtSort.Rows(jj).Item("Result") = "22"
'                                            For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                                                If dtInfor3("Object Tag").ToString = dtSort.Rows(jj).Item("Object Tag").ToString Then

'                                                    dtInfor3("Result") = "22"
'                                                    dtInforLineOut.AcceptChanges()


'                                                End If
'                                            Next
'                                        Else
'                                            If icoutLine > 1 Then
'                                                Dim id1 As Double = dtSort.Rows(i).Item("d1")
'                                                Dim jjd1 As Double = dtSort.Rows(jj).Item("d1")
'                                                If id1 / jjd1 < 0.5 Then
'                                                    dtSort.Rows(jj).Item("Result") = "22"
'                                                    For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                                                        If dtInfor3("Object Tag").ToString = dtSort.Rows(jj).Item("Object Tag").ToString Then

'                                                            dtInfor3("Result") = "22"
'                                                            dtInforLineOut.AcceptChanges()

'                                                        End If
'                                                    Next
'                                                End If
'                                            End If


'                                        End If
'                                    End If
'                                End If
'                            Next

'                        End If
'                    Catch ex As Exception

'                    End Try

'                Next
'            Next
'        Next
'        Try
'            For idel As Integer = dtInforLineOut.Rows.Count - 1 To 0 Step -1
'                Dim irow As DataRow = dtInforLineOut.Rows.Item(idel)
'                If irow("Result").ToString = "22" Then
'                    dtInforLineOut.Rows.Remove(irow)
'                End If
'            Next
'        Catch ex As Exception

'        End Try

'        dtInforLineOut.AcceptChanges()


'    End Sub

'    Sub TempTakeInfor2LineMono(ByVal tmpDtb As DataTable, dtInforLineOut As DataTable, ByVal CheckBoltNut As Boolean, ByVal iCountTag As Integer)
'        Dim i As Integer, j As Integer
'        Dim tmpScale As Double
'        Dim iGrCount As Integer = 1
'        Dim icheckX As Boolean = False, icheckY As Boolean = False
'        Dim dtView3 As New DataView(tmpDtb)
'        dtView3.Sort = "d1"
'        tmpDtb = dtView3.ToTable

'        i = 0
'        Dim iSect As String = tmpDtb.Rows(i).Item("Sect")
'        Dim iLenght As Double = tmpDtb.Rows(i).Item("Line Length")
'        Dim id1 As Double = tmpDtb.Rows(i).Item("d1")
'        'lw.WriteLine(tmpDtb.Rows(i).Item("Group Tag"))
'        Dim DiaX() As Double, DiaY() As Double
'        Dim tmpDiaX As Double, tmpDiaY As Double
'        If id1 < 15 Then
'            For j = i + 1 To 4

'                Dim jSect As String = tmpDtb.Rows(j).Item("Sect")
'                Dim jLenght As Double = tmpDtb.Rows(j).Item("Line Length")
'                Dim jd1 As Double = tmpDtb.Rows(j).Item("d1")

'                If Right(iSect, 1) = Right(jSect, 1) Then

'                    Dim ScaleLenth As Double = iLenght / jLenght
'                    'Xét chiều dài 2 đoạn
'                    If ScaleLenth >= 0.98 And ScaleLenth <= 1.02 Then
'                        'Xét khoảng cách  2 đoạn tới trục Z
'                        Dim ScaleDist As Double = jd1 / id1
'                        If ScaleDist >= 0.92 And ScaleDist <= 1.08 Then

'                            Dim pt3d1 As New Point3d(tmpDtb.Rows(i).Item("Xm"), tmpDtb.Rows(i).Item("Ym"), tmpDtb.Rows(i).Item("Zm"))
'                            Dim pt3d2 As New Point3d(tmpDtb.Rows(j).Item("Xm"), tmpDtb.Rows(j).Item("Ym"), tmpDtb.Rows(j).Item("Zm"))

'                            If Right(iSect, 1) = "X" Then
'                                tmpDtb.Rows(i).Item("CtrLineX") = 1
'                                tmpDtb.Rows(j).Item("CtrLineX") = 1
'                                icheckX = True
'                                Exit For

'                            ElseIf Right(iSect, 1) = "Y" Then
'                                tmpDtb.Rows(i).Item("CtrLineX") = 1
'                                tmpDtb.Rows(j).Item("CtrLineX") = 1
'                                icheckY = True
'                                Exit For

'                            End If

'                        End If

'                    End If

'                End If
'            Next

'            If CheckBoltNut = False Then
'                If iCountTag > 2 Then

'                    For Each dtInfor1 As DataRow In tmpDtb.Rows
'                        If dtInfor1("CtrLineX") <> "" Then

'                            For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                                If dtInfor3("Object Tag").ToString = dtInfor1("Object Tag").ToString Then
'                                    dtInfor3("CtrLineX") = dtInfor1("CtrLineX")
'                                    dtInforLineOut.AcceptChanges()
'                                End If
'                            Next

'                        End If
'                    Next

'                ElseIf iCountTag = 2 Then
'                    'If icheckX = True And icheckY = True Then
'                    For Each dtInfor1 As DataRow In tmpDtb.Rows
'                        If dtInfor1("CtrLineX") <> "" Then

'                            For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                                If dtInfor3("Object Tag").ToString = dtInfor1("Object Tag").ToString Then
'                                    dtInfor3("CtrLineX") = dtInfor1("CtrLineX")
'                                    dtInforLineOut.AcceptChanges()

'                                End If
'                            Next

'                        End If
'                    Next
'                    'End If
'                End If

'            Else
'            End If
'        End If
'    End Sub

'    Sub TakeInfor2LineMono(ByRef iGrName As String, ByVal dtInforLineOut As DataTable, ByVal CheckBoltNut As Boolean)

'        Dim dtView1 As New DataView(dtInforLineOut)
'        Dim strFill1 As String = "GroupName = " & iGrName
'        dtView1.RowFilter = String.Format("[GroupName] like '%{0}'", iGrName)
'        Dim tmpDtb As DataTable = dtInforLineOut.Clone
'        tmpDtb = dtView1.ToTable

'        'Lọc Góc (những đường song song với trục Z)
'        Dim dtView2 As New DataView(tmpDtb)
'        dtView2.RowFilter = String.Format("[a1] like '%{0}'", 1)
'        tmpDtb = dtView2.ToTable
'        Dim dtView3 As New DataView(tmpDtb)
'        dtView3.Sort = "d1"
'        tmpDtb = dtView3.ToTable
'        Dim iLineLenghtX As Double = 0
'        Dim iLineLenghtY As Double = 0
'        For Each dtr1 As DataRow In tmpDtb.Rows
'            Try
'                If iLineLenghtX > 0 And iLineLenghtY > 0 Then
'                    Exit For

'                ElseIf Right(dtr1("Sect"), 1) = "X" Then
'                    iLineLenghtX = dtr1("Line Length")
'                ElseIf Right(dtr1("Sect"), 1) = "Y" Then
'                    iLineLenghtY = dtr1("Line Length")
'                End If
'                'If Right(dtr1("Sect"), 1) = "X" Then

'                '    lw.WriteLine(iLineLenghtX)

'                'ElseIf Right(dtr1("Sect"), 1) = "Y" Then


'                '    lw.WriteLine(iLineLenghtY)
'                'ElseIf iLineLenghtX <> 0 And iLineLenghtY <> 0 Then
'                '    Exit For

'                'End If
'            Catch ex As Exception

'            End Try

'        Next

'        Dim iGrTagList As New List(Of String)
'        Dim iCountTag As Integer = 0
'        For Each dtRow As DataRow In tmpDtb.Rows
'            Try
'                If dtRow("Line Length") / iLineLenghtX >= 0.99 And dtRow("Line Length") / iLineLenghtX <= 1.01 And Right(dtRow("Sect"), 1) = "X" Then
'                    If iGrTagList.Contains(dtRow("Group Tag").ToString) = False Then
'                        iGrTagList.Add(dtRow("Group Tag").ToString)
'                        iCountTag += 1
'                    End If
'                ElseIf dtRow("Line Length") / iLineLenghtY >= 0.99 And dtRow("Line Length") / iLineLenghtY <= 1.01 And Right(dtRow("Sect"), 1) = "Y" Then
'                    If iGrTagList.Contains(dtRow("Group Tag").ToString) = False Then
'                        iGrTagList.Add(dtRow("Group Tag").ToString)
'                        iCountTag += 1
'                    End If
'                End If
'            Catch ex As Exception

'            End Try


'        Next
'        'lw.WriteLine(iCountTag)
'        If iCountTag > 2 Then
'            For Each iGrTag As String In iGrTagList
'                For Each dtRow As DataRow In tmpDtb.Rows
'                    Try
'                        If dtRow("Group Tag").ToString = iGrTag Then
'                            Dim dtView22 As New DataView(tmpDtb)
'                            dtView22.RowFilter = String.Format("[Group Tag] like '%{0}'", iGrTag)
'                            Dim tmpDtb1 As DataTable = tmpDtb.Clone
'                            tmpDtb1 = dtView22.ToTable
'                            Call TempTakeInfor2LineMono(tmpDtb1, dtInforLineOut, CheckBoltNut, iCountTag)
'                            Exit For
'                        End If
'                    Catch ex As Exception

'                    End Try

'                Next

'            Next
'        ElseIf iCountTag = 2 Then
'            For Each iGrTag As String In iGrTagList
'                For Each dtRow As DataRow In tmpDtb.Rows
'                    Try
'                        If dtRow("Group Tag").ToString = iGrTag Then
'                            Dim dtView22 As New DataView(tmpDtb)
'                            dtView22.RowFilter = String.Format("[Group Tag] like '%{0}'", iGrTag)
'                            Dim tmpDtb1 As DataTable = tmpDtb.Clone
'                            tmpDtb1 = dtView22.ToTable
'                            Call TempTakeInfor2LineMono(tmpDtb1, dtInforLineOut, CheckBoltNut, iCountTag)
'                            Exit For
'                        End If
'                    Catch ex As Exception

'                    End Try

'                Next

'            Next

'        End If

'    End Sub

'    Sub TakeInforLine(ByVal dtInforLineOut As DataTable, ByRef tmpCsys As NXOpen.CartesianCoordinateSystem, ByVal iRootcomp As Component)
'        Dim theSession As Session = Session.GetSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim theUfSession As UFSession = UFSession.GetUFSession()
'        Dim tmpGrp As NXOpen.Tag = NXOpen.Tag.Null
'        Dim myGroup As NXOpen.Group
'        Dim member_count As Integer
'        Dim group_member_list() As Tag
'        Dim iSelCoor As NXOpen.CartesianCoordinateSystem
'        Dim CsPoint As Point3d  'Diem goc CS
'        Dim Object1Tag As Long
'        Dim ptObj1 As NXOpen.Point

'        For Each iSelCoor In theSession.Parts.Work.CoordinateSystems
'            If iSelCoor.Origin.X <> 0 Or iSelCoor.Origin.Y <> 0 Or iSelCoor.Origin.Z <> 0 Then
'                Dim iMatrix As Matrix3x3 = iSelCoor.Orientation.Element
'                CsPoint = New Point3d(iSelCoor.Origin.X, iSelCoor.Origin.Y, iSelCoor.Origin.Z)
'                ptObj1 = workPart.Points.CreatePoint(CsPoint)
'                Object1Tag = ptObj1.Tag
'                tmpCsys = iSelCoor
'                Exit For

'            End If
'        Next

'        For Each iChild As Component In iRootcomp.GetChildren
'            Do
'                theUfSession.Obj.CycleObjsInPart(iChild.Prototype.OwningPart.Tag, UFConstants.UF_group_type, tmpGrp)
'                If tmpGrp = NXOpen.Tag.Null Then
'                    Continue Do
'                End If
'                Dim theType As Integer, theSubtype As Integer
'                theUfSession.Obj.AskTypeAndSubtype(tmpGrp, theType, theSubtype)

'                If theSubtype = UFConstants.UF_group_type Then
'                    myGroup = Utilities.NXObjectManager.Get(tmpGrp)
'                End If

'                myGroup = Utilities.NXObjectManager.Get(tmpGrp)
'                theUfSession.Group.AskGroupData(myGroup.Tag, group_member_list, member_count)
'                For Each iTag As Tag In group_member_list
'                    Dim iObj As NXObject = Nothing
'                    iObj = NXObjectManager.Get(iTag)
'                Next
'                If InStr(myGroup.Name.ToString.ToUpper, "Dynamic Sections".ToUpper) > 0 Or InStr(myGroup.Name.ToString.ToUpper, "Sect_".ToUpper) > 0 Then

'                Else

'                    Try
'                        Call GetGroupInfor(myGroup, dtInforLineOut, tmpCsys, Object1Tag, iChild)
'                    Catch ex As Exception
'                    End Try

'                End If
'            Loop Until tmpGrp = NXOpen.Tag.Null
'        Next

'    End Sub

'    Sub TakeInfor2Line(ByRef iGrName As String, dtInforLineOut As DataTable, ByVal CheckBoltNut As Boolean)

'        Dim i As Integer, j As Integer
'        Dim tmpScale As Double
'        Dim iGrCount As Integer = 1

'        Dim icheckX As Boolean = False, icheckY As Boolean = False

'        Dim dtView1 As New DataView(dtInforLineOut)
'        Dim strFill1 As String = "GroupName = " & iGrName
'        dtView1.RowFilter = String.Format("[GroupName] like '%{0}'", iGrName)
'        Dim tmpDtb As DataTable = dtInforLineOut.Clone
'        tmpDtb = dtView1.ToTable
'        'Lọc Góc (những đường song song với trục Z)
'        Dim dtView2 As New DataView(tmpDtb)
'        dtView2.RowFilter = String.Format("[a1] like '%{0}'", 1)
'        tmpDtb = dtView2.ToTable
'        Dim iBase1 As Double = 0.92
'        Dim iBase2 As Double = 1.08
'        Dim iBase3 As Double = 0.7
'        Dim iBase4 As Double = 1.3


'        Dim tmpLineLength As Double = 5
'        Dim tmpd1 As Double = 10

'        If InStr(iGrName.ToUpper, "BOLT") > 0 Or InStr(iGrName.ToUpper, "STUD-BALL") > 0 Or InStr(iGrName.ToUpper, "NUT") > 0 Or InStr(iGrName.ToUpper, "CLIP") > 0 _
'           Or InStr(iGrName.ToUpper, "SCR") > 0 Or InStr(iGrName.ToUpper, "SCREW") > 0 Or InStr(iGrName.ToUpper, "PIN") > 0 _
'            Or InStr(iGrName.ToUpper, "RIVET") > 0 Or InStr(iGrName.ToUpper, "GROM") > 0 Or InStr(iGrName.ToUpper, "PLUG") > 0 _
'            Or InStr(iGrName.ToUpper, "MONO") > 0 Or InStr(iGrName.ToUpper, "OTHER") > 0 Then
'            iBase1 = 0.99
'            iBase2 = 1.01
'            iBase3 = 0.94
'            iBase4 = 1.06

'            tmpLineLength = 100
'        End If
'        'Sort khoảng cách với trục Z
'        Dim dtView3 As New DataView(tmpDtb)
'        dtView3.Sort = "d1"
'        tmpDtb = dtView3.ToTable

'        'For Each iGrtag As String In iGrTagList
'        i = 0
'        Dim iSect As String = tmpDtb.Rows(i).Item("Sect")
'        Dim iLenght As Double = tmpDtb.Rows(i).Item("Line Length")
'        Dim id1 As Double = tmpDtb.Rows(i).Item("d1")
'        Dim DiaX() As Double, DiaY() As Double
'        Dim tmpDiaX As Double, tmpDiaY As Double
'        If iLenght > tmpLineLength Then

'        ElseIf id1 < tmpd1 Then

'            For j = i + 1 To 3

'                Dim jSect As String = tmpDtb.Rows(j).Item("Sect")
'                Dim jLenght As Double = tmpDtb.Rows(j).Item("Line Length")
'                Dim jd1 As Double = tmpDtb.Rows(j).Item("d1")

'                If Right(iSect, 1) = Right(jSect, 1) Then

'                    Dim ScaleLenth As Double = iLenght / jLenght
'                    'Xét chiều dài 2 đoạn
'                    If ScaleLenth >= iBase1 And ScaleLenth <= iBase2 Then
'                        'Xét khoảng cách  2 đoạn tới trục Z
'                        Dim ScaleDist As Double = jd1 / id1
'                        If ScaleDist >= iBase3 And ScaleDist <= iBase4 And jd1 < 30 And id1 < 30 Then

'                            Dim pt3d1d As New Point3d(tmpDtb.Rows(i).Item("Xd"), tmpDtb.Rows(i).Item("Yd"), tmpDtb.Rows(i).Item("Zd"))
'                            Dim pt3d2d As New Point3d(tmpDtb.Rows(j).Item("Xd"), tmpDtb.Rows(j).Item("Yd"), tmpDtb.Rows(j).Item("Zd"))
'                            Dim pt3d1c As New Point3d(tmpDtb.Rows(i).Item("Xc"), tmpDtb.Rows(i).Item("Yc"), tmpDtb.Rows(i).Item("Zc"))
'                            Dim pt3d2c As New Point3d(tmpDtb.Rows(j).Item("Xc"), tmpDtb.Rows(j).Item("Yc"), tmpDtb.Rows(j).Item("Zc"))
'                            Dim pt3d1 As Point3d
'                            Dim pt3d2 As Point3d
'                            If DirOf2Line(pt3d1d, pt3d2d, pt3d1c, pt3d2c) < 0.2 Then
'                                If DistanceOf2Pt(pt3d1d, pt3d2c) <= DistanceOf2Pt(pt3d2d, pt3d1c) Then
'                                    pt3d1 = pt3d1d
'                                    pt3d2 = pt3d2c

'                                Else
'                                    pt3d1 = pt3d2d
'                                    pt3d2 = pt3d1c
'                                End If
'                            Else
'                                If DistanceOf2Pt(pt3d1d, pt3d2d) <= DistanceOf2Pt(pt3d1c, pt3d2c) Then
'                                    pt3d1 = pt3d1d
'                                    pt3d2 = pt3d2d

'                                Else
'                                    pt3d1 = pt3d1c
'                                    pt3d2 = pt3d2c
'                                End If
'                            End If
'                            If Right(iSect, 1) = "X" Then

'                                tmpDiaX = DistanceOf2Pt(pt3d1, pt3d2)
'                                tmpDtb.Rows(i).Item("Hole Size") = tmpDiaX
'                                tmpDtb.Rows(j).Item("Hole Size") = tmpDiaX
'                                tmpDtb.Rows(i).Item("Xg") = (tmpDtb.Rows(i).Item("Xm") + tmpDtb.Rows(j).Item("Xm")) / 2
'                                tmpDtb.Rows(i).Item("Yg") = (tmpDtb.Rows(i).Item("Ym") + tmpDtb.Rows(j).Item("Ym")) / 2
'                                tmpDtb.Rows(i).Item("Zg") = (tmpDtb.Rows(i).Item("Zm") + tmpDtb.Rows(j).Item("Zm")) / 2
'                                'tmpDtb.Rows(i).Item("Xg") = (pt3d1.X + pt3d2.X) / 2
'                                'tmpDtb.Rows(i).Item("Yg") = (pt3d1.Y + pt3d2.Y) / 2
'                                'tmpDtb.Rows(i).Item("Zg") = (pt3d1.Z + pt3d2.Z) / 2
'                                tmpDtb.Rows(i).Item("Hole Type") = "Group_" & iGrCount & "_DiaX"
'                                tmpDtb.Rows(j).Item("Hole Type") = "Group_" & iGrCount & "_DiaX"
'                                icheckX = True
'                                Exit For

'                            ElseIf Right(iSect, 1) = "Y" Then

'                                tmpDiaY = DistanceOf2Pt(pt3d1, pt3d2)
'                                tmpDtb.Rows(i).Item("Hole Size") = tmpDiaY
'                                tmpDtb.Rows(j).Item("Hole Size") = tmpDiaY
'                                tmpDtb.Rows(i).Item("Xg") = (tmpDtb.Rows(i).Item("Xm") + tmpDtb.Rows(j).Item("Xm")) / 2
'                                tmpDtb.Rows(i).Item("Yg") = (tmpDtb.Rows(i).Item("Ym") + tmpDtb.Rows(j).Item("Ym")) / 2
'                                tmpDtb.Rows(i).Item("Zg") = (tmpDtb.Rows(i).Item("Zm") + tmpDtb.Rows(j).Item("Zm")) / 2
'                                'tmpDtb.Rows(i).Item("Xg") = (pt3d1.X + pt3d2.X) / 2
'                                'tmpDtb.Rows(i).Item("Yg") = (pt3d1.Y + pt3d2.Y) / 2
'                                'tmpDtb.Rows(i).Item("Zg") = (pt3d1.Z + pt3d2.Z) / 2
'                                tmpDtb.Rows(i).Item("Hole Type") = "Group_" & iGrCount & "_DiaY"
'                                tmpDtb.Rows(j).Item("Hole Type") = "Group_" & iGrCount & "_DiaY"
'                                icheckY = True
'                                Exit For

'                            End If

'                        End If

'                    End If

'                End If
'            Next
'            Dim ii As Integer, jj As Integer
'            If j = 1 Then
'                ii = 2
'                jj = 3
'            ElseIf j = 2 Then
'                ii = 1
'                jj = 3
'            ElseIf j = 3 Then
'                ii = 1
'                jj = 2
'            Else
'            End If

'            Dim jjSect As String = tmpDtb.Rows(jj).Item("Sect")
'            Dim jjLenght As Double = tmpDtb.Rows(jj).Item("Line Length")
'            Dim jjd1 As Double = tmpDtb.Rows(jj).Item("d1")
'            Dim iiSect As String = tmpDtb.Rows(ii).Item("Sect")
'            Dim iiLenght As Double = tmpDtb.Rows(ii).Item("Line Length")
'            Dim iid1 As Double = tmpDtb.Rows(ii).Item("d1")

'            If Right(iiSect, 1) = Right(jjSect, 1) Then

'                Dim ScaleLenth As Double = iiLenght / jjLenght
'                If ScaleLenth >= iBase1 And ScaleLenth <= iBase2 Then

'                    Dim ScaleDist As Double = jjd1 / iid1
'                    If ScaleDist >= iBase3 And ScaleDist <= iBase4 And jjd1 < 30 And iid1 < 30 Then
'                        Dim pt3d1d As New Point3d(tmpDtb.Rows(ii).Item("Xd"), tmpDtb.Rows(ii).Item("Yd"), tmpDtb.Rows(ii).Item("Zd"))
'                        Dim pt3d2d As New Point3d(tmpDtb.Rows(jj).Item("Xd"), tmpDtb.Rows(jj).Item("Yd"), tmpDtb.Rows(jj).Item("Zd"))
'                        Dim pt3d1c As New Point3d(tmpDtb.Rows(ii).Item("Xc"), tmpDtb.Rows(ii).Item("Yc"), tmpDtb.Rows(ii).Item("Zc"))
'                        Dim pt3d2c As New Point3d(tmpDtb.Rows(jj).Item("Xc"), tmpDtb.Rows(jj).Item("Yc"), tmpDtb.Rows(jj).Item("Zc"))

'                        Dim pt3d1 As Point3d
'                        Dim pt3d2 As Point3d
'                        If DirOf2Line(pt3d1d, pt3d2d, pt3d1c, pt3d2c) < 0.2 Then

'                            If DistanceOf2Pt(pt3d1d, pt3d2c) <= DistanceOf2Pt(pt3d2d, pt3d1c) Then
'                                pt3d1 = pt3d1d
'                                pt3d2 = pt3d2c

'                            Else
'                                pt3d1 = pt3d2d
'                                pt3d2 = pt3d1c
'                            End If
'                        Else
'                            If DistanceOf2Pt(pt3d1d, pt3d2d) <= DistanceOf2Pt(pt3d1c, pt3d2c) Then
'                                pt3d1 = pt3d1d
'                                pt3d2 = pt3d2d

'                            Else
'                                pt3d1 = pt3d1c
'                                pt3d2 = pt3d2c
'                            End If
'                        End If
'                        If Right(iiSect, 1) = "X" Then

'                            tmpDiaX = DistanceOf2Pt(pt3d1, pt3d2)
'                            tmpDtb.Rows(ii).Item("Hole Size") = tmpDiaX
'                            tmpDtb.Rows(jj).Item("Hole Size") = tmpDiaX
'                            tmpDtb.Rows(ii).Item("Xg") = (tmpDtb.Rows(ii).Item("Xm") + tmpDtb.Rows(jj).Item("Xm")) / 2
'                            tmpDtb.Rows(ii).Item("Yg") = (tmpDtb.Rows(ii).Item("Ym") + tmpDtb.Rows(jj).Item("Ym")) / 2
'                            tmpDtb.Rows(ii).Item("Zg") = (tmpDtb.Rows(ii).Item("Zm") + tmpDtb.Rows(jj).Item("Zm")) / 2
'                            tmpDtb.Rows(ii).Item("Hole Type") = "Group_" & iGrCount & "_DiaX"
'                            tmpDtb.Rows(jj).Item("Hole Type") = "Group_" & iGrCount & "_DiaX"
'                            icheckX = True

'                        ElseIf Right(iiSect, 1) = "Y" Then

'                            tmpDiaY = DistanceOf2Pt(pt3d1, pt3d2)
'                            tmpDtb.Rows(ii).Item("Hole Size") = tmpDiaY
'                            tmpDtb.Rows(jj).Item("Hole Size") = tmpDiaY
'                            tmpDtb.Rows(ii).Item("Xg") = (tmpDtb.Rows(ii).Item("Xm") + tmpDtb.Rows(jj).Item("Xm")) / 2
'                            tmpDtb.Rows(ii).Item("Yg") = (tmpDtb.Rows(ii).Item("Ym") + tmpDtb.Rows(jj).Item("Ym")) / 2
'                            tmpDtb.Rows(ii).Item("Zg") = (tmpDtb.Rows(ii).Item("Zm") + tmpDtb.Rows(jj).Item("Zm")) / 2
'                            tmpDtb.Rows(ii).Item("Hole Type") = "Group_" & iGrCount & "_DiaY"
'                            tmpDtb.Rows(jj).Item("Hole Type") = "Group_" & iGrCount & "_DiaY"
'                            icheckY = True

'                        End If
'                    End If

'                End If

'            End If
'            If CheckBoltNut = False Then

'                If icheckX = True And icheckY = True Then

'                    For Each dtInfor1 As DataRow In tmpDtb.Rows
'                        If dtInfor1("Hole Size") <> "" Then

'                            For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                                If dtInfor3("Object Tag").ToString = dtInfor1("Object Tag").ToString Then
'                                    dtInfor3("Hole Size") = dtInfor1("Hole Size")
'                                    dtInfor3("Hole Type") = dtInfor1("Hole Type")
'                                    dtInfor3("Xg") = dtInfor1("Xg")
'                                    dtInfor3("Yg") = dtInfor1("Yg")
'                                    dtInfor3("Zg") = dtInfor1("Zg")
'                                    dtInforLineOut.AcceptChanges()

'                                End If
'                            Next

'                        End If
'                    Next

'                Else
'                    For Each dtInfor1 As DataRow In tmpDtb.Rows
'                        If dtInfor1("Hole Size") <> "" Then

'                            For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                                If dtInfor3("Object Tag").ToString = dtInfor1("Object Tag").ToString Then

'                                    dtInfor3("Hole Size") = ""
'                                    dtInfor3("Hole Type") = ""
'                                    dtInforLineOut.AcceptChanges()

'                                End If
'                            Next

'                        End If
'                    Next

'                End If
'            Else
'                If icheckX = True And icheckY = True Then

'                    For Each dtInfor1 As DataRow In tmpDtb.Rows
'                        If dtInfor1("Hole Size") <> "" Then

'                            For Each dtInfor3 As DataRow In dtInforLineOut.Rows
'                                If dtInfor3("Object Tag").ToString = dtInfor1("Object Tag").ToString Then

'                                    If InStr(dtInfor3("GroupName").ToString.ToUpper, "WELD") > 0 And InStr(dtInfor3("GroupName").ToString.ToUpper, "NUT") > 0 Then
'                                        dtInfor3("Hole Size") = "WELD_NUT"
'                                    ElseIf InStr(dtInfor3("GroupName").ToString.ToUpper, "WELD") > 0 And InStr(dtInfor3("GroupName").ToString.ToUpper, "BOLT") > 0 Then
'                                        dtInfor3("Hole Size") = "WELD_BOLT"
'                                    ElseIf InStr(dtInfor3("GroupName").ToString.ToUpper, "NUT") > 0 And InStr(dtInfor3("GroupName").ToString.ToUpper, "WELD") = 0 Then
'                                        dtInfor3("Hole Size") = "NUT"
'                                    End If

'                                    dtInfor3("Xg") = dtInfor1("Xg")
'                                    dtInfor3("Yg") = dtInfor1("Yg")
'                                    dtInfor3("Zg") = dtInfor1("Zg")
'                                    dtInforLineOut.AcceptChanges()

'                                End If
'                            Next

'                        End If
'                    Next

'                End If

'            End If

'        End If

'    End Sub

'    Sub CheckMetalAndTrimNearCsys(ByVal iGrName1 As String, ByVal dtSect As DataTable, ByRef iCheckMetal As Boolean)
'        Dim dtView1 As New DataView(dtSect)
'        Dim strFill1 As String = "Group Tag = " & iGrName1
'        dtView1.RowFilter = String.Format("[Group Tag] like '%{0}'", iGrName1)
'        Dim tmpDtb As DataTable = dtSect.Clone
'        tmpDtb = dtView1.ToTable

'        Dim tmpDtb2 As DataTable = dtSect.Clone
'        tmpDtb2 = dtView1.ToTable

'        Dim dtView2 As New DataView(tmpDtb)
'        dtView2.RowFilter = String.Format("[a1] like '%{0}'", 1)
'        tmpDtb = dtView2.ToTable

'        tmpDtb.DefaultView.Sort = "d1"
'        Dim dtSort As DataTable = tmpDtb.DefaultView.ToTable()
'        dtSort.AcceptChanges()
'        Dim tmpd1 As Double = 10
'        Dim icheckD1 As Boolean = False
'        For Each dtr As DataRow In dtSort.Rows
'            If dtr("Hole Size") = "" Then
'                For Each dtr1 As DataRow In dtSort.Rows
'                    Try
'                        If dtr1("d1") / dtr("d1") >= 0.99 And dtr1("d1") / dtr("d1") <= 1.01 And dtr("Object Tag") <> dtr1("Object Tag") Then
'                            Dim pt3d1 As New Point3d(dtr1("Xm"), dtr1("Ym"), dtr1("Zm"))
'                            Dim pt3d2 As New Point3d(dtr("Xm"), dtr("Ym"), dtr("Zm"))
'                            icheckD1 = True
'                            dtr1("Hole Size") = DistanceOf2Pt(pt3d1, pt3d2)
'                            dtr("Hole Size") = DistanceOf2Pt(pt3d1, pt3d2)
'                        End If
'                    Catch ex As Exception

'                    End Try


'                Next
'            End If
'        Next


'        Dim iCheckBolt1 As Double = 1

'        For Each dtRowTemp As DataRow In dtSort.Rows

'            If dtRowTemp("Hole Size").ToString <> "" Then

'                For Each dtRowTemp2 As DataRow In tmpDtb2.Rows
'                    Try
'                        If dtRowTemp2("a1") = "0" And dtRowTemp2("Hole Size") = "" Then

'                            Dim Object1Tag As Long = CType(dtRowTemp("Object Tag").ToString, Long)
'                            Dim Object2Tag As Long = CType(dtRowTemp2("Object Tag").ToString, Long)
'                            Dim guess1(2) As Double
'                            Dim guess2(2) As Double
'                            Dim pt1(2) As Double
'                            Dim pt2(2) As Double
'                            Dim minDist As Double
'                            theUFSession.Modl.AskMinimumDist(Object1Tag, Object2Tag, 0, guess1, 0, guess2, minDist, pt1, pt2)

'                            If minDist < 0.01 Then
'                                iCheckBolt1 += 1
'                            End If

'                        End If
'                    Catch ex As Exception

'                    End Try

'                Next

'            End If
'        Next

'        If iCheckBolt1 > 3 Then

'            iCheckMetal = True

'        End If


'    End Sub

'    Sub CheckDirCsysWithMono(ByVal iGrName As String, ByVal dtInforLineOut As DataTable, ByRef iCheckDirCsys As Boolean)

'        Try
'            Dim dtView1 As New DataView(dtInforLineOut)
'            Dim strFill1 As String = "GroupName = " & iGrName
'            dtView1.RowFilter = String.Format("[GroupName] like '%{0}'", iGrName)
'            Dim tmpDtb As DataTable = dtInforLineOut.Clone
'            tmpDtb = dtView1.ToTable
'            'Lọc Góc (những đường song song với trục Z)
'            Dim dtView2 As New DataView(tmpDtb)
'            dtView2.RowFilter = String.Format("[a1] like '%{0}'", 1)
'            tmpDtb = dtView2.ToTable
'            'Sort khoảng cách với trục Z
'            Dim dtView3 As New DataView(tmpDtb)
'            dtView3.Sort = "d1"
'            tmpDtb = dtView3.ToTable
'            Dim i As Integer
'            'For Each iGrtag As String In iGrTagList
'            i = 0
'            Dim id1 As Double = tmpDtb.Rows(i).Item("d1")
'            If id1 < 15 Then
'                iCheckDirCsys = True
'            End If
'        Catch ex As Exception
'            iCheckDirCsys = False
'        End Try
'    End Sub

'    Sub PMIPointAndPoint(ByVal ipoint3d1 As String, ByVal ipoint3d2 As String, ByVal icheckSect As String, ByVal tmpCsys As CartesianCoordinateSystem, ByVal iNumtemp As Double, ByVal iCheckHole As String, ByVal iVectorPMI As Vector3d)
'        Dim theSession As Session = Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim theUI As NXOpen.UI = NXOpen.UI.GetUI()
'        Dim idatum As NXOpen.DatumPlane
'        Dim idatumXZ As DatumPlane
'        Dim idatumYZ As DatumPlane
'        Dim CsPoint1 As Point3d  'Diem goc CS
'        Dim point1 As NXOpen.Point

'        CsPoint1 = New Point3d(Split(ipoint3d1, ",")(0), Split(ipoint3d1, ",")(1), Split(ipoint3d1, ",")(2))
'        point1 = workPart.Points.CreatePoint(CsPoint1)

'        Dim CsPoint2 As Point3d  'Diem goc CS
'        Dim point2 As NXOpen.Point
'        CsPoint2 = New Point3d(Split(ipoint3d2, ",")(0), Split(ipoint3d2, ",")(1), Split(ipoint3d2, ",")(2))
'        point2 = workPart.Points.CreatePoint(CsPoint2)



'        'theUI.VisualizationLinePreferences.UpdateLineFontObjects(False)
'        displayPart.Preferences.LineVisualization.ShowWidths = True
'        Dim nullNXOpen_Annotations_Dimension As NXOpen.Annotations.Dimension = Nothing
'        Dim pmiLinearDimensionBuilder1 As NXOpen.Annotations.PmiLinearDimensionBuilder = Nothing
'        pmiLinearDimensionBuilder1 = workPart.Dimensions.CreatePmiLinearDimensionBuilder(nullNXOpen_Annotations_Dimension)
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(False)
'        pmiLinearDimensionBuilder1.Origin.Anchor = NXOpen.Annotations.OriginBuilder.AlignmentPosition.MidCenter
'        If iCheckHole = "C" Then
'            pmiLinearDimensionBuilder1.Measurement.Method = NXOpen.Annotations.DimensionMeasurementBuilder.MeasurementMethod.Cylindrical
'        ElseIf iCheckHole = "CL" Then
'            pmiLinearDimensionBuilder1.Measurement.Method = NXOpen.Annotations.DimensionMeasurementBuilder.MeasurementMethod.PointToPoint
'        Else

'        End If
'        pmiLinearDimensionBuilder1.Origin.Plane.PlaneMethod = NXOpen.Annotations.PlaneBuilder.PlaneMethodType.ModelView
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        Dim nullNXOpen_Direction As NXOpen.Direction = Nothing
'        pmiLinearDimensionBuilder1.Measurement.Direction = nullNXOpen_Direction
'        Dim nullNXOpen_View As NXOpen.View = Nothing
'        pmiLinearDimensionBuilder1.Measurement.DirectionView = nullNXOpen_View
'        pmiLinearDimensionBuilder1.Style.DimensionStyle.NarrowDisplayType = NXOpen.Annotations.NarrowDisplayOption.None
'        pmiLinearDimensionBuilder1.FirstAssociativity.SetValue(NXOpen.InferSnapType.SnapType.Exist, point1, displayPart.ModelingViews.WorkView, Nothing, Nothing, nullNXOpen_View, Nothing)
'        pmiLinearDimensionBuilder1.FirstAssociativity.SetValue(NXOpen.InferSnapType.SnapType.Exist, point1, displayPart.ModelingViews.WorkView, Nothing, Nothing, nullNXOpen_View, Nothing)
'        Dim objects1(0) As NXOpen.NXObject
'        objects1(0) = point1
'        pmiLinearDimensionBuilder1.AssociatedObjects.Nxobjects.SetArray(objects1)
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        Dim dimensionlinearunits11 As NXOpen.Annotations.DimensionUnit = Nothing
'        dimensionlinearunits11 = pmiLinearDimensionBuilder1.Style.UnitsStyle.DimensionLinearUnits
'        Dim dimensionlinearunits12 As NXOpen.Annotations.DimensionUnit = Nothing
'        dimensionlinearunits12 = pmiLinearDimensionBuilder1.Style.UnitsStyle.DimensionLinearUnits
'        pmiLinearDimensionBuilder1.FirstAssociativity.SetValue(NXOpen.InferSnapType.SnapType.Mid, point1, displayPart.ModelingViews.WorkView, Nothing, Nothing, nullNXOpen_View, Nothing)
'        pmiLinearDimensionBuilder1.SecondAssociativity.SetValue(NXOpen.InferSnapType.SnapType.Mid, point2, displayPart.ModelingViews.WorkView, Nothing, Nothing, nullNXOpen_View, Nothing)

'        Dim objects2(1) As NXOpen.NXObject
'        objects2(0) = point1
'        objects2(1) = point2
'        pmiLinearDimensionBuilder1.AssociatedObjects.Nxobjects.SetArray(objects2)
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiLinearDimensionBuilder1.Origin.Plane.PlaneMethod = NXOpen.Annotations.PlaneBuilder.PlaneMethodType.UserDefined
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        Dim xform1 As NXOpen.Xform = Nothing
'        Dim iDatumPlane As NXOpen.DatumPlane
'        Dim point3 As Point3d
'        'point3 = New Point3d(tmpCsys.Origin.X, tmpCsys.Origin.Y, tmpCsys.Origin.Z)
'        If Right(icheckSect, 1) = "X" Then
'            iDatumPlane = CType(workPart.Datums.FindObject("DATUM_CSYS(0) YZ plane"), NXOpen.DatumPlane)
'            point3 = New Point3d(iDatumPlane.Origin.X + iNumtemp, iDatumPlane.Origin.Y + iNumtemp, iDatumPlane.Origin.Z + iNumtemp)
'            'Create_LineEquation_From_Point_And_DirectionVector(point3, iVectorPMI, iNumtemp, point3)
'        ElseIf Right(icheckSect, 1) = "Y" Then
'            iDatumPlane = CType(workPart.Datums.FindObject("DATUM_CSYS(0) XZ plane"), NXOpen.DatumPlane)
'            point3 = New Point3d(iDatumPlane.Origin.X + iNumtemp, iDatumPlane.Origin.Y + iNumtemp, iDatumPlane.Origin.Z + iNumtemp)
'            'Create_LineEquation_From_Point_And_DirectionVector(point3, iVectorPMI, iNumtemp, point3)
'        End If
'        xform1 = workPart.Xforms.CreateXform(iDatumPlane, NXOpen.SmartObject.UpdateOption.AfterModeling)
'        Dim cartesianCoordinateSystem1 As NXOpen.CartesianCoordinateSystem = Nothing
'        cartesianCoordinateSystem1 = workPart.CoordinateSystems.CreateCoordinateSystem(xform1, NXOpen.SmartObject.UpdateOption.AfterModeling)
'        pmiLinearDimensionBuilder1.Origin.Plane.UserDefinedPlane = xform1
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)

'        Dim assocOrigin1 As NXOpen.Annotations.Annotation.AssociativeOriginData = Nothing
'        assocOrigin1.OriginType = NXOpen.Annotations.AssociativeOriginType.Drag
'        assocOrigin1.View = nullNXOpen_View
'        assocOrigin1.ViewOfGeometry = nullNXOpen_View
'        Dim nullNXOpen_Point As NXOpen.Point = Nothing

'        assocOrigin1.PointOnGeometry = nullNXOpen_Point
'        Dim nullNXOpen_Annotations_Annotation As NXOpen.Annotations.Annotation = Nothing
'        assocOrigin1.VertAnnotation = nullNXOpen_Annotations_Annotation
'        assocOrigin1.VertAlignmentPosition = NXOpen.Annotations.AlignmentPosition.TopLeft
'        assocOrigin1.HorizAnnotation = nullNXOpen_Annotations_Annotation
'        assocOrigin1.HorizAlignmentPosition = NXOpen.Annotations.AlignmentPosition.TopLeft
'        assocOrigin1.AlignedAnnotation = nullNXOpen_Annotations_Annotation
'        assocOrigin1.DimensionLine = 0
'        assocOrigin1.AssociatedView = nullNXOpen_View
'        assocOrigin1.AssociatedPoint = nullNXOpen_Point
'        assocOrigin1.OffsetAnnotation = nullNXOpen_Annotations_Annotation
'        assocOrigin1.OffsetAlignmentPosition = NXOpen.Annotations.AlignmentPosition.TopLeft
'        assocOrigin1.XOffsetFactor = 0.0
'        assocOrigin1.YOffsetFactor = 0.0
'        assocOrigin1.StackAlignmentPosition = NXOpen.Annotations.StackAlignmentPosition.Above
'        pmiLinearDimensionBuilder1.Origin.SetAssociativeOrigin(assocOrigin1)
'        pmiLinearDimensionBuilder1.Origin.Origin.SetValue(Nothing, nullNXOpen_View, point3)

'        'pmiLinearDimensionBuilder1.Style.LetteringStyle.DimensionTextSize = 3
'        pmiLinearDimensionBuilder1.Style.LetteringStyle.DimensionTextSize = 3
'        pmiLinearDimensionBuilder1.Style.LetteringStyle.DimensionTextAspectRatio = 0.6
'        pmiLinearDimensionBuilder1.Style.LetteringStyle.DimensionTextCharSpaceFactor = 0.6
'        'pmiLinearDimensionBuilder1.Style.LetteringStyle.GeneralTextSize = 1.5
'        pmiLinearDimensionBuilder1.Style.LineArrowStyle.ArrowheadLength = 3

'        pmiLinearDimensionBuilder1.Style.DimensionStyle.DimensionValuePrecision = 2
'        pmiLinearDimensionBuilder1.Style.DimensionStyle.AngularDimensionValuePrecision = 2
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiLinearDimensionBuilder1.Style.LineArrowStyle.LeaderOrientation = NXOpen.Annotations.LeaderSide.Left
'        pmiLinearDimensionBuilder1.Style.DimensionStyle.TextCentered = True

'        Dim displayModification1 As NXOpen.DisplayModification = Nothing
'        displayModification1 = theSession.DisplayManager.NewDisplayModification()
'        displayModification1.ApplyToAllFaces = True
'        displayModification1.ApplyToOwningParts = True
'        'displayModification1.NewColor = 31
'        'displayModification1.NewFont = NXOpen.DisplayableObject.ObjectFont.Solid
'        'displayModification1.NewWidth = NXOpen.DisplayableObject.ObjectWidth.Three
'        Dim nXObject1(0) As NXOpen.DisplayableObject
'        nXObject1(0) = pmiLinearDimensionBuilder1.Commit()
'        displayModification1.Apply(nXObject1)
'        displayModification1.Dispose()
'        pmiLinearDimensionBuilder1.Destroy()
'        theSession.CleanUpFacetedFacesAndEdges()

'    End Sub

'    Sub PMIPointAndPointNew(ByVal ipoint3d1 As String, ByVal ipoint3d2 As String, ByVal icheckSect As String, ByVal tmpCsys As CartesianCoordinateSystem, ByVal iNumtemp As Double, ByVal iCheckHole As String, ByVal iVectorPMI As Vector3d)
'        Dim theSession As Session = Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim theUI As NXOpen.UI = NXOpen.UI.GetUI()
'        Dim idatum As NXOpen.DatumPlane
'        Dim idatumXZ As DatumPlane
'        Dim idatumYZ As DatumPlane
'        Dim CsPoint1 As Point3d  'Diem goc CS
'        Dim point1 As NXOpen.Point

'        CsPoint1 = New Point3d(Split(ipoint3d1, ",")(0), Split(ipoint3d1, ",")(1), Split(ipoint3d1, ",")(2))
'        point1 = workPart.Points.CreatePoint(CsPoint1)

'        Dim CsPoint2 As Point3d  'Diem goc CS
'        Dim point2 As NXOpen.Point
'        CsPoint2 = New Point3d(Split(ipoint3d2, ",")(0), Split(ipoint3d2, ",")(1), Split(ipoint3d2, ",")(2))
'        point2 = workPart.Points.CreatePoint(CsPoint2)



'        'theUI.VisualizationLinePreferences.UpdateLineFontObjects(False)
'        displayPart.Preferences.LineVisualization.ShowWidths = True
'        Dim nullNXOpen_Annotations_Dimension As NXOpen.Annotations.Dimension = Nothing
'        Dim pmiLinearDimensionBuilder1 As NXOpen.Annotations.PmiLinearDimensionBuilder = Nothing
'        pmiLinearDimensionBuilder1 = workPart.Dimensions.CreatePmiLinearDimensionBuilder(nullNXOpen_Annotations_Dimension)
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(False)
'        pmiLinearDimensionBuilder1.Origin.Anchor = NXOpen.Annotations.OriginBuilder.AlignmentPosition.MidCenter
'        Dim iNumLayout As Integer
'        If iCheckHole = "C" Then
'            pmiLinearDimensionBuilder1.Measurement.Method = NXOpen.Annotations.DimensionMeasurementBuilder.MeasurementMethod.Cylindrical
'        ElseIf iCheckHole = "CL" Then
'            pmiLinearDimensionBuilder1.Measurement.Method = NXOpen.Annotations.DimensionMeasurementBuilder.MeasurementMethod.PointToPoint
'        Else

'        End If
'        pmiLinearDimensionBuilder1.Origin.Plane.PlaneMethod = NXOpen.Annotations.PlaneBuilder.PlaneMethodType.ModelView
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        Dim nullNXOpen_Direction As NXOpen.Direction = Nothing
'        pmiLinearDimensionBuilder1.Measurement.Direction = nullNXOpen_Direction
'        Dim nullNXOpen_View As NXOpen.View = Nothing
'        pmiLinearDimensionBuilder1.Measurement.DirectionView = nullNXOpen_View
'        pmiLinearDimensionBuilder1.Style.DimensionStyle.NarrowDisplayType = NXOpen.Annotations.NarrowDisplayOption.None
'        pmiLinearDimensionBuilder1.FirstAssociativity.SetValue(NXOpen.InferSnapType.SnapType.Exist, point1, displayPart.ModelingViews.WorkView, Nothing, Nothing, nullNXOpen_View, Nothing)
'        pmiLinearDimensionBuilder1.FirstAssociativity.SetValue(NXOpen.InferSnapType.SnapType.Exist, point1, displayPart.ModelingViews.WorkView, Nothing, Nothing, nullNXOpen_View, Nothing)
'        Dim objects1(0) As NXOpen.NXObject
'        objects1(0) = point1
'        pmiLinearDimensionBuilder1.AssociatedObjects.Nxobjects.SetArray(objects1)
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        Dim dimensionlinearunits11 As NXOpen.Annotations.DimensionUnit = Nothing
'        dimensionlinearunits11 = pmiLinearDimensionBuilder1.Style.UnitsStyle.DimensionLinearUnits
'        Dim dimensionlinearunits12 As NXOpen.Annotations.DimensionUnit = Nothing
'        dimensionlinearunits12 = pmiLinearDimensionBuilder1.Style.UnitsStyle.DimensionLinearUnits
'        pmiLinearDimensionBuilder1.FirstAssociativity.SetValue(NXOpen.InferSnapType.SnapType.Mid, point1, displayPart.ModelingViews.WorkView, Nothing, Nothing, nullNXOpen_View, Nothing)
'        pmiLinearDimensionBuilder1.SecondAssociativity.SetValue(NXOpen.InferSnapType.SnapType.Mid, point2, displayPart.ModelingViews.WorkView, Nothing, Nothing, nullNXOpen_View, Nothing)

'        Dim objects2(1) As NXOpen.NXObject
'        objects2(0) = point1
'        objects2(1) = point2
'        pmiLinearDimensionBuilder1.AssociatedObjects.Nxobjects.SetArray(objects2)
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiLinearDimensionBuilder1.Origin.Plane.PlaneMethod = NXOpen.Annotations.PlaneBuilder.PlaneMethodType.UserDefined
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        'Dim xform1 As NXOpen.Xform = CType(workPart.FindObject("ENTITY 219 2"), NXOpen.Xform)
'        'Dim iDatumPlane As NXOpen.DatumPlane
'        Dim point3 As Point3d

'        Dim ZVector As Vector3d = New Vector3d(tmpCsys.Orientation.Element.Zx, tmpCsys.Orientation.Element.Zy, tmpCsys.Orientation.Element.Zz)
'        Dim iOrigin As Point3d = New Point3d(tmpCsys.Origin.X, tmpCsys.Origin.Y, tmpCsys.Origin.Z)
'        Dim xform2 As NXOpen.Xform = Nothing
'        xform2 = workPart.Xforms.CreateXformFromCurrentView(NXOpen.SmartObject.UpdateOption.AfterModeling, 1.0)
'        Dim orientation1 As NXOpen.Matrix3x3 = Nothing
'        'orientation1.Xx = -0.0
'        'orientation1.Xy = -0.0
'        'orientation1.Xz = -1.0
'        'orientation1.Yx = 0.0
'        'orientation1.Yy = -1.0
'        'orientation1.Yz = 0.0
'        'orientation1.Zx = -1.0
'        'orientation1.Zy = 0.0
'        'orientation1.Zz = 0.0
'        Dim X1 As Double
'        Dim Y1 As Double
'        Dim Z1 As Double

'        ''point3 = New Point3d(tmpCsys.Origin.X, tmpCsys.Origin.Y, tmpCsys.Origin.Z)
'        If Right(icheckSect, 1) = "X" Then
'            'iDatumPlane = CType(workPart.Datums.FindObject("DATUM_CSYS(0) YZ plane"), NXOpen.DatumPlane)
'            orientation1.Xx = tmpCsys.Orientation.Element.Yx
'            orientation1.Xy = tmpCsys.Orientation.Element.Yy
'            orientation1.Xz = tmpCsys.Orientation.Element.Yz

'            orientation1.Yx = tmpCsys.Orientation.Element.Zx
'            orientation1.Yy = tmpCsys.Orientation.Element.Zy
'            orientation1.Yz = tmpCsys.Orientation.Element.Zz

'            orientation1.Zx = tmpCsys.Orientation.Element.Xx
'            orientation1.Zy = tmpCsys.Orientation.Element.Xy
'            orientation1.Zz = tmpCsys.Orientation.Element.Xz

'            X1 = iOrigin.X + iNumtemp * iVectorPMI.X
'            Y1 = iOrigin.Y + iNumtemp * iVectorPMI.Y
'            Z1 = iOrigin.Z + iNumtemp * iVectorPMI.Z


'            X1 = X1 + 15 * tmpCsys.Orientation.Element.Yx
'            Y1 = Y1 + 15 * tmpCsys.Orientation.Element.Yy
'            Z1 = Z1 + 15 * tmpCsys.Orientation.Element.Yz


'            'X1 = X1 + orientation1.Zx * 20
'            'Y1 = Y1 + orientation1.Zy * 20
'            'Z1 = Z1 + orientation1.Zz * 20

'            'point3 = New Point3d(iDatumPlane.Origin.X + iNumtemp, iDatumPlane.Origin.Y + iNumtemp, iDatumPlane.Origin.Z + iNumtemp)
'            ''Create_LineEquation_From_Point_And_DirectionVector(point3, iVectorPMI, iNumtemp, point3)
'        ElseIf Right(icheckSect, 1) = "Y" Then
'            'iDatumPlane = CType(workPart.Datums.FindObject("DATUM_CSYS(0) XZ plane"), NXOpen.DatumPlane)
'            orientation1.Xx = tmpCsys.Orientation.Element.Xx
'            orientation1.Xy = tmpCsys.Orientation.Element.Xy
'            orientation1.Xz = tmpCsys.Orientation.Element.Xz

'            orientation1.Yx = tmpCsys.Orientation.Element.Zx
'            orientation1.Yy = tmpCsys.Orientation.Element.Zy
'            orientation1.Yz = tmpCsys.Orientation.Element.Zz

'            orientation1.Zx = tmpCsys.Orientation.Element.Yx
'            orientation1.Zy = tmpCsys.Orientation.Element.Yy
'            orientation1.Zz = tmpCsys.Orientation.Element.Yz

'            X1 = iOrigin.X + iNumtemp * iVectorPMI.X
'            Y1 = iOrigin.Y + iNumtemp * iVectorPMI.Y
'            Z1 = iOrigin.Z + iNumtemp * iVectorPMI.Z

'            X1 = X1 + 15 * tmpCsys.Orientation.Element.Xx
'            Y1 = Y1 + 15 * tmpCsys.Orientation.Element.Xy
'            Z1 = Z1 + 15 * tmpCsys.Orientation.Element.Xz
'            'point3 = New Point3d(iOrigin.X + 5 + iNumtemp * iVectorPMI.X, iOrigin.Y + iNumtemp * iVectorPMI.Y, iOrigin.Z + iNumtemp * iVectorPMI.Z)
'            'point3 = New Point3d(iDatumPlane.Origin.X + iNumtemp, iDatumPlane.Origin.Y + iNumtemp, iDatumPlane.Origin.Z + iNumtemp)
'            ''Create_LineEquation_From_Point_And_DirectionVector(point3, iVectorPMI, iNumtemp, point3)
'        End If

'        point3 = New Point3d(X1, Y1, Z1)
'        Dim ipt As NXOpen.Point = workPart.Points.CreatePoint(point3)

'        'ipt.SetVisibility(SmartObject.VisibilityOption.Visible)

'        Dim origin1 As NXOpen.Point3d = point3
'        xform2.SetOrigin(origin1)
'        xform2.SetOrientation(orientation1)

'        'Dim ipt As NXOpen.Point = workPart.Points.CreatePoint(point3)

'        'ipt.SetVisibility(SmartObject.VisibilityOption.Visible)

'        'xform1 = workPart.Xforms.CreateXform(iDatumPlane, NXOpen.SmartObject.UpdateOption.AfterModeling)
'        'Dim cartesianCoordinateSystem1 As NXOpen.CartesianCoordinateSystem = Nothing
'        'cartesianCoordinateSystem1 = workPart.CoordinateSystems.CreateCoordinateSystem(xform1, NXOpen.SmartObject.UpdateOption.AfterModeling)


'        Dim cartesianCoordinateSystem1 As NXOpen.CartesianCoordinateSystem = Nothing
'        cartesianCoordinateSystem1 = workPart.CoordinateSystems.CreateCoordinateSystem(xform2, NXOpen.SmartObject.UpdateOption.AfterModeling)

'        pmiLinearDimensionBuilder1.Origin.Plane.UserDefinedPlane = xform2

'        'pmiLinearDimensionBuilder1.Origin.Plane.UserDefinedPlane = xform1
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)

'        Dim assocOrigin1 As NXOpen.Annotations.Annotation.AssociativeOriginData = Nothing
'        assocOrigin1.OriginType = NXOpen.Annotations.AssociativeOriginType.RelativeToGeometry
'        'assocOrigin1.OriginType = NXOpen.Annotations.AssociativeOriginType.Drag
'        assocOrigin1.View = nullNXOpen_View
'        assocOrigin1.ViewOfGeometry = nullNXOpen_View
'        Dim nullNXOpen_Point As NXOpen.Point = Nothing

'        assocOrigin1.PointOnGeometry = ipt
'        Dim nullNXOpen_Annotations_Annotation As NXOpen.Annotations.Annotation = Nothing
'        assocOrigin1.VertAnnotation = nullNXOpen_Annotations_Annotation
'        assocOrigin1.VertAlignmentPosition = NXOpen.Annotations.AlignmentPosition.TopLeft
'        assocOrigin1.HorizAnnotation = nullNXOpen_Annotations_Annotation
'        assocOrigin1.HorizAlignmentPosition = NXOpen.Annotations.AlignmentPosition.TopLeft
'        assocOrigin1.AlignedAnnotation = nullNXOpen_Annotations_Annotation
'        assocOrigin1.DimensionLine = 0
'        assocOrigin1.AssociatedView = nullNXOpen_View
'        assocOrigin1.AssociatedPoint = nullNXOpen_Point
'        assocOrigin1.OffsetAnnotation = nullNXOpen_Annotations_Annotation
'        assocOrigin1.OffsetAlignmentPosition = NXOpen.Annotations.AlignmentPosition.TopLeft
'        assocOrigin1.XOffsetFactor = 0.0
'        assocOrigin1.YOffsetFactor = 0.0
'        assocOrigin1.StackAlignmentPosition = NXOpen.Annotations.StackAlignmentPosition.Above
'        pmiLinearDimensionBuilder1.Origin.SetAssociativeOrigin(assocOrigin1)
'        pmiLinearDimensionBuilder1.Origin.Origin.SetValue(Nothing, nullNXOpen_View, point3)

'        'pmiLinearDimensionBuilder1.Style.LetteringStyle.DimensionTextSize = 3
'        pmiLinearDimensionBuilder1.Style.LetteringStyle.DimensionTextSize = 3
'        pmiLinearDimensionBuilder1.Style.LetteringStyle.DimensionTextAspectRatio = 0.6
'        pmiLinearDimensionBuilder1.Style.LetteringStyle.DimensionTextCharSpaceFactor = 0.6
'        'pmiLinearDimensionBuilder1.Style.LetteringStyle.GeneralTextSize = 1.5
'        pmiLinearDimensionBuilder1.Style.LineArrowStyle.ArrowheadLength = 3

'        pmiLinearDimensionBuilder1.Style.DimensionStyle.DimensionValuePrecision = 2
'        pmiLinearDimensionBuilder1.Style.DimensionStyle.AngularDimensionValuePrecision = 2
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiLinearDimensionBuilder1.Style.LineArrowStyle.LeaderOrientation = NXOpen.Annotations.LeaderSide.Left
'        pmiLinearDimensionBuilder1.Style.DimensionStyle.TextCentered = False

'        Dim displayModification1 As NXOpen.DisplayModification = Nothing
'        displayModification1 = theSession.DisplayManager.NewDisplayModification()
'        displayModification1.ApplyToAllFaces = True
'        displayModification1.ApplyToOwningParts = True
'        'displayModification1.NewColor = 31
'        'displayModification1.NewFont = NXOpen.DisplayableObject.ObjectFont.Solid
'        'displayModification1.NewWidth = NXOpen.DisplayableObject.ObjectWidth.Three
'        Dim nXObject1(0) As NXOpen.DisplayableObject
'        nXObject1(0) = pmiLinearDimensionBuilder1.Commit()
'        displayModification1.Apply(nXObject1)
'        displayModification1.Dispose()
'        pmiLinearDimensionBuilder1.Destroy()
'        theSession.CleanUpFacetedFacesAndEdges()

'    End Sub

'    Sub PMILineAndPoint(ByVal iLine As String, ByVal ipoint3d2 As String, ByVal icheckSect As String, ByVal tmpCsys As CartesianCoordinateSystem, ByVal iNumtemp As Integer)
'        Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display

'        Dim CsPoint2 As Point3d  'Diem goc CS
'        Dim point2 As NXOpen.Point
'        CsPoint2 = New Point3d(Split(ipoint3d2, ",")(0), Split(ipoint3d2, ",")(1), Split(ipoint3d2, ",")(2))
'        point2 = workPart.Points.CreatePoint(CsPoint2)
'        Dim obj As NXOpen.TaggedObject = NXOpen.Utilities.NXObjectManager.Get(iLine)
'        Dim myLine
'        Try
'            myLine = CType(obj, NXOpen.Line)
'        Catch ex As Exception
'            myLine = CType(obj, NXOpen.Curve)
'        End Try

'        Dim nullNXOpen_Annotations_Dimension As NXOpen.Annotations.Dimension = Nothing
'        displayPart.Preferences.LineVisualization.ShowWidths = True
'        Dim pmiLinearDimensionBuilder1 As NXOpen.Annotations.PmiLinearDimensionBuilder = Nothing
'        pmiLinearDimensionBuilder1 = workPart.Dimensions.CreatePmiLinearDimensionBuilder(nullNXOpen_Annotations_Dimension)
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiLinearDimensionBuilder1.Origin.Anchor = NXOpen.Annotations.OriginBuilder.AlignmentPosition.MidCenter
'        pmiLinearDimensionBuilder1.Origin.Plane.PlaneMethod = NXOpen.Annotations.PlaneBuilder.PlaneMethodType.YzPlane
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        Dim nullNXOpen_Direction As NXOpen.Direction = Nothing
'        pmiLinearDimensionBuilder1.Measurement.Direction = nullNXOpen_Direction
'        Dim nullNXOpen_View As NXOpen.View = Nothing
'        pmiLinearDimensionBuilder1.Measurement.DirectionView = nullNXOpen_View
'        pmiLinearDimensionBuilder1.Style.DimensionStyle.NarrowDisplayType = NXOpen.Annotations.NarrowDisplayOption.None
'        pmiLinearDimensionBuilder1.FirstAssociativity.SetValue(NXOpen.InferSnapType.SnapType.Exist, myLine, displayPart.ModelingViews.WorkView, Nothing, Nothing, nullNXOpen_View, Nothing)
'        pmiLinearDimensionBuilder1.FirstAssociativity.SetValue(NXOpen.InferSnapType.SnapType.Exist, myLine, displayPart.ModelingViews.WorkView, Nothing, Nothing, nullNXOpen_View, Nothing)
'        Dim objects1(0) As NXOpen.NXObject
'        objects1(0) = myLine
'        pmiLinearDimensionBuilder1.AssociatedObjects.Nxobjects.SetArray(objects1)
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        Dim dimensionlinearunits11 As NXOpen.Annotations.DimensionUnit = Nothing
'        dimensionlinearunits11 = pmiLinearDimensionBuilder1.Style.UnitsStyle.DimensionLinearUnits
'        Dim dimensionlinearunits12 As NXOpen.Annotations.DimensionUnit = Nothing
'        dimensionlinearunits12 = pmiLinearDimensionBuilder1.Style.UnitsStyle.DimensionLinearUnits
'        pmiLinearDimensionBuilder1.FirstAssociativity.SetValue(NXOpen.InferSnapType.SnapType.None, myLine, displayPart.ModelingViews.WorkView, Nothing, Nothing, nullNXOpen_View, Nothing)
'        pmiLinearDimensionBuilder1.SecondAssociativity.SetValue(NXOpen.InferSnapType.SnapType.Mid, point2, displayPart.ModelingViews.WorkView, Nothing, Nothing, nullNXOpen_View, Nothing)
'        Dim objects2(1) As NXOpen.NXObject
'        objects2(0) = point2
'        objects2(1) = myLine
'        pmiLinearDimensionBuilder1.AssociatedObjects.Nxobjects.SetArray(objects2)
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiLinearDimensionBuilder1.Origin.Plane.PlaneMethod = NXOpen.Annotations.PlaneBuilder.PlaneMethodType.UserDefined
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        Dim xform1 As NXOpen.Xform = Nothing
'        Dim iDatumPlane As NXOpen.DatumPlane
'        Dim point3 As Point3d
'        If Right(icheckSect, 1) = "X" Then
'            iDatumPlane = CType(workPart.Datums.FindObject("DATUM_CSYS(0) YZ plane"), NXOpen.DatumPlane)
'            point3 = New Point3d(iDatumPlane.Origin.X + iNumtemp, iDatumPlane.Origin.Y + iNumtemp, iDatumPlane.Origin.Z + iNumtemp)
'        ElseIf Right(icheckSect, 1) = "Y" Then
'            iDatumPlane = CType(workPart.Datums.FindObject("DATUM_CSYS(0) XZ plane"), NXOpen.DatumPlane)
'            point3 = New Point3d(iDatumPlane.Origin.X + iNumtemp, iDatumPlane.Origin.Y + iNumtemp, iDatumPlane.Origin.Z + iNumtemp)
'        End If
'        xform1 = workPart.Xforms.CreateXform(iDatumPlane, NXOpen.SmartObject.UpdateOption.AfterModeling)
'        Dim cartesianCoordinateSystem1 As NXOpen.CartesianCoordinateSystem = Nothing
'        cartesianCoordinateSystem1 = workPart.CoordinateSystems.CreateCoordinateSystem(xform1, NXOpen.SmartObject.UpdateOption.AfterModeling)
'        pmiLinearDimensionBuilder1.Origin.Plane.UserDefinedPlane = xform1
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)

'        Dim assocOrigin1 As NXOpen.Annotations.Annotation.AssociativeOriginData = Nothing
'        assocOrigin1.OriginType = NXOpen.Annotations.AssociativeOriginType.Drag
'        assocOrigin1.View = nullNXOpen_View
'        assocOrigin1.ViewOfGeometry = nullNXOpen_View
'        Dim nullNXOpen_Point As NXOpen.Point = Nothing

'        assocOrigin1.PointOnGeometry = nullNXOpen_Point
'        Dim nullNXOpen_Annotations_Annotation As NXOpen.Annotations.Annotation = Nothing
'        assocOrigin1.VertAnnotation = nullNXOpen_Annotations_Annotation
'        assocOrigin1.VertAlignmentPosition = NXOpen.Annotations.AlignmentPosition.TopLeft
'        assocOrigin1.HorizAnnotation = nullNXOpen_Annotations_Annotation
'        assocOrigin1.HorizAlignmentPosition = NXOpen.Annotations.AlignmentPosition.TopLeft
'        assocOrigin1.AlignedAnnotation = nullNXOpen_Annotations_Annotation
'        assocOrigin1.DimensionLine = 0
'        assocOrigin1.AssociatedView = nullNXOpen_View
'        assocOrigin1.AssociatedPoint = nullNXOpen_Point
'        assocOrigin1.OffsetAnnotation = nullNXOpen_Annotations_Annotation
'        assocOrigin1.OffsetAlignmentPosition = NXOpen.Annotations.AlignmentPosition.TopLeft
'        assocOrigin1.XOffsetFactor = 0.0
'        assocOrigin1.YOffsetFactor = 0.0
'        assocOrigin1.StackAlignmentPosition = NXOpen.Annotations.StackAlignmentPosition.Above
'        pmiLinearDimensionBuilder1.Origin.SetAssociativeOrigin(assocOrigin1)
'        pmiLinearDimensionBuilder1.Origin.Origin.SetValue(Nothing, nullNXOpen_View, point3)
'        pmiLinearDimensionBuilder1.Style.LetteringStyle.DimensionTextSize = 3
'        pmiLinearDimensionBuilder1.Style.LetteringStyle.DimensionTextAspectRatio = 0.6
'        pmiLinearDimensionBuilder1.Style.LetteringStyle.DimensionTextCharSpaceFactor = 0.6
'        'pmiLinearDimensionBuilder1.Style.LetteringStyle.GeneralTextSize = 1.5
'        pmiLinearDimensionBuilder1.Style.LineArrowStyle.ArrowheadLength = 3
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiLinearDimensionBuilder1.Style.LineArrowStyle.LeaderOrientation = NXOpen.Annotations.LeaderSide.Left
'        pmiLinearDimensionBuilder1.Style.DimensionStyle.TextCentered = True
'        pmiLinearDimensionBuilder1.Style.DimensionStyle.DimensionValuePrecision = 2
'        pmiLinearDimensionBuilder1.Style.DimensionStyle.AngularDimensionValuePrecision = 2


'        Dim displayModification1 As NXOpen.DisplayModification = Nothing
'        displayModification1 = theSession.DisplayManager.NewDisplayModification()
'        displayModification1.ApplyToAllFaces = True
'        displayModification1.ApplyToOwningParts = True
'        'displayModification1.NewColor = 31
'        'displayModification1.NewFont = NXOpen.DisplayableObject.ObjectFont.Solid
'        'displayModification1.NewWidth = NXOpen.DisplayableObject.ObjectWidth.Three
'        Dim nXObject1(0) As NXOpen.DisplayableObject
'        nXObject1(0) = pmiLinearDimensionBuilder1.Commit()
'        displayModification1.Apply(nXObject1)
'        displayModification1.Dispose()
'        pmiLinearDimensionBuilder1.Destroy()
'        theSession.CleanUpFacetedFacesAndEdges()

'    End Sub

'    Sub PMILineAndPointNew(ByVal iLine As String, ByVal ipoint3d2 As String, ByVal icheckSect As String, ByVal tmpCsys As CartesianCoordinateSystem, ByVal iNumtemp As Integer, ByVal iVectorZ As Vector3d)
'        Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display

'        Dim CsPoint2 As Point3d  'Diem goc CS
'        Dim point2 As NXOpen.Point
'        CsPoint2 = New Point3d(Split(ipoint3d2, ",")(0), Split(ipoint3d2, ",")(1), Split(ipoint3d2, ",")(2))
'        point2 = workPart.Points.CreatePoint(CsPoint2)
'        Dim obj As NXOpen.TaggedObject = NXOpen.Utilities.NXObjectManager.Get(iLine)
'        Dim myLine
'        Try
'            myLine = CType(obj, NXOpen.Line)
'        Catch ex As Exception
'            myLine = CType(obj, NXOpen.Curve)
'        End Try
'        Dim junk(2) As Double, trash As Double
'        Dim EndPt(2) As Double
'        Dim StrPt(2) As Double
'        theUFSession.Modl.AskCurveProps(myLine.Tag, 1, EndPt, junk, junk, junk, trash, trash)
'        theUFSession.Modl.AskCurveProps(myLine.Tag, 0, StrPt, junk, junk, junk, trash, trash)
'        Dim StrPoint As Point3d = New Point3d(StrPt(0), StrPt(1), StrPt(2))
'        Dim EndPoint As Point3d = New Point3d(EndPt(0), EndPt(1), EndPt(2))
'        Dim iVectorHuong As Vector3d
'        If DistanceOf2Pt(StrPoint, CsPoint2) < DistanceOf2Pt(EndPoint, CsPoint2) Then
'            'iPoint1 = EndPoint
'            iVectorHuong = New Vector3d(EndPoint.X - StrPoint.X, EndPoint.Y - StrPoint.Y, EndPoint.Z - StrPoint.Z)
'        Else
'            iVectorHuong = New Vector3d(StrPoint.X - EndPoint.X, StrPoint.Y - EndPoint.Y, StrPoint.Z - EndPoint.Z)
'        End If


'        Dim nullNXOpen_Annotations_Dimension As NXOpen.Annotations.Dimension = Nothing
'        displayPart.Preferences.LineVisualization.ShowWidths = True
'        Dim pmiLinearDimensionBuilder1 As NXOpen.Annotations.PmiLinearDimensionBuilder = Nothing
'        pmiLinearDimensionBuilder1 = workPart.Dimensions.CreatePmiLinearDimensionBuilder(nullNXOpen_Annotations_Dimension)
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiLinearDimensionBuilder1.Origin.Anchor = NXOpen.Annotations.OriginBuilder.AlignmentPosition.MidCenter
'        pmiLinearDimensionBuilder1.Origin.Plane.PlaneMethod = NXOpen.Annotations.PlaneBuilder.PlaneMethodType.YzPlane
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        Dim nullNXOpen_Direction As NXOpen.Direction = Nothing
'        pmiLinearDimensionBuilder1.Measurement.Direction = nullNXOpen_Direction
'        Dim nullNXOpen_View As NXOpen.View = Nothing
'        pmiLinearDimensionBuilder1.Measurement.DirectionView = nullNXOpen_View
'        pmiLinearDimensionBuilder1.Style.DimensionStyle.NarrowDisplayType = NXOpen.Annotations.NarrowDisplayOption.None
'        pmiLinearDimensionBuilder1.FirstAssociativity.SetValue(NXOpen.InferSnapType.SnapType.Exist, myLine, displayPart.ModelingViews.WorkView, Nothing, Nothing, nullNXOpen_View, Nothing)
'        pmiLinearDimensionBuilder1.FirstAssociativity.SetValue(NXOpen.InferSnapType.SnapType.Exist, myLine, displayPart.ModelingViews.WorkView, Nothing, Nothing, nullNXOpen_View, Nothing)
'        Dim objects1(0) As NXOpen.NXObject
'        objects1(0) = myLine
'        pmiLinearDimensionBuilder1.AssociatedObjects.Nxobjects.SetArray(objects1)
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        Dim dimensionlinearunits11 As NXOpen.Annotations.DimensionUnit = Nothing
'        dimensionlinearunits11 = pmiLinearDimensionBuilder1.Style.UnitsStyle.DimensionLinearUnits
'        Dim dimensionlinearunits12 As NXOpen.Annotations.DimensionUnit = Nothing
'        dimensionlinearunits12 = pmiLinearDimensionBuilder1.Style.UnitsStyle.DimensionLinearUnits
'        pmiLinearDimensionBuilder1.FirstAssociativity.SetValue(NXOpen.InferSnapType.SnapType.None, myLine, displayPart.ModelingViews.WorkView, Nothing, Nothing, nullNXOpen_View, Nothing)
'        pmiLinearDimensionBuilder1.SecondAssociativity.SetValue(NXOpen.InferSnapType.SnapType.Mid, point2, displayPart.ModelingViews.WorkView, Nothing, Nothing, nullNXOpen_View, Nothing)
'        Dim objects2(1) As NXOpen.NXObject
'        objects2(0) = point2
'        objects2(1) = myLine
'        pmiLinearDimensionBuilder1.AssociatedObjects.Nxobjects.SetArray(objects2)
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiLinearDimensionBuilder1.Origin.Plane.PlaneMethod = NXOpen.Annotations.PlaneBuilder.PlaneMethodType.UserDefined
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        'Dim xform1 As NXOpen.Xform = Nothing
'        'Dim iDatumPlane As NXOpen.DatumPlane
'        Dim point3 As Point3d
'        Dim X1 As Double
'        Dim Y1 As Double
'        Dim Z1 As Double

'        'Dim iHuong As Vector3d
'        'Dim iOrigin As Point3d = New Point3d(tmpCsys.Origin.X, tmpCsys.Origin.Y, tmpCsys.Origin.Z)
'        Dim iOrigin As Point3d = New Point3d(point2.Coordinates.X, point2.Coordinates.Y, point2.Coordinates.Z)
'        'If Right(icheckSect, 1) = "X" Then
'        '    iDatumPlane = CType(workPart.Datums.FindObject("DATUM_CSYS(0) YZ plane"), NXOpen.DatumPlane)
'        '    iHuong = New Vector3d(tmpCsys.Orientation.Element.Yx, tmpCsys.Orientation.Element.Yy, tmpCsys.Orientation.Element.Yz)
'        '    'point3 = New Point3d(iDatumPlane.Origin.X + iNumtemp, iDatumPlane.Origin.Y + iNumtemp, iDatumPlane.Origin.Z + iNumtemp)
'        'ElseIf Right(icheckSect, 1) = "Y" Then
'        '    iDatumPlane = CType(workPart.Datums.FindObject("DATUM_CSYS(0) XZ plane"), NXOpen.DatumPlane)
'        '    iHuong = New Vector3d(tmpCsys.Orientation.Element.Xx, tmpCsys.Orientation.Element.Xy, tmpCsys.Orientation.Element.Xz)
'        '    'point3 = New Point3d(iDatumPlane.Origin.X + iNumtemp, iDatumPlane.Origin.Y + iNumtemp, iDatumPlane.Origin.Z + iNumtemp)
'        'End If
'        iNumtemp += 5

'        Dim orientation1 As NXOpen.Matrix3x3 = Nothing

'        If Right(icheckSect, 1) = "X" Then

'            orientation1.Xx = tmpCsys.Orientation.Element.Yx
'            orientation1.Xy = tmpCsys.Orientation.Element.Yy
'            orientation1.Xz = tmpCsys.Orientation.Element.Yz

'            orientation1.Yx = tmpCsys.Orientation.Element.Zx
'            orientation1.Yy = tmpCsys.Orientation.Element.Zy
'            orientation1.Yz = tmpCsys.Orientation.Element.Zz

'            orientation1.Zx = tmpCsys.Orientation.Element.Xx
'            orientation1.Zy = tmpCsys.Orientation.Element.Xy
'            orientation1.Zz = tmpCsys.Orientation.Element.Xz

'            X1 = iOrigin.X + iNumtemp * iVectorHuong.X
'            Y1 = iOrigin.Y + iNumtemp * iVectorHuong.Y
'            Z1 = iOrigin.Z + iNumtemp * iVectorHuong.Z


'            X1 = X1 + 5 * -iVectorZ.X
'            Y1 = Y1 + 5 * -iVectorZ.Y
'            Z1 = Z1 + 5 * -iVectorZ.Z

'        ElseIf Right(icheckSect, 1) = "Y" Then

'            orientation1.Xx = tmpCsys.Orientation.Element.Xx
'            orientation1.Xy = tmpCsys.Orientation.Element.Xy
'            orientation1.Xz = tmpCsys.Orientation.Element.Xz

'            orientation1.Yx = tmpCsys.Orientation.Element.Zx
'            orientation1.Yy = tmpCsys.Orientation.Element.Zy
'            orientation1.Yz = tmpCsys.Orientation.Element.Zz

'            orientation1.Zx = tmpCsys.Orientation.Element.Yx
'            orientation1.Zy = tmpCsys.Orientation.Element.Yy
'            orientation1.Zz = tmpCsys.Orientation.Element.Yz

'            X1 = iOrigin.X + iNumtemp * iVectorHuong.X
'            Y1 = iOrigin.Y + iNumtemp * iVectorHuong.Y
'            Z1 = iOrigin.Z + iNumtemp * iVectorHuong.Z


'            X1 = X1 + 5 * -iVectorZ.X
'            Y1 = Y1 + 5 * -iVectorZ.Y
'            Z1 = Z1 + 5 * -iVectorZ.Z

'        End If
'        point3 = New Point3d(X1, Y1, Z1)
'        Dim xform2 As NXOpen.Xform = Nothing
'        xform2 = workPart.Xforms.CreateXformFromCurrentView(NXOpen.SmartObject.UpdateOption.AfterModeling, 1.0)
'        Dim origin1 As NXOpen.Point3d = point3
'        xform2.SetOrigin(origin1)
'        xform2.SetOrientation(orientation1)


'        'xform1 = workPart.Xforms.CreateXform(iDatumPlane, NXOpen.SmartObject.UpdateOption.AfterModeling)
'        Dim cartesianCoordinateSystem1 As NXOpen.CartesianCoordinateSystem = Nothing
'        cartesianCoordinateSystem1 = workPart.CoordinateSystems.CreateCoordinateSystem(xform2, NXOpen.SmartObject.UpdateOption.AfterModeling)
'        pmiLinearDimensionBuilder1.Origin.Plane.UserDefinedPlane = xform2
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)

'        Dim assocOrigin1 As NXOpen.Annotations.Annotation.AssociativeOriginData = Nothing
'        assocOrigin1.OriginType = NXOpen.Annotations.AssociativeOriginType.Drag
'        assocOrigin1.View = nullNXOpen_View
'        assocOrigin1.ViewOfGeometry = nullNXOpen_View
'        Dim nullNXOpen_Point As NXOpen.Point = Nothing

'        assocOrigin1.PointOnGeometry = nullNXOpen_Point
'        Dim nullNXOpen_Annotations_Annotation As NXOpen.Annotations.Annotation = Nothing
'        assocOrigin1.VertAnnotation = nullNXOpen_Annotations_Annotation
'        assocOrigin1.VertAlignmentPosition = NXOpen.Annotations.AlignmentPosition.TopLeft
'        assocOrigin1.HorizAnnotation = nullNXOpen_Annotations_Annotation
'        assocOrigin1.HorizAlignmentPosition = NXOpen.Annotations.AlignmentPosition.TopLeft
'        assocOrigin1.AlignedAnnotation = nullNXOpen_Annotations_Annotation
'        assocOrigin1.DimensionLine = 0
'        assocOrigin1.AssociatedView = nullNXOpen_View
'        assocOrigin1.AssociatedPoint = nullNXOpen_Point
'        assocOrigin1.OffsetAnnotation = nullNXOpen_Annotations_Annotation
'        assocOrigin1.OffsetAlignmentPosition = NXOpen.Annotations.AlignmentPosition.TopLeft
'        assocOrigin1.XOffsetFactor = 0.0
'        assocOrigin1.YOffsetFactor = 0.0
'        assocOrigin1.StackAlignmentPosition = NXOpen.Annotations.StackAlignmentPosition.Above
'        pmiLinearDimensionBuilder1.Origin.SetAssociativeOrigin(assocOrigin1)
'        pmiLinearDimensionBuilder1.Origin.Origin.SetValue(Nothing, nullNXOpen_View, point3)
'        pmiLinearDimensionBuilder1.Style.LetteringStyle.DimensionTextSize = 3
'        pmiLinearDimensionBuilder1.Style.LetteringStyle.DimensionTextAspectRatio = 0.6
'        pmiLinearDimensionBuilder1.Style.LetteringStyle.DimensionTextCharSpaceFactor = 0.6
'        'pmiLinearDimensionBuilder1.Style.LetteringStyle.GeneralTextSize = 1.5
'        pmiLinearDimensionBuilder1.Style.LineArrowStyle.ArrowheadLength = 3
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiLinearDimensionBuilder1.Style.LineArrowStyle.LeaderOrientation = NXOpen.Annotations.LeaderSide.Left
'        pmiLinearDimensionBuilder1.Style.DimensionStyle.TextCentered = False
'        pmiLinearDimensionBuilder1.Style.DimensionStyle.DimensionValuePrecision = 2
'        pmiLinearDimensionBuilder1.Style.DimensionStyle.AngularDimensionValuePrecision = 2


'        Dim displayModification1 As NXOpen.DisplayModification = Nothing
'        displayModification1 = theSession.DisplayManager.NewDisplayModification()
'        displayModification1.ApplyToAllFaces = True
'        displayModification1.ApplyToOwningParts = True
'        'displayModification1.NewColor = 31
'        'displayModification1.NewFont = NXOpen.DisplayableObject.ObjectFont.Solid
'        'displayModification1.NewWidth = NXOpen.DisplayableObject.ObjectWidth.Three
'        Dim nXObject1(0) As NXOpen.DisplayableObject
'        nXObject1(0) = pmiLinearDimensionBuilder1.Commit()
'        displayModification1.Apply(nXObject1)
'        displayModification1.Dispose()
'        pmiLinearDimensionBuilder1.Destroy()
'        theSession.CleanUpFacetedFacesAndEdges()

'    End Sub

'    Sub DoKichThuocTheoPhuong(ByVal iLine As String, ByVal iPoint3d As Point3d, ByVal iVector As Vector3d, ByRef giatri As Double)
'        Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim CsPoint1 As Point3d  'Diem goc CS
'        Dim ipoint As NXOpen.Point
'        CsPoint1 = New Point3d(iPoint3d.X, iPoint3d.Y, iPoint3d.Z)
'        ipoint = workPart.Points.CreatePoint(CsPoint1)
'        Dim obj As NXOpen.TaggedObject = NXOpen.Utilities.NXObjectManager.Get(iLine)
'        Dim myLine
'        Try
'            myLine = CType(obj, NXOpen.Line)
'        Catch ex As Exception
'            myLine = CType(obj, NXOpen.Curve)
'        End Try


'        Dim nullNXOpen_NXObject As NXOpen.NXObject = Nothing
'        Dim measureDistanceBuilder1 As NXOpen.MeasureDistanceBuilder = Nothing
'        measureDistanceBuilder1 = workPart.MeasureManager.CreateMeasureDistanceBuilder(nullNXOpen_NXObject)
'        measureDistanceBuilder1.Mtype = NXOpen.MeasureDistanceBuilder.MeasureType.Minimum
'        Dim unit1 As NXOpen.Unit = CType(workPart.UnitCollection.FindObject("MilliMeter"), NXOpen.Unit)
'        Dim expression1 As NXOpen.Expression = Nothing
'        expression1 = workPart.Expressions.CreateSystemExpressionWithUnits("0", unit1)
'        Dim direction1 As NXOpen.Direction = Nothing
'        direction1 = workPart.Directions.CreateDirection(ipoint, iVector)
'        measureDistanceBuilder1.ProjectionVector = direction1
'        measureDistanceBuilder1.Object1.Value = myLine
'        measureDistanceBuilder1.Object2.Value = ipoint
'        Dim object1 As Object = CType(myLine, Object)
'        Dim object2 As Object = CType(ipoint, Object)
'        Dim measureDistance1 As NXOpen.MeasureDistance = Nothing
'        measureDistance1 = workPart.MeasureManager.NewDistance(unit1, ipoint, myLine, direction1)
'        giatri = measureDistance1.Value
'        Dim datadeleted1 As Boolean = Nothing
'        datadeleted1 = theSession.DeleteTransientDynamicSectionCutData()
'        measureDistanceBuilder1.Destroy()
'        workPart.Expressions.Delete(expression1)
'    End Sub

'    Sub InsertToInforLineDataTable(ByVal iSectName As String, ByVal GroupName As String, ByVal GroupTag As String, ByVal ObjectTag As String, ByVal Linelength As Double, ByVal iStrPt3d As Point3d, ByVal iEndPt3d As Point3d, ByVal iCtrPt3d As Point3d,
'                                ByVal iType As String, ByVal d1 As Double, ByVal a1 As Double, ByVal dtInforLineOut As DataTable, ByVal iCsys As CartesianCoordinateSystem)


'        Dim iBase1 As Double = 0.9
'        Dim iBase2 As Double = 1.01
'        If InStr(GroupName.ToUpper, "BOLT") > 0 Or InStr(GroupName.ToUpper, "STUD-BALL") > 0 Or InStr(GroupName.ToUpper, "NUT") > 0 _
'           Or InStr(GroupName.ToUpper, "SCR") > 0 Or InStr(GroupName.ToUpper, "SCREW") > 0 Or InStr(GroupName.ToUpper, "PIN") > 0 _
'           Or InStr(GroupName.ToUpper, "RIVET") > 0 Or InStr(GroupName.ToUpper, "GROM") > 0 Or InStr(GroupName.ToUpper, "PLUG") > 0 _
'            Or InStr(GroupName.ToUpper, "MONO") > 0 Or InStr(GroupName.ToUpper, "OTHER") > 0 Then
'            iBase1 = 0.997
'            iBase2 = 1.003
'        ElseIf InStr(GroupName.ToUpper, "CLIP") > 0 Then
'            iBase1 = 0.9
'            iBase2 = 1.1

'        End If
'        Dim row As DataRow = dtInforLineOut.NewRow
'        row("Sect") = iSectName
'        row("GroupName") = GroupName
'        row("Group Tag") = GroupTag
'        row("Object Tag") = ObjectTag
'        row("Line length") = Linelength
'        row("Xd") = iStrPt3d.X
'        row("Yd") = iStrPt3d.Y
'        row("Zd") = iStrPt3d.Z
'        row("Xm") = iCtrPt3d.X
'        row("Ym") = iCtrPt3d.Y
'        row("Zm") = iCtrPt3d.Z
'        row("Xc") = iEndPt3d.X
'        row("Yc") = iEndPt3d.Y
'        row("Zc") = iEndPt3d.Z
'        row("Vx") = iEndPt3d.X - iStrPt3d.X
'        row("Vy") = iEndPt3d.Y - iStrPt3d.Y
'        row("Vz") = iEndPt3d.Z - iStrPt3d.Z
'        row("TypeLine") = iType
'        row("d1") = d1

'        Dim iZCS(2) As Double
'        Dim iMatrix As Matrix3x3 = iCsys.Orientation.Element

'        iZCS(0) = iMatrix.Zx.ToString
'        iZCS(1) = iMatrix.Zy.ToString
'        iZCS(2) = iMatrix.Zz.ToString

'        Dim iCosA1 As Double = C007_iAngleMesure(iZCS(0), iZCS(1), iZCS(2), iEndPt3d.X - iStrPt3d.X, iEndPt3d.Y - iStrPt3d.Y, iEndPt3d.Z - iStrPt3d.Z)

'        iCosA1 = Math.Abs(iCosA1)


'        If iBase1 <= iCosA1 And iCosA1 <= iBase2 Then

'            row("a1") = 1
'            row("Result") = 1

'        ElseIf iCosA1 <= 0.045 Then

'            row("a1") = 0

'        Else

'            row("a1") = ""

'        End If
'        row("Xg") = 0
'        row("Yg") = 0
'        row("Zg") = 0
'        row("Hole Size") = ""
'        row("Hole Type") = ""
'        row("DistTemp") = 0
'        row("CtrLineX") = ""
'        row("CtrLineY") = ""
'        row("CtrLineTag") = ""
'        row("CtrUnmatch") = ""
'        row("BoltCL") = ""
'        'row("Danmen") = "0"
'        dtInforLineOut.Rows.Add(row)

'    End Sub

'    Function Diem_do_Thread(ByVal iPoint3D_1 As Point3d, iPoint3D_2 As Point3d, ByVal tmpCsys As CartesianCoordinateSystem, ByVal iCtrNutPoint As Point3d) As Point3d
'        'Dim theSession As Session = Session.GetSession()
'        'Dim theUFSession As UFSession = UFSession.GetUFSession()
'        'Dim workPart As Part = theSession.Parts.Work
'        Dim iPoint3DCS As Point3d = New Point3d(tmpCsys.Origin.X, tmpCsys.Origin.Y, tmpCsys.Origin.Z)
'        Dim iPointLine As Point3d
'        Dim iMatrix As Matrix3x3 = tmpCsys.Orientation.Element
'        Dim iDirectionVector As Vector3d = New Vector3d(iMatrix.Zx, iMatrix.Zy, iMatrix.Zz)
'        'Create_LineEquation_From_Point_And_DirectionVector(iPoint3DCS, iDirectionVector, 100, iPointLine)
'        Dim iVector As Vector3d = New Vector3d(iCtrNutPoint.X - tmpCsys.Origin.X, iCtrNutPoint.Y - tmpCsys.Origin.Y, iCtrNutPoint.Z - tmpCsys.Origin.Z)
'        Create_LineEquation_From_Point_And_DirectionVector(iPoint3DCS, iVector, 50, iPointLine)
'        'Dim ipt As NXOpen.Point = workPart.Points.CreatePoint(iPointLine)
'        'ipt.SetVisibility(SmartObject.VisibilityOption.Visible)
'        Dim iCos1 As Double, iCos2 As Double
'        iCos1 = CosOf2Line(iPointLine, iPoint3DCS, iPointLine, iPoint3D_1)
'        iCos2 = CosOf2Line(iPointLine, iPoint3DCS, iPointLine, iPoint3D_2)
'        'lw.WriteLine(iCos1)
'        'lw.WriteLine(iCos2)
'        If iCos1 > iCos2 Then
'            Diem_do_Thread = iPoint3D_2
'        Else
'            Diem_do_Thread = iPoint3D_1
'        End If

'    End Function

'    Function Create_LineEquation_From_Point_And_DirectionVector(ByVal iPoint As Point3d, ByVal iDirectionVector As Vector3d, ByVal t As Double, ByRef iPoint_Line As Point3d)
'        iPoint_Line.X = iPoint.X + iDirectionVector.X * t
'        iPoint_Line.Y = iPoint.Y + iDirectionVector.Y * t
'        iPoint_Line.Z = iPoint.Z + iDirectionVector.Z * t
'    End Function

'    Function CosOf2Line(ByVal iPt1 As Point3d, ByVal iPt2 As Point3d, ByVal iPt3 As Point3d, ByVal iPt4 As Point3d) As Double
'        Dim v1x As Double, v1y As Double, v1z As Double, v2x As Double, v2y As Double, v2z As Double
'        v1x = iPt1.X - iPt2.X
'        v1y = iPt1.Y - iPt2.Y
'        v1z = iPt1.Z - iPt2.Z

'        v2x = iPt3.X - iPt4.X
'        v2y = iPt3.Y - iPt4.Y
'        v2z = iPt3.Z - iPt4.Z
'        CosOf2Line = (v1x * v2x + v1y * v2y + v1z * v2z) / Math.Sqrt((v1x ^ 2 + v1y ^ 2 + v1z ^ 2) * (v2x ^ 2 + v2y ^ 2 + v2z ^ 2))
'    End Function

'    Function CosOf2Vector(ByVal iPt1 As Point3d, ByVal iPt2 As Point3d, ByVal v2x As Double, ByVal v2y As Double, ByVal v2z As Double) As Double
'        Dim v1x As Double, v1y As Double, v1z As Double
'        v1x = iPt1.X - iPt2.X
'        v1y = iPt1.Y - iPt2.Y
'        v1z = iPt1.Z - iPt2.Z
'        CosOf2Vector = (v1x * v2x + v1y * v2y + v1z * v2z) / Math.Sqrt((v1x ^ 2 + v1y ^ 2 + v1z ^ 2) * (v2x ^ 2 + v2y ^ 2 + v2z ^ 2))
'    End Function

'    Function DirOf2Line(ByVal iPt1 As Point3d, ByVal iPt2 As Point3d, ByVal iPt3 As Point3d, ByVal iPt4 As Point3d) As Double
'        Dim v1x As Double, v1y As Double, v1z As Double, v2x As Double, v2y As Double, v2z As Double
'        v1x = (iPt1.X + iPt2.X) / 2
'        v1y = (iPt1.Y + iPt2.Y) / 2
'        v1z = (iPt1.Z + iPt2.Z) / 2

'        v2x = (iPt3.X + iPt4.X) / 2
'        v2y = (iPt3.Y + iPt4.Y) / 2
'        v2z = (iPt3.Z + iPt4.Z) / 2
'        DirOf2Line = Math.Sqrt((v1x - v2x) ^ 2 + (v1y - v2y) ^ 2 + (v1z - v2z) ^ 2)
'    End Function

'    Sub D001_CreateCenterLine(ByVal newStartPoint As Point3d, ByVal newEndPoint As Point3d, ByRef iCtrLine As Line)      'Input: Mảng chứa 2 Spline của lỗ. Output: Tạo ra 1 Hole Center Line, dành cho Nut và lỗ
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim Point_LineHole1() As Point3d
'        Dim Point_LineHole2() As Point3d
'        Dim stPt(2) As Double
'        Dim edPt(2) As Double
'        Dim junk3(2) As Double
'        Dim junk1 As Double
'        iCtrLine = workPart.Curves.CreateLine(newStartPoint, newEndPoint)        'tạo line
'        'Kéo dài và format đường tâm
'        Dim displayModification1 As NXOpen.DisplayModification = Nothing
'        displayModification1 = theSession.DisplayManager.NewDisplayModification()
'        displayModification1.ApplyToAllFaces = True
'        displayModification1.ApplyToOwningParts = False
'        displayModification1.NewFont = NXOpen.DisplayableObject.ObjectFont.Centerline
'        displayModification1.NewWidth = NXOpen.DisplayableObject.ObjectWidth.Thin
'        Dim objects1(0) As NXOpen.DisplayableObject
'        objects1(0) = iCtrLine
'        displayModification1.Apply(objects1)
'        displayModification1.Dispose()
'        theSession.CleanUpFacetedFacesAndEdges()
'        Dim iLineLen As Double = iCtrLine.GetLength + 2.5
'        Dim associativeLineBuilder1 As NXOpen.Features.AssociativeLineBuilder = Nothing
'        associativeLineBuilder1 = workPart.BaseFeatures.CreateAssociativeLineBuilder(iCtrLine)
'        associativeLineBuilder1.Limits.StartLimit.LimitOption = NXOpen.GeometricUtilities.CurveExtendData.LimitOptions.Value
'        associativeLineBuilder1.Limits.StartLimit.Distance.RightHandSide = "-2.5"
'        associativeLineBuilder1.Limits.EndLimit.LimitOption = NXOpen.GeometricUtilities.CurveExtendData.LimitOptions.Value
'        associativeLineBuilder1.Limits.EndLimit.Distance.RightHandSide = iLineLen
'        Dim nXObject1 As NXOpen.NXObject = Nothing
'        nXObject1 = associativeLineBuilder1.Commit()
'        associativeLineBuilder1.Destroy()

'    End Sub

'    Sub CreateInforPMI(ByVal iComponentName As String, ByVal iGroup As Group)
'        Dim theSession As Session = Session.GetSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As Part = theSession.Parts.Display
'        Dim TheUFsession As UFSession = UFSession.GetUFSession()
'        Dim NULLTAG As Tag = NXOpen.Tag.Null
'        Dim objectTag As Tag = NXOpen.Tag.Null
'        Dim group_count As Integer = 0
'        Dim group_list() As Group
'        Dim group_member_list() As Tag
'        Dim member_count As Integer

'        TheUFsession.Group.AskGroupData(iGroup.Tag, group_member_list, member_count)
'        Dim midPt(2) As Double
'        For Each iTag As Tag In group_member_list
'            Dim iObj As NXObject = Nothing
'            iObj = NXObjectManager.Get(iTag)
'            Dim iCurve As Curve = CType(iObj, Curve)
'            TheUFsession.Modl.AskCurveProps(iCurve.Tag, 0.5, midPt, junk, junk, junk, trash, trash)
'            Exit For
'        Next

'        Dim tmpName As String
'        Dim tmpPartNo As String, tmpPartName As String

'        If InStr(iGroup.Name.ToUpper, "BOLT") > 0 Or InStr(iGroup.Name.ToUpper, "NUT") > 0 Then
'            tmpName = Split(iGroup.Name, "$")(0) & "$" & Split(iGroup.Name, "$")(1)

'        ElseIf InStr(iGroup.Name.ToUpper, "$") > 0 Then

'            tmpPartNo = Split(iGroup.Name, "$")(1)
'            tmpPartNo = Split(tmpPartNo, "__#")(0)
'            tmpPartName = Split(iGroup.Name, "$")(0)


'            If InStr(tmpPartName, "~") > 0 Then

'                tmpPartName = Split(tmpPartName, "~")(1)


'            End If


'            If InStr(tmpPartNo, "~") > 0 Then
'                tmpPartNo = Split(tmpPartNo, "~")(1)

'            End If



'            If Len(Split(iGroup.Name, "$")(3)) = 1 Then
'                tmpName = tmpPartName & "$" & tmpPartNo
'            Else
'                tmpName = tmpPartName & "$" & tmpPartNo & "$" & Split(iGroup.Name, "$")(2) & "$" & Split(iGroup.Name, "$")(3)
'            End If

'        Else

'            tmpName = iGroup.Name
'        End If
'        Dim aContents As String = tmpName
'        Dim X0 As Double = midPt(0)
'        Dim Y0 As Double = midPt(1)
'        Dim Z0 As Double = midPt(2)
'        Dim X1 As Double
'        Dim Y1 As Double
'        Dim Z1 As Double

'        Dim modelingView1 As ModelingView
'        modelingView1 = displayPart.ModelingViews.WorkView
'        Dim a1 As Double, a2 As Double, a3 As Double, b1 As Double, b2 As Double, b3 As Double, c1 As Double, c2 As Double, c3 As Double, a As Double, b As Double, c As Double
'        Dim aX As String, aY As String, aZ As String, aX1 As String, aY1 As String, aZ1 As String

'        Dim iOriPt As NXOpen.Point, iZaxis As DatumAxis, tempXdir As Vector3d, tempYdir As Vector3d, tempZdir As Vector3d
'        Call D001_SearchCsysTest(iOriPt, iZaxis, tempXdir, tempYdir, tempZdir)

'        If Right(iComponentName, 1) = "X" Then
'            a1 = tempYdir.X
'            a2 = tempYdir.Y
'            a3 = tempYdir.Z
'            b1 = tempZdir.X
'            b2 = tempZdir.Y
'            b3 = tempZdir.Z
'            c1 = tempXdir.X
'            c2 = tempXdir.Y
'            c3 = tempXdir.Z
'        Else
'            a1 = tempZdir.X
'            a2 = tempZdir.Y
'            a3 = tempZdir.Z
'            b1 = tempXdir.X
'            b2 = tempXdir.Y
'            b3 = tempXdir.Z
'            c1 = tempYdir.X
'            c2 = tempYdir.Y
'            c3 = tempYdir.Z
'        End If

'        X1 = X0 + 10 * b1
'        Y1 = Y0 + 10 * b2
'        Z1 = Z0 + 10 * b3
'        X1 = X1 + 15 * a1
'        X1 = X1 + 15 * a2
'        X1 = X1 + 15 * a3

'        Dim nullAnnotations_SimpleDraftingAid As Annotations.SimpleDraftingAid = Nothing
'        Dim pmiNoteBuilder1 As Annotations.PmiNoteBuilder
'        pmiNoteBuilder1 = workPart.Annotations.CreatePmiNoteBuilder(nullAnnotations_SimpleDraftingAid)
'        pmiNoteBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiNoteBuilder1.Origin.Anchor = Annotations.OriginBuilder.AlignmentPosition.MidCenter
'        Dim i As Integer
'        Dim aArrayA
'        aArrayA = Split(aContents, "$")
'        Dim text1(UBound(aArrayA, 1)) As String
'        For i = 0 To UBound(aArrayA, 1)
'            text1(i) = Trim(aArrayA(i))
'        Next


'        pmiNoteBuilder1.Text.TextBlock.SetText(text1)
'        pmiNoteBuilder1.TextAlignment = Annotations.DraftingNoteBuilder.TextAlign.BelowbottomExtToMax
'        Dim leaderData1 As Annotations.LeaderData
'        leaderData1 = workPart.Annotations.CreateLeaderData()
'        leaderData1.StubSize = 2.0#
'        leaderData1.Arrowhead = Annotations.LeaderData.ArrowheadType.OpenArrow
'        pmiNoteBuilder1.Leader.Leaders.Append(leaderData1)
'        leaderData1.StubSide = Annotations.LeaderSide.Inferred
'        Dim symbolscale1 As Double
'        symbolscale1 = pmiNoteBuilder1.Text.TextBlock.SymbolScale
'        Dim symbolaspectratio1 As Double
'        symbolaspectratio1 = pmiNoteBuilder1.Text.TextBlock.SymbolAspectRatio
'        pmiNoteBuilder1.Origin.Plane.PlaneMethod = Annotations.PlaneBuilder.PlaneMethodType.UserDefined
'        pmiNoteBuilder1.Origin.SetInferRelativeToGeometry(True)

'        Dim origin1 As Point3d
'        Dim xDirection1 As Vector3d
'        Dim yDirection1 As Vector3d
'        If Right(iComponentName, 1) = "Y" Then
'            origin1 = New Point3d(X0, Y0, Z0)
'            xDirection1 = New Vector3d(b1, b2, b3)
'            yDirection1 = New Vector3d(a1, a2, a3)
'        Else
'            origin1 = New Point3d(X0, Y0, Z0)
'            xDirection1 = New Vector3d(a1, a2, a3)
'            yDirection1 = New Vector3d(b1, b2, b3)
'        End If

'        Dim xform3 As Xform
'        xform3 = workPart.Xforms.CreateXform(origin1, xDirection1, yDirection1, SmartObject.UpdateOption.AfterModeling, 1.0#)

'        'Dim cartesianCoordinateSystem1 As CartesianCoordinateSystem
'        'cartesianCoordinateSystem1 = workPart.CoordinateSystems.CreateCoordinateSystem(xform3, SmartObject.UpdateOption.AfterModeling)
'        pmiNoteBuilder1.Origin.Plane.UserDefinedPlane = xform3
'        pmiNoteBuilder1.Origin.SetInferRelativeToGeometry(True)
'        Dim coordinates1 As Point3d = New Point3d(X0, Y0, Z0)
'        Dim point1 As NXOpen.Point
'        point1 = workPart.Points.CreatePoint(coordinates1)
'        Dim point2 As Point3d = New Point3d(X0, Y0, Z0)
'        Try
'            leaderData1.Leader.SetValue(point1, displayPart.ModelingViews.WorkView, point2)
'        Catch
'            leaderData1.Leader.SetValue(point1, workPart.ModelingViews.WorkView, point2)
'        End Try

'        Dim assocOrigin1 As Annotations.Annotation.AssociativeOriginData
'        assocOrigin1.OriginType = Annotations.AssociativeOriginType.Drag
'        Dim nullView As NXOpen.View = Nothing
'        assocOrigin1.View = nullView
'        assocOrigin1.ViewOfGeometry = nullView
'        Dim nullPoint As NXOpen.Point = Nothing
'        assocOrigin1.PointOnGeometry = nullPoint
'        Dim nullAnnotations_Annotation As Annotations.Annotation = Nothing
'        assocOrigin1.OffsetAlignmentPosition = Annotations.AlignmentPosition.TopLeft
'        assocOrigin1.XOffsetFactor = 0.0#
'        assocOrigin1.YOffsetFactor = 0.0#
'        assocOrigin1.StackAlignmentPosition = Annotations.StackAlignmentPosition.Above
'        pmiNoteBuilder1.Origin.SetAssociativeOrigin(assocOrigin1)
'        pmiNoteBuilder1.Style.LetteringStyle.GeneralTextAspectRatio = 0.6
'        pmiNoteBuilder1.Style.LetteringStyle.GeneralTextCharSpaceFactor = 0.6
'        pmiNoteBuilder1.Style.LetteringStyle.GeneralTextSize = 3
'        pmiNoteBuilder1.Style.LineArrowStyle.ArrowheadLength = 3

'        Dim point3 As Point3d = New Point3d(X1, Y1, Z1)
'        pmiNoteBuilder1.Origin.Origin.SetValue(Nothing, nullView, point3)
'        pmiNoteBuilder1.Origin.SetInferRelativeToGeometry(True)
'        leaderData1.StubSide = Annotations.LeaderSide.Left
'        Dim nXObject1 As NXObject
'        nXObject1 = pmiNoteBuilder1.Commit()
'        pmiNoteBuilder1.Destroy()
'    End Sub

'    Sub DeleteDupliateGroup(ByVal iComponentName As String)
'        Dim theSession As Session = Session.GetSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As Part = theSession.Parts.Display
'        Dim TheUFsession As UFSession = UFSession.GetUFSession()
'        Dim tmpGrp As NXOpen.Tag = NXOpen.Tag.Null
'        Dim myGroup As NXOpen.Group
'        Dim iGroupInforArr As New List(Of String)
'        Dim iGrNameList As New List(Of String)
'        Dim i As Integer
'        Dim iDelGroup As New List(Of Group)

'        Dim iGroupInfor As String

'        Do
'            TheUFsession.Obj.CycleObjsInPart(workPart.Tag, UFConstants.UF_group_type, tmpGrp)
'            If tmpGrp = NXOpen.Tag.Null Then
'                Continue Do
'            End If

'            myGroup = Utilities.NXObjectManager.Get(tmpGrp)
'            If iGrNameList.Contains(myGroup.Name) = False Then
'                iGrNameList.Add(myGroup.Name)

'                If InStr(myGroup.Name, "THICK") = 0 Then                        'những PMI của buhin Thickness (trong tên có chữ "THICK") thì k hiển thị PMI
'                    Call GetGroupInfor(myGroup, iGroupInfor)
'                    If iGroupInfor <> "" Then
'                        If iGroupInforArr.Contains(iGroupInfor) = False Then
'                            iGroupInforArr.Add(iGroupInfor)
'                            Try
'                                Call CreateInforPMI(iComponentName, myGroup)
'                            Catch ex As Exception
'                            End Try
'                        Else
'                            iDelGroup.Add(myGroup)
'                        End If
'                    End If
'                End If
'            End If



'        Loop Until tmpGrp = NXOpen.Tag.Null

'        For Each iGroup1 As Group In iDelGroup
'            TheUFsession.Obj.DeleteObject(iGroup1.Tag)
'        Next

'    End Sub

'    Sub GetGroupInfor(ByVal iGroup As Group, ByRef iGroupInfor As String)
'        Dim theSession As Session = Session.GetSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As Part = theSession.Parts.Display
'        Dim TheUFsession As UFSession = UFSession.GetUFSession()
'        Dim NULLTAG As Tag = NXOpen.Tag.Null
'        Dim objectTag As Tag = NXOpen.Tag.Null
'        Dim group_count As Integer = 0
'        Dim group_list() As Group
'        Dim group_member_list() As Tag
'        Dim member_count As Integer

'        Dim iGroupLen As Double
'        Try

'            TheUFsession.Group.AskGroupData(iGroup.Tag, group_member_list, member_count)
'            Dim i As Integer = 0
'            Dim XCoor() As Double, YCoor() As Double, ZCoor() As Double
'            For Each iTag As Tag In group_member_list
'                Dim iObj As NXObject = Nothing
'                iObj = NXObjectManager.Get(iTag)
'                Dim iCurve As Curve = CType(iObj, Curve)

'                iGroupLen = iGroupLen + iCurve.GetLength

'                Dim midPt(2) As Double
'                TheUFsession.Modl.AskCurveProps(iCurve.Tag, 0.5, midPt, junk, junk, junk, trash, trash)
'                Dim iPt3d As New Point3d(midPt(0), midPt(1), midPt(2))

'                ReDim Preserve XCoor(i)
'                XCoor(i) = midPt(0)
'                ReDim Preserve YCoor(i)
'                YCoor(i) = midPt(1)
'                ReDim Preserve ZCoor(i)
'                ZCoor(i) = midPt(2)
'                i = i + 1
'            Next


'            Dim iX As Double, iY As Double, iZ As Double
'            Dim tmpX As Double = 0, tmpY As Double = 0, tmpZ As Double = 0

'            For i = 0 To UBound(XCoor)
'                tmpX = tmpX + XCoor(i)
'                tmpY = tmpY + YCoor(i)
'                tmpZ = tmpZ + ZCoor(i)
'            Next


'            iGroupInfor = Math.Round(iGroupLen, 2) & "\\" & Math.Round(tmpX, 2) & Math.Round(tmpY, 2) & Math.Round(tmpZ, 2)


'        Catch ex As Exception
'            iGroupInfor = ""
'        End Try


'    End Sub

'    Sub Angle2line(ByVal iPoint1 As Point3d, ByVal iPoint2 As Point3d, ByVal iPoint3 As Point3d, Zcs() As Double, ByRef iCheckCtrOut As String, ByVal iPtCs As Point3d)
'        Dim theSession As Session = Session.GetSession()
'        Dim workpart As Part = theSession.Parts.Work
'        Dim iCos As Double
'        Dim iPtCtr1 As Point3d = New Point3d((iPoint1.X + iPoint2.X) / 2, (iPoint1.Y + iPoint2.Y) / 2, (iPoint1.Z + iPoint2.Z) / 2)
'        Dim iPtCtr2 As Point3d = New Point3d((iPoint1.X + iPoint3.X) / 2, (iPoint1.Y + iPoint3.Y) / 2, (iPoint1.Z + iPoint3.Z) / 2)

'        iCos = CosOf2Vector(iPtCtr1, iPtCtr2, Zcs(0), Zcs(1), Zcs(2))
'        Dim iCosDEG As Double = Math.Acos(iCos) * 180 / Math.PI
'        iCos = Math.Abs(Math.Round(iCos, 4))
'        If 0.9999 <= iCos And iCos <= 1.0001 Then '''0.04 độ

'            Dim iDirectionVector1 As Vector3d
'            Call Create_DirectionVector_From_2_Point3D(iPtCtr1, iPtCtr2, iDirectionVector1)
'            Dim iDirectionVector2 As Vector3d = New Vector3d(Zcs(0), Zcs(1), Zcs(2))
'            Dim iDir As Vector3d
'            Call Tich_co_huong_2_vector(iDirectionVector1, iDirectionVector2, iDir)
'            Dim a As Double
'            a = (Math.Sqrt(iDir.X ^ 2 + iDir.Y ^ 2 + iDir.Z ^ 2)) / (Math.Sqrt(iDirectionVector1.X ^ 2 + iDirectionVector1.Y ^ 2 + iDirectionVector1.Z ^ 2))
'            a = Math.Round(a, 4)
'            If a > 0.04 Then
'                iCheckCtrOut = "NG"
'                lw.WriteLine("Gia tri NG  " & a)
'                'Dim iPt2 As NXOpen.Point = workpart.Points.CreatePoint(iPoint1)
'                'iPt2.SetVisibility(SmartObject.VisibilityOption.Visible)
'                'Dim iPt3 As NXOpen.Point = workpart.Points.CreatePoint(iPoint2)
'                'iPt3.SetVisibility(SmartObject.VisibilityOption.Visible)
'            Else
'                iCheckCtrOut = "OK"
'            End If
'        Else
'            iCheckCtrOut = "NG"
'            lw.WriteLine("goc do NG  " & 90 - iCosDEG)
'            'Dim iPt2 As NXOpen.Point = workpart.Points.CreatePoint(iPoint1)
'            'iPt2.SetVisibility(SmartObject.VisibilityOption.Visible)
'            'Dim iPt3 As NXOpen.Point = workpart.Points.CreatePoint(iPoint2)
'            'iPt3.SetVisibility(SmartObject.VisibilityOption.Visible)
'        End If

'    End Sub

'    Sub Angle2Vector(ByVal iPoint1 As Point3d, ByVal iPoint2 As Point3d, Zcs() As Double, ByRef iCheckCtrOut As String, ByVal iPtCs As Point3d)
'        Dim theSession As Session = Session.GetSession()
'        Dim workpart As Part = theSession.Parts.Work
'        Dim iCos As Double
'        Dim iPtCtr As Point3d = New Point3d((iPoint1.X + iPoint2.X) / 2, (iPoint1.Y + iPoint2.Y) / 2, (iPoint1.Z + iPoint2.Z) / 2)
'        iCos = CosOf2Vector(iPoint1, iPoint2, Zcs(0), Zcs(1), Zcs(2))
'        Dim iCosDEG As Double = Math.Acos(iCos) * 180 / Math.PI
'        iCos = Math.Abs(Math.Round(iCos, 4))
'        If Math.Abs(90 - iCosDEG) <= 0.04 Then '''89 độ
'            Dim iDirectionVector1 As Vector3d
'            Call Create_DirectionVector_From_2_Point3D(iPoint1, iPoint2, iDirectionVector1)
'            Dim iCtrLine As Line
'            Dim iPt1 As NXOpen.Point = workpart.Points.CreatePoint(iPtCtr)
'            Dim a As Double
'            a = DistanceBetweenPointandVector(iPtCs, iPtCtr, iDirectionVector1)
'            a = Math.Round(a, 4)
'            'lw.WriteLine("Khoang Cach : " & a)
'            If a > 0.04 Then
'                iCheckCtrOut = "NG"
'                lw.WriteLine("Gia tri NG  " & a)
'                'Dim iPt2 As Point = workPart.Points.CreatePoint(iPoint1)
'                'iPt2.SetVisibility(SmartObject.VisibilityOption.Visible)
'                'Dim iPt3 As Point = workPart.Points.CreatePoint(iPoint2)
'                'iPt3.SetVisibility(SmartObject.VisibilityOption.Visible)
'            Else
'                iCheckCtrOut = "OK"
'                'lw.WriteLine("Gia tri OK  " & a)
'            End If
'        Else
'            iCheckCtrOut = "NG"
'            lw.WriteLine("goc do NG  " & 90 - iCosDEG)
'            'Dim iPt2 As Point = workPart.Points.CreatePoint(iPoint1)
'            'iPt2.SetVisibility(SmartObject.VisibilityOption.Visible)
'            'Dim iPt3 As Point = workPart.Points.CreatePoint(iPoint2)
'            'iPt3.SetVisibility(SmartObject.VisibilityOption.Visible)
'        End If

'    End Sub

'    Sub Create_DirectionVector_From_2_Point3D(ByVal iPoint1 As Point3d, ByVal iPoint2 As Point3d, ByRef iDirectionVector As Vector3d)           'Tạo Vector chỉ phương từ 2 điểm
'        iDirectionVector.X = iPoint2.X - iPoint1.X
'        iDirectionVector.Y = iPoint2.Y - iPoint1.Y
'        iDirectionVector.Z = iPoint2.Z - iPoint1.Z
'    End Sub

'    Sub Tich_co_huong_2_vector(ByVal iVector3D1 As Vector3d, ByVal iVector3D2 As Vector3d, ByRef iVectorOut As Vector3d)
'        iVectorOut.X = iVector3D1.Y * iVector3D2.Z - iVector3D1.Z * iVector3D2.Y
'        iVectorOut.Y = iVector3D1.Z * iVector3D2.X - iVector3D1.X * iVector3D2.Z
'        iVectorOut.Z = iVector3D1.X * iVector3D2.Y - iVector3D1.Y * iVector3D2.X
'    End Sub

'    Sub Format_CtrLine(ByVal iiLine() As Line)
'        Dim theSession As Session = Session.GetSession()

'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        For Each iLine As Line In iiLine
'            Dim displayModification1 As NXOpen.DisplayModification = Nothing
'            displayModification1 = theSession.DisplayManager.NewDisplayModification()
'            displayModification1.ApplyToAllFaces = True
'            displayModification1.ApplyToOwningParts = False
'            displayModification1.NewFont = NXOpen.DisplayableObject.ObjectFont.Centerline           'Line Font
'            displayModification1.NewWidth = NXOpen.DisplayableObject.ObjectWidth.Thin               'Width
'            Dim objects1(0) As NXOpen.DisplayableObject
'            objects1(0) = iLine
'            displayModification1.Apply(objects1)
'            displayModification1.Dispose()
'            theSession.CleanUpFacetedFacesAndEdges()
'            Dim iLineLen As Double = iLine.GetLength + 10
'            Dim associativeLineBuilder1 As NXOpen.Features.AssociativeLineBuilder = Nothing
'            associativeLineBuilder1 = workPart.BaseFeatures.CreateAssociativeLineBuilder(iLine)
'            associativeLineBuilder1.Limits.StartLimit.LimitOption = NXOpen.GeometricUtilities.CurveExtendData.LimitOptions.Value
'            associativeLineBuilder1.Limits.StartLimit.Distance.RightHandSide = "-10"
'            associativeLineBuilder1.Limits.EndLimit.LimitOption = NXOpen.GeometricUtilities.CurveExtendData.LimitOptions.Value
'            associativeLineBuilder1.Limits.EndLimit.Distance.RightHandSide = iLineLen

'            Dim nXObject1 As NXOpen.NXObject = Nothing
'            nXObject1 = associativeLineBuilder1.Commit()
'            associativeLineBuilder1.Destroy()
'        Next
'    End Sub

'    Sub 線ズレPMI(ByVal iComponentName As String, ByVal iString As String, ByVal tmpCsys As CartesianCoordinateSystem)                  'tạo chỉ chị PMI tại gốc CS
'        Dim theSession As Session = Session.GetSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As Part = theSession.Parts.Display
'        Dim TheUFsession As UFSession = UFSession.GetUFSession()


'        'Dim iOriPt As NXOpen.Point, iZaxis As DatumAxis, tempXdir As Vector3d, tempYdir As Vector3d, tempZdir As Vector3d
'        'Call D001_SearchCsysTest(iOriPt, iZaxis, tempXdir, tempYdir, tempZdir)


'        Dim X0 As Double = tmpCsys.Origin.X
'        Dim Y0 As Double = tmpCsys.Origin.Y
'        Dim Z0 As Double = tmpCsys.Origin.Z
'        Dim X1 As Double
'        Dim Y1 As Double
'        Dim Z1 As Double
'        Dim iMatrix As Matrix3x3 = tmpCsys.Orientation.Element
'        Dim modelingView1 As ModelingView
'        modelingView1 = displayPart.ModelingViews.WorkView
'        Dim a1 As Double, a2 As Double, a3 As Double, b1 As Double, b2 As Double, b3 As Double, c1 As Double, c2 As Double, c3 As Double, a As Double, b As Double, c As Double
'        Dim aX As String, aY As String, aZ As String, aX1 As String, aY1 As String, aZ1 As String


'        'lw.WriteLine(tmpCsys.Origin.ToString)

'        'lw.WriteLine(tmpCsys.Orientation.Element.ToString)


'        If Right(iComponentName, 1) = "X" Then
'            a1 = iMatrix.Yx
'            a2 = iMatrix.Yy
'            a3 = iMatrix.Yz
'            b1 = iMatrix.Zx
'            b2 = iMatrix.Zy
'            b3 = iMatrix.Zz
'            c1 = iMatrix.Xx
'            c2 = iMatrix.Xy
'            c3 = iMatrix.Xz


'            X1 = X0 + b1 * 20
'            Y1 = Y0 + b2 * 20
'            Z1 = Z0 + b3 * 20


'            X1 = X1 + a1 * 30
'            Y1 = Y1 + a2 * 30
'            Z1 = Z1 + a3 * 30


'            'lw.WriteLine("Mat cat X")
'            'lw.WriteLine("X1, Y1, Z1: " & X1 & ", " & Y1 & Z1)

'            'Dim iNewpt3d As New Point3d(X1, Y1, Z1)
'            'Dim iPt As NXOpen.Point = workPart.Points.CreatePoint(iNewpt3d)
'            'iPt.SetVisibility(SmartObject.VisibilityOption.Visible)

'        Else
'            a1 = iMatrix.Zx
'            a2 = iMatrix.Zy
'            a3 = iMatrix.Zz

'            b1 = iMatrix.Xx
'            b2 = iMatrix.Xy
'            b3 = iMatrix.Xz

'            c1 = iMatrix.Yx
'            c2 = iMatrix.Yy
'            c3 = iMatrix.Yz



'            X1 = X0 + a1 * 20
'            Y1 = Y0 + a2 * 20
'            Z1 = Z0 + a3 * 20


'            X1 = X1 + b1 * 30
'            Y1 = Y1 + b2 * 30
'            Z1 = Z1 + b3 * 30
'            'lw.WriteLine("Mat cat Y")
'            'lw.WriteLine("X1, Y1, Z1: " & X1 & ", " & Y1 & Z1)

'            'Dim iNewpt3d As New Point3d(X1, Y1, Z1)
'            'Dim iPt As NXOpen.Point = workPart.Points.CreatePoint(iNewpt3d)
'            'iPt.SetVisibility(SmartObject.VisibilityOption.Visible)


'        End If



'        Dim nullAnnotations_SimpleDraftingAid As Annotations.SimpleDraftingAid = Nothing
'        Dim pmiNoteBuilder1 As Annotations.PmiNoteBuilder
'        pmiNoteBuilder1 = workPart.Annotations.CreatePmiNoteBuilder(nullAnnotations_SimpleDraftingAid)
'        pmiNoteBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiNoteBuilder1.Origin.Anchor = Annotations.OriginBuilder.AlignmentPosition.MidCenter

'        Dim text1(0) As String
'        text1(0) = iString


'        pmiNoteBuilder1.Text.TextBlock.SetText(text1)
'        pmiNoteBuilder1.TextAlignment = Annotations.DraftingNoteBuilder.TextAlign.BelowbottomExtToMax
'        Dim leaderData1 As Annotations.LeaderData
'        leaderData1 = workPart.Annotations.CreateLeaderData()
'        leaderData1.StubSize = 2.0#
'        leaderData1.Arrowhead = Annotations.LeaderData.ArrowheadType.OpenArrow
'        pmiNoteBuilder1.Leader.Leaders.Append(leaderData1)
'        leaderData1.StubSide = Annotations.LeaderSide.Inferred
'        Dim symbolscale1 As Double
'        symbolscale1 = pmiNoteBuilder1.Text.TextBlock.SymbolScale
'        Dim symbolaspectratio1 As Double
'        symbolaspectratio1 = pmiNoteBuilder1.Text.TextBlock.SymbolAspectRatio
'        pmiNoteBuilder1.Origin.Plane.PlaneMethod = Annotations.PlaneBuilder.PlaneMethodType.UserDefined
'        pmiNoteBuilder1.Origin.SetInferRelativeToGeometry(True)

'        Dim origin1 As Point3d
'        Dim xDirection1 As Vector3d
'        Dim yDirection1 As Vector3d
'        If Right(iComponentName, 1) = "Y" Then
'            origin1 = New Point3d(X0, Y0, Z0)
'            xDirection1 = New Vector3d(b1, b2, b3)
'            yDirection1 = New Vector3d(a1, a2, a3)
'        Else
'            origin1 = New Point3d(X0, Y0, Z0)
'            xDirection1 = New Vector3d(a1, a2, a3)
'            yDirection1 = New Vector3d(b1, b2, b3)
'        End If

'        Dim xform3 As Xform
'        xform3 = workPart.Xforms.CreateXform(origin1, xDirection1, yDirection1, SmartObject.UpdateOption.AfterModeling, 1.0#)

'        'Dim cartesianCoordinateSystem1 As CartesianCoordinateSystem
'        'cartesianCoordinateSystem1 = workPart.CoordinateSystems.CreateCoordinateSystem(xform3, SmartObject.UpdateOption.AfterModeling)
'        pmiNoteBuilder1.Origin.Plane.UserDefinedPlane = xform3
'        pmiNoteBuilder1.Origin.SetInferRelativeToGeometry(True)
'        Dim coordinates1 As Point3d = New Point3d(X0, Y0, Z0)
'        Dim point1 As NXOpen.Point
'        point1 = workPart.Points.CreatePoint(coordinates1)
'        Dim point2 As Point3d = New Point3d(X0, Y0, Z0)
'        Try
'            leaderData1.Leader.SetValue(point1, displayPart.ModelingViews.WorkView, point2)
'        Catch
'            leaderData1.Leader.SetValue(point1, workPart.ModelingViews.WorkView, point2)
'        End Try

'        Dim assocOrigin1 As Annotations.Annotation.AssociativeOriginData
'        assocOrigin1.OriginType = Annotations.AssociativeOriginType.Drag
'        Dim nullView As NXOpen.View = Nothing
'        assocOrigin1.View = nullView
'        assocOrigin1.ViewOfGeometry = nullView
'        Dim nullPoint As NXOpen.Point = Nothing
'        assocOrigin1.PointOnGeometry = nullPoint
'        Dim nullAnnotations_Annotation As Annotations.Annotation = Nothing
'        assocOrigin1.OffsetAlignmentPosition = Annotations.AlignmentPosition.TopLeft
'        assocOrigin1.XOffsetFactor = 0.0#
'        assocOrigin1.YOffsetFactor = 0.0#
'        assocOrigin1.StackAlignmentPosition = Annotations.StackAlignmentPosition.Above
'        pmiNoteBuilder1.Origin.SetAssociativeOrigin(assocOrigin1)
'        pmiNoteBuilder1.Style.LetteringStyle.GeneralTextAspectRatio = 0.6
'        pmiNoteBuilder1.Style.LetteringStyle.GeneralTextCharSpaceFactor = 0.6
'        pmiNoteBuilder1.Style.LetteringStyle.GeneralTextSize = 3
'        pmiNoteBuilder1.Style.LineArrowStyle.ArrowheadLength = 3

'        Dim point3 As Point3d = New Point3d(X1, Y1, Z1)
'        pmiNoteBuilder1.Origin.Origin.SetValue(Nothing, nullView, point3)
'        'pmiNoteBuilder1.Origin.
'        pmiNoteBuilder1.Origin.SetInferRelativeToGeometry(True)
'        leaderData1.StubSide = Annotations.LeaderSide.Left
'        Dim nXObject1 As NXObject
'        nXObject1 = pmiNoteBuilder1.Commit()
'        pmiNoteBuilder1.Destroy()
'    End Sub

'    Sub CreatePMIInforPart(ByVal iComponentName As String, ByVal iListABC As List(Of String))
'        Dim theSession As Session = Session.GetSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As Part = theSession.Parts.Display
'        Dim TheUFsession As UFSession = UFSession.GetUFSession()
'        Dim tmpGrp As NXOpen.Tag = NXOpen.Tag.Null
'        Dim myGroup As NXOpen.Group
'        Dim iGroupInforArr As New List(Of String)
'        Dim iGrNameList As New List(Of String)
'        Dim i As Integer, iDemChua As Integer
'        Dim iDelGroup As New List(Of Group)
'        Dim iPointChua3D As Point3d                 'Point3D chùa
'        Dim iGroupInfor As String
'        Dim iStringChithi() As String                    'biến này chứa tọa độ điểm chỉ thị PMI của GR và những thứ cần thiết để chỉ thị PMI
'        Dim iOriPt As NXOpen.Point, iZaxis As DatumAxis, tempXdir As Vector3d, tempYdir As Vector3d, tempZdir As Vector3d, iOriPt3D As Point3d
'        Call D001_SearchCsysTest(iOriPt, iZaxis, tempXdir, tempYdir, tempZdir)
'        Call Create_Point3D_From_Point(iOriPt, iOriPt3D)
'        Call Create_LineEquation_From_Point_And_DirectionVector(iOriPt3D, tempZdir, 50, iPointChua3D)
'        Dim iPointMax1 As Point3d, iPointMax2 As Point3d, iPointMin1 As Point3d, iPointMin2 As Point3d
'        If Right(iComponentName, 1) = "X" Then
'            Call Create_LineEquation_From_Point_And_DirectionVector(iPointChua3D, tempYdir, 75, iPointMax1)
'            Call Create_LineEquation_From_Point_And_DirectionVector(iPointChua3D, tempYdir, -75, iPointMax2)
'        Else
'            Call Create_LineEquation_From_Point_And_DirectionVector(iPointChua3D, tempXdir, 75, iPointMax1)
'            Call Create_LineEquation_From_Point_And_DirectionVector(iPointChua3D, tempXdir, -75, iPointMax2)
'        End If
'        Call Create_LineEquation_From_Point_And_DirectionVector(iOriPt3D, tempZdir, -50, iPointChua3D)
'        If Right(iComponentName, 1) = "X" Then
'            Call Create_LineEquation_From_Point_And_DirectionVector(iPointChua3D, tempYdir, 75, iPointMin1)
'            Call Create_LineEquation_From_Point_And_DirectionVector(iPointChua3D, tempYdir, -75, iPointMin2)
'        Else
'            Call Create_LineEquation_From_Point_And_DirectionVector(iPointChua3D, tempXdir, 75, iPointMin1)
'            Call Create_LineEquation_From_Point_And_DirectionVector(iPointChua3D, tempXdir, -75, iPointMin2)
'        End If
'        Dim iGroupName() As String                  'mảng chứa tên các Group để chỉ thị PMI
'        Dim iPoint3DDatBen1Test() As Point3d, iPoint3DDatBen2Test() As Point3d
'        Call Tim_so_luong_Group_can_chi_thi(iComponentName, iGroupName)
'        Call Phan_loai_Group(iComponentName, iGroupName, iPointMax1, iPointMin1, iPointMax2, iPointMin2, iListABC)

'    End Sub

'    Sub Create_Point_For_InforPMI(ByVal iGroup As Group, ByRef iStringChithi As String)                 'sub này tìm điểm trong group để chỉ thị PMI
'        Dim theSession As Session = Session.GetSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As Part = theSession.Parts.Display
'        Dim TheUFsession As UFSession = UFSession.GetUFSession()

'        Dim NULLTAG As Tag = NXOpen.Tag.Null
'        Dim objectTag As Tag = NXOpen.Tag.Null
'        Dim group_count As Integer = 0
'        Dim group_list() As Group
'        Dim group_member_list() As Tag
'        Dim member_count As Integer

'        TheUFsession.Group.AskGroupData(iGroup.Tag, group_member_list, member_count)
'        Dim midPt(2) As Double
'        For Each iTag As Tag In group_member_list
'            Dim iObj As NXObject = Nothing
'            iObj = NXObjectManager.Get(iTag)
'            Dim iCurve As Curve = CType(iObj, Curve)
'            TheUFsession.Modl.AskCurveProps(iCurve.Tag, 0.5, midPt, junk, junk, junk, trash, trash)
'            Exit For
'        Next

'        iStringChithi = midPt(0) & "," & midPt(1) & "," & midPt(2) & "*" & iGroup.Name



'    End Sub

'    Sub CreatePMI(ByVal iComponentName As String, ByVal aContents() As String, ByVal iPoint3DTrong As Point3d, ByVal iPoint3DRiaSapXep As Point3d, ByVal iHuongPMI As String, ByVal iListABC As List(Of String))
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing

'        Dim X0 As Double = iPoint3DTrong.X, Y0 As Double = iPoint3DTrong.Y, Z0 As Double = iPoint3DTrong.Z
'        Dim X1 As Double
'        Dim Y1 As Double
'        Dim Z1 As Double
'        Dim modelingView1 As ModelingView
'        modelingView1 = displayPart.ModelingViews.WorkView
'        Dim a1 As Double, a2 As Double, a3 As Double, b1 As Double, b2 As Double, b3 As Double, c1 As Double, c2 As Double, c3 As Double, a As Double, b As Double, c As Double
'        Dim aX As String, aY As String, aZ As String, aX1 As String, aY1 As String, aZ1 As String

'        Dim iOriPt As NXOpen.Point, iZaxis As DatumAxis, tempXdir As Vector3d, tempYdir As Vector3d, tempZdir As Vector3d
'        Call D001_SearchCsysTest(iOriPt, iZaxis, tempXdir, tempYdir, tempZdir)

'        If Right(iComponentName, 1) = "X" Then
'            a1 = tempYdir.X
'            a2 = tempYdir.Y
'            a3 = tempYdir.Z
'            b1 = tempZdir.X
'            b2 = tempZdir.Y
'            b3 = tempZdir.Z
'            c1 = tempXdir.X
'            c2 = tempXdir.Y
'            c3 = tempXdir.Z
'        Else
'            a1 = tempZdir.X
'            a2 = tempZdir.Y
'            a3 = tempZdir.Z
'            b1 = tempXdir.X
'            b2 = tempXdir.Y
'            b3 = tempXdir.Z
'            c1 = tempYdir.X
'            c2 = tempYdir.Y
'            c3 = tempYdir.Z
'        End If

'        X1 = iPoint3DRiaSapXep.X
'        Y1 = iPoint3DRiaSapXep.Y
'        Z1 = iPoint3DRiaSapXep.Z



'        'Dim iNewPt3d As New Point3d(X1, Y1, Z1)
'        'Dim iPt As NXOpen.Point = workPart.Points.CreatePoint(iNewPt3d)
'        'iPt.SetVisibility(SmartObject.VisibilityOption.Visible)


'        Dim nullAnnotations_SimpleDraftingAid As Annotations.SimpleDraftingAid = Nothing
'        Dim pmiNoteBuilder1 As Annotations.PmiNoteBuilder
'        pmiNoteBuilder1 = workPart.Annotations.CreatePmiNoteBuilder(nullAnnotations_SimpleDraftingAid)
'        pmiNoteBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiNoteBuilder1.Origin.Anchor = Annotations.OriginBuilder.AlignmentPosition.MidCenter

'        'Dim i As Integer

'        'Dim text1(3) As String
'        Dim tmpName As String
'        'Dim tmpPartNo As String, tmpPartName As String
'        For Each iString As String In aContents
'            If "[X=" & Split(Split(iString, "*")(0), ",")(0) & ",Y=" & Split(Split(iString, "*")(0), ",")(1) & ",Z=" & Split(Split(iString, "*")(0), ",")(2) & "]" = iPoint3DTrong.ToString Then
'                tmpName = Split(iString, "*")(1)
'            End If
'        Next
'        'lw.WriteLine(tmpName)
'        Try
'            For Each istring As String In iListABC
'                'lw.WriteLine(istring)

'                If Split(istring, "$")(0) = Split(tmpName, "$")(0) And Left(Split(istring, "$")(1), 11) = Left(Split(tmpName, "$")(1), 11) And Left(Split(istring, "$")(2), 5) = Left(Split(tmpName, "$")(2), 5) Then
'                    If InStr(istring, "部品A") > 0 Then
'                        tmpName = "(部品A)$" & tmpName
'                    ElseIf InStr(istring, "部品B") > 0 Then
'                        tmpName = "(部品B)$" & tmpName
'                    ElseIf InStr(istring, "部品C") > 0 Then
'                        tmpName = "(部品C)$" & tmpName
'                    ElseIf InStr(istring, "部品D") > 0 Then
'                        tmpName = "(部品D)$" & tmpName
'                    ElseIf InStr(istring, "部品E") > 0 Then
'                        tmpName = "(部品E)$" & tmpName
'                    End If
'                End If
'            Next
'        Catch ex As Exception
'            For Each istring As String In iListABC
'                Try
'                    If Split(istring, "$")(0) = Split(tmpName, "$")(0) And Left(Split(istring, "$")(1), 11) = Left(Split(tmpName, "$")(1), 11) Then
'                        If InStr(istring, "部品A") > 0 Then
'                            tmpName = "(部品A)$" & tmpName
'                        ElseIf InStr(istring, "部品B") > 0 Then
'                            tmpName = "(部品B)$" & tmpName
'                        ElseIf InStr(istring, "部品C") > 0 Then
'                            tmpName = "(部品C)$" & tmpName
'                        ElseIf InStr(istring, "部品D") > 0 Then
'                            tmpName = "(部品D)$" & tmpName
'                        ElseIf InStr(istring, "部品E") > 0 Then
'                            tmpName = "(部品E)$" & tmpName
'                        End If
'                    End If
'                Catch ex3 As Exception
'                    If Split(istring, "$")(0) = Split(tmpName, "$")(0) Then
'                        If InStr(istring, "部品A") > 0 Then
'                            tmpName = "(部品A)$" & tmpName
'                        ElseIf InStr(istring, "部品B") > 0 Then
'                            tmpName = "(部品B)$" & tmpName
'                        ElseIf InStr(istring, "部品C") > 0 Then
'                            tmpName = "(部品C)$" & tmpName
'                        ElseIf InStr(istring, "部品D") > 0 Then
'                            tmpName = "(部品D)$" & tmpName
'                        ElseIf InStr(istring, "部品E") > 0 Then
'                            tmpName = "(部品E)$" & tmpName
'                        End If
'                    End If
'                End Try

'            Next

'        End Try


'        Dim i As Integer
'        Dim aArrayA
'        aArrayA = Split(tmpName, "$")
'        Dim text1(UBound(aArrayA, 1)) As String
'        For i = 0 To UBound(aArrayA, 1)
'            text1(i) = Trim(aArrayA(i))
'        Next

'        pmiNoteBuilder1.Text.TextBlock.SetText(text1)
'        pmiNoteBuilder1.TextAlignment = Annotations.DraftingNoteBuilder.TextAlign.BelowbottomExtToMax
'        pmiNoteBuilder1.Origin.Plane.PlaneMethod = Annotations.PlaneBuilder.PlaneMethodType.UserDefined
'        Dim leaderData1 As Annotations.LeaderData
'        leaderData1 = workPart.Annotations.CreateLeaderData()
'        leaderData1.StubSize = 2.0#
'        leaderData1.Arrowhead = Annotations.LeaderData.ArrowheadType.OpenArrow
'        pmiNoteBuilder1.Leader.Leaders.Append(leaderData1)
'        ''''''''''''''''''
'        leaderData1.StubSide = Annotations.LeaderSide.Inferred
'        ''''''''''''''''''
'        Dim symbolscale1 As Double
'        symbolscale1 = pmiNoteBuilder1.Text.TextBlock.SymbolScale
'        Dim symbolaspectratio1 As Double
'        symbolaspectratio1 = pmiNoteBuilder1.Text.TextBlock.SymbolAspectRatio
'        pmiNoteBuilder1.Origin.Plane.PlaneMethod = Annotations.PlaneBuilder.PlaneMethodType.UserDefined
'        pmiNoteBuilder1.Origin.SetInferRelativeToGeometry(True)
'        Dim origin1 As Point3d
'        Dim xDirection1 As Vector3d
'        Dim yDirection1 As Vector3d
'        If Right(iComponentName, 1) = "Y" Then
'            origin1 = New Point3d(X0, Y0, Z0)
'            xDirection1 = New Vector3d(b1, b2, b3)
'            yDirection1 = New Vector3d(a1, a2, a3)
'        Else
'            origin1 = New Point3d(X0, Y0, Z0)
'            xDirection1 = New Vector3d(a1, a2, a3)
'            yDirection1 = New Vector3d(b1, b2, b3)
'        End If

'        Dim xform3 As Xform
'        xform3 = workPart.Xforms.CreateXform(origin1, xDirection1, yDirection1, SmartObject.UpdateOption.AfterModeling, 1.0#)

'        'Dim cartesianCoordinateSystem1 As CartesianCoordinateSystem
'        'cartesianCoordinateSystem1 = workPart.CoordinateSystems.CreateCoordinateSystem(xform3, SmartObject.UpdateOption.AfterModeling)
'        pmiNoteBuilder1.Origin.Plane.UserDefinedPlane = xform3
'        pmiNoteBuilder1.Origin.SetInferRelativeToGeometry(True)
'        Dim coordinates1 As Point3d = New Point3d(X0, Y0, Z0)
'        Dim point1 As NXOpen.Point
'        point1 = workPart.Points.CreatePoint(coordinates1)
'        Dim point2 As Point3d = New Point3d(X0, Y0, Z0)
'        Try
'            leaderData1.Leader.SetValue(point1, displayPart.ModelingViews.WorkView, point2)
'        Catch
'            leaderData1.Leader.SetValue(point1, workPart.ModelingViews.WorkView, point2)
'        End Try

'        Dim assocOrigin1 As Annotations.Annotation.AssociativeOriginData
'        assocOrigin1.OriginType = Annotations.AssociativeOriginType.Drag
'        Dim nullView As NXOpen.View = Nothing
'        assocOrigin1.View = nullView
'        assocOrigin1.ViewOfGeometry = nullView
'        Dim nullPoint As NXOpen.Point = Nothing
'        assocOrigin1.PointOnGeometry = nullPoint
'        Dim nullAnnotations_Annotation As Annotations.Annotation = Nothing
'        assocOrigin1.OffsetAlignmentPosition = Annotations.AlignmentPosition.TopLeft
'        assocOrigin1.XOffsetFactor = 0.0#
'        assocOrigin1.YOffsetFactor = 0.0#
'        assocOrigin1.StackAlignmentPosition = Annotations.StackAlignmentPosition.Above
'        pmiNoteBuilder1.Origin.SetAssociativeOrigin(assocOrigin1)
'        pmiNoteBuilder1.Style.LetteringStyle.GeneralTextAspectRatio = 0.6
'        pmiNoteBuilder1.Style.LetteringStyle.GeneralTextCharSpaceFactor = 0.6
'        pmiNoteBuilder1.Style.LetteringStyle.GeneralTextSize = 3
'        pmiNoteBuilder1.Style.LineArrowStyle.ArrowheadLength = 3

'        Dim point3 As Point3d = New Point3d(X1, Y1, Z1)
'        pmiNoteBuilder1.Origin.Origin.SetValue(Nothing, nullView, point3)
'        pmiNoteBuilder1.Origin.SetInferRelativeToGeometry(True)
'        If iHuongPMI = "LEFT" Then
'            leaderData1.StubSide = Annotations.LeaderSide.Left
'        ElseIf iHuongPMI = "RIGHT" Then
'            leaderData1.StubSide = Annotations.LeaderSide.Right
'        End If

'        Dim nXObject1 As NXObject
'        nXObject1 = pmiNoteBuilder1.Commit()
'        pmiNoteBuilder1.Destroy()

'    End Sub

'    Sub CreatePMITest(ByVal iComponentName As String, ByVal iGroupName As String, ByVal iPoint3DTrong As Point3d, ByVal iPoint3DRiaSapXep As Point3d, ByVal iHuongPMI As String)
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        Dim X0 As Double = iPoint3DTrong.X, Y0 As Double = iPoint3DTrong.Y, Z0 As Double = iPoint3DTrong.Z
'        Dim X1 As Double
'        Dim Y1 As Double
'        Dim Z1 As Double
'        Dim modelingView1 As ModelingView
'        modelingView1 = displayPart.ModelingViews.WorkView
'        Dim a1 As Double, a2 As Double, a3 As Double, b1 As Double, b2 As Double, b3 As Double, c1 As Double, c2 As Double, c3 As Double, a As Double, b As Double, c As Double
'        Dim aX As String, aY As String, aZ As String, aX1 As String, aY1 As String, aZ1 As String

'        Dim iOriPt As NXOpen.Point, iZaxis As DatumAxis, tempXdir As Vector3d, tempYdir As Vector3d, tempZdir As Vector3d
'        Call D001_SearchCsysTest(iOriPt, iZaxis, tempXdir, tempYdir, tempZdir)

'        If Right(iComponentName, 1) = "X" Then
'            a1 = tempYdir.X
'            a2 = tempYdir.Y
'            a3 = tempYdir.Z
'            b1 = tempZdir.X
'            b2 = tempZdir.Y
'            b3 = tempZdir.Z
'            c1 = tempXdir.X
'            c2 = tempXdir.Y
'            c3 = tempXdir.Z
'        Else
'            a1 = tempZdir.X
'            a2 = tempZdir.Y
'            a3 = tempZdir.Z
'            b1 = tempXdir.X
'            b2 = tempXdir.Y
'            b3 = tempXdir.Z
'            c1 = tempYdir.X
'            c2 = tempYdir.Y
'            c3 = tempYdir.Z
'        End If

'        X1 = iPoint3DRiaSapXep.X
'        Y1 = iPoint3DRiaSapXep.Y
'        Z1 = iPoint3DRiaSapXep.Z



'        Dim nullAnnotations_SimpleDraftingAid As Annotations.SimpleDraftingAid = Nothing
'        Dim pmiNoteBuilder1 As Annotations.PmiNoteBuilder
'        pmiNoteBuilder1 = workPart.Annotations.CreatePmiNoteBuilder(nullAnnotations_SimpleDraftingAid)
'        pmiNoteBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiNoteBuilder1.Origin.Anchor = Annotations.OriginBuilder.AlignmentPosition.MidCenter

'        Dim i As Integer

'        Dim text1(3) As String


'        Try
'            text1(0) = Split(iGroupName, "$")(0)
'            text1(1) = Split(iGroupName, "$")(1)
'            text1(2) = Split(iGroupName, "$")(2)
'            text1(3) = Split(iGroupName, "$")(3)

'        Catch ex As Exception

'        End Try





'        pmiNoteBuilder1.Text.TextBlock.SetText(text1)
'        pmiNoteBuilder1.TextAlignment = Annotations.DraftingNoteBuilder.TextAlign.BelowbottomExtToMax
'        pmiNoteBuilder1.Origin.Plane.PlaneMethod = Annotations.PlaneBuilder.PlaneMethodType.UserDefined
'        Dim leaderData1 As Annotations.LeaderData
'        leaderData1 = workPart.Annotations.CreateLeaderData()
'        leaderData1.StubSize = 2.0#
'        leaderData1.Arrowhead = Annotations.LeaderData.ArrowheadType.OpenArrow
'        pmiNoteBuilder1.Leader.Leaders.Append(leaderData1)
'        ''''''''''''''''''
'        leaderData1.StubSide = Annotations.LeaderSide.Inferred
'        ''''''''''''''''''
'        Dim symbolscale1 As Double
'        symbolscale1 = pmiNoteBuilder1.Text.TextBlock.SymbolScale
'        Dim symbolaspectratio1 As Double
'        symbolaspectratio1 = pmiNoteBuilder1.Text.TextBlock.SymbolAspectRatio
'        pmiNoteBuilder1.Origin.Plane.PlaneMethod = Annotations.PlaneBuilder.PlaneMethodType.UserDefined
'        pmiNoteBuilder1.Origin.SetInferRelativeToGeometry(True)
'        Dim origin1 As Point3d
'        Dim xDirection1 As Vector3d
'        Dim yDirection1 As Vector3d
'        If Right(iComponentName, 1) = "Y" Then
'            origin1 = New Point3d(X0, Y0, Z0)
'            xDirection1 = New Vector3d(b1, b2, b3)
'            yDirection1 = New Vector3d(a1, a2, a3)
'        Else
'            origin1 = New Point3d(X0, Y0, Z0)
'            xDirection1 = New Vector3d(a1, a2, a3)
'            yDirection1 = New Vector3d(b1, b2, b3)
'        End If

'        Dim xform3 As Xform
'        xform3 = workPart.Xforms.CreateXform(origin1, xDirection1, yDirection1, SmartObject.UpdateOption.AfterModeling, 1.0#)

'        'Dim cartesianCoordinateSystem1 As CartesianCoordinateSystem
'        'cartesianCoordinateSystem1 = workPart.CoordinateSystems.CreateCoordinateSystem(xform3, SmartObject.UpdateOption.AfterModeling)
'        pmiNoteBuilder1.Origin.Plane.UserDefinedPlane = xform3
'        pmiNoteBuilder1.Origin.SetInferRelativeToGeometry(True)
'        Dim coordinates1 As Point3d = New Point3d(X0, Y0, Z0)
'        Dim point1 As NXOpen.Point
'        point1 = workPart.Points.CreatePoint(coordinates1)
'        Dim point2 As Point3d = New Point3d(X0, Y0, Z0)
'        Try
'            leaderData1.Leader.SetValue(point1, displayPart.ModelingViews.WorkView, point2)
'        Catch
'            leaderData1.Leader.SetValue(point1, workPart.ModelingViews.WorkView, point2)
'        End Try

'        Dim assocOrigin1 As Annotations.Annotation.AssociativeOriginData
'        assocOrigin1.OriginType = Annotations.AssociativeOriginType.Drag
'        Dim nullView As NXOpen.View = Nothing
'        assocOrigin1.View = nullView
'        assocOrigin1.ViewOfGeometry = nullView
'        Dim nullPoint As NXOpen.Point = Nothing
'        assocOrigin1.PointOnGeometry = nullPoint
'        Dim nullAnnotations_Annotation As Annotations.Annotation = Nothing
'        assocOrigin1.OffsetAlignmentPosition = Annotations.AlignmentPosition.TopLeft
'        assocOrigin1.XOffsetFactor = 0.0#
'        assocOrigin1.YOffsetFactor = 0.0#
'        assocOrigin1.StackAlignmentPosition = Annotations.StackAlignmentPosition.Above
'        pmiNoteBuilder1.Origin.SetAssociativeOrigin(assocOrigin1)
'        pmiNoteBuilder1.Style.LetteringStyle.GeneralTextAspectRatio = 0.6
'        pmiNoteBuilder1.Style.LetteringStyle.GeneralTextCharSpaceFactor = 0.6
'        pmiNoteBuilder1.Style.LetteringStyle.GeneralTextSize = 3
'        pmiNoteBuilder1.Style.LineArrowStyle.ArrowheadLength = 3

'        Dim point3 As Point3d = New Point3d(X1, Y1, Z1)
'        pmiNoteBuilder1.Origin.Origin.SetValue(Nothing, nullView, point3)
'        pmiNoteBuilder1.Origin.SetInferRelativeToGeometry(True)
'        If iHuongPMI = "LEFT" Then
'            leaderData1.StubSide = Annotations.LeaderSide.Left
'        ElseIf iHuongPMI = "RIGHT" Then
'            leaderData1.StubSide = Annotations.LeaderSide.Right
'        End If

'        Dim nXObject1 As NXObject
'        nXObject1 = pmiNoteBuilder1.Commit()
'        pmiNoteBuilder1.Destroy()

'    End Sub

'    Sub Fix_View(ByVal iComponentName As String)
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim lw As ListingWindow = theSession.ListingWindow
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing

'        Dim iOriPt As NXOpen.Point, iZaxis As DatumAxis, tempXdir As Vector3d, tempYdir As Vector3d, tempZdir As Vector3d, iOriPt3D As Point3d
'        Call D001_SearchCsysTest(iOriPt, iZaxis, tempXdir, tempYdir, tempZdir)

'        Dim matrix1 As NXOpen.Matrix3x3 = Nothing
'        If Right(iComponentName, 1) = "X" Then
'            matrix1.Xx = tempYdir.X
'            matrix1.Xy = tempYdir.Y
'            matrix1.Xz = tempYdir.Z
'            matrix1.Yx = tempZdir.X
'            matrix1.Yy = tempZdir.Y
'            matrix1.Yz = tempZdir.Z
'            matrix1.Zx = tempXdir.X
'            matrix1.Zy = tempXdir.Y
'            matrix1.Zz = tempXdir.Z
'        ElseIf Right(iComponentName, 1) = "Y" Then
'            matrix1.Xx = tempXdir.X
'            matrix1.Xy = tempXdir.Y
'            matrix1.Xz = tempXdir.Z
'            matrix1.Yx = tempZdir.X
'            matrix1.Yy = tempZdir.Y
'            matrix1.Yz = tempZdir.Z
'            matrix1.Zx = -1 * tempYdir.X
'            matrix1.Zy = -1 * tempYdir.Y
'            matrix1.Zz = -1 * tempYdir.Z
'        ElseIf Right(iComponentName, 1) = "Z" Then

'        End If

'        displayPart.ModelingViews.WorkView.Orient(matrix1)

'    End Sub

'    Sub Create_Point3D_From_Point(ByVal iPoint As NXOpen.Point, ByRef iPoint3D As Point3d)
'        iPoint3D.X = iPoint.Coordinates.X
'        iPoint3D.Y = iPoint.Coordinates.Y
'        iPoint3D.Z = iPoint.Coordinates.Z
'    End Sub

'    Sub Sap_xep_tranh_kanshou_New(ByVal iComponentName As String, ByVal iPoint3DTrong() As Point3d, ByVal iPoint3DMax As Point3d, ByVal iPoint3DMin As Point3d)
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display

'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        Dim iPoint3DThutu() As Point3d
'        Dim i As Integer = 0, j As Integer = 0, k As Integer = 0
'        Dim iDirVectorDatPMI As Vector3d = Create_DirectionVector_From_2_Point3D(iPoint3DMax, iPoint3DMin)
'        Dim iOriPt As NXOpen.Point, iZaxis As DatumAxis, tempXdir As Vector3d, tempYdir As Vector3d, tempZdir As Vector3d, iOriPt3D As Point3d
'        Call D001_SearchCsysTest(iOriPt, iZaxis, tempXdir, tempYdir, tempZdir)
'        Call Create_Point3D_From_Point(iOriPt, iOriPt3D)

'        For i = 0 To UBound(iPoint3DTrong)
'            Dim iDirVectorPhu As Vector3d = Create_DirectionVector_From_2_Point3D(iPoint3DTrong(i), iPoint3DMax)
'            Dim t As Double
'            t = -1 * (tempZdir.X * iDirVectorPhu.X + tempZdir.Y * iDirVectorPhu.Y + tempZdir.Z * iDirVectorPhu.Z) / (iDirVectorDatPMI.X * tempZdir.X + iDirVectorDatPMI.Y * tempZdir.Y + iDirVectorDatPMI.Z * tempZdir.Z)
'            ReDim Preserve iPoint3DThutu(i)
'            Call Create_LineEquation_From_Point_And_DirectionVector(iPoint3DMax, iDirVectorDatPMI, t, iPoint3DThutu(i))
'            'Call Create_Point_Features(iPoint3DThutu(i))
'        Next
'        Dim iPoint3DTG1 As Point3d, iPoint3DTG2 As Point3d
'        For j = 0 To UBound(iPoint3DTrong)
'            For i = 0 To UBound(iPoint3DThutu)
'                If i < UBound(iPoint3DThutu) Then
'                    Dim iLen1 As Double, iLen2 As Double
'                    Call GetLength2Point3D(iPoint3DMax, iPoint3DThutu(i), iLen1)
'                    Call GetLength2Point3D(iPoint3DMax, iPoint3DThutu(i + 1), iLen2)
'                    If iLen1 > iLen2 Then
'                        iPoint3DTG1 = iPoint3DThutu(i)
'                        iPoint3DTG2 = iPoint3DTrong(i)
'                        iPoint3DThutu(i) = iPoint3DThutu(i + 1)
'                        iPoint3DTrong(i) = iPoint3DTrong(i + 1)
'                        iPoint3DThutu(i + 1) = iPoint3DTG1
'                        iPoint3DTrong(i + 1) = iPoint3DTG2
'                    End If
'                End If
'            Next
'        Next
'    End Sub

'    Sub Timgiaodiem2duongthang(ByVal A1 As Point3d, ByVal B1 As Point3d, ByVal A2 As Point3d, ByVal B2 As Point3d, ByRef iPointGiao As Point3d)            'mp Oxy
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing


'        Dim a As Vector3d
'        Dim b As Vector3d
'        Dim t As Double

'        '''''''''''''''''Thông số của iLine1 : Điểm đầu cuối, vector a chỉ phương''''''''''''''''''''
'        'Start_End_Mid_Point_ForCurve(iLine1, A1, B1, C1)
'        a.X = B1.X - A1.X                                           'giá trị vector a
'        a.Y = B1.Y - A1.Y
'        a.Z = B1.Z - A1.Z

'        '''''''''''''''''Thông số của iLine2 : Điểm đầu cuối, vector b chỉ phương''''''''''''''''''''
'        'Start_End_Mid_Point_ForCurve(iLine2, A2, B2, C2)
'        b.X = B2.X - A2.X                                           'giá trị vector b
'        b.Y = B2.Y - A2.Y
'        b.Z = B2.Z - A2.Z

'        '''''''''''''''''Tìm t'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'        'lw.WriteLine("adfds: " & b.X * a.Y - a.X * b.Y & "_" & b.X * a.Z - a.X * b.Z)
'        If Math.Round((b.X * a.Y - a.X * b.Y), 4) <> 0 Then        'Kiểm tra điều kiện mẫu số của t <> 0
'            'lw.WriteLine("1")
'            t = ((A2.Y - A1.Y) * b.X - (A2.X - A1.X) * b.Y) / (b.X * a.Y - a.X * b.Y)
'        ElseIf Math.Round((b.X * a.Z - a.X * b.Z), 4) <> 0 Then
'            'lw.WriteLine("2")
'            t = ((A2.Z - A1.Z) * b.X - (A2.X - A1.X) * b.Z) / (b.X * a.Z - a.X * b.Z)
'        Else
'            'lw.WriteLine("3")
'            t = ((A2.Z - A1.Z) * b.Y - (A2.Y - A1.Y) * b.Z) / (b.Y * a.Z - a.Y * b.Z)
'        End If

'        ''''''''''''''''Tìm giao điểm dựa vào t''''''''''''''''''''''''''''''''''''''''''''''''''''''
'        iPointGiao.X = A1.X + a.X * t
'        iPointGiao.Y = A1.Y + a.Y * t
'        iPointGiao.Z = A1.Z + a.Z * t

'    End Sub

'    Function Create_DirectionVector_From_2_Point3D(ByVal iPoint1 As Point3d, ByVal iPoint2 As Point3d) As Vector3d           'Tạo Vector chỉ phương từ 2 điểm
'        Create_DirectionVector_From_2_Point3D.X = iPoint2.X - iPoint1.X
'        Create_DirectionVector_From_2_Point3D.Y = iPoint2.Y - iPoint1.Y
'        Create_DirectionVector_From_2_Point3D.Z = iPoint2.Z - iPoint1.Z
'    End Function

'    Sub D001_SearchCsysTest(ByRef iOriPt As NXOpen.Point, ByRef iZaxis As DatumAxis, ByRef tempXdir As Vector3d, ByRef tempYdir As Vector3d, ByRef tempZdir As Vector3d)

'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display

'        Dim iFeats As FeatureCollection = workPart.Features
'        Dim iCsys As NXOpen.Features.DatumCsys

'        For Each iFeat As Feature In iFeats
'            If TypeOf (iFeat) Is NXOpen.Features.DatumCsys Then
'                iCsys = CType(iFeat, NXOpen.Features.DatumCsys)
'                Dim iEntities As NXObject() = iCsys.GetEntities()
'                Dim iDirCount As Integer = 0
'                Dim iMess As String
'                For Each iEnt As NXObject In iEntities
'                    If TypeOf (iEnt) Is NXOpen.Point Then
'                        iOriPt = CType(iEnt, NXOpen.Point)

'                        If iOriPt.Coordinates.ToString = "[X=0,Y=0,Z=0]" Then
'                            Exit For
'                        End If
'                    ElseIf TypeOf (iEnt) Is CartesianCoordinateSystem Then
'                        Dim itempcs As CartesianCoordinateSystem
'                        itempcs = iEnt

'                        tempXdir.X = itempcs.Orientation.Element.Xx
'                        tempXdir.Y = itempcs.Orientation.Element.Xy
'                        tempXdir.Z = itempcs.Orientation.Element.Xz

'                        tempYdir.X = itempcs.Orientation.Element.Yx
'                        tempYdir.Y = itempcs.Orientation.Element.Yy
'                        tempYdir.Z = itempcs.Orientation.Element.Yz

'                        tempZdir.X = itempcs.Orientation.Element.Zx
'                        tempZdir.Y = itempcs.Orientation.Element.Zy
'                        tempZdir.Z = itempcs.Orientation.Element.Zz

'                    ElseIf TypeOf (iEnt) Is NXOpen.DatumAxis Then
'                        Dim iAxis As NXOpen.DatumAxis = CType(iEnt, NXOpen.DatumAxis)
'                        If iDirCount = 0 Then
'                            iMess = "X Direction: "
'                        ElseIf iDirCount = 1 Then
'                            iMess = "Y Direction: "
'                        Else
'                            iMess = "Z Direction: "
'                            iZaxis = iAxis
'                        End If
'                        iDirCount = iDirCount + 1
'                    End If
'                Next
'            End If
'        Next
'    End Sub

'    Sub GetLength2Point3D(ByVal iPoint1 As Point3d, ByVal iPoint2 As Point3d, ByRef iLength As Double)
'        iLength = Math.Sqrt((iPoint1.X - iPoint2.X) ^ 2 + (iPoint1.Y - iPoint2.Y) ^ 2 + (iPoint1.Z - iPoint2.Z) ^ 2)
'    End Sub

'    Sub Create_Point_Features(ByVal ip As NXOpen.Point)
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing

'        Dim nullNXOpen_Features_Feature As NXOpen.Features.Feature = Nothing
'        Dim pointFeatureBuilder1 As NXOpen.Features.PointFeatureBuilder = Nothing
'        pointFeatureBuilder1 = workPart.BaseFeatures.CreatePointFeatureBuilder(nullNXOpen_Features_Feature)
'        pointFeatureBuilder1.Point = ip
'        pointFeatureBuilder1.Commit()
'    End Sub

'    Sub Create_Point_Features(ByVal ip3d As Point3d)
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing

'        Dim ip As NXOpen.Point = workPart.Points.CreatePoint(ip3d)
'        Dim nullNXOpen_Features_Feature As NXOpen.Features.Feature = Nothing
'        Dim pointFeatureBuilder1 As NXOpen.Features.PointFeatureBuilder = Nothing
'        pointFeatureBuilder1 = workPart.BaseFeatures.CreatePointFeatureBuilder(nullNXOpen_Features_Feature)
'        pointFeatureBuilder1.Point = ip
'        pointFeatureBuilder1.Commit()
'    End Sub

'    Sub Tim_so_luong_Group_can_chi_thi(ByVal iComponentName As String, ByRef iGroupName() As String)
'        Dim theSession As Session = Session.GetSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As Part = theSession.Parts.Display
'        Dim TheUFsession As UFSession = UFSession.GetUFSession()
'        Dim tmpGrp As NXOpen.Tag = NXOpen.Tag.Null
'        Dim myGroup As NXOpen.Group
'        Dim iGroupInforArr As New List(Of String)
'        Dim iGrNameList As New List(Of String)
'        Dim i As Integer, iDemChua As Integer
'        Dim iDelGroup As New List(Of Group)
'        Dim iGroupInfor As String

'        Dim iSoLuongPMI As Integer = 0
'        Do
'            TheUFsession.Obj.CycleObjsInPart(workPart.Tag, UFConstants.UF_group_type, tmpGrp)
'            If tmpGrp = NXOpen.Tag.Null Then
'                Continue Do
'            End If
'            myGroup = Utilities.NXObjectManager.Get(tmpGrp)
'            If InStr(myGroup.Name, "^") > 0 Then
'                myGroup.SetName(myGroup.Name.Replace("^", "%"))

'            End If

'            Dim iTempName As String
'            Dim iNameGr As String
'            If InStr(myGroup.Name, "THICK") > 0 Then
'                iTempName = Split(myGroup.Name, "$")(0) & "$" & Split(Split(myGroup.Name, "$")(1), "_#THICK")(0) & "$" & Split(myGroup.Name, "$")(2) & "$" & Split(myGroup.Name, "$")(3) & "$" & Split(myGroup.Name, "$")(4)
'                'lw.WriteLine(iNameGr)
'            ElseIf InStr(myGroup.Name, "THICK") = 0 Then
'                iTempName = myGroup.Name
'            End If
'            Dim tmpPartNo As String, tmpPartName As String
'            If InStr(iTempName.ToUpper, "BOLT") > 0 Or InStr(iTempName.ToUpper, "NUT") > 0 Then
'                iNameGr = Split(iTempName, "$")(0) & "$" & Split(iTempName, "$")(1)
'            ElseIf InStr(iTempName.ToUpper, "$") > 0 Then
'                tmpPartNo = Split(iTempName, "$")(1)
'                tmpPartNo = Split(tmpPartNo, "__#")(0)
'                tmpPartName = Split(iTempName, "$")(0)
'                If InStr(tmpPartName, "~") > 0 Then
'                    tmpPartName = Split(tmpPartName, "~")(1)
'                End If
'                If InStr(tmpPartNo, "~") > 0 Then
'                    tmpPartNo = Split(tmpPartNo, "~")(1)
'                End If
'                If Len(Split(iTempName, "$")(3)) = 1 Then
'                    If Len(Split(iTempName, "$")(2)) = 0 Then
'                        iNameGr = tmpPartName & "$" & tmpPartNo
'                    Else
'                        iNameGr = tmpPartName & "$" & tmpPartNo & "$" & Split(iTempName, "$")(2)
'                    End If
'                Else
'                    iNameGr = tmpPartName & "$" & tmpPartNo & "$" & Split(iTempName, "$")(2) & "$" & Split(iTempName, "$")(3)
'                End If
'            Else
'                iNameGr = iTempName
'            End If
'            If iGrNameList.Contains(iNameGr) = False Then                  'Câu lệnh Contains: kiểm tra trong List (iGrNameList) đã có "???" chưa, chưa có thì False, có rồi thì True. làm cái này để khi có những Group trùng tên thì chỉ lấy 1 Group để chỉ thị
'                iGrNameList.Add(iNameGr)
'                If InStr(iNameGr, "THICK") = 0 Then                        'những PMI của buhin Thickness (trong tên có chữ "THICK") thì k hiển thị PMI
'                    Call GetGroupInfor(myGroup, iGroupInfor)
'                    If iGroupInfor <> "" Then
'                        If iGroupInforArr.Contains(iGroupInfor) = False Then
'                            iGroupInforArr.Add(iGroupInfor)
'                            ReDim Preserve iGroupName(iSoLuongPMI)
'                            iGroupName(iSoLuongPMI) = iNameGr
'                            iSoLuongPMI = iSoLuongPMI + 1
'                        Else
'                            iDelGroup.Add(myGroup)
'                        End If
'                    End If
'                End If
'            End If
'        Loop Until tmpGrp = NXOpen.Tag.Null
'    End Sub

'    Sub Phan_loai_Group(ByVal iComponentName As String, ByVal iGroupName() As String, ByVal iPointMax1 As Point3d, ByVal iPointMin1 As Point3d, ByVal iPointMax2 As Point3d, ByVal iPointMin2 As Point3d, ByVal iListABC As List(Of String))
'        'Chia các Group cần chỉ thị thành 3 nhóm: 4 Group 4 góc, những Group lệch hẳn về 1 bên, những Gr có thể chỉ thị đều 2 bên; Tìm điểm chỉ thị PMI cho từng Group
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim iHuongPMI As String
'        Dim iOriPt As NXOpen.Point, iZaxis As DatumAxis, tempXdir As Vector3d, tempYdir As Vector3d, tempZdir As Vector3d, iOriPt3D As Point3d
'        Call D001_SearchCsysTest(iOriPt, iZaxis, tempXdir, tempYdir, tempZdir)
'        Call Create_Point3D_From_Point(iOriPt, iOriPt3D)
'        Dim iStringChithi() As String, iStringDem As Integer = 0
'        Dim iPointchithiben1() As Point3d, dem1 As Integer = 0, iPointchithiben2() As Point3d, dem2 As Integer = 0
'        Dim iPoint3DDatBen1() As Point3d, iPoint3DDatBen2() As Point3d
'        Dim i As Integer = 0, j As Integer = 0, ichua As Integer = 0
'        Dim iMinLen As Double = 13042000, iMinCurve As Curve, iMaxLen As Double = -13042000, iMaxCurve As Curve, iDelGroupName As String
'        'Step1: Xác định 4 Group 4 góc
'        Dim iDatPMIStep1() As Point3d
'        ReDim Preserve iDatPMIStep1(0)
'        iDatPMIStep1(0) = iPointMax1
'        ReDim Preserve iDatPMIStep1(1)
'        iDatPMIStep1(1) = iPointMin1
'        ReDim Preserve iDatPMIStep1(2)
'        iDatPMIStep1(2) = iPointMax2
'        ReDim Preserve iDatPMIStep1(3)
'        iDatPMIStep1(3) = iPointMin2
'        Dim iDiemchithiPMIStep1() As Point3d
'        Dim iGrNameList As New List(Of String)
'        For j = 0 To UBound(iDatPMIStep1)
'            If j <= UBound(iGroupName) Then
'                Dim NULLTAG As Tag = NXOpen.Tag.Null
'                Dim objectTag As Tag = NXOpen.Tag.Null
'                theUFSession.Obj.CycleObjsInPart(workPart.Tag, NXOpen.UF.UFConstants.UF_group_type, objectTag)
'                Dim iPointChua As NXOpen.Point = workPart.Points.CreatePoint(iDatPMIStep1(j))
'                Do
'                    i = 0
'                    Dim group_count As Integer = 0
'                    Dim group_list() As Group
'                    Dim group_member_list() As Tag
'                    Dim member_count As Integer
'                    Dim mygroup As Group = Nothing
'                    Dim myObject As NXObject = Nothing
'                    myObject = NXObjectManager.Get(objectTag)
'                    mygroup = CType(myObject, Group)
'                    Array.Resize(group_list, group_count + 1)
'                    group_list(group_count) = mygroup
'                    theUFSession.Group.AskGroupData(objectTag, group_member_list, member_count)
'                    theUFSession.Obj.CycleObjsInPart(workPart.Tag, NXOpen.UF.UFConstants.UF_group_type, objectTag)
'                    mygroup.SetName(mygroup.Name.ToUpper)
'                    'lw.WriteLine(mygroup.Name)
'                    Dim iTempName As String
'                    Dim iNameGr As String
'                    If InStr(mygroup.Name, "THICK") > 0 Then
'                        iTempName = Split(mygroup.Name, "$")(0) & "$" & Split(Split(mygroup.Name, "$")(1), "_#THICK")(0) & "$" & Split(mygroup.Name, "$")(2) & "$" & Split(mygroup.Name, "$")(3) & "$" & Split(mygroup.Name, "$")(4)
'                        'lw.WriteLine(iNameGr)
'                    ElseIf InStr(mygroup.Name, "THICK") = 0 Then
'                        iTempName = mygroup.Name
'                    End If
'                    Dim tmpPartNo As String, tmpPartName As String
'                    If InStr(iTempName.ToUpper, "BOLT") > 0 Or InStr(iTempName.ToUpper, "NUT") > 0 Then
'                        iNameGr = Split(iTempName, "$")(0) & "$" & Split(iTempName, "$")(1)
'                    ElseIf InStr(iTempName.ToUpper, "$") > 0 Then
'                        tmpPartNo = Split(iTempName, "$")(1)
'                        tmpPartNo = Split(tmpPartNo, "__#")(0)
'                        tmpPartName = Split(iTempName, "$")(0)
'                        If InStr(tmpPartName, "~") > 0 Then
'                            tmpPartName = Split(tmpPartName, "~")(1)
'                        End If
'                        If InStr(tmpPartNo, "~") > 0 Then
'                            tmpPartNo = Split(tmpPartNo, "~")(1)
'                        End If
'                        If Len(Split(iTempName, "$")(3)) = 1 Then
'                            If Len(Split(iTempName, "$")(2)) = 0 Then
'                                iNameGr = tmpPartName & "$" & tmpPartNo
'                            Else
'                                iNameGr = tmpPartName & "$" & tmpPartNo & "$" & Split(iTempName, "$")(2)
'                            End If
'                        Else
'                            iNameGr = tmpPartName & "$" & tmpPartNo & "$" & Split(iTempName, "$")(2) & "$" & Split(iTempName, "$")(3)
'                        End If
'                    Else
'                        iNameGr = iTempName
'                    End If
'                    If iGrNameList.Contains(iNameGr) = False Then
'                        Dim iCheck As Boolean = False
'                        For Each iStr As String In iGroupName                   'ktra xem group đang xét có nằm trong những Group được chỉ thị PMI hay không
'                            If iNameGr = iStr Then
'                                Dim iCurveTG As Curve, iLen As Double
'                                For Each iTag As Tag In group_member_list
'                                    Dim iObj As NXObject = Nothing
'                                    iObj = NXObjectManager.Get(iTag)
'                                    iCurveTG = CType(iObj, Curve)
'                                    Call DistanceMeasure(Mid_Point_ForCurve(iCurveTG), iPointChua, iLen)
'                                    If iMinLen > iLen Then
'                                        iMinLen = iLen
'                                        iMinCurve = iCurveTG
'                                        iDelGroupName = iNameGr
'                                    End If
'                                Next
'                            End If
'                        Next
'                    End If
'                    'Câu lệnh Contains: kiểm tra trong List (iGrNameList) đã có "???" chưa, chưa có thì False, có rồi thì True. làm cái này để khi có những Group trùng tên thì chỉ lấy 1 Group để chỉ thị

'                Loop While objectTag <> NULLTAG

'                ReDim Preserve iDiemchithiPMIStep1(j)
'                iDiemchithiPMIStep1(j) = Mid_Point3D_ForCurve(iMinCurve)

'                ReDim Preserve iStringChithi(iStringDem)
'                iStringChithi(iStringDem) = iDiemchithiPMIStep1(j).X & "," & iDiemchithiPMIStep1(j).Y & "," & iDiemchithiPMIStep1(j).Z & "*" & iDelGroupName
'                iStringDem += 1

'                For ichua = 0 To UBound(iGroupName)                   'Xóa GroupName đã được chỉ thị trong mảng iGroupName
'                    If iDelGroupName = iGroupName(ichua) Then
'                        iGroupName(ichua) = ""
'                    End If
'                Next
'                iMinLen = 13042000
'            End If
'        Next

'        If UBound(iDiemchithiPMIStep1) >= 1 Then
'            For i = 0 To 1
'                ReDim Preserve iPointchithiben1(dem1)
'                iPointchithiben1(dem1) = iDiemchithiPMIStep1(i)                 '''''''''''''''
'                dem1 += 1
'            Next
'        Else
'            Exit Sub
'        End If
'        If UBound(iDiemchithiPMIStep1) >= 2 Then
'            For i = 2 To UBound(iDiemchithiPMIStep1)
'                ReDim Preserve iPointchithiben2(dem2)
'                iPointchithiben2(dem2) = iDiemchithiPMIStep1(i)                 '''''''''''''''
'                dem2 += 1
'            Next
'        End If

'        If UBound(iGroupName) <= 3 Then
'            If UBound(iGroupName) <= 1 Then
'                For i = 0 To UBound(iGroupName)
'                    ReDim Preserve iPoint3DDatBen1(i)
'                    iPoint3DDatBen1(i) = iDatPMIStep1(i)
'                Next
'            Else
'                For i = 0 To 1
'                    ReDim Preserve iPoint3DDatBen1(i)
'                    iPoint3DDatBen1(i) = iDatPMIStep1(i)
'                Next
'                For i = 2 To UBound(iGroupName)
'                    ReDim Preserve iPoint3DDatBen2(i - 2)
'                    iPoint3DDatBen2(i - 2) = iDatPMIStep1(i)
'                Next
'            End If
'        End If


'        'Step 2: Xác định những Group nằm hẳn về 1 bên
'        Dim iDem1 As Integer = 0, iDem2 As Integer = 0                  'biến đếm sô lượng PMI nằm lệch hẳn về 1 bên của từng bên
'        Dim iGroupNameStep3() As String
'        If UBound(iGroupName) > 3 Then
'            Dim q As Integer = 0
'            Dim iLine1 As Curve, iLine2 As Curve
'            iLine1 = workPart.Curves.CreateLine(iPointMax1, iPointMin1)
'            iLine1.SetVisibility(SmartObject.VisibilityOption.Invisible)
'            iLine2 = workPart.Curves.CreateLine(iPointMax2, iPointMin2)
'            iLine2.SetVisibility(SmartObject.VisibilityOption.Invisible)

'            Dim iLen1 As Double = 13042000, iLen2 As Double = 13042000
'            Dim KCTB As Double = 75
'            Dim iGrNameList1 As New List(Of String)
'            For j = 0 To UBound(iGroupName)
'                If iGroupName(j) <> "" Then
'                    Dim NULLTAG As Tag = NXOpen.Tag.Null
'                    Dim objectTag As Tag = NXOpen.Tag.Null
'                    theUFSession.Obj.CycleObjsInPart(workPart.Tag, NXOpen.UF.UFConstants.UF_group_type, objectTag)
'                    Do
'                        i = 0
'                        Dim group_count As Integer = 0
'                        Dim group_list() As Group
'                        Dim group_member_list() As Tag
'                        Dim member_count As Integer
'                        Dim mygroup As Group = Nothing
'                        Dim myObject As NXObject = Nothing
'                        myObject = NXObjectManager.Get(objectTag)
'                        mygroup = CType(myObject, Group)
'                        Array.Resize(group_list, group_count + 1)
'                        group_list(group_count) = mygroup
'                        theUFSession.Group.AskGroupData(objectTag, group_member_list, member_count)
'                        theUFSession.Obj.CycleObjsInPart(workPart.Tag, NXOpen.UF.UFConstants.UF_group_type, objectTag)
'                        mygroup.SetName(mygroup.Name.ToUpper)                   'tên Gr viết hoa hết
'                        Dim iTempName As String
'                        Dim iNameGr As String
'                        If InStr(mygroup.Name, "THICK") > 0 Then
'                            iTempName = Split(mygroup.Name, "$")(0) & "$" & Split(Split(mygroup.Name, "$")(1), "_#THICK")(0) & "$" & Split(mygroup.Name, "$")(2) & "$" & Split(mygroup.Name, "$")(3) & "$" & Split(mygroup.Name, "$")(4)
'                            'lw.WriteLine(iNameGr)
'                        ElseIf InStr(mygroup.Name, "THICK") = 0 Then
'                            iTempName = mygroup.Name
'                        End If
'                        Dim tmpPartNo As String, tmpPartName As String
'                        If InStr(iTempName.ToUpper, "BOLT") > 0 Or InStr(iTempName.ToUpper, "NUT") > 0 Then
'                            iNameGr = Split(iTempName, "$")(0) & "$" & Split(iTempName, "$")(1)
'                        ElseIf InStr(iTempName.ToUpper, "$") > 0 Then
'                            tmpPartNo = Split(iTempName, "$")(1)
'                            tmpPartNo = Split(tmpPartNo, "__#")(0)
'                            tmpPartName = Split(iTempName, "$")(0)
'                            If InStr(tmpPartName, "~") > 0 Then
'                                tmpPartName = Split(tmpPartName, "~")(1)
'                            End If
'                            If InStr(tmpPartNo, "~") > 0 Then
'                                tmpPartNo = Split(tmpPartNo, "~")(1)
'                            End If
'                            If Len(Split(iTempName, "$")(3)) = 1 Then
'                                If Len(Split(iTempName, "$")(2)) = 0 Then
'                                    iNameGr = tmpPartName & "$" & tmpPartNo
'                                Else
'                                    iNameGr = tmpPartName & "$" & tmpPartNo & "$" & Split(iTempName, "$")(2)
'                                End If
'                            Else
'                                iNameGr = tmpPartName & "$" & tmpPartNo & "$" & Split(iTempName, "$")(2) & "$" & Split(iTempName, "$")(3)
'                            End If
'                        Else
'                            iNameGr = iTempName
'                        End If

'                        If iGrNameList1.Contains(iNameGr) = False Then
'                            If iNameGr = iGroupName(j) Then
'                                Dim iCurveTG As Curve, iCurve1 As Curve, iCurve2 As Curve, iiLen1 As Double, iiLen2 As Double
'                                For Each iTag As Tag In group_member_list
'                                    Dim iObj As NXObject = Nothing
'                                    iObj = NXObjectManager.Get(iTag)
'                                    iCurveTG = CType(iObj, Curve)
'                                    Call DistanceMeasure(iCurveTG, iLine1, iiLen1)
'                                    Call DistanceMeasure(iCurveTG, iLine2, iiLen2)
'                                    If iLen1 > iiLen1 Then
'                                        iLen1 = iiLen1
'                                        iCurve1 = iCurveTG
'                                        iDelGroupName = iNameGr
'                                    End If
'                                    If iLen2 > iiLen2 Then
'                                        iLen2 = iiLen2
'                                        iCurve2 = iCurveTG
'                                        iDelGroupName = iNameGr
'                                    End If
'                                Next

'                                If iLen1 < KCTB And iLen2 < KCTB Then
'                                    ReDim Preserve iGroupNameStep3(q)
'                                    iGroupNameStep3(q) = iNameGr
'                                    q += 1
'                                Else
'                                    If iLen1 < KCTB Then
'                                        iDem1 += 1
'                                        ReDim Preserve iPointchithiben1(dem1)
'                                        iPointchithiben1(dem1) = iPointchithiben1(dem1 - 1)
'                                        iPointchithiben1(dem1 - 1) = Mid_Point3D_ForCurve(iCurve1)
'                                        dem1 += 1
'                                        ReDim Preserve iStringChithi(iStringDem)
'                                        iStringChithi(iStringDem) = Mid_Point3D_ForCurve(iCurve1).X & "," & Mid_Point3D_ForCurve(iCurve1).Y & "," & Mid_Point3D_ForCurve(iCurve1).Z & "*" & iDelGroupName
'                                        iStringDem += 1
'                                    Else
'                                        iDem2 += 1
'                                        ReDim Preserve iPointchithiben2(dem2)
'                                        iPointchithiben2(dem2) = iPointchithiben2(dem2 - 1)
'                                        iPointchithiben2(dem2 - 1) = Mid_Point3D_ForCurve(iCurve2)
'                                        dem2 += 1
'                                        ReDim Preserve iStringChithi(iStringDem)
'                                        iStringChithi(iStringDem) = Mid_Point3D_ForCurve(iCurve2).X & "," & Mid_Point3D_ForCurve(iCurve2).Y & "," & Mid_Point3D_ForCurve(iCurve2).Z & "*" & iDelGroupName
'                                        iStringDem += 1
'                                    End If
'                                End If
'                                Exit Do
'                            End If
'                        End If

'                    Loop While objectTag <> NULLTAG
'                End If

'                For ichua = 0 To UBound(iGroupName)                   'Xóa GroupName đã được chỉ thị trong mảng iGroupName
'                    If iDelGroupName = iGroupName(ichua) Then
'                        iGroupName(ichua) = ""
'                    End If
'                Next
'                iLen1 = 13042000
'                iLen2 = 13042000
'            Next


'            If IsArray(iGroupNameStep3) = False Then
'                Dim iiDemChua As Integer
'                Dim iPoint3DDatBen1Test(UBound(iPointchithiben1)) As Point3d, iPoint3DDatBen2Test(UBound(iPointchithiben2)) As Point3d
'                iPoint3DDatBen1Test(0) = iPointMax1
'                For iiDemChua = 1 To UBound(iPointchithiben1) - 1
'                    Call Create_LineEquation_From_Point_And_DirectionVector(iPointMax1, tempZdir, -1 * (100 / (UBound(iPointchithiben1)) * iiDemChua), iPoint3DDatBen1Test(iiDemChua))
'                Next
'                iPoint3DDatBen1Test(UBound(iPointchithiben1)) = iPointMin1

'                iPoint3DDatBen2Test(0) = iPointMax2
'                For iiDemChua = 1 To UBound(iPointchithiben2) - 1
'                    Call Create_LineEquation_From_Point_And_DirectionVector(iPointMax2, tempZdir, -1 * (100 / (UBound(iPointchithiben2)) * iiDemChua), iPoint3DDatBen2Test(iiDemChua))
'                Next
'                iPoint3DDatBen2Test(UBound(iPointchithiben2)) = iPointMin2

'                iPoint3DDatBen1 = iPoint3DDatBen1Test
'                iPoint3DDatBen2 = iPoint3DDatBen2Test
'            End If
'            'Step3: Layout những buhin còn lại, ưu tiên chỉ thị bên còn ít vị trí Layout hơn trước
'            ''Xem xét hiện trạng phân bố PMI hiện tại, sau đó phân bố những PMI còn lại của Step 3 sao cho hợp lý
'            '''Số lượng PMI chia đều trên lý thuyết
'            Dim iSoLuongPMIBen1 As Integer, iSoLuongPMIBen2 As Integer
'            iSoLuongPMIBen2 = (UBound(iGroupName) + 1) \ 2
'            iSoLuongPMIBen1 = UBound(iGroupName) + 1 - iSoLuongPMIBen2
'            Dim iDemChua As Integer
'            If IsArray(iGroupNameStep3) = True Then
'                If UBound(iPointchithiben1) + 1 < iSoLuongPMIBen1 And UBound(iPointchithiben2) + 1 < iSoLuongPMIBen2 Then           'Nếu cả 2 bên vẫn còn chỗ để đặt chỉ thị PMI
'                    'Dim iPoint3DDatBen1() As Point3d, iPoint3DDatBen2() As Point3d
'                    Dim iPoint3DDatBen1Test(iSoLuongPMIBen1 - 1) As Point3d, iPoint3DDatBen2Test(iSoLuongPMIBen2 - 1) As Point3d
'                    iPoint3DDatBen1Test(0) = iPointMax1
'                    For iDemChua = 1 To iSoLuongPMIBen1 - 2
'                        Call Create_LineEquation_From_Point_And_DirectionVector(iPointMax1, tempZdir, -1 * (100 / (iSoLuongPMIBen1 - 1) * iDemChua), iPoint3DDatBen1Test(iDemChua))
'                    Next
'                    iPoint3DDatBen1Test(iSoLuongPMIBen1 - 1) = iPointMin1

'                    iPoint3DDatBen2Test(0) = iPointMax2
'                    For iDemChua = 1 To iSoLuongPMIBen2 - 2
'                        Call Create_LineEquation_From_Point_And_DirectionVector(iPointMax2, tempZdir, -1 * (100 / (iSoLuongPMIBen2 - 1) * iDemChua), iPoint3DDatBen2Test(iDemChua))
'                    Next
'                    iPoint3DDatBen2Test(iSoLuongPMIBen2 - 1) = iPointMin2

'                    iPoint3DDatBen1 = iPoint3DDatBen1Test
'                    iPoint3DDatBen2 = iPoint3DDatBen2Test



'                    If UBound(iPointchithiben1) > UBound(iPointchithiben2) Then               'bên 1 còn ÍT vị trí đặt hơn
'                        iHuongPMI = "LEFT"
'                        Dim iPointchithi1() As Point3d, iGroupNameStep31() As String
'                        Layout_Step3(Nothing, Nothing, iPoint3DDatBen1, iDem1, iGroupNameStep3, iPointchithi1, iGroupNameStep31)
'                        If IsArray(iPointchithi1) = True Then
'                            For i = 0 To UBound(iPointchithi1)
'                                ReDim Preserve iPointchithiben1(dem1)
'                                iPointchithiben1(dem1) = iPointchithiben1(dem1 - 1)
'                                iPointchithiben1(dem1 - 1) = iPointchithi1(i)
'                                dem1 += 1
'                                ReDim Preserve iStringChithi(iStringDem)
'                                iStringChithi(iStringDem) = iPointchithi1(i).X & "," & iPointchithi1(i).Y & "," & iPointchithi1(i).Z & "*" & iGroupNameStep31(i)
'                                iStringDem += 1
'                            Next
'                        End If
'                        iHuongPMI = "RIGHT"
'                        Dim iPointchithi2() As Point3d, iGroupNameStep32() As String
'                        Layout_Step3(Nothing, Nothing, iPoint3DDatBen2, iDem2, iGroupNameStep3, iPointchithi2, iGroupNameStep32)
'                        If IsArray(iPointchithi2) = True Then
'                            For i = 0 To UBound(iPointchithi2)
'                                ReDim Preserve iPointchithiben2(dem2)
'                                iPointchithiben2(dem2) = iPointchithiben2(dem2 - 1)
'                                iPointchithiben2(dem2 - 1) = iPointchithi2(i)
'                                dem2 += 1
'                                ReDim Preserve iStringChithi(iStringDem)
'                                iStringChithi(iStringDem) = iPointchithi2(i).X & "," & iPointchithi2(i).Y & "," & iPointchithi2(i).Z & "*" & iGroupNameStep32(i)
'                                iStringDem += 1
'                            Next
'                        End If
'                    Else                                                                'bên 1 còn NHIỀU vị trí đặt hơn
'                        iHuongPMI = "RIGHT"
'                        Dim iPointchithi2() As Point3d, iGroupNameStep32() As String
'                        Layout_Step3(Nothing, Nothing, iPoint3DDatBen2, iDem2, iGroupNameStep3, iPointchithi2, iGroupNameStep32)
'                        If IsArray(iPointchithi2) = True Then
'                            For i = 0 To UBound(iPointchithi2)
'                                ReDim Preserve iPointchithiben2(dem2)
'                                iPointchithiben2(dem2) = iPointchithiben2(dem2 - 1)
'                                iPointchithiben2(dem2 - 1) = iPointchithi2(i)
'                                dem2 += 1
'                                ReDim Preserve iStringChithi(iStringDem)
'                                iStringChithi(iStringDem) = iPointchithi2(i).X & "," & iPointchithi2(i).Y & "," & iPointchithi2(i).Z & "*" & iGroupNameStep32(i)
'                                iStringDem += 1
'                            Next
'                        End If
'                        iHuongPMI = "LEFT"
'                        Dim iPointchithi1() As Point3d, iGroupNameStep31() As String
'                        Layout_Step3(Nothing, Nothing, iPoint3DDatBen1, iDem1, iGroupNameStep3, iPointchithi1, iGroupNameStep31)
'                        If IsArray(iPointchithi1) = True Then
'                            For i = 0 To UBound(iPointchithi1)
'                                ReDim Preserve iPointchithiben1(dem1)
'                                iPointchithiben1(dem1) = iPointchithiben1(dem1 - 1)
'                                iPointchithiben1(dem1 - 1) = iPointchithi1(i)
'                                dem1 += 1
'                                ReDim Preserve iStringChithi(iStringDem)
'                                iStringChithi(iStringDem) = iPointchithi1(i).X & "," & iPointchithi1(i).Y & "," & iPointchithi1(i).Z & "*" & iGroupNameStep31(i)
'                                iStringDem += 1
'                            Next
'                        End If
'                    End If

'                ElseIf UBound(iPointchithiben1) + 1 < iSoLuongPMIBen1 And UBound(iPointchithiben2) + 1 >= iSoLuongPMIBen2 Then           'chỉ bên 1 còn chỗ
'                    Dim iPoint3DDatBen2Test(UBound(iPointchithiben2)) As Point3d
'                    iPoint3DDatBen2Test(0) = iPointMax2
'                    For iDemChua = 1 To UBound(iPoint3DDatBen2Test) - 1
'                        Call Create_LineEquation_From_Point_And_DirectionVector(iPointMax2, tempZdir, -1 * (100 / (UBound(iPoint3DDatBen2Test)) * iDemChua), iPoint3DDatBen2Test(iDemChua))
'                    Next
'                    iPoint3DDatBen2Test(UBound(iPointchithiben2)) = iPointMin2
'                    iPoint3DDatBen2 = iPoint3DDatBen2Test

'                    Dim iPoint3DDatBen1Test(UBound(iGroupName) - UBound(iPoint3DDatBen2) - 1) As Point3d
'                    iPoint3DDatBen1Test(0) = iPointMax1
'                    For iDemChua = 1 To UBound(iPoint3DDatBen1Test) - 1
'                        Call Create_LineEquation_From_Point_And_DirectionVector(iPointMax1, tempZdir, -1 * (100 / (UBound(iPoint3DDatBen1Test)) * iDemChua), iPoint3DDatBen1Test(iDemChua))
'                    Next
'                    iPoint3DDatBen1Test(UBound(iPoint3DDatBen1Test)) = iPointMin1
'                    iPoint3DDatBen1 = iPoint3DDatBen1Test

'                    '''''''''''''
'                    Dim iPointchithi1() As Point3d, iGroupNameStep31() As String
'                    Layout_Step3(Nothing, Nothing, iPoint3DDatBen1, iDem1, iGroupNameStep3, iPointchithi1, iGroupNameStep31)
'                    If IsArray(iPointchithi1) = True Then
'                        For i = 0 To UBound(iPointchithi1)
'                            ReDim Preserve iPointchithiben1(dem1)
'                            iPointchithiben1(dem1) = iPointchithiben1(dem1 - 1)
'                            iPointchithiben1(dem1 - 1) = iPointchithi1(i)
'                            dem1 += 1
'                            ReDim Preserve iStringChithi(iStringDem)
'                            iStringChithi(iStringDem) = iPointchithi1(i).X & "," & iPointchithi1(i).Y & "," & iPointchithi1(i).Z & "*" & iGroupNameStep31(i)
'                            iStringDem += 1
'                        Next
'                    End If


'                ElseIf UBound(iPointchithiben1) + 1 >= iSoLuongPMIBen1 And UBound(iPointchithiben2) + 1 < iSoLuongPMIBen2 Then           'chỉ bên 2 còn chỗ
'                    Dim iPoint3DDatBen1Test(UBound(iPointchithiben1)) As Point3d
'                    iPoint3DDatBen1Test(0) = iPointMax1
'                    For iDemChua = 1 To UBound(iPointchithiben1) - 1
'                        Call Create_LineEquation_From_Point_And_DirectionVector(iPointMax1, tempZdir, -1 * (100 / (UBound(iPointchithiben1)) * iDemChua), iPoint3DDatBen1Test(iDemChua))
'                    Next
'                    iPoint3DDatBen1Test(UBound(iPointchithiben1)) = iPointMin1
'                    iPoint3DDatBen1 = iPoint3DDatBen1Test

'                    Dim iPoint3DDatBen2Test(UBound(iGroupName) - UBound(iPoint3DDatBen1) - 1) As Point3d
'                    iPoint3DDatBen2Test(0) = iPointMax2
'                    For iDemChua = 1 To UBound(iPoint3DDatBen2Test) - 1
'                        Call Create_LineEquation_From_Point_And_DirectionVector(iPointMax2, tempZdir, -1 * (100 / (UBound(iPoint3DDatBen2Test)) * iDemChua), iPoint3DDatBen2Test(iDemChua))
'                    Next
'                    iPoint3DDatBen2Test(UBound(iPoint3DDatBen2Test)) = iPointMin2
'                    iPoint3DDatBen2 = iPoint3DDatBen2Test

'                    '''''''''''''''''''
'                    Dim iPointchithi2() As Point3d, iGroupNameStep32() As String
'                    Layout_Step3(Nothing, Nothing, iPoint3DDatBen2, iDem2, iGroupNameStep3, iPointchithi2, iGroupNameStep32)
'                    If IsArray(iPointchithi2) = True Then
'                        For i = 0 To UBound(iPointchithi2)
'                            ReDim Preserve iPointchithiben2(dem2)
'                            iPointchithiben2(dem2) = iPointchithiben2(dem2 - 1)
'                            iPointchithiben2(dem2 - 1) = iPointchithi2(i)
'                            dem2 += 1
'                            ReDim Preserve iStringChithi(iStringDem)
'                            iStringChithi(iStringDem) = iPointchithi2(i).X & "," & iPointchithi2(i).Y & "," & iPointchithi2(i).Z & "*" & iGroupNameStep32(i)
'                            iStringDem += 1
'                        Next
'                    End If

'                End If
'            End If

'        End If

'        'Dim ilistGr As New List(Of String)
'        If IsArray(iPoint3DDatBen1) = True Then
'            Call Sap_xep_tranh_kanshou_New(iComponentName, iPointchithiben1, iPointMax1, iPointMin1)
'            For i = 0 To UBound(iPoint3DDatBen1)
'                iHuongPMI = "LEFT"
'                Call CreatePMI(iComponentName, iStringChithi, iPointchithiben1(i), iPoint3DDatBen1(i), iHuongPMI, iListABC)
'            Next
'        End If

'        If IsArray(iPoint3DDatBen2) = True Then
'            Call Sap_xep_tranh_kanshou_New(iComponentName, iPointchithiben2, iPointMax1, iPointMin1)
'            For i = 0 To UBound(iPoint3DDatBen2)
'                iHuongPMI = "RIGHT"
'                Call CreatePMI(iComponentName, iStringChithi, iPointchithiben2(i), iPoint3DDatBen2(i), iHuongPMI, iListABC)

'            Next
'        End If
'    End Sub

'    Sub DistanceMeasure(ByVal iObj1 As NXObject, ByVal iObj2 As NXObject, ByRef iDistance As Double)
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim nullUnit As Unit = Nothing
'        Dim theDispObject1 As DisplayableObject = CType(iObj1, DisplayableObject)
'        Dim theDispObject2 As DisplayableObject = CType(iObj2, DisplayableObject)
'        Dim measureDistance1 As MeasureDistance = workPart.MeasureManager.NewDistance(nullUnit, MeasureManager.MeasureType.Minimum, theDispObject1, theDispObject2)
'        iDistance = Math.Round(measureDistance1.Value, 3)

'    End Sub

'    Sub DistanceMeasure_Maximum(ByVal iObj1 As NXObject, ByVal iObj2 As NXObject, ByRef iDistance As Double)
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim nullUnit As Unit = Nothing
'        Dim theDispObject1 As DisplayableObject = CType(iObj1, DisplayableObject)
'        Dim theDispObject2 As DisplayableObject = CType(iObj2, DisplayableObject)
'        Dim measureDistance1 As MeasureDistance = workPart.MeasureManager.NewDistance(nullUnit, MeasureManager.MeasureType.Maximum, theDispObject1, theDispObject2)
'        iDistance = Math.Round(measureDistance1.Value, 3)

'    End Sub

'    Function Mid_Point_ForCurve(ByVal iCurve As Curve) As NXOpen.Point
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display

'        Dim objects1(0) As NXOpen.NXObject
'        Dim stPt(2) As Double
'        Dim edPt(2) As Double
'        Dim junk3(2) As Double
'        Dim junk1 As Double
'        Dim iMidPoint As Point3d

'        theUFSession.Modl.AskCurveProps(iCurve.Tag, 1 / 2, stPt, junk3, junk3, junk3, junk1, junk1)
'        iMidPoint.X = stPt(0)
'        iMidPoint.Y = stPt(1)
'        iMidPoint.Z = stPt(2)
'        Mid_Point_ForCurve = workPart.Points.CreatePoint(iMidPoint)

'    End Function

'    Function Mid_Point3D_ForCurve(ByVal iCurve As Curve) As Point3d
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display

'        Dim objects1(0) As NXOpen.NXObject
'        Dim stPt(2) As Double
'        Dim edPt(2) As Double
'        Dim junk3(2) As Double
'        Dim junk1 As Double
'        Dim iMidPoint As Point3d

'        theUFSession.Modl.AskCurveProps(iCurve.Tag, 1 / 2, stPt, junk3, junk3, junk3, junk1, junk1)
'        Mid_Point3D_ForCurve.X = stPt(0)
'        Mid_Point3D_ForCurve.Y = stPt(1)
'        Mid_Point3D_ForCurve.Z = stPt(2)

'    End Function

'    Sub Start_End_Mid_Point_ForCurve(ByVal iCurve As Curve, ByRef iStart As NXOpen.Point, ByRef iEnd As NXOpen.Point, ByRef iMid As NXOpen.Point)
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display

'        Dim objects1(0) As NXOpen.NXObject
'        Dim stPt(2) As Double
'        Dim edPt(2) As Double
'        Dim junk3(2) As Double
'        Dim junk1 As Double
'        Dim iStartPoint As Point3d, iEndPoint As Point3d, iMidPoint As Point3d
'        theUFSession.Modl.AskCurveProps(iCurve.Tag, 0, stPt, junk3, junk3, junk3, junk1, junk1)
'        iStartPoint.X = stPt(0)
'        iStartPoint.Y = stPt(1)
'        iStartPoint.Z = stPt(2)
'        iStart = workPart.Points.CreatePoint(iStartPoint)

'        theUFSession.Modl.AskCurveProps(iCurve.Tag, 1, stPt, junk3, junk3, junk3, junk1, junk1)
'        iEndPoint.X = stPt(0)
'        iEndPoint.Y = stPt(1)
'        iEndPoint.Z = stPt(2)
'        iEnd = workPart.Points.CreatePoint(iEndPoint)

'        theUFSession.Modl.AskCurveProps(iCurve.Tag, 1 / 2, stPt, junk3, junk3, junk3, junk1, junk1)
'        iMidPoint.X = stPt(0)
'        iMidPoint.Y = stPt(1)
'        iMidPoint.Z = stPt(2)
'        iMid = workPart.Points.CreatePoint(iMidPoint)

'    End Sub

'    Sub Delete_Object(ByVal iObject As NXObject)

'        Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display

'        Dim objects1(0) As NXOpen.NXObject
'        objects1(0) = iObject
'        Dim nErrs1 As Integer = Nothing
'        nErrs1 = theSession.UpdateManager.AddToDeleteList(objects1)

'    End Sub

'    Sub DelPMI()
'        Dim theSession As Session = Session.GetSession()


'        If IsNothing(theSession.Parts.Work) Then
'            'active part required
'            Return
'        End If

'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As Part = theSession.Parts.Display
'        Dim currentScale As Double = displayPart.ModelingViews.WorkView.Scale

'        Dim lw As ListingWindow = theSession.ListingWindow
'        lw.Open()



'        For Each myPmi As Annotations.Pmi In workPart.PmiManager.Pmis
'            Dim markId2 As NXOpen.Session.UndoMarkId = Nothing
'            markId2 = theSession.SetUndoMark(NXOpen.Session.MarkVisibility.Visible, "Delete")
'            Dim objects1(0) As NXOpen.NXObject
'            objects1(0) = myPmi
'            Dim nErrs1 As Integer = Nothing
'            nErrs1 = theSession.UpdateManager.AddToDeleteList(objects1)

'            Dim notifyOnDelete2 As Boolean = Nothing
'            notifyOnDelete2 = theSession.Preferences.Modeling.NotifyOnDelete

'            Dim nErrs2 As Integer = Nothing
'            nErrs2 = theSession.UpdateManager.DoUpdate(markId2)
'        Next
'        Try
'            workPart.ModelingViews.WorkView.Regenerate()
'            workPart.ModelingViews.WorkView.UpdateDisplay()
'        Catch ex As Exception
'            displayPart.ModelingViews.WorkView.Regenerate()
'            displayPart.ModelingViews.WorkView.UpdateDisplay()
'        End Try
'    End Sub

'    Sub Xoay(ByVal TmpCs As CartesianCoordinateSystem, ByVal iSectName As String)
'        Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim matrix1 As NXOpen.Matrix3x3 = Nothing
'        Dim translation1 As NXOpen.Point3d

'        If iSectName = "X" Then
'            matrix1.Xx = TmpCs.Orientation.Element.Yx
'            matrix1.Xy = TmpCs.Orientation.Element.Yy
'            matrix1.Xz = TmpCs.Orientation.Element.Yz

'            matrix1.Yx = TmpCs.Orientation.Element.Zx
'            matrix1.Yy = TmpCs.Orientation.Element.Zy
'            matrix1.Yz = TmpCs.Orientation.Element.Zz

'            matrix1.Zx = TmpCs.Orientation.Element.Xx
'            matrix1.Zy = TmpCs.Orientation.Element.Xy
'            matrix1.Zz = TmpCs.Orientation.Element.Xz

'            displayPart.ModelingViews.WorkView.Orient(matrix1)

'            'translation1.X = TmpCs.Origin.X + 200 * TmpCs.Orientation.Element.Yx
'            'translation1.Y = TmpCs.Origin.Y + 200 * TmpCs.Orientation.Element.Yy
'            'translation1.Z = TmpCs.Origin.Z + 200 * TmpCs.Orientation.Element.Yz
'            'workPart.ModelingViews.WorkView.SetRotationTranslationScale(matrix1, translation1, 1)
'        ElseIf iSectName = "Y" Then

'            matrix1.Xx = TmpCs.Orientation.Element.Xx
'            matrix1.Xy = TmpCs.Orientation.Element.Xy
'            matrix1.Xz = TmpCs.Orientation.Element.Xz

'            matrix1.Yx = TmpCs.Orientation.Element.Zx
'            matrix1.Yy = TmpCs.Orientation.Element.Zy
'            matrix1.Yz = TmpCs.Orientation.Element.Zz

'            matrix1.Zx = -TmpCs.Orientation.Element.Yx
'            matrix1.Zy = -TmpCs.Orientation.Element.Yy
'            matrix1.Zz = -TmpCs.Orientation.Element.Yz

'            displayPart.ModelingViews.WorkView.Orient(matrix1)
'            'translation1.X = TmpCs.Origin.X + 200 * TmpCs.Orientation.Element.Xx
'            'translation1.Y = TmpCs.Origin.Y + 200 * TmpCs.Orientation.Element.Xy
'            'translation1.Z = TmpCs.Origin.Z + 200 * TmpCs.Orientation.Element.Xz

'            'workPart.ModelingViews.WorkView.SetRotationTranslationScale(matrix1, translation1, 1)

'        End If
'    End Sub

'    Sub Layout_Step3(ByVal iComponentName As String, ByVal iHuongPMI As String, ByVal iPoint3DDat() As Point3d, ByVal iDem As Integer, ByVal iGroupNameStep3() As String, ByRef iPointchithi() As Point3d, ByRef iGroupName() As String)
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display

'        Dim i As Integer = 0, j As Integer = 0, k As Integer = 0, iChua As Integer = 0

'        Dim iMinLen As Double = 13042000, iMinCurve As Curve, iDelGroupName As String
'        For j = 1 + iDem To UBound(iPoint3DDat) - 1
'            Dim NULLTAG As Tag = NXOpen.Tag.Null
'            Dim objectTag As Tag = NXOpen.Tag.Null
'            theUFSession.Obj.CycleObjsInPart(workPart.Tag, NXOpen.UF.UFConstants.UF_group_type, objectTag)
'            Dim iPointChua As NXOpen.Point = workPart.Points.CreatePoint(iPoint3DDat(j))
'            Do
'                i = 0
'                Dim group_count As Integer = 0
'                Dim group_list() As Group
'                Dim group_member_list() As Tag
'                Dim member_count As Integer
'                Dim mygroup As Group = Nothing
'                Dim myObject As NXObject = Nothing
'                myObject = NXObjectManager.Get(objectTag)
'                mygroup = CType(myObject, Group)
'                Array.Resize(group_list, group_count + 1)
'                group_list(group_count) = mygroup
'                theUFSession.Group.AskGroupData(objectTag, group_member_list, member_count)
'                theUFSession.Obj.CycleObjsInPart(workPart.Tag, NXOpen.UF.UFConstants.UF_group_type, objectTag)
'                mygroup.SetName(mygroup.Name.ToUpper)
'                Dim iTempName As String
'                Dim iNameGr As String
'                If InStr(mygroup.Name, "THICK") > 0 Then
'                    iTempName = Split(mygroup.Name, "$")(0) & "$" & Split(Split(mygroup.Name, "$")(1), "_#THICK")(0) & "$" & Split(mygroup.Name, "$")(2) & "$" & Split(mygroup.Name, "$")(3) & "$" & Split(mygroup.Name, "$")(4)
'                    'lw.WriteLine(iNameGr)
'                ElseIf InStr(mygroup.Name, "THICK") = 0 Then
'                    iTempName = mygroup.Name
'                End If
'                Dim tmpPartNo As String, tmpPartName As String
'                If InStr(iTempName.ToUpper, "BOLT") > 0 Or InStr(iTempName.ToUpper, "NUT") > 0 Then
'                    iNameGr = Split(iTempName, "$")(0) & "$" & Split(iTempName, "$")(1)
'                ElseIf InStr(iTempName.ToUpper, "$") > 0 Then
'                    tmpPartNo = Split(iTempName, "$")(1)
'                    tmpPartNo = Split(tmpPartNo, "__#")(0)
'                    tmpPartName = Split(iTempName, "$")(0)
'                    If InStr(tmpPartName, "~") > 0 Then
'                        tmpPartName = Split(tmpPartName, "~")(1)
'                    End If
'                    If InStr(tmpPartNo, "~") > 0 Then
'                        tmpPartNo = Split(tmpPartNo, "~")(1)
'                    End If
'                    If Len(Split(iTempName, "$")(3)) = 1 Then
'                        If Len(Split(iTempName, "$")(2)) = 0 Then
'                            iNameGr = tmpPartName & "$" & tmpPartNo
'                        Else
'                            iNameGr = tmpPartName & "$" & tmpPartNo & "$" & Split(iTempName, "$")(2)
'                        End If
'                    Else
'                        iNameGr = tmpPartName & "$" & tmpPartNo & "$" & Split(iTempName, "$")(2) & "$" & Split(iTempName, "$")(3)
'                    End If
'                Else
'                    iNameGr = iTempName
'                End If
'                Dim iCheck As Boolean = False
'                For Each iStr As String In iGroupNameStep3                   'ktra xem group đang xét có nằm trong những Group được chỉ thị PMI hay không
'                    If iNameGr = iStr Then
'                        Dim iCurveTG As Curve, iLen As Double
'                        For Each iTag As Tag In group_member_list
'                            Dim iObj As NXObject = Nothing
'                            iObj = NXObjectManager.Get(iTag)
'                            iCurveTG = CType(iObj, Curve)
'                            Call DistanceMeasure(Mid_Point_ForCurve(iCurveTG), iPointChua, iLen)
'                            If iMinLen > iLen Then
'                                iMinLen = iLen
'                                iMinCurve = iCurveTG
'                                iDelGroupName = iNameGr
'                            End If
'                        Next


'                        ReDim Preserve iPointchithi(k)
'                        iPointchithi(k) = Mid_Point3D_ForCurve(iMinCurve)
'                        ReDim Preserve iGroupName(k)
'                        iGroupName(k) = iNameGr
'                        k += 1

'                        'Call CreatePMITest(iComponentName, mygroup.Name, Mid_Point3D_ForCurve(iMinCurve), iPoint3DDat(j), iHuongPMI)
'                        Exit Do
'                    End If
'                Next
'            Loop While objectTag <> NULLTAG

'            For iChua = 0 To UBound(iGroupNameStep3)                   'Xóa GroupName đã được chỉ thị trong mảng iGroupName
'                If iDelGroupName = iGroupNameStep3(iChua) Then
'                    iGroupNameStep3(iChua) = ""
'                End If
'            Next
'            iMinLen = 13042000
'        Next


'    End Sub

'    ''''''締結板厚作成

'    Sub CreatePartOffset(ByVal child As Component, ByVal dtThick As DataTable)
'        Dim theSession As Session = Session.GetSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim EIWToolLibrary = System.Reflection.Assembly.LoadFile("D:\nxcad\scratch\VehiclePlanMacro\VPG-Sysytem.dll")
'        Dim VPGToolList = System.Activator.CreateInstance(EIWToolLibrary.GetExportedTypes(0))

'        Try
'            VPGToolList.VPG_System_Check()
'        Catch ex As Exception
'            MsgBox("VPG-System.dllがありません", vbExclamation)
'            Exit Sub
'        End Try

'        Try
'            If child.GetStringAttribute("PART_THICKNESS").ToString <> "" Then

'                theComponent = child
'                Dim iThickness As String = theComponent.GetStringAttribute("PART_THICKNESS")
'                Dim inamePart As String = theComponent.GetStringAttribute("DB_PART_NAME")
'                Dim iPartNo As String = theComponent.GetStringAttribute("DB_PART_NO")
'                Dim iRev As String
'                Try
'                    iRev = theComponent.GetStringAttribute("DB_PART_REV")
'                Catch ex As Exception
'                    iRev = ""
'                End Try
'                Try
'                    Call C007_Convert_Z_CS(CoverZ, BodyCheck)
'                Catch
'                End Try
'                If BodyCheck = True Then
'                    Try

'                        Call C007_ThicknessBody(iThickness, child, CoverZ, inamePart, iPartNo)
'                    Catch
'                        Try
'                            Call C007_ThicknessBodyFace(iThickness, child, CoverZ, inamePart, iPartNo)
'                        Catch
'                            Try
'                                Call C007_ThicknessOneFace(iThickness, child, CoverZ, inamePart, iPartNo)
'                            Catch
'                                lw.WriteLine("PartThickness有(Offsetできない): " & iPartNo & " : " & inamePart & "   T " & iThickness)
'                                Dim iFunc As String
'                                Call iSearchFuncNo(child, iFunc)
'                                Call InsertThickWaringToExcel(iFunc, inamePart, iPartNo, "SheetBody", iThickness, "PartThickness有(Offsetできない)", dtThick)
'                                Exit Sub
'                            End Try

'                        End Try

'                    End Try
'                    Try
'                        SaveAsNewNamePart(inamePart, iPartNo & "_#Thick_" & iRev)
'                    Catch ex As Exception
'                        lw.WriteLine("Loi saveas: ")
'                        lw.WriteLine(ex.ToString)
'                    End Try

'                Else

'                End If
'                VPGToolList.aCountAAA("186")
'            Else

'            End If
'        Catch ex As Exception
'        End Try

'    End Sub

'    Sub C007_Convert_Z_CS(ByRef CoverZ As Boolean, ByRef BodyCheck As Boolean)
'        ''''''thuat toan: Tim CS co diem goc <>(0,0,0) dau tien, lay huong Z cua CS
'        ''''''Tu CS nay, tim diem tren Body gan voi CS nhat
'        ''''''Tu diem nay, tim mat tren SheetBody chua diem (Vi Code tim Vec to phap tuyen chi tim giua mat va 1 diem tren mat)
'        ''''''Tu mat va Diem o tren tim vec to phap tuyen cua mat
'        ''''''So sanh huong phap tuyen va huong Z cuqa CS
'        Dim ufs As UFSession = UFSession.GetUFSession()
'        Dim theSession As Session = Session.GetSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As Part = theSession.Parts.Display
'        Dim cp1(2) As Double
'        Dim partFeature As Features.Feature
'        'lw.WriteLine("")

'        Dim iXx As Double
'        Dim iYy As Double
'        Dim iZz As Double
'        Dim iminDist As Double

'        '''Tim Diem goc cua CS va tim BOdy de Tim Diem tren Body gan voi CS nhat
'        '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'        Dim Object1Tag As Long
'        Dim Object2Tag As Long
'        Dim iSelCoor As NXOpen.CartesianCoordinateSystem
'        Dim CsPoint As Point3d  'Diem goc CS
'        Dim ptObj1 As NXOpen.Point
'        Dim bodies As BodyCollection = workPart.Bodies
'        Dim sheetBodies(-1) As Body
'        Dim counter As Integer = 0
'        Dim bodyCount As Integer = bodies.ToArray.Length

'        Dim body1 As NXOpen.Body
'        If bodyCount > 0 Then
'            For Each thisBody As Body In bodies
'                BodyCheck = thisBody.IsSheetBody
'                If thisBody.IsSheetBody.Equals(True) Then
'                    'lw.WriteLine(thisBody.IsBlanked.ToString)
'                    If thisBody.IsBlanked.Equals(False) Then
'                        body1 = thisBody
'                        Object2Tag = body1.Tag
'                        'lw.WriteLine("Sheet Body: " & body1.ToString())
'                    End If
'                End If
'            Next
'        End If

'        Dim iZCS(2) As Double 'huong Z cua CS
'        For Each iSelCoor In theSession.Parts.Work.CoordinateSystems
'            If iSelCoor.Origin.X <> 0 Or iSelCoor.Origin.Y <> 0 Or iSelCoor.Origin.Z <> 0 Then
'                Dim iMatrix As Matrix3x3 = iSelCoor.Orientation.Element
'                CsPoint = New Point3d(iSelCoor.Origin.X, iSelCoor.Origin.Y, iSelCoor.Origin.Z)
'                ptObj1 = workPart.Points.CreatePoint(CsPoint)
'                Object1Tag = ptObj1.Tag
'                iZCS(0) = iMatrix.Zx.ToString
'                iZCS(1) = iMatrix.Zy.ToString
'                iZCS(2) = iMatrix.Zz.ToString
'                'lw.WriteLine("Huong Z cua CS: iZx: " & iZCS(0) & " " & "iZy: " & iZCS(1) & " " & "iZz: " & iZCS(2))
'                'lw.WriteLine("Huong Z cua CS: iZx: " & Int(iZCS(0)) & " " & "iZy: " & Int(iZCS(1)) & " " & "iZz: " & Int(iZCS(2)))
'                ''' tim BOdy (Body la body cuoi cung cua Feature)
'                '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

'                '''''Tim Diem tren Body gan voi CS nhat (Body la body cuoi cung cua Feature)
'                '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'                Dim guess1(2) As Double
'                Dim guess2(2) As Double
'                Dim pt1(2) As Double
'                Dim pt2(2) As Double
'                Dim minDist As Double
'                theUFSession.Modl.AskMinimumDist(Object1Tag, Object2Tag, 0, guess1, 0, guess2, minDist, pt1, pt2)   ' pt2 la Diem tren Body gan voi CS nhat ung voi object2tag
'                'lw.WriteLine("Diem gan CS nhat: x: " & pt2(0) & " " & "y: " & pt2(1) & " " & "z: " & pt2(2))
'                'lw.WriteLine("khoang cach nho nhat: " & minDist.ToString)
'                Dim Minpoint As Point3d  'Diem gan voi CS nhat tren Body
'                Dim ptObj2 As NXOpen.Point
'                Minpoint = New Point3d(pt2(0), pt2(1), pt2(2))
'                ptObj2 = workPart.Points.CreatePoint(Minpoint)

'                '''''Tim Face cua Body chứa điểm gần với CS nhất 
'                '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'                Dim iface As NXOpen.Face
'                Dim iMinface As NXOpen.Face     'mat gan voi Cs nhat
'                Dim iMin As Double      'khoi tao gia tri khoang cach nho nhat, de tim mat gan voi CS nhat
'                Dim ObjectFaceTag As Long
'                iMin = 1
'                For Each iface In body1.GetFaces
'                    theUFSession.Modl.AskMinimumDist(ptObj2.Tag, iface.Tag, 0, guess1, 0, guess2, minDist, pt1, pt2)
'                    If minDist < iMin Then
'                        iMin = minDist
'                        iMinface = iface
'                    End If
'                Next
'                'lw.WriteLine("khoang cach min " & iMin)
'                ''''Tim Vector phap tuyen cua mat
'                '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'                Dim pt(2) As Double
'                Dim u1(2) As Double
'                Dim v1(2) As Double
'                Dim u2(2) As Double
'                Dim v2(2) As Double
'                Dim norm(2) As Double
'                Dim radii(1) As Double
'                Dim param(1) As Double
'                theUFSession.Modl.AskFaceParm(iMinface.Tag, pt2, param, pt)   '195011
'                theUFSession.Modl.AskFaceProps(iMinface.Tag, param, pt, u1, v1, u2, v2, norm, radii)
'                'lw.WriteLine("huong phap tuyen: X: " & norm(0).ToString & " Y: " & norm(1).ToString & " Z: " & norm(2).ToString)
'                'lw.WriteLine("huong phap tuyen: X: " & Int(norm(0)).ToString & " Y: " & Int(norm(1)).ToString & " Z: " & Int(norm(2)).ToString)
'                ''' So sanh Vecto phap tuyen cua mat va huong Z cua CS (Cung huong/khac huong) True: Cung huong, False: khac huong
'                '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'                Dim faceType As Integer
'                Dim facePt(2) As Double
'                Dim faceDir(2) As Double
'                Dim bbox(5) As Double
'                Dim faceRadius As Double
'                Dim faceRadData As Double
'                Dim normDirection As Integer

'                If Math.Abs(C007_iAngleMesure(iZCS(0), iZCS(1), iZCS(2), norm(0), norm(1), norm(2))) > 0.8 Then
'                    ufs.Modl.AskFaceData(iMinface.Tag, faceType, facePt, faceDir, bbox, faceRadius, faceRadData, normDirection)
'                    'lw.WriteLine(faceRadius.ToString)
'                    If faceRadius = 0 Or faceRadius > 20 Then
'                        Dim iDatumAxis As DatumAxis
'                        'lw.WriteLine(iAngleMesure(iZCS(0), iZCS(1), iZCS(2), norm(0), norm(1), norm(2)))
'                        If C007_iAngleMesure(iZCS(0), iZCS(1), iZCS(2), norm(0), norm(1), norm(2)) < 0 Then
'                            CoverZ = False
'                        Else
'                            CoverZ = True
'                        End If

'                        Exit For

'                    End If

'                End If
'            End If
'        Next


'    End Sub

'    Sub C007_ThicknessBody(ByVal ithickness As String, ByVal theComponent As Assemblies.Component, ByVal CoverZ As Boolean, ByVal inamepart As String, ByVal iPartNo As String)
'        Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work
'        Dim partFeature As Features.Feature
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display

'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        theSession.Parts.SetWorkComponent(theComponent, NXOpen.PartCollection.RefsetOption.Entire, NXOpen.PartCollection.WorkComponentOption.Visible, partLoadStatus1)

'        workPart = theSession.Parts.Work ' REINF-BACK DOOR LOCK

'        Dim nullNXOpen_Features_Feature As NXOpen.Features.Feature = Nothing
'        Dim thickenBuilder1 As NXOpen.Features.ThickenBuilder = Nothing

'        thickenBuilder1 = workPart.Features.CreateThickenBuilder(nullNXOpen_Features_Feature)

'        thickenBuilder1.Tolerance = 0.01
'        thickenBuilder1.FirstOffset.RightHandSide = ithickness '"0.5" 'i
'        thickenBuilder1.SecondOffset.RightHandSide = "0"
'        thickenBuilder1.BooleanOperation.Type = NXOpen.GeometricUtilities.BooleanOperation.BooleanType.Create
'        Dim bodies As BodyCollection = workPart.Bodies
'        Dim sheetBodies(-1) As Body
'        Dim counter As Integer = 0
'        Dim bodyCount As Integer = bodies.ToArray.Length
'        'lw.WriteLine("All Bodies in Work Part: " & bodyCount.ToString())
'        Dim body1 As NXOpen.Body
'        If bodyCount > 0 Then
'            For Each thisBody As Body In bodies
'                If thisBody.IsSheetBody.Equals(True) Then
'                    'lw.WriteLine(thisBody.IsBlanked.ToString)
'                    If thisBody.IsBlanked.Equals(False) Then
'                        body1 = thisBody
'                        'lw.WriteLine("Sheet Body: " & body1.ToString())
'                    End If
'                End If
'            Next
'        End If
'        Dim faceBodyRule1 As NXOpen.FaceBodyRule = Nothing
'        faceBodyRule1 = workPart.ScRuleFactory.CreateRuleFaceBody(body1)
'        Dim rules1(0) As NXOpen.SelectionIntentRule
'        rules1(0) = faceBodyRule1
'        thickenBuilder1.FaceCollector.ReplaceRules(rules1, False)
'        'lw.WriteLine(CoverZ.ToString)
'        If CoverZ = False Then
'            thickenBuilder1.ReverseDirection = True
'        End If
'        Dim nXObject1 As NXOpen.NXObject = Nothing
'        nXObject1 = thickenBuilder1.Commit()
'        thickenBuilder1.Destroy()
'        theSession.CleanUpFacetedFacesAndEdges()


'        Dim removeParametersBuilder1 As NXOpen.Features.RemoveParametersBuilder = Nothing
'        removeParametersBuilder1 = workPart.Features.CreateRemoveParametersBuilder()
'        Dim body2 As NXOpen.Body = CType(workPart.Bodies.FindObject(nXObject1.JournalIdentifier.ToString), NXOpen.Body)
'        Dim added1 As Boolean = Nothing
'        added1 = removeParametersBuilder1.Objects.Add(body2)


'        Dim nXObject2 As NXOpen.NXObject = Nothing
'        nXObject2 = removeParametersBuilder1.Commit()

'        Try
'            theUFSession.Obj.DeleteObject(body1.Tag)
'        Catch ex As Exception
'            Try
'                theUFSession.Obj.DeleteObject(nXObject1.Tag)
'            Catch ex1 As Exception

'            End Try

'        End Try

'        'lw.WriteLine("Part Tao duoc do day : " & iPartNo & " : " & inamepart & "   T " & ithickness)

'    End Sub
'    ''///////////////////////////////////////////////////////////////////////////////////////////////////
'    Sub C007_ThicknessOneFace(ByVal i As String, ByVal theComponent As Assemblies.Component, ByVal CoverZ As Boolean, ByVal inamepart As String, ByVal iPartNo As String)
'        Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work
'        Dim Object1Tag As Long
'        Dim Object2Tag As Long
'        Dim bodies As BodyCollection = workPart.Bodies
'        Dim sheetBodies(-1) As Body
'        Dim counter As Integer = 0
'        Dim bodyCount As Integer = bodies.ToArray.Length

'        lw.Open()
'        'lw.WriteLine("All Bodies in Work Part: " & bodyCount.ToString())
'        Dim body1 As NXOpen.Body
'        If bodyCount > 0 Then
'            For Each thisBody As Body In bodies
'                If thisBody.IsSheetBody.Equals(True) Then
'                    If thisBody.IsBlanked.Equals(False) Then
'                        body1 = thisBody
'                        Object2Tag = body1.Tag
'                    End If
'                End If
'            Next
'        End If

'        Dim displayPart As Part = theSession.Parts.Display
'        Dim cp1(2) As Double
'        Dim partFeature As Features.Feature
'        lw.Open()
'        'lw.WriteLine("")
'        Dim iXx As Double
'        Dim iYy As Double
'        Dim iZz As Double
'        Dim iminDist As Double
'        '''Tim Diem goc cua CS va tim BOdy de Tim Diem tren Body gan voi CS nhat
'        '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'        Dim iSelCoor As NXOpen.CartesianCoordinateSystem
'        Dim CsPoint As Point3d  'Diem goc CS
'        Dim ptObj1 As NXOpen.Point
'        Dim ifacecheck As NXOpen.Face = Nothing
'        Dim iZCS(2) As Double 'huong Z cua CS
'        Dim icheck1 As String
'        Dim icheck2 As String


'        Dim iOffsetFace As New List(Of Face)
'        For Each iEdge As Edge In body1.GetEdges
'            Dim theFaces() As Face = iEdge.GetFaces()
'            If theFaces.GetLength(0) < 2 Then
'                iOffsetFace.Add(theFaces(0))
'            End If

'        Next

'        Dim iOffcetComplete As New List(Of String)


'        For Each iSelCoor In theSession.Parts.Work.CoordinateSystems
'            If iSelCoor.Origin.X <> 0 Or iSelCoor.Origin.Y <> 0 Or iSelCoor.Origin.Z <> 0 Then
'                Dim iMatrix As Matrix3x3 = iSelCoor.Orientation.Element
'                CsPoint = New Point3d(iSelCoor.Origin.X, iSelCoor.Origin.Y, iSelCoor.Origin.Z)
'                ptObj1 = workPart.Points.CreatePoint(CsPoint)

'                Object1Tag = ptObj1.Tag

'                Dim guess1(2) As Double
'                Dim guess2(2) As Double
'                Dim pt1(2) As Double
'                Dim pt2(2) As Double
'                Dim minDist As Double
'                theUFSession.Modl.AskMinimumDist(Object1Tag, Object2Tag, 0, guess1, 0, guess2, minDist, pt1, pt2)   ' pt2 la Diem tren Body gan voi CS nhat ung voi object2tag
'                'lw.WriteLine("Diem gan CS nhat: x: " & pt2(0) & " " & "y: " & pt2(1) & " " & "z: " & pt2(2))
'                'lw.WriteLine("khoang cach nho nhat: " & minDist.ToString)
'                Dim Minpoint As Point3d  'Diem gan voi CS nhat tren Body
'                Dim ptObj2 As NXOpen.Point
'                Minpoint = New Point3d(pt2(0), pt2(1), pt2(2))
'                ptObj2 = workPart.Points.CreatePoint(Minpoint)

'                '''''Tim Face cua Body chứa điểm gần với CS nhất 
'                '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'                Dim iface As NXOpen.Face
'                Dim iMinface As NXOpen.Face

'                'mat gan voi Cs nhat
'                Dim iMin As Double      'khoi tao gia tri khoang cach nho nhat, de tim mat gan voi CS nhat
'                Dim ObjectFaceTag As Long
'                iMin = 1

'                Dim faces1(0) As NXOpen.Face
'                For Each iface In iOffsetFace 'body1.GetFaces
'                    theUFSession.Modl.AskMinimumDist(ptObj2.Tag, iface.Tag, 0, guess1, 0, guess2, minDist, pt1, pt2)
'                    If minDist < iMin Then
'                        'If iMinface.ToString <> iface.ToString Then
'                        iMin = minDist
'                        iMinface = iface
'                        icheck1 = iMinface.Tag.ToString

'                    End If
'                Next






'                If icheck1 <> icheck2 Then
'                    'End If


'                    If iOffcetComplete.Contains(iMinface.Tag) = False Then
'                        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'                        theSession.Parts.SetWorkComponent(theComponent, NXOpen.PartCollection.RefsetOption.Entire, NXOpen.PartCollection.WorkComponentOption.Visible, partLoadStatus1)
'                        workPart = theSession.Parts.Work
'                        Dim nullNXOpen_Features_Feature As NXOpen.Features.Feature = Nothing
'                        Dim thickenBuilder1 As NXOpen.Features.ThickenBuilder = Nothing

'                        thickenBuilder1 = workPart.Features.CreateThickenBuilder(nullNXOpen_Features_Feature)
'                        thickenBuilder1.Tolerance = 0.01
'                        thickenBuilder1.FirstOffset.RightHandSide = i
'                        thickenBuilder1.SecondOffset.RightHandSide = "0"
'                        thickenBuilder1.BooleanOperation.Type = NXOpen.GeometricUtilities.BooleanOperation.BooleanType.Create

'                        faces1(0) = iMinface
'                        Dim faceDumbRule1 As NXOpen.FaceDumbRule = Nothing
'                        faceDumbRule1 = workPart.ScRuleFactory.CreateRuleFaceDumb(faces1)

'                        Dim rules1(0) As NXOpen.SelectionIntentRule
'                        rules1(0) = faceDumbRule1
'                        thickenBuilder1.FaceCollector.ReplaceRules(rules1, False)
'                        If CoverZ = False Then
'                            thickenBuilder1.ReverseDirection = True
'                        End If
'                        Dim nXObject1 As NXOpen.NXObject = Nothing
'                        nXObject1 = thickenBuilder1.Commit()
'                        thickenBuilder1.Destroy()
'                        theSession.CleanUpFacetedFacesAndEdges()
'                        icheck2 = iMinface.Tag.ToString



'                        Dim removeParametersBuilder1 As NXOpen.Features.RemoveParametersBuilder = Nothing
'                        removeParametersBuilder1 = workPart.Features.CreateRemoveParametersBuilder()

'                        Dim body2 As NXOpen.Body = CType(workPart.Bodies.FindObject(nXObject1.JournalIdentifier.ToString), NXOpen.Body)
'                        Dim added1 As Boolean = Nothing
'                        added1 = removeParametersBuilder1.Objects.Add(body2)
'                        Dim nXObject2 As NXOpen.NXObject = Nothing
'                        nXObject2 = removeParametersBuilder1.Commit()
'                        iOffcetComplete.Add(iMinface.Tag)
'                    Else

'                    End If





'                End If
'            End If
'        Next
'        'lw.WriteLine("Part Tao do day tung face: " & iPartNo & " : " & inamepart)

'        For Each iBody As Body In bodies
'            If iBody.IsSheetBody Then
'                theUFSession.Obj.DeleteObject(iBody.Tag)

'            End If


'        Next

'    End Sub

'    Sub C007_ThicknessBodyFace(ByVal ithickness As String, ByVal theComponent As Assemblies.Component, ByVal CoverZ As Boolean, ByVal inamepart As String, ByVal iPartNo As String)
'        Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work
'        Dim Object1Tag As Long
'        Dim Object2Tag As Long
'        Dim Object3Tag As Long
'        Dim bodies As BodyCollection = workPart.Bodies
'        Dim sheetBodies(-1) As Body
'        Dim counter As Integer = 0
'        Dim bodyCount As Integer = bodies.ToArray.Length

'        'lw.WriteLine("All Bodies in Work Part: " & bodyCount.ToString())
'        Dim body1 As NXOpen.Body
'        If bodyCount > 0 Then
'            For Each thisBody As Body In bodies
'                If thisBody.IsSheetBody.Equals(True) Then
'                    If thisBody.IsBlanked.Equals(False) Then
'                        body1 = thisBody
'                        Object2Tag = body1.Tag
'                    End If
'                End If
'            Next
'        End If

'        Dim displayPart As Part = theSession.Parts.Display
'        Dim cp1(2) As Double
'        Dim partFeature As Features.Feature
'        Dim iXx As Double
'        Dim iYy As Double
'        Dim iZz As Double
'        Dim iminDist As Double
'        '''Tim Diem goc cua CS va tim BOdy de Tim Diem tren Body gan voi CS nhat
'        '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'        Dim iSelCoor As NXOpen.CartesianCoordinateSystem
'        Dim CsPoint As Point3d  'Diem goc CS
'        Dim ptObj1 As NXOpen.Point
'        Dim iminD As Double = 9.1
'        Dim iZCS(2) As Double 'huong Z cua CS
'        For Each iSelCoor In theSession.Parts.Work.CoordinateSystems
'            If iSelCoor.Origin.X <> 0 Or iSelCoor.Origin.Y <> 0 Or iSelCoor.Origin.Z <> 0 Then
'                Dim iMatrix As Matrix3x3 = iSelCoor.Orientation.Element
'                CsPoint = New Point3d(iSelCoor.Origin.X, iSelCoor.Origin.Y, iSelCoor.Origin.Z)
'                ptObj1 = workPart.Points.CreatePoint(CsPoint)

'                Object1Tag = ptObj1.Tag

'                Dim solidbody As Body
'                For Each thisBody1 As Body In bodies
'                    If thisBody1.IsSolidBody.Equals(True) Then
'                        If thisBody1.IsBlanked.Equals(False) Then
'                            solidbody = thisBody1
'                            Object3Tag = solidbody.Tag
'                        End If
'                        Dim guess1(2) As Double
'                        Dim guess2(2) As Double
'                        Dim pt1(2) As Double
'                        Dim pt2(2) As Double
'                        Dim minDist As Double
'                        theUFSession.Modl.AskMinimumDist(Object1Tag, Object3Tag, 0, guess1, 0, guess2, minDist, pt1, pt2)
'                        'lw.WriteLine("Diem gan CS nhat: x: " & pt2(0) & " " & "y: " & pt2(1) & " " & "z: " & pt2(2))
'                        'lw.WriteLine(minDist)
'                        ' pt2 la Diem tren Body gan voi CS nhat ung voi object2tag
'                        iminD = minDist
'                        If minDist <= 9 Then

'                            Exit For

'                        End If

'                    End If
'                Next

'                If iminD > 9 Then
'                    Dim guess1(2) As Double
'                    Dim guess2(2) As Double
'                    Dim pt1(2) As Double
'                    Dim pt2(2) As Double
'                    Dim minDist As Double
'                    theUFSession.Modl.AskMinimumDist(Object1Tag, Object2Tag, 0, guess1, 0, guess2, minDist, pt1, pt2)   ' pt2 la Diem tren Body gan voi CS nhat ung voi object2tag
'                    'lw.WriteLine("Diem gan CS nhat: x: " & pt2(0) & " " & "y: " & pt2(1) & " " & "z: " & pt2(2))
'                    'lw.WriteLine("khoang cach nho nhat: " & minDist.ToString)
'                    Dim Minpoint As Point3d  'Diem gan voi CS nhat tren Body
'                    Dim ptObj2 As NXOpen.Point
'                    Minpoint = New Point3d(pt2(0), pt2(1), pt2(2))
'                    ptObj2 = workPart.Points.CreatePoint(Minpoint)

'                    '''''Tim Face cua Body chứa điểm gần với CS nhất 
'                    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'                    Dim iface As NXOpen.Face
'                    Dim iMinface As NXOpen.Face
'                    Dim ifacecheck As NXOpen.Face
'                    'mat gan voi Cs nhat
'                    Dim iMin As Double      'khoi tao gia tri khoang cach nho nhat, de tim mat gan voi CS nhat
'                    Dim ObjectFaceTag As Long
'                    iMin = 1


'                    Dim faces1(0) As NXOpen.Face
'                    For Each iface In body1.GetFaces
'                        theUFSession.Modl.AskMinimumDist(ptObj2.Tag, iface.Tag, 0, guess1, 0, guess2, minDist, pt1, pt2)
'                        If minDist < iMin Then
'                            'If iMinface.ToString <> iface.ToString Then
'                            iMin = minDist
'                            iMinface = iface
'                        End If
'                    Next
'                    Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'                    theSession.Parts.SetWorkComponent(theComponent, NXOpen.PartCollection.RefsetOption.Entire, NXOpen.PartCollection.WorkComponentOption.Visible, partLoadStatus1)
'                    workPart = theSession.Parts.Work
'                    Dim nullNXOpen_Features_Feature As NXOpen.Features.Feature = Nothing
'                    Dim thickenBuilder1 As NXOpen.Features.ThickenBuilder = Nothing

'                    thickenBuilder1 = workPart.Features.CreateThickenBuilder(nullNXOpen_Features_Feature)
'                    thickenBuilder1.Tolerance = 0.01
'                    thickenBuilder1.FirstOffset.RightHandSide = ithickness
'                    thickenBuilder1.SecondOffset.RightHandSide = "0"
'                    thickenBuilder1.BooleanOperation.Type = NXOpen.GeometricUtilities.BooleanOperation.BooleanType.Create

'                    faces1(0) = iMinface
'                    'Dim faceDumbRule1 As NXOpen.FaceDumbRule = Nothing
'                    'faceDumbRule1 = workPart.ScRuleFactory.CreateRuleFaceDumb(faces1)

'                    Dim boundaryFaces1(-1) As NXOpen.Face
'                    Dim faceTangentRule1 As NXOpen.FaceTangentRule = Nothing
'                    faceTangentRule1 = workPart.ScRuleFactory.CreateRuleFaceTangent(iMinface, boundaryFaces1, 0.5)

'                    Dim rules1(0) As NXOpen.SelectionIntentRule
'                    rules1(0) = faceTangentRule1
'                    thickenBuilder1.FaceCollector.ReplaceRules(rules1, False)
'                    If CoverZ = False Then
'                        thickenBuilder1.ReverseDirection = True
'                    End If
'                    Dim nXObject1 As NXOpen.NXObject = Nothing
'                    nXObject1 = thickenBuilder1.Commit()
'                    thickenBuilder1.Destroy()
'                    theSession.CleanUpFacetedFacesAndEdges()


'                    Dim removeParametersBuilder1 As NXOpen.Features.RemoveParametersBuilder = Nothing
'                    removeParametersBuilder1 = workPart.Features.CreateRemoveParametersBuilder()

'                    Dim body2 As NXOpen.Body = CType(workPart.Bodies.FindObject(nXObject1.JournalIdentifier.ToString), NXOpen.Body)
'                    Dim added1 As Boolean = Nothing
'                    added1 = removeParametersBuilder1.Objects.Add(body2)
'                    Dim nXObject2 As NXOpen.NXObject = Nothing
'                    nXObject2 = removeParametersBuilder1.Commit()

'                    'Exit For
'                End If
'            End If
'            'Exit For
'        Next
'        For Each iBody As Body In bodies
'            If iBody.IsSheetBody Then
'                theUFSession.Obj.DeleteObject(iBody.Tag)
'            End If
'        Next
'        'lw.WriteLine("Part Tao duoc do day : " & iPartNo & " : " & inamepart & "   T " & ithickness)

'    End Sub

'    Function C007_iAngleMesure(ByVal X1 As Double, Y1 As Double, Z1 As Double, X2 As Double, Y2 As Double, Z2 As Double) As Double
'        C007_iAngleMesure = (X1 * X2 + Y1 * Y2 + Z1 * Z2) / (Math.Sqrt(X1 ^ 2 + Y1 ^ 2 + Z1 ^ 2) * Math.Sqrt(X2 ^ 2 + Y2 ^ 2 + Z2 ^ 2))
'        'lw.WriteLine(Math.Abs(C007_iAngleMesure))
'    End Function

'    Sub CopyThickPart(ByVal comp As Component, ByVal dtthick As DataTable)
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        Dim theSession As Session = Session.GetSession
'        Dim workPart As Part = theSession.Parts.Work
'        For Each Child As Component In comp.GetChildren

'            Try
'                If Child.GetStringAttribute("PART_THICKNESS").ToString <> "" Then
'                    Dim part1 As Part
'                    Dim childNo As String = Child.GetStringAttribute("DB_PART_NO").ToString() & "/" & Child.GetStringAttribute("DB_PART_REV").ToString()
'                    part1 = CType(theSession.Parts.FindObject("@DB/" & childNo), Part)
'                    Dim position As Point3d
'                    Dim matrix As Matrix3x3

'                    Child.GetPosition(position, matrix)
'                    orientation1.Xx = matrix.Xx
'                    orientation1.Xy = matrix.Xy
'                    orientation1.Xz = matrix.Xz
'                    orientation1.Yx = matrix.Yx
'                    orientation1.Yy = matrix.Yy
'                    orientation1.Yz = matrix.Yz
'                    orientation1.Zx = matrix.Zx
'                    orientation1.Zy = matrix.Zy
'                    orientation1.Zz = matrix.Zz

'                    Dim component1 As Component
'                    component1 = workPart.ComponentAssembly.AddComponent(part1, "None", "", position, matrix, -1, partLoadStatus1)

'                    partLoadStatus1.Dispose()

'                Else
'                    '''Part Sheetbody khoong co do day o property dua ra excel warring

'                    Try
'                        Dim inamePart = Child.GetStringAttribute("DB_PART_NAME")
'                        Dim iPartNo = Child.GetStringAttribute("DB_PART_NO")
'                        If InStr(inamePart.ToUpper, "BOLT") > 0 Or InStr(inamePart.ToUpper, "STUD-BALL") > 0 Or InStr(inamePart.ToUpper, "NUT") > 0 Or InStr(inamePart.ToUpper, "CLIP") > 0 _
'                            Or InStr(inamePart.ToUpper, "SCR") > 0 Or InStr(inamePart.ToUpper, "SCREW") > 0 Or InStr(inamePart.ToUpper, "PIN") > 0 Or InStr(inamePart.ToUpper, "RIVET") > 0 _
'                                Or InStr(inamePart.ToUpper, "GROM") > 0 Or InStr(inamePart.ToUpper, "PLUG") > 0 Then
'                        Else
'                            Dim compPart1 As Part = CType(Child.Prototype, Part)
'                            Dim obj As NXOpen.TaggedObject = NXOpen.Utilities.NXObjectManager.Get(AskAllBodies(compPart1))
'                            Dim mybody
'                            Try
'                                mybody = CType(obj, NXOpen.Body)
'                                If mybody.IsSolidBody.Equals(True) Then
'                                    If mybody.IsBlanked.Equals(False) Then
'                                    End If
'                                Else
'                                    If mybody.IsBlanked.Equals(False) Then
'                                        'lw.WriteLine("Body: SOLID " & Child.GetStringAttribute("DB_PART_NO").ToString)
'                                        Dim iFunc As String
'                                        Call iSearchFuncNo(Child, iFunc)
'                                        Call InsertThickWaringToExcel(iFunc, inamePart, iPartNo, "SheetBody", "無", "PartThick無", dtthick)
'                                    End If

'                                End If
'                            Catch ex As Exception
'                            End Try
'                        End If

'                    Catch ex As Exception

'                    End Try

'                End If
'            Catch ex As Exception

'            End Try
'            Call CopyThickPart(Child, dtthick)
'        Next

'    End Sub

'    Sub InsertThickWaringToExcel(ByVal FuncNo As String, ByVal PartName As String, ByVal PartNo As String, ByVal type As String, ByVal Thick As String,
'                               ByVal Comment As String, ByVal dtThick As DataTable)
'        Dim row As DataRow = dtThick.NewRow
'        row("Function No") = FuncNo
'        row("Part Name") = PartName
'        row("Part No") = PartNo
'        row("Type") = type
'        row("Thickness") = Thick
'        row("Comment") = Comment


'        dtThick.Rows.Add(row)
'        dtThick.AcceptChanges()

'    End Sub

'    ''''''締結_位置検知

'    Sub InforCsHole(ByVal dtGroupOut As DataTable)
'        Dim theSession As Session = Session.GetSession()
'        Dim workpart As Part = theSession.Parts.Work
'        Dim iRootNo As String = workpart.FullPath.ToString
'        Dim objWorksheetIn = objWorkbook.worksheets("Input")
'        Dim i As Integer
'        Dim InFunction As String

'        For i = 4 To 10000
'            If objWsTool.cells(i, "D").value = "" Then Exit Sub

'            If objWsTool.cells(i, "C").value = "A_車体" Then
'                InFunction = objWsTool.cells(i, "D").value

'                'lw.WriteLine("InFunction: " & InFunction)
'                Call OpenPart(InFunction)

'                theUFSession.Ui.SetPrompt("Get Infor of Function: " & InFunction)
'                Call FitView()
'                Dim dispPart As Part = theSession.Parts.Display
'                Dim visibleObjects() As DisplayableObject

'                Try
'                    visibleObjects = workpart.Views.WorkView.AskVisibleObjects()
'                Catch ex As Exception
'                    visibleObjects = dispPart.Views.WorkView.AskVisibleObjects()
'                End Try

'                Try
'                    Dim iSheetBodyOwnningPartTag As New List(Of String)
'                    Dim iSolidBodyOwnningPartTag As New List(Of String)
'                    Dim DuplicateCsysList As New List(Of String)

'                    For Each displayableObject As DisplayableObject In visibleObjects
'                        Try
'                            Dim tmp = displayableObject.OwningComponent.GetStringAttribute("DB_PART_NO").ToString
'                        Catch ex As Exception
'                            'Exit For
'                        End Try
'                        If TypeOf displayableObject Is CartesianCoordinateSystem Then
'                            Dim iCsys As CartesianCoordinateSystem
'                            iCsys = CType(displayableObject, CartesianCoordinateSystem)
'                            Call InsertCsysToDataTable(iCsys, DuplicateCsysList, dtGroupOut)
'                        ElseIf TypeOf (displayableObject) Is Body Then
'                            iBody = CType(displayableObject, Body)
'                            OwningComp = CType(iBody.OwningComponent, Component)
'                            If iBody.IsSheetBody Then
'                                Try
'                                    iCheckTrans = CheckCompTrans(iBody.OwningComponent)
'                                    iBody.OwningComponent.GetPosition(position, matrix)
'                                    Call InsertHoleToDataTable(iBody, iSheetBodyOwnningPartTag, dtGroupOut)
'                                Catch ex As Exception

'                                End Try

'                            ElseIf iBody.IsSolidBody Then
'                                Try
'                                    Dim tmpName As String = iBody.OwningComponent.GetStringAttribute("DB_PART_NAME").ToString.ToUpper
'                                    If InStr(tmpName, "BOLT") > 0 Or InStr(tmpName, "NUT") > 0 Or InStr(tmpName, "CLIP") > 0 Or InStr(tmpName, "SCREW") > 0 Or InStr(tmpName, "SCR") > 0 Or InStr(tmpName, "GROM") > 0 _
'                                        Or InStr(tmpName, "RIVET") > 0 Or InStr(tmpName, "PLUG") > 0 Or InStr(tmpName, "PIN") > 0 Then
'                                        Call InsertCenterOfGarivtyToDataTable(iBody, dtGroupOut)
'                                    End If
'                                Catch ex As Exception

'                                End Try
'                            End If
'                        End If
'                    Next

'                    Dim iEndDate As Date = Now


'                    objWsTool.cells(i, "J").value = Now.ToString

'                    'iRows("時間") = iEndDate & " - " & iStDate
'                    'Call iPrintDtFuncInToExcel(dtFunctionIn)
'                    Call iPrintPositionToExcel(dtGroupOut)
'                Catch ex As Exception
'                    lw.WriteLine("Loi 4")
'                    lw.WriteLine(ex.ToString)
'                End Try
'            End If
'        Next
'    End Sub

'    Sub CreateCsysGroup(ByVal dtGroupIn As DataTable, ByRef dtOut As DataTable)
'        '''Xóa tọa độ 0,0,0
'        For k As Integer = dtGroupIn.Rows.Count - 1 To 0 Step -1
'            Dim irow As DataRow = dtGroupIn.Rows.Item(k)
'            If irow("Origin X") = 0 And irow("Origin Y") = 0 And irow("Origin Z") = 0 Then
'                dtGroupIn.Rows.Remove(irow)
'            ElseIf Math.Round(irow("Origin X"), 0) = 0 And Math.Round(irow("Origin Z"), 0) = 0 Then
'                If irow("Type").ToString = "Csys" Then
'                    Dim iXx As Double = CType(Split(irow("Csys DirX"), ",")(0), Double)
'                    Dim iXy As Double = CType(Split(irow("Csys DirX"), ",")(1), Double)
'                    Dim iXz As Double = CType(Split(irow("Csys DirX"), ",")(2), Double)
'                    Dim iYx As Double = CType(Split(irow("Csys DirY"), ",")(0), Double)
'                    Dim iYy As Double = CType(Split(irow("Csys DirY"), ",")(1), Double)
'                    Dim iYz As Double = CType(Split(irow("Csys DirY"), ",")(2), Double)
'                    Dim iZx As Double = CType(Split(irow("Csys DirZ"), ",")(0), Double)
'                    Dim iZy As Double = CType(Split(irow("Csys DirZ"), ",")(1), Double)
'                    Dim iZz As Double = CType(Split(irow("Csys DirZ"), ",")(2), Double)
'                    If iXx = 1 And iXy = 0 And iXz = 0 And iYx = 0 And iYy = 1 And iYz = 0 And iZx = 0 And iZy = 0 And iZz = 1 Then
'                        dtGroupIn.Rows.Remove(irow)
'                    End If
'                End If

'            End If
'        Next
'        dtGroupIn.AcceptChanges()
'        dtGroupIn.DefaultView.Sort = "Origin X"
'        Dim dtResult As DataTable = dtGroupIn.DefaultView.ToTable()
'        dtResult.AcceptChanges()

'        '''xóa trùng tọa độ Csys

'        For iRowDelete As Integer = dtResult.Rows.Count - 1 To 1 Step -1
'            Dim irow As DataRow = dtResult.Rows.Item(iRowDelete)
'            Dim irowAf As DataRow = dtResult.Rows.Item(iRowDelete - 1)
'            If irowAf("Origin X") = irow("Origin X") And irowAf("Origin Y") = irow("Origin Y") And irowAf("Origin Z") = irow("Origin Z") And irowAf("TagPart") = irow("TagPart") _
'                And irow("Type") = "Csys" And irowAf("Type") = "Csys" And irowAf("Type") = irow("Type") Then
'                dtResult.Rows.Remove(irow)
'            End If
'        Next
'        dtResult.AcceptChanges()
'        '''tìm những tạo độ lỗ gần với Cs, gán tag Cs vào lỗ
'        For Each drCs As DataRow In dtResult.Rows
'            If drCs("Type").ToString = "Sheet Body" Then
'                For Each drCs2 As DataRow In dtResult.Rows
'                    If drCs2("Type").ToString = "Csys" And drCs("TagPart").ToString = drCs2("TagPart").ToString Then
'                        Dim iPtHole As Point3d = New Point3d(drCs("Origin X"), drCs("Origin Y"), drCs("Origin Z"))
'                        Dim iPtCsys As Point3d = New Point3d(drCs2("Origin X"), drCs2("Origin Y"), drCs2("Origin Z"))
'                        Dim iVectorX As Vector3d = New Vector3d(Split(drCs2("Csys DirX"), ",")(0), Split(drCs2("Csys DirX"), ",")(1), Split(drCs2("Csys DirX"), ",")(2))
'                        Dim iVectorY As Vector3d = New Vector3d(Split(drCs2("Csys DirY"), ",")(0), Split(drCs2("Csys DirY"), ",")(1), Split(drCs2("Csys DirY"), ",")(2))
'                        Dim iVectorZ As Vector3d = New Vector3d(Split(drCs2("Csys DirZ"), ",")(0), Split(drCs2("Csys DirZ"), ",")(1), Split(drCs2("Csys DirZ"), ",")(2))
'                        Dim iDirX As Double = DistanceBetweenPointandVector(iPtHole, iPtCsys, iVectorX)
'                        Dim iDirY As Double = DistanceBetweenPointandVector(iPtHole, iPtCsys, iVectorY)
'                        Dim iDirZ As Double = DistanceBetweenPointandVector(iPtHole, iPtCsys, iVectorZ)
'                        If iDirX < 8 And iDirY < 8 And iDirZ < 8 Then
'                            drCs("Csys DirX") = drCs2("Csys DirX")
'                            drCs("Csys DirY") = drCs2("Csys DirY")
'                            drCs("Csys DirZ") = drCs2("Csys DirZ")
'                            drCs("TagCsys") = drCs2("TagCsys")
'                            Exit For
'                        End If
'                    End If
'                Next
'            End If
'        Next
'        dtResult.AcceptChanges()

'        Dim iGroupCheck As Integer = 1
'        Dim iGroup As Integer = 1
'        Dim iCheck As Boolean
'        Dim iLRow As Integer = dtResult.Rows.Count - 1
'        Dim idist As Double
'        Dim idist2 As Double
'        Dim intLower As Integer
'        Dim intUpper As Integer
'        Dim intMiddle As Integer
'        Dim iTempcheck As Integer
'        Dim iCheckNear As Boolean
'        '''sắp xếp tọa độ X
'        ''' Nhóm Group theo những tọa độ trùng nhau
'        Dim igroupCheckList As New List(Of String)
'        For ii As Integer = 0 To iLRow
'            intLower = ii
'            intUpper = iLRow
'            Do While intUpper > intLower
'                intMiddle = (intUpper + intLower) \ 2
'                If (dtResult.Rows(intUpper).Item("Origin X") - dtResult.Rows(intLower).Item("Origin X")) < 11 Then
'                    intLower = intMiddle + 1
'                Else
'                    intUpper = intMiddle
'                End If
'            Loop
'            iTempcheck = intUpper + 1
'            If iTempcheck > iLRow Then
'                iTempcheck = iLRow
'            End If
'            If dtResult.Rows(iTempcheck).Item("Origin X") - dtResult.Rows(intUpper).Item("Origin X") < 11 Then
'                For iii As Integer = iTempcheck To iLRow
'                    If dtResult.Rows(iii).Item("Origin X") - dtResult.Rows(iii - 1).Item("Origin X") < 11 Then
'                        intLower = iii
'                        Dim iiiCheck As Integer = iii + 1
'                        If iiiCheck > iLRow Then
'                            iiiCheck = iLRow
'                        End If
'                        If dtResult.Rows(iiiCheck).Item("Origin X") - dtResult.Rows(iii).Item("Origin X") > 11 Then
'                            Exit For
'                        End If
'                    End If
'                Next
'            End If

'            For j As Integer = ii To intLower
'                If dtResult.Rows(j).Item("Group") = "0" Then
'                    Dim igroupList As New List(Of String)
'                    Dim ibatdau(100000) As Integer
'                    Dim icheckHole As Boolean = False
'                    Dim itg As Integer = 0
'                    Dim jX As Double = dtResult.Rows(j).Item("Origin X")
'                    Dim jY As Double = dtResult.Rows(j).Item("Origin Y")
'                    Dim jZ As Double = dtResult.Rows(j).Item("Origin Z")

'                    For jj As Integer = ii To intLower
'                        If dtResult.Rows(jj).Item("Group") = "0" Then
'                            Dim jiX As Double = dtResult.Rows(jj).Item("Origin X")
'                            Dim jiY As Double = dtResult.Rows(jj).Item("Origin Y")
'                            Dim jiZ As Double = dtResult.Rows(jj).Item("Origin Z")

'                            Call DistMath(jX, jY, jZ, jiX, jiY, jiZ, idist, iCheckNear)
'                            If idist < 16 And dtResult.Rows(jj).Item("Group") = "0" And iCheckNear = True Then
'                                dtResult.Rows(jj).Item("Group") = iGroup
'                                If dtResult.Rows(jj).Item("Hole Shape") = "" Then

'                                    If InStr(dtResult.Rows(jj).Item("Part Name").ToString.ToUpper, "BOLT") > 0 _
'                                        Or InStr(dtResult.Rows(jj).Item("Part Name").ToString.ToUpper, "NUT") > 0 _
'                                        Or InStr(dtResult.Rows(jj).Item("Part Name").ToString.ToUpper, "CLIP") > 0 _
'                                        Or InStr(dtResult.Rows(jj).Item("Part Name").ToString.ToUpper, "SCREW") > 0 _
'                                            Or InStr(dtResult.Rows(jj).Item("Part Name").ToString.ToUpper, "SCR") > 0 _
'                                            Or InStr(dtResult.Rows(jj).Item("Part Name").ToString.ToUpper, "RIVET") > 0 _
'                                                Or InStr(dtResult.Rows(jj).Item("Part Name").ToString.ToUpper, "GROM") > 0 _
'                                                Or InStr(dtResult.Rows(jj).Item("Part Name").ToString.ToUpper, "PLUG") > 0 _
'                                                    Or InStr(dtResult.Rows(jj).Item("Part Name").ToString.ToUpper, "PIN") > 0 Then
'                                        If dtResult.Rows(jj).Item("Type").ToString = "Solid Body" Then
'                                            icheckHole = True
'                                        End If
'                                    End If
'                                Else
'                                    icheckHole = True
'                                End If
'                                igroupList.Add(iGroup)
'                                ibatdau(itg) = jj
'                                itg = itg + 1
'                                iCheck = True
'                                idist = 12
'                                idist2 = 12
'                                iCheckNear = False
'                            End If
'                        End If
'                    Next
'                    If iCheck = True And igroupList.Count > 1 And icheckHole = True Then
'                        Dim jgr As Integer = 0
'                        itg = 0
'                        igroupCheckList.Add(iGroup)
'                        iGroup += 1
'                        icheckHole = False
'                    ElseIf iCheck = True Then
'                        For ixoa As Integer = 0 To itg - 1
'                            dtResult.Rows(ibatdau(ixoa)).Item("Group") = -1
'                        Next
'                        itg = 0
'                    End If
'                    iCheck = False
'                End If
'            Next

'        Next
'        ''' Xóa Cs không gần body
'        For idel As Integer = dtResult.Rows.Count - 1 To 0 Step -1
'            Dim irow As DataRow = dtResult.Rows.Item(idel)
'            If irow("Group") = -1 Then
'                dtResult.Rows.Remove(irow)
'            End If
'        Next
'        dtResult.AcceptChanges()
'        '''sắp xếp Group từ nhỏ đến lớn
'        dtResult.DefaultView.Sort = "Group"
'        Dim dtGroup As DataTable = dtResult.DefaultView.ToTable()
'        dtGroup.AcceptChanges()
'        iLRow = dtGroup.Rows.Count - 1
'        ''''tim vi tri lo cung part bi nhom sai
'        Dim idisttrung1 As Double
'        Dim idisttrung2 As Double
'        For Each iGroupCheck In igroupCheckList
'            For itrung As Integer = 0 To iLRow
'                If dtGroup.Rows(itrung).Item("Group") = iGroupCheck And dtGroup.Rows(itrung).Item("Type").ToString = "Sheet Body" Then
'                    For itrung2 As Integer = itrung + 1 To iLRow
'                        If dtGroup.Rows(itrung).Item("TagPart").ToString = dtGroup.Rows(itrung2).Item("TagPart").ToString _
'                                And dtGroup.Rows(itrung).Item("SheetBodyTag").ToString = dtGroup.Rows(itrung2).Item("SheetBodyTag").ToString _
'                                    And dtGroup.Rows(itrung2).Item("Group") = iGroupCheck And dtGroup.Rows(itrung2).Item("Type").ToString = "Sheet Body" Then
'                            For itrung3 As Integer = 0 To iLRow
'                                If dtGroup.Rows(itrung3).Item("Group") = iGroupCheck Then
'                                    If dtGroup.Rows(itrung3).Item("Type").ToString = "Csys" Then
'                                        Try
'                                            Dim itrung3X As Double = dtGroup.Rows(itrung3).Item("Origin X")
'                                            Dim itrung3Y As Double = dtGroup.Rows(itrung3).Item("Origin Y")
'                                            Dim itrung3Z As Double = dtGroup.Rows(itrung3).Item("Origin Z")
'                                            Dim itrung2X As Double = dtGroup.Rows(itrung2).Item("Origin X")
'                                            Dim itrung2Y As Double = dtGroup.Rows(itrung2).Item("Origin Y")
'                                            Dim itrung2Z As Double = dtGroup.Rows(itrung2).Item("Origin Z")
'                                            Dim itrungX As Double = dtGroup.Rows(itrung).Item("Origin X")
'                                            Dim itrungY As Double = dtGroup.Rows(itrung).Item("Origin Y")
'                                            Dim itrungZ As Double = dtGroup.Rows(itrung).Item("Origin Z")
'                                            Dim iPtHole As Point3d = New Point3d(itrungX, itrungY, itrungZ)
'                                            Dim iPtHole2 As Point3d = New Point3d(itrung2X, itrung2Y, itrung2Z)
'                                            Dim iPtCsys As Point3d = New Point3d(itrung3X, itrung3Y, itrung3Z)
'                                            Dim iVectorX As Vector3d = New Vector3d(CType(Split(dtResult.Rows(itrung3).Item("Csys DirX"), ",")(0), Double), CType(Split(dtResult.Rows(itrung3).Item("Csys DirX"), ",")(1), Double), CType(Split(dtResult.Rows(itrung3).Item("Csys DirX"), ",")(2), Double))
'                                            Dim iVectorY As Vector3d = New Vector3d(CType(Split(dtResult.Rows(itrung3).Item("Csys DirY"), ",")(0), Double), CType(Split(dtResult.Rows(itrung3).Item("Csys DirY"), ",")(1), Double), CType(Split(dtResult.Rows(itrung3).Item("Csys DirY"), ",")(2), Double))
'                                            Dim iVectorZ As Vector3d = New Vector3d(CType(Split(dtResult.Rows(itrung3).Item("Csys DirZ"), ",")(0), Double), CType(Split(dtResult.Rows(itrung3).Item("Csys DirZ"), ",")(1), Double), CType(Split(dtResult.Rows(itrung3).Item("Csys DirZ"), ",")(2), Double))

'                                            Dim iDirX As Double = DistanceBetweenPointandVector(iPtHole, iPtCsys, iVectorX)
'                                            Dim iDirY As Double = DistanceBetweenPointandVector(iPtHole, iPtCsys, iVectorY)
'                                            Dim iDirZ As Double = DistanceBetweenPointandVector(iPtHole, iPtCsys, iVectorZ)
'                                            Dim iDir2X As Double = DistanceBetweenPointandVector(iPtHole2, iPtCsys, iVectorX)
'                                            Dim iDir2Y As Double = DistanceBetweenPointandVector(iPtHole2, iPtCsys, iVectorY)
'                                            Dim iDir2Z As Double = DistanceBetweenPointandVector(iPtHole2, iPtCsys, iVectorZ)

'                                            If iDirX < 8 And iDirY < 8 And iDirZ < 8 And dtGroup.Rows(itrung).Item("TagPart").ToString = dtGroup.Rows(itrung3).Item("TagPart").ToString Then
'                                                dtGroup.Rows(itrung).Item("Group") = iGroup
'                                                dtGroup.Rows(itrung3).Item("Group") = iGroup
'                                                iGroup += 1
'                                                Exit For
'                                            ElseIf iDir2X < 8 And iDir2Y < 8 And iDir2Z < 8 And dtGroup.Rows(itrung2).Item("TagPart").ToString = dtGroup.Rows(itrung3).Item("TagPart").ToString Then
'                                                dtGroup.Rows(itrung2).Item("Group") = iGroup
'                                                dtGroup.Rows(itrung3).Item("Group") = iGroup
'                                                iGroup += 1
'                                                Exit For
'                                            End If
'                                        Catch ex As Exception
'                                            Try
'                                                Dim itrung3X As Double = dtGroup.Rows(itrung3).Item("Origin X")
'                                                Dim itrung3Y As Double = dtGroup.Rows(itrung3).Item("Origin Y")
'                                                Dim itrung3Z As Double = dtGroup.Rows(itrung3).Item("Origin Z")
'                                                Dim itrung2X As Double = dtGroup.Rows(itrung2).Item("Origin X")
'                                                Dim itrung2Y As Double = dtGroup.Rows(itrung2).Item("Origin Y")
'                                                Dim itrung2Z As Double = dtGroup.Rows(itrung2).Item("Origin Z")
'                                                Dim itrungX As Double = dtGroup.Rows(itrung).Item("Origin X")
'                                                Dim itrungY As Double = dtGroup.Rows(itrung).Item("Origin Y")
'                                                Dim itrungZ As Double = dtGroup.Rows(itrung).Item("Origin Z")
'                                                Dim iPtHole As Point3d = New Point3d(itrungX, itrungY, itrungZ)
'                                                Dim iPtHole2 As Point3d = New Point3d(itrung2X, itrung2Y, itrung2Z)
'                                                Dim iPtCsys As Point3d = New Point3d(itrung3X, itrung3Y, itrung3Z)
'                                                Dim iVectorX As Vector3d = New Vector3d(CType(Split(dtResult.Rows(itrung2).Item("Csys DirX").ToString, ",")(0), Double), CType(Split(dtResult.Rows(itrung2).Item("Csys DirX").ToString, ",")(1), Double), CType(Split(dtResult.Rows(itrung2).Item("Csys DirX").ToString, ",")(2), Double))
'                                                Dim iVectorY As Vector3d = New Vector3d(CType(Split(dtResult.Rows(itrung2).Item("Csys DirY").ToString, ",")(0), Double), CType(Split(dtResult.Rows(itrung2).Item("Csys DirY").ToString, ",")(1), Double), CType(Split(dtResult.Rows(itrung2).Item("Csys DirY").ToString, ",")(2), Double))
'                                                Dim iVectorZ As Vector3d = New Vector3d(CType(Split(dtResult.Rows(itrung2).Item("Csys DirZ").ToString, ",")(0), Double), CType(Split(dtResult.Rows(itrung2).Item("Csys DirZ").ToString, ",")(1), Double), CType(Split(dtResult.Rows(itrung2).Item("Csys DirZ").ToString, ",")(2), Double))

'                                                Dim iDirX As Double = DistanceBetweenPointandVector(iPtHole, iPtCsys, iVectorX)
'                                                Dim iDirY As Double = DistanceBetweenPointandVector(iPtHole, iPtCsys, iVectorY)
'                                                Dim iDirZ As Double = DistanceBetweenPointandVector(iPtHole, iPtCsys, iVectorZ)
'                                                Dim iDir2X As Double = DistanceBetweenPointandVector(iPtHole2, iPtCsys, iVectorX)
'                                                Dim iDir2Y As Double = DistanceBetweenPointandVector(iPtHole2, iPtCsys, iVectorY)
'                                                Dim iDir2Z As Double = DistanceBetweenPointandVector(iPtHole2, iPtCsys, iVectorZ)

'                                                If iDirX < 8 And iDirY < 8 And iDirZ < 8 And dtGroup.Rows(itrung).Item("TagPart").ToString = dtGroup.Rows(itrung3).Item("TagPart").ToString Then
'                                                    dtGroup.Rows(itrung).Item("Group") = iGroup
'                                                    dtGroup.Rows(itrung3).Item("Group") = iGroup
'                                                    iGroup += 1
'                                                    Exit For
'                                                ElseIf iDir2X < 8 And iDir2Y < 8 And iDir2Z < 8 And dtGroup.Rows(itrung2).Item("TagPart").ToString = dtGroup.Rows(itrung3).Item("TagPart").ToString Then
'                                                    dtGroup.Rows(itrung2).Item("Group") = iGroup
'                                                    dtGroup.Rows(itrung3).Item("Group") = iGroup
'                                                    iGroup += 1
'                                                    Exit For
'                                                End If
'                                            Catch ex1 As Exception

'                                            End Try

'                                        End Try

'                                    End If
'                                End If
'                            Next
'                        End If
'                    Next
'                End If
'            Next
'        Next

'        dtGroup.AcceptChanges()
'        Dim dtView12 As New DataView(dtGroup)
'        dtView12.Sort = "Group"
'        dtGroup = dtView12.ToTable

'        iLRow = dtGroup.Rows.Count - 1
'        dtGroup.AcceptChanges()
'        Dim iLRow1 As Integer = dtGroup.Rows.Count - 1
'        ''' Lấy tạo độ Cs đại điện theo thuật toán tìm vị trí cắt
'        Dim iLRGroup As Integer
'        Dim iStGroup As Integer = 0
'        For iNoGroup As Integer = 1 To dtGroup.Rows(iLRow1).Item("Group")
'            For iNo As Integer = iStGroup To iLRow1
'                If dtGroup.Rows(iNo).Item("Group").ToString = iNoGroup Then
'                    iLRGroup = iNo
'                    For iSt As Integer = iNo To iLRow1
'                        If dtGroup.Rows(iSt).Item("Group").ToString <> iNoGroup Then
'                            iStGroup = iSt - 1
'                            'iNoGroup = iSt + 1
'                            Exit For
'                        ElseIf dtGroup.Rows(iLRow1).Item("Group") = iNoGroup Then
'                            iStGroup = iLRow1
'                        End If
'                    Next
'                    Exit For
'                End If
'            Next

'            Dim iNomin As Integer
'            For iNo0 As Integer = iLRGroup To iStGroup
'                If dtGroup.Rows(iNo0).Item("Hole Shape").ToString = "Daruma" And dtGroup.Rows(iNo0).Item("TagCsys").ToString <> Nothing Then
'                    For iNo11 As Integer = iNo0 To iStGroup
'                        If dtGroup.Rows(iNo11).Item("Hole Shape").ToString = "Daruma" Then
'                            If CType(Split(dtGroup.Rows(iNo0).Item("Hole Size").ToString, "x")(0).ToString, Double) <= CType(Split(dtGroup.Rows(iNo11).Item("Hole Size").ToString, "x")(0).ToString, Double) Then
'                                '    dtGroup.Rows(iNoEnd).Item("Create Section Csys") = dtGroup.Rows(iNoEnd).Item("TagCsys")
'                                iNomin = iNo0
'                            Else
'                                iNomin = iNo11
'                                iNo0 = iNo11
'                            End If
'                        End If
'                    Next
'                    dtGroup.Rows(iNomin).Item("Create Section Csys") = dtGroup.Rows(iNomin).Item("TagCsys")
'                    iNomin = Nothing
'                    Exit For
'                ElseIf iNo0 = iStGroup Then
'                    For iNo1 As Integer = iLRGroup To iStGroup
'                        If Left(dtGroup.Rows(iNo1).Item("Hole Shape").ToString, 3) = "Obl" And dtGroup.Rows(iNo1).Item("TagCsys").ToString <> Nothing Then
'                            For iNo11 As Integer = iNo1 To iStGroup
'                                If Left(dtGroup.Rows(iNo11).Item("Hole Shape").ToString, 3) = "Obl" Then
'                                    If CType(Split(dtGroup.Rows(iNo1).Item("Hole Size").ToString, "x")(0).ToString, Double) <= CType(Split(dtGroup.Rows(iNo11).Item("Hole Size").ToString, "x")(0).ToString, Double) Then
'                                        '    dtGroup.Rows(iNoEnd).Item("Create Section Csys") = dtGroup.Rows(iNoEnd).Item("TagCsys")
'                                        iNomin = iNo1
'                                    Else
'                                        iNomin = iNo11
'                                        iNo1 = iNo11
'                                    End If
'                                End If
'                            Next
'                            dtGroup.Rows(iNomin).Item("Create Section Csys") = dtGroup.Rows(iNomin).Item("TagCsys")
'                            iNomin = Nothing
'                            Exit For

'                        ElseIf iNo1 = iStGroup Then
'                            For iNo2 As Integer = iLRGroup To iStGroup
'                                If dtGroup.Rows(iNo2).Item("Hole Shape").ToString = "Hole" And dtGroup.Rows(iNo2).Item("TagCsys").ToString <> Nothing Then
'                                    For iNo11 As Integer = iNo2 To iStGroup
'                                        If dtGroup.Rows(iNo11).Item("Hole Shape").ToString = "Hole" Then
'                                            If CType(dtGroup.Rows(iNo2).Item("Hole Size").ToString, Double) <= CType(dtGroup.Rows(iNo11).Item("Hole Size").ToString, Double) Then
'                                                '    dtGroup.Rows(iNoEnd).Item("Create Section Csys") = dtGroup.Rows(iNoEnd).Item("TagCsys")
'                                                iNomin = iNo2
'                                            Else
'                                                iNomin = iNo11
'                                                iNo2 = iNo11
'                                            End If
'                                        End If
'                                    Next
'                                    dtGroup.Rows(iNomin).Item("Create Section Csys") = dtGroup.Rows(iNomin).Item("TagCsys")
'                                    iNomin = Nothing
'                                    'dtGroup.Rows(iNo2).Item("Create Section Csys") = dtGroup.Rows(iNo2).Item("TagCsys")
'                                    Exit For
'                                ElseIf iNo2 = iStGroup Then
'                                    For iNo3 As Integer = iLRGroup To iStGroup
'                                        'If dtGroup.Rows(iNo3).Item("Type").ToString <> "Solid Body" Then
'                                        Dim icheckMono As Boolean = False
'                                        If dtGroup.Rows(iNo3).Item("Type").ToString = "Csys" Then
'                                            For iNo4 As Integer = iLRGroup To iStGroup
'                                                If InStr(dtGroup.Rows(iNo4).Item("Part Name").ToString.ToUpper, "BOLT") > 0 Or InStr(dtGroup.Rows(iNo4).Item("Part Name").ToString.ToUpper, "NUT") > 0 _
'                                               Or InStr(dtGroup.Rows(iNo4).Item("Part Name").ToString.ToUpper, "CLIP") > 0 Or InStr(dtGroup.Rows(iNo4).Item("Part Name").ToString.ToUpper, "SCREW") > 0 _
'                                                   Or InStr(dtGroup.Rows(iNo4).Item("Part Name").ToString.ToUpper, "SCR") > 0 Or InStr(dtGroup.Rows(iNo4).Item("Part Name").ToString.ToUpper, "RIVET") > 0 _
'                                                       Or InStr(dtGroup.Rows(iNo4).Item("Part Name").ToString.ToUpper, "GROM") > 0 Or InStr(dtGroup.Rows(iNo4).Item("Part Name").ToString.ToUpper, "PLUG") > 0 _
'                                                           Or InStr(dtGroup.Rows(iNo4).Item("Part Name").ToString.ToUpper, "PIN") > 0 Then

'                                                    icheckMono = True
'                                                    Exit For

'                                                End If
'                                            Next
'                                            If icheckMono = True Then
'                                                dtGroup.Rows(iNo3).Item("Create Section Csys") = dtGroup.Rows(iNo3).Item("TagCsys")
'                                                Exit For
'                                            End If
'                                        End If
'                                    Next
'                                End If
'                            Next
'                        End If
'                    Next
'                End If
'            Next
'            dtGroup.AcceptChanges()

'            ''' Vị trí teiketsu phải có bolt hoặc nut và 1 lỗ 
'            For iCut As Integer = iLRGroup To iStGroup
'                If dtGroup.Rows(iCut).Item("Type").ToString = "Sheet Body" Then
'                    For iCut1 As Integer = iLRGroup To iStGroup
'                        If InStr(dtGroup.Rows(iCut1).Item("Part Name").ToString.ToUpper, "BOLT") > 0 Then
'                            CsysPMIGroup(dtGroup, iLRGroup, iStGroup, "Bolt_Nut", "01")
'                        ElseIf InStr(dtGroup.Rows(iCut1).Item("Part Name").ToString.ToUpper, "NUT") > 0 Then
'                            If InStr(dtGroup.Rows(iCut1).Item("Part Name").ToString.ToUpper, "PLATE") = 0 Then
'                                CsysPMIGroup(dtGroup, iLRGroup, iStGroup, "Bolt_Nut", "01")
'                            End If

'                        ElseIf InStr(dtGroup.Rows(iCut1).Item("Part Name").ToString.ToUpper, "CLIP") > 0 Then
'                            CsysPMIGroup(dtGroup, iLRGroup, iStGroup, "Clip", "02")
'                        ElseIf InStr(dtGroup.Rows(iCut1).Item("Part Name").ToString.ToUpper, "SCREW") > 0 Then
'                            CsysPMIGroup(dtGroup, iLRGroup, iStGroup, "Screw", "03")
'                        ElseIf InStr(dtGroup.Rows(iCut1).Item("Part Name").ToString.ToUpper, "SCR") > 0 Then
'                            CsysPMIGroup(dtGroup, iLRGroup, iStGroup, "Screw", "03")
'                        ElseIf InStr(dtGroup.Rows(iCut1).Item("Part Name").ToString.ToUpper, "RIVET") > 0 Then
'                            CsysPMIGroup(dtGroup, iLRGroup, iStGroup, "Rivet", "04")
'                        ElseIf InStr(dtGroup.Rows(iCut1).Item("Part Name").ToString.ToUpper, "GROM") > 0 Then
'                            CsysPMIGroup(dtGroup, iLRGroup, iStGroup, "Grom", "05")
'                        ElseIf InStr(dtGroup.Rows(iCut1).Item("Part Name").ToString.ToUpper, "PLUG") > 0 Then
'                            CsysPMIGroup(dtGroup, iLRGroup, iStGroup, "PLUG", "06")
'                        ElseIf InStr(dtGroup.Rows(iCut1).Item("Part Name").ToString.ToUpper, "PIN") > 0 Then
'                            CsysPMIGroup(dtGroup, iLRGroup, iStGroup, "PIN", "07")
'                        Else
'                            'CsysPMIGroup(dtGroup, iLRGroup, iStGroup, "NG", "NG")
'                        End If
'                    Next
'                    'ElseIf iCut = iStGroup Then
'                End If
'            Next
'            dtGroup.AcceptChanges()
'            For iCut1 As Integer = iLRGroup To iStGroup
'                If dtGroup.Rows(iCut1).Item("締結Type").ToString = "" Then

'                    If InStr(dtGroup.Rows(iCut1).Item("Part Name").ToString.ToUpper, "BOLT") > 0 Or InStr(dtGroup.Rows(iCut1).Item("Part Name").ToString.ToUpper, "NUT") > 0 Then
'                        If InStr(dtGroup.Rows(iCut1).Item("Part Name").ToString.ToUpper, "PLATE") = 0 Then
'                            For iCut2 As Integer = iLRGroup To iStGroup
'                                dtGroup.Rows(iCut2).Item("締結Type") = "Bolt_Nut"
'                                If dtGroup.Rows(iCut2).Item("Create Section Csys").ToString <> "" Then
'                                    dtGroup.Rows(iCut2).Item("CsysPMI") = String.Format("{0:000000}", dtGroup.Rows(iCut2).Item("Group")) & "; " & dtGroup.Rows(iCut2).Item("Part No") & "; " & "01" & "; " & "NG" & "; " & "NG"
'                                End If
'                            Next
'                        End If

'                    ElseIf InStr(dtGroup.Rows(iCut1).Item("Part Name").ToString.ToUpper, "NUT") > 0 Then
'                        If InStr(dtGroup.Rows(iCut1).Item("Part Name").ToString.ToUpper, "PLATE") = 0 Then
'                            For iCut2 As Integer = iLRGroup To iStGroup
'                                dtGroup.Rows(iCut2).Item("締結Type") = "Bolt_Nut"
'                                If dtGroup.Rows(iCut2).Item("Create Section Csys").ToString <> "" Then
'                                    dtGroup.Rows(iCut2).Item("CsysPMI") = String.Format("{0:000000}", dtGroup.Rows(iCut2).Item("Group")) & "; " & dtGroup.Rows(iCut2).Item("Part No") & "; " & "01" & "; " & "NG" & "; " & "NG"
'                                End If
'                            Next
'                        End If

'                    ElseIf InStr(dtGroup.Rows(iCut1).Item("Part Name").ToString.ToUpper, "CLIP") > 0 Then
'                        For iCut2 As Integer = iLRGroup To iStGroup
'                            dtGroup.Rows(iCut2).Item("締結Type") = "Clip"
'                            If dtGroup.Rows(iCut2).Item("Create Section Csys").ToString <> "" Then
'                                dtGroup.Rows(iCut2).Item("CsysPMI") = String.Format("{0:000000}", dtGroup.Rows(iCut2).Item("Group")) & "; " & dtGroup.Rows(iCut2).Item("Part No") & "; " & "02" & "; " & "NG" & "; " & "NG"
'                            End If
'                        Next
'                    ElseIf InStr(dtGroup.Rows(iCut1).Item("Part Name").ToString.ToUpper, "SCREW") > 0 Or InStr(dtGroup.Rows(iCut1).Item("Part Name").ToString.ToUpper, "SCR") > 0 Then
'                        For iCut2 As Integer = iLRGroup To iStGroup
'                            dtGroup.Rows(iCut2).Item("締結Type") = "Screw"
'                            If dtGroup.Rows(iCut2).Item("Create Section Csys").ToString <> "" Then
'                                dtGroup.Rows(iCut2).Item("CsysPMI") = String.Format("{0:000000}", dtGroup.Rows(iCut2).Item("Group")) & "; " & dtGroup.Rows(iCut2).Item("Part No") & "; " & "03" & "; " & "NG" & "; " & "NG"
'                            End If
'                        Next
'                    ElseIf InStr(dtGroup.Rows(iCut1).Item("Part Name").ToString.ToUpper, "SCR") > 0 Then
'                        For iCut2 As Integer = iLRGroup To iStGroup
'                            dtGroup.Rows(iCut2).Item("締結Type") = "Screw"
'                            If dtGroup.Rows(iCut2).Item("Create Section Csys").ToString <> "" Then
'                                dtGroup.Rows(iCut2).Item("CsysPMI") = String.Format("{0:000000}", dtGroup.Rows(iCut2).Item("Group")) & "; " & dtGroup.Rows(iCut2).Item("Part No") & "; " & "03" & "; " & "NG" & "; " & "NG"
'                            End If
'                        Next
'                    ElseIf InStr(dtGroup.Rows(iCut1).Item("Part Name").ToString.ToUpper, "RIVET") > 0 Then
'                        For iCut2 As Integer = iLRGroup To iStGroup
'                            dtGroup.Rows(iCut2).Item("締結Type") = "Rivet"
'                            If dtGroup.Rows(iCut2).Item("Create Section Csys").ToString <> "" Then
'                                dtGroup.Rows(iCut2).Item("CsysPMI") = String.Format("{0:000000}", dtGroup.Rows(iCut2).Item("Group")) & "; " & dtGroup.Rows(iCut2).Item("Part No") & "; " & "04" & "; " & "NG" & "; " & "NG"
'                            End If
'                        Next
'                    ElseIf InStr(dtGroup.Rows(iCut1).Item("Part Name").ToString.ToUpper, "GROM") > 0 Then
'                        For iCut2 As Integer = iLRGroup To iStGroup
'                            dtGroup.Rows(iCut2).Item("締結Type") = "Grom"
'                            If dtGroup.Rows(iCut2).Item("Create Section Csys").ToString <> "" Then
'                                dtGroup.Rows(iCut2).Item("CsysPMI") = String.Format("{0:000000}", dtGroup.Rows(iCut2).Item("Group")) & "; " & dtGroup.Rows(iCut2).Item("Part No") & "; " & "05" & "; " & "NG" & "; " & "NG"
'                            End If
'                        Next
'                    ElseIf InStr(dtGroup.Rows(iCut1).Item("Part Name").ToString.ToUpper, "PLUG") > 0 Then
'                        For iCut2 As Integer = iLRGroup To iStGroup
'                            dtGroup.Rows(iCut2).Item("締結Type") = "PLUG"
'                            If dtGroup.Rows(iCut2).Item("Create Section Csys").ToString <> "" Then
'                                dtGroup.Rows(iCut2).Item("CsysPMI") = String.Format("{0:000000}", dtGroup.Rows(iCut2).Item("Group")) & "; " & dtGroup.Rows(iCut2).Item("Part No") & "; " & "06" & "; " & "NG" & "; " & "NG"
'                            End If
'                        Next
'                    ElseIf InStr(dtGroup.Rows(iCut1).Item("Part Name").ToString.ToUpper, "PIN") > 0 Then
'                        For iCut2 As Integer = iLRGroup To iStGroup
'                            dtGroup.Rows(iCut2).Item("締結Type") = "PIN"
'                            If dtGroup.Rows(iCut2).Item("Create Section Csys").ToString <> "" Then
'                                dtGroup.Rows(iCut2).Item("CsysPMI") = String.Format("{0:000000}", dtGroup.Rows(iCut2).Item("Group")) & "; " & dtGroup.Rows(iCut2).Item("Part No") & "; " & "07" & "; " & "NG" & "; " & "NG"
'                            End If
'                        Next
'                    Else
'                        'For iCut2 As Integer = iLRGroup To iStGroup
'                        '    dtGroup.Rows(iCut2).Item("締結Type") = "NG"
'                        '    If dtGroup.Rows(iCut2).Item("Create Section Csys").ToString <> "" Then
'                        '        dtGroup.Rows(iCut2).Item("CsysPMI") = String.Format("{0:000000}", dtGroup.Rows(iCut2).Item("Group")) & "; " & dtGroup.Rows(iCut2).Item("Part No") & "; " & "NG" & "; " & "NG" & "; " & "NG"
'                        '    End If
'                        'Next

'                    End If
'                End If
'            Next
'            For iCut1 As Integer = iLRGroup To iStGroup
'                If dtGroup.Rows(iCut1).Item("締結Type").ToString = "" Then

'                    For iCut2 As Integer = iLRGroup To iStGroup
'                        dtGroup.Rows(iCut2).Item("締結Type") = "NG"
'                        If dtGroup.Rows(iCut2).Item("Create Section Csys").ToString <> "" Then
'                            dtGroup.Rows(iCut2).Item("CsysPMI") = String.Format("{0:000000}", dtGroup.Rows(iCut2).Item("Group")) & "; " & dtGroup.Rows(iCut2).Item("Part No") & "; " & "NG" & "; " & "NG" & "; " & "NG"
'                        End If
'                    Next
'                End If
'            Next
'            ''''check Group không biết có phải vị trí teiketu hay không.
'        Next
'        dtGroup.AcceptChanges()
'        '''xóa tạo độ trọng tâm solid Body
'        'For idelt As Integer = dtGroup.Rows.Count - 1 To 0 Step -1
'        '    Dim irowT As DataRow = dtGroup.Rows.Item(idelt)
'        '    If irowT("Type") = "Solid Body" Then
'        '        dtGroup.Rows.Remove(irowT)
'        '    End If
'        'Next
'        dtGroup.AcceptChanges()
'        dtOut = dtGroup

'    End Sub

'    Sub FindHoleLock(ByVal dtGroup As DataTable, ByRef dtGrLockOut As DataTable)
'        Dim theSession As Session = Session.GetSession()
'        Dim workpart As Part = theSession.Parts.Work
'        Dim iRootNo As String = workpart.FullPath.ToString
'        Dim iRootPart As Part = workpart
'        Dim iRootcomp As Component = workpart.ComponentAssembly.RootComponent
'        Dim partLoadStatus1 As PartLoadStatus

'        Dim dtView1 As New DataView(dtGroup)
'        dtView1.RowFilter = String.Format("[締結Type] like '%{0}'", "NG")
'        Dim tmpDtb1 As DataTable = dtGroup.Clone
'        tmpDtb1 = dtView1.ToTable
'        Dim PartTagList As New List(Of String)
'        For Each dtr As DataRow In tmpDtb1.Rows
'            If PartTagList.Contains(dtr("TagPart").ToString) = False Then
'                PartTagList.Add(dtr("TagPart").ToString)
'            End If
'        Next

'        For Each iPartTag As String In PartTagList
'            Dim iParttagList As New List(Of String)
'            Dim iGroupTemp1 As String, iGroupTemp2 As String
'            Dim iGr1CountCheck As Integer = 0
'            Dim iGr2CountCheck As Integer = 0
'            Dim tmpDtb As DataTable = tmpDtb1.Clone
'            Dim dtView2 As New DataView(tmpDtb1)
'            dtView2.RowFilter = String.Format("[TagPart] like '%{0}'", iPartTag)
'            tmpDtb = dtView2.ToTable

'            For Each drt As DataRow In tmpDtb.Rows
'                If InStr(drt("Csys Name").ToString.ToUpper, "MARK") > 0 Then
'                    drt("Group") = -1

'                ElseIf drt("Type").ToString = "Csys" Then
'                    Dim icheckCs As Boolean = False
'                    For Each drt1 As DataRow In tmpDtb.Rows
'                        If drt1("Type").ToString = "Sheet Body" Or drt1("Type").ToString = "Solid Body" Then

'                            Dim iPt1 As Point3d = New Point3d(CType(drt("Origin X"), Double), CType(drt("Origin Y"), Double), CType(drt("Origin Z"), Double))
'                            Dim iPt2 As Point3d = New Point3d(CType(drt1("Origin X"), Double), CType(drt1("Origin Y"), Double), CType(drt1("Origin Z"), Double))
'                            Dim iVectorX As Vector3d = New Vector3d(Split(drt("Csys DirX"), ",")(0), Split(drt("Csys DirX"), ",")(1), Split(drt("Csys DirX"), ",")(2))
'                            Dim iVectorY As Vector3d = New Vector3d(Split(drt("Csys DirY"), ",")(0), Split(drt("Csys DirY"), ",")(1), Split(drt("Csys DirY"), ",")(2))
'                            Dim iVectorZ As Vector3d = New Vector3d(Split(drt("Csys DirZ"), ",")(0), Split(drt("Csys DirZ"), ",")(1), Split(drt("Csys DirZ"), ",")(2))
'                            Dim iDirX As Double = DistanceBetweenPointandVector(iPt1, iPt2, iVectorX)
'                            Dim iDirY As Double = DistanceBetweenPointandVector(iPt1, iPt2, iVectorY)
'                            Dim iDirZ As Double = DistanceBetweenPointandVector(iPt1, iPt2, iVectorZ)
'                            If iDirX < 8 And iDirY < 8 And iDirZ < 8 Then

'                                icheckCs = True
'                                Exit For
'                            End If
'                        End If
'                    Next
'                    If icheckCs = False Then
'                        drt("Group") = -1
'                    End If
'                End If
'            Next
'            For idel As Integer = tmpDtb.Rows.Count - 1 To 0 Step -1
'                Dim irow As DataRow = tmpDtb.Rows.Item(idel)
'                If irow("Group") = -1 Then
'                    tmpDtb.Rows.Remove(irow)
'                End If
'            Next
'            tmpDtb.AcceptChanges()
'            For Each dt1 As DataRow In tmpDtb.Rows
'                If dt1("Hole Shape").ToString = "Obl Hole" Then
'                    Dim iCheckGr As Integer = 0
'                    For Each dtCheck As DataRow In tmpDtb.Rows
'                        If dtCheck("Group").ToString = dt1("Group").ToString Then
'                            iCheckGr += 1
'                        End If
'                    Next
'                    If iCheckGr = 2 Then
'                        For Each dt2 As DataRow In tmpDtb.Rows
'                            If dt2("Hole Shape").ToString = "Hole" And dt1("Group").ToString <> dt2("Group").ToString Then
'                                Dim iCheckGr2 As Integer = 0
'                                For Each dtCheck As DataRow In tmpDtb.Rows
'                                    If dtCheck("Group").ToString = dt2("Group").ToString Then
'                                        iCheckGr2 += 1
'                                    End If
'                                Next
'                                If iCheckGr2 = 2 Then
'                                    'If InStr(dt1("Hole Shape"), "Obl") > 0 And InStr(dt2("Hole Shape"), "Obl") = 0 Then
'                                    If CType(Split(dt1("Hole Size"), "x")(1), Double) = CType(dt2("Hole Size"), Double) Then
'                                        Dim v2x As Double = CType(Split(dt1("Csys DirX"), ",")(0), Double)
'                                        Dim v2y As Double = CType(Split(dt1("Csys DirX"), ",")(1), Double)
'                                        Dim v2z As Double = CType(Split(dt1("Csys DirX"), ",")(2), Double)
'                                        Dim iPt1 As Point3d = New Point3d(CType(dt1("Origin X"), Double), CType(dt1("Origin Y"), Double), CType(dt1("Origin Z"), Double))
'                                        Dim iPt2 As Point3d = New Point3d(CType(dt2("Origin X"), Double), CType(dt2("Origin Y"), Double), CType(dt2("Origin Z"), Double))
'                                        Dim ivector As Vector3d = New Vector3d(v2x, v2y, v2z)

'                                        If DistanceBetweenPointandVector(iPt1, iPt2, ivector) < 0.5 Then
'                                            iGr1CountCheck += 1

'                                            If iGr1CountCheck = 1 Then
'                                                For Each dtr As DataRow In dtGroup.Rows
'                                                    If dtr("Group").ToString = dt1("Group").ToString Or dtr("Group").ToString = dt2("Group").ToString Then
'                                                        dtr("Create Direct Y") = 1
'                                                        iGroupTemp1 = dt1("Group").ToString
'                                                        iGroupTemp2 = dt2("Group").ToString
'                                                    End If
'                                                Next


'                                            ElseIf iGr1CountCheck > 1 Then
'                                                For Each dtr As DataRow In dtGroup.Rows
'                                                    If dtr("Group").ToString = iGroupTemp1 Or dtr("Group").ToString = iGroupTemp2 Then
'                                                        dtr("Create Direct Y") = 2
'                                                    End If
'                                                Next
'                                            End If


'                                        Else
'                                        End If
'                                    End If
'                                End If
'                            End If
'                        Next
'                    End If
'                End If
'            Next
'        Next

'        For Each dr As DataRow In dtGroup.Rows
'            If dr("Create Direct Y").ToString <> "1" Then
'                dr("Create Direct Y") = 2
'            End If
'        Next
'        'Dim theComponent As Component
'        'For Each ichild1 As Component In iRootcomp.GetChildren
'        '    If ichild1.GetStringAttribute("DB_PART_NAME").ToString = "Data Cs Lock" Then
'        '        theSession.Parts.SetWorkComponent(ichild1, partLoadStatus1)
'        '        theComponent = ichild1
'        '        Exit For
'        '    End If
'        'Next
'        Dim tmpDtb3 As DataTable = dtGroup.Clone
'        Dim dtView3 As New DataView(dtGroup)

'        dtView3.RowFilter = String.Format("[Create Direct Y] like '%{0}'", 1)
'        tmpDtb3 = dtView3.ToTable
'        'For Each dtr As DataRow In tmpDtb3.Rows
'        '    If dtr("Type").ToString = "Csys" Then
'        '        Dim iPtStr As String
'        '        Dim xDirect As String, yDirect As String, OutCsysName As String, OutCsysLabel As String
'        '        iPtStr = CType(dtr("Origin X").ToString, Double) & "," & CType(dtr("Origin Y").ToString, Double) & "," & CType(dtr("Origin Z").ToString, Double)
'        '        xDirect = dtr("Csys DirX").ToString
'        '        yDirect = dtr("Csys DirY").ToString
'        '        Dim OutCs As Features.Feature

'        '        Call CreateCsysOutput(iPtStr, xDirect, yDirect, OutCsysName, theComponent, OutCs)

'        '    End If
'        'Next
'        'Dim thecomponent1 As Component
'        'For Each ichild1 As Component In iRootcomp.GetChildren
'        '    If ichild1.GetStringAttribute("DB_PART_NAME").ToString = "Data Cs Cut" Then
'        '        theSession.Parts.SetWorkComponent(ichild1, partLoadStatus1)
'        '        thecomponent1 = ichild1
'        '        Exit For
'        '    End If
'        'Next
'        Dim tmpDtb4 As DataTable = dtGroup.Clone
'        Dim dtView4 As New DataView(dtGroup)

'        dtView4.RowFilter = String.Format("[Create Direct Y] like '%{0}'", 2)
'        tmpDtb4 = dtView4.ToTable
'        Dim GroupList As New List(Of String)
'        For Each dtr As DataRow In tmpDtb4.Rows
'            If GroupList.Contains(dtr("Group").ToString) = False Then
'                GroupList.Add(dtr("Group").ToString)
'            End If
'        Next
'        Dim ii As Integer = 1
'        For Each iGrList As String In GroupList
'            Dim iCheck As Boolean = False
'            For Each drt As DataRow In tmpDtb4.Rows
'                If drt("Group").ToString = iGrList Then

'                    drt("Group") = ii
'                    iCheck = True
'                End If
'            Next
'            If iCheck = True Then
'                ii += 1
'            End If
'        Next
'        tmpDtb4.AcceptChanges()

'        For Each drt As DataRow In tmpDtb4.Rows
'            If drt("Create Section Csys").ToString <> "" Then
'                drt("CsysPMI") = String.Format("{0:000000}", drt("Group")) & Mid(drt("CsysPMI").ToString, 7, 1000)
'            End If
'        Next
'        Dim itemp As Integer = 1
'        For Each drt As DataRow In tmpDtb4.Rows
'            If drt("Create Section Csys").ToString <> "" Then
'                drt("CsysPMI") = String.Format("{0:000000}", itemp) & Mid(drt("CsysPMI").ToString, 7, 1000)
'                itemp += 1
'            End If
'        Next


'        'For Each dtr As DataRow In tmpDtb4.Rows
'        '    If dtr("Create Section Csys").ToString <> "" Then
'        '        Dim iPtStr As String
'        '        Dim xDirect As String, yDirect As String, OutCsysName As String, OutCsysLabel As String
'        '        iPtStr = CType(dtr("Origin X").ToString, Double) & "," & CType(dtr("Origin Y").ToString, Double) & "," & CType(dtr("Origin Z").ToString, Double)
'        '        xDirect = dtr("Csys DirX").ToString
'        '        yDirect = dtr("Csys DirY").ToString
'        '        Dim OutCs As Features.Feature

'        '        Call CreateCsysOutput(iPtStr, xDirect, yDirect, OutCsysName, thecomponent1, OutCs)

'        '    End If
'        'Next
'        dtGrLockOut = tmpDtb4

'    End Sub

'    Function CsysPMIGroup(ByVal dtGroup As DataTable, ByVal iLRGroup As Integer, ByVal iStGroup As Integer, ByVal iTypeBolt As String, ByVal iTypeCode As String)
'        For iCut2 As Integer = iLRGroup To iStGroup
'            dtGroup.Rows(iCut2).Item("締結Type") = iTypeBolt

'            If dtGroup.Rows(iCut2).Item("Create Section Csys").ToString = "" Then
'                ''''''''INSERTCODE HEAR
'            Else
'                If dtGroup.Rows(iCut2).Item("Hole Shape").ToString = "Hole" Or dtGroup.Rows(iCut2).Item("Hole Shape").ToString = "Obl Hole" Or
'                    dtGroup.Rows(iCut2).Item("Hole Shape").ToString = "Obl Square" Or dtGroup.Rows(iCut2).Item("Hole Shape").ToString = "Daruma" Then
'                    If dtGroup.Rows(iCut2).Item("Hole Shape").ToString = "Hole" Then
'                        dtGroup.Rows(iCut2).Item("CsysPMI") = String.Format("{0:000000}", String.Format("{0:000000}", dtGroup.Rows(iCut2).Item("Group"))) & "; " & dtGroup.Rows(iCut2).Item("Part No") & "; " & iTypeCode & "; " & "C" & "; " & "-"
'                    ElseIf dtGroup.Rows(iCut2).Item("Hole Shape").ToString = "Obl Hole" Then
'                        dtGroup.Rows(iCut2).Item("CsysPMI") = String.Format("{0:000000}", String.Format("{0:000000}", dtGroup.Rows(iCut2).Item("Group"))) & "; " & dtGroup.Rows(iCut2).Item("Part No") & "; " & iTypeCode & "; " & "H" & "; " & "-"
'                    ElseIf dtGroup.Rows(iCut2).Item("Hole Shape").ToString = "Obl Square" Then
'                        dtGroup.Rows(iCut2).Item("CsysPMI") = String.Format("{0:000000}", dtGroup.Rows(iCut2).Item("Group")) & "; " & dtGroup.Rows(iCut2).Item("Part No") & "; " & iTypeCode & "; " & "S" & "; " & "-"
'                    ElseIf dtGroup.Rows(iCut2).Item("Hole Shape").ToString = "Daruma" Then
'                        dtGroup.Rows(iCut2).Item("CsysPMI") = String.Format("{0:000000}", dtGroup.Rows(iCut2).Item("Group")) & "; " & dtGroup.Rows(iCut2).Item("Part No") & "; " & iTypeCode & "; " & "D" & "; " & "-"
'                    End If
'                Else
'                    For iCut3 As Integer = iLRGroup To iStGroup
'                        If dtGroup.Rows(iCut3).Item("Hole Shape").ToString = "Obl Hole" Then
'                            dtGroup.Rows(iCut2).Item("CsysPMI") = String.Format("{0:000000}", dtGroup.Rows(iCut2).Item("Group")) & "; " & dtGroup.Rows(iCut2).Item("Part No") & "; " & iTypeCode & "; " & "H" & "; " & "-"
'                            Exit For
'                        ElseIf iCut3 = iStGroup Then
'                            For iCut4 As Integer = iLRGroup To iStGroup
'                                If dtGroup.Rows(iCut4).Item("Hole Shape").ToString = "Obl Square" Then
'                                    dtGroup.Rows(iCut2).Item("CsysPMI") = String.Format("{0:000000}", dtGroup.Rows(iCut2).Item("Group")) & "; " & dtGroup.Rows(iCut2).Item("Part No") & "; " & iTypeCode & "; " & "S" & "; " & "-"
'                                    Exit For
'                                ElseIf iCut4 = iStGroup Then
'                                    For iCut5 As Integer = iLRGroup To iStGroup
'                                        If dtGroup.Rows(iCut5).Item("Hole Shape").ToString = "Daruma" Then
'                                            dtGroup.Rows(iCut2).Item("CsysPMI") = String.Format("{0:000000}", dtGroup.Rows(iCut2).Item("Group")) & "; " & dtGroup.Rows(iCut2).Item("Part No") & "; " & iTypeCode & "; " & "D" & "; " & "-"
'                                            Exit For
'                                        ElseIf iCut5 = iStGroup Then
'                                            For iCut6 As Integer = iLRGroup To iStGroup
'                                                If dtGroup.Rows(iCut6).Item("Hole Shape").ToString = "Hole" Then
'                                                    dtGroup.Rows(iCut2).Item("CsysPMI") = String.Format("{0:000000}", dtGroup.Rows(iCut2).Item("Group")) & "; " & dtGroup.Rows(iCut2).Item("Part No") & "; " & iTypeCode & "; " & "C" & "; " & "-"
'                                                    Exit For
'                                                End If
'                                            Next
'                                        End If
'                                    Next
'                                End If
'                            Next
'                        End If
'                    Next
'                End If
'            End If
'        Next
'        dtGroup.AcceptChanges()

'    End Function

'    Sub CopyPositionToSheetDanmenOut(ByVal dtGroupOut As DataTable, ByVal dtDanmenOut As DataTable)

'        'Dim dtCut As DataTable = dtGroupOut
'        'dtCut.DefaultView.Sort = "Function"
'        'Dim dtCutResult As DataTable = dtCut.DefaultView.ToTable()
'        'dtCutResult.AcceptChanges()

'        For Each iRow1 As DataRow In dtGroupOut.Rows
'            If iRow1("Create Section Csys").ToString <> "" Then
'                Dim iPtStr As String
'                Dim xDirect As String, yDirect As String, OutCsysName As String
'                Dim xPoint As Double, yPoint As Double, zPoint As Double
'                xPoint = CType(iRow1("Origin X").ToString, Double)
'                yPoint = CType(iRow1("Origin Y").ToString, Double)
'                zPoint = CType(iRow1("Origin Z").ToString, Double)
'                iPtStr = CType(iRow1("Origin X").ToString, Double) & "," & CType(iRow1("Origin Y").ToString, Double) & "," & CType(iRow1("Origin Z").ToString, Double)
'                xDirect = iRow1("Csys DirX").ToString
'                yDirect = iRow1("Csys DirY").ToString
'                OutCsysName = Mid(iRow1("Function").ToString, 7, 6) & " - " & iRow1("Group").ToString & "_" & iRow1("CsysPMI").ToString
'                Dim iCsysName As String = iRow1("CsysPMI").ToString

'                Dim iBui As String = ""
'                Dim iFunc As String = iRow1("Function").ToString
'                Dim iGroup As String = Trim(Split(iRow1("CsysPMI").ToString, ";")(0))
'                Dim ipartno As String = Trim(Split(iRow1("CsysPMI").ToString, ";")(1))
'                Dim imono As String = Trim(Split(iRow1("CsysPMI").ToString, ";")(2))
'                Dim iholetype As String = Trim(Split(iRow1("CsysPMI").ToString, ";")(3))
'                Dim iHandan As String = Trim(Split(iRow1("CsysPMI").ToString, ";")(4))
'                Call InsertPositionOutToExcel(iBui, iGroup, ipartno, xPoint, yPoint, zPoint, imono, iholetype, iHandan, xDirect, yDirect, iFunc, OutCsysName, dtDanmenOut)
'                Dim EIWToolLibrary = System.Reflection.Assembly.LoadFile("D:\nxcad\scratch\VehiclePlanMacro\VPG-Sysytem.dll")
'                Dim VPGToolList = System.Activator.CreateInstance(EIWToolLibrary.GetExportedTypes(0))

'                Try
'                    VPGToolList.VPG_System_Check()
'                Catch ex As Exception
'                    MsgBox("VPG-System.dllがありません", vbExclamation)
'                    Exit Sub
'                End Try
'                VPGToolList.aCountAAA("185")
'            End If
'        Next

'    End Sub

'    Sub CreateAssyPositionInfor(ByVal dtCutResult As DataTable, ByVal iAssyPMI As Component)
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        Dim theSession As Session = Session.GetSession()
'        Dim iPtStr As String
'        Dim xDirect As String, yDirect As String, OutCsysName As String, OutCsysLabel As String
'        Dim iFunc1 As String = "Hoang"
'        Dim iFunc2 As String = "Quyet"
'        Dim iFunc3 As String = "Tien"

'        Dim dtView12 As New DataView(dtCutResult)
'        dtView12.Sort = "Function"
'        dtCutResult = dtView12.ToTable

'        For Each iRow As DataRow In dtCutResult.Rows
'            theSession.Parts.SetWorkComponent(iAssyPMI, partLoadStatus1)
'            'If iRow("Create Section Csys").ToString <> "" Then
'            iFunc1 = Mid(iRow("Function").ToString, 7, 6)
'            If iFunc1 <> iFunc3 Then
'                Dim iAssyP As Component = Nothing
'                CreateAssyNewLv2(iFunc1 & "_PMI", iAssyP)
'                For Each iRow1 As DataRow In dtCutResult.Rows
'                    'If iRow1("Create Section Csys").ToString <> "" Then
'                    iFunc2 = Mid(iRow1("Function").ToString, 7, 6)

'                    If iFunc2 = iFunc1 Then
'                        iPtStr = CType(iRow1("Origin X").ToString, Double) & "," & CType(iRow1("Origin Y").ToString, Double) & "," & CType(iRow1("Origin Z").ToString, Double)
'                        xDirect = iRow1("Csys DirX").ToString
'                        yDirect = iRow1("Csys DirY").ToString
'                        OutCsysName = Split(iRow1("CsysPMI").ToString, "_")(0)



'                        Dim iCsysName As String = iRow1("CsysPMI").ToString
'                        iCsysName = String.Format("{0:000000}", iRow1("Group").ToString)
'                        Dim OutCs As Features.Feature
'                        Dim ipoint1 As NXOpen.Point
'                        Dim tmpCs As CartesianCoordinateSystem
'                        Call CreateCsysOutput(iPtStr, xDirect, yDirect, OutCsysName, iAssyP, OutCs)
'                        For Each iObj As NXOpen.NXObject In OutCs.GetEntities
'                            If TypeOf (iObj) Is NXOpen.Point Then
'                                ipoint1 = iObj
'                            ElseIf TypeOf (iObj) Is CartesianCoordinateSystem Then
'                                tmpCs = iObj
'                            End If
'                        Next
'                        Dim point1 As NXOpen.Point3d = New NXOpen.Point3d(tmpCs.Origin.X, tmpCs.Origin.Y, tmpCs.Origin.Z)
'                        Call CreatePMIPosition(iCsysName, point1, ipoint1, iAssyP)
'                        iFunc3 = iFunc1
'                    End If
'                    'End If
'                Next
'            End If
'        Next
'        partLoadStatus1.Dispose()

'    End Sub

'    Sub CreateCsysOutput(ByVal iOriginPt As String, ByVal xDirect As String, ByVal yDirect As String, ByVal iCsysName As String, ByVal iAssyPMI As Component, ByRef iOutCs As Features.Feature)
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'        theSession.Parts.SetWorkComponent(iAssyPMI, partLoadStatus1)
'        Dim workPart As NXOpen.Part = theSession.Parts.Work
'        Dim iPtX As Double = CType(Trim(Split(iOriginPt, ",")(0)), Double)
'        Dim iPtY As Double = CType(Trim(Split(iOriginPt, ",")(1)), Double)
'        Dim iPtZ As Double = CType(Trim(Split(iOriginPt, ",")(2)), Double)

'        Dim xDirX As Double = CType(Trim(Split(xDirect, ",")(0)), Double)
'        Dim xDirY As Double = CType(Trim(Split(xDirect, ",")(1)), Double)
'        Dim xDirZ As Double = CType(Trim(Split(xDirect, ",")(2)), Double)

'        Dim yDirX As Double = CType(Trim(Split(yDirect, ",")(0)), Double)
'        Dim yDirY As Double = CType(Trim(Split(yDirect, ",")(1)), Double)
'        Dim yDirZ As Double = CType(Trim(Split(yDirect, ",")(2)), Double)

'        Dim origin5 As NXOpen.Point3d = New NXOpen.Point3d(iPtX, iPtY, iPtZ)
'        Dim xDirection1 As NXOpen.Vector3d = New NXOpen.Vector3d(xDirX, xDirY, xDirZ)
'        Dim yDirection1 As NXOpen.Vector3d = New NXOpen.Vector3d(yDirX, yDirY, yDirZ)


'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim nullNXOpen_Features_Feature As NXOpen.Features.Feature = Nothing
'        Dim datumCsysBuilder1 As NXOpen.Features.DatumCsysBuilder = Nothing
'        datumCsysBuilder1 = workPart.Features.CreateDatumCsysBuilder(nullNXOpen_Features_Feature)


'        Dim cartesianCoordinateSystem1 As NXOpen.CartesianCoordinateSystem = Nothing
'        cartesianCoordinateSystem1 = workPart.CoordinateSystems.CreateCoordinateSystem(origin5, xDirection1, yDirection1)
'        datumCsysBuilder1.Csys = cartesianCoordinateSystem1
'        datumCsysBuilder1.DisplayScaleFactor = 1.0

'        Dim nXObject2 As NXOpen.NXObject = Nothing
'        nXObject2 = datumCsysBuilder1.Commit()
'        nXObject2.SetName(iCsysName)
'        iOutCs = nXObject2
'        datumCsysBuilder1.Destroy()
'        theSession.CleanUpFacetedFacesAndEdges()
'    End Sub
'    '//////// Lấy tọa độ Cs tên vị trí vào DataArray
'    Sub CreatePMIPosition(ByVal iLabel As String, ByVal ipoint3d As Point3d, ByVal point1 As NXOpen.Point, ByVal AssyPMI As Component)
'        Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        theSession.Parts.SetWorkComponent(AssyPMI, partLoadStatus1)
'        Dim nullNXOpen_Annotations_CoordinateNote As NXOpen.Annotations.CoordinateNote = Nothing
'        Dim coordinateNoteBuilder1 As NXOpen.Annotations.CoordinateNoteBuilder = Nothing
'        coordinateNoteBuilder1 = workPart.PmiManager.PmiAttributes.CreateCoordinateNoteBuilder(nullNXOpen_Annotations_CoordinateNote)
'        coordinateNoteBuilder1.Origin.SetInferRelativeToGeometry(True)
'        coordinateNoteBuilder1.Origin.Anchor = NXOpen.Annotations.OriginBuilder.AlignmentPosition.MidCenter
'        coordinateNoteBuilder1.Title = "Coordinate Note"
'        coordinateNoteBuilder1.Category = "User Defined"
'        coordinateNoteBuilder1.Identifier = "User Defined"
'        coordinateNoteBuilder1.Revision = "-"
'        coordinateNoteBuilder1.ToggleX = True
'        coordinateNoteBuilder1.StringPrefixX = "x="
'        coordinateNoteBuilder1.ToggleY = True
'        coordinateNoteBuilder1.StringPrefixY = "y="
'        coordinateNoteBuilder1.ToggleZ = True
'        coordinateNoteBuilder1.StringPrefixZ = "z="
'        coordinateNoteBuilder1.StringPrefixI = "I="
'        coordinateNoteBuilder1.StringPrefixJ = "J="
'        coordinateNoteBuilder1.StringPrefixK = "K="
'        coordinateNoteBuilder1.ToggleLabel = True
'        coordinateNoteBuilder1.StringPrefixLabel = iLabel
'        coordinateNoteBuilder1.StringPrefixLevel = "Level="
'        coordinateNoteBuilder1.DecimalPlace = 4
'        coordinateNoteBuilder1.Origin.Plane.PlaneMethod = NXOpen.Annotations.PlaneBuilder.PlaneMethodType.ModelView
'        coordinateNoteBuilder1.Origin.SetInferRelativeToGeometry(True)
'        Dim leaderData1 As NXOpen.Annotations.LeaderData = Nothing
'        leaderData1 = workPart.Annotations.CreateLeaderData()
'        leaderData1.StubSize = 2.0
'        leaderData1.Arrowhead = NXOpen.Annotations.LeaderData.ArrowheadType.OpenArrow
'        leaderData1.VerticalAttachment = NXOpen.Annotations.LeaderVerticalAttachment.Center
'        coordinateNoteBuilder1.Leader.Leaders.Append(leaderData1)
'        leaderData1.StubSide = NXOpen.Annotations.LeaderSide.Inferred
'        coordinateNoteBuilder1.Origin.SetInferRelativeToGeometry(True)
'        coordinateNoteBuilder1.Origin.SetInferRelativeToGeometry(True)
'        Dim unit1 As NXOpen.Unit = CType(workPart.UnitCollection.FindObject("MilliMeter"), NXOpen.Unit)
'        Dim expression1 As NXOpen.Expression = Nothing
'        expression1 = workPart.Expressions.CreateSystemExpressionWithUnits("0", unit1)
'        'Dim datumCsys1 As NXOpen.Features.DatumCsys = CType(workPart.Features.FindObject("DATUM_CSYS(71)"), NXOpen.Features.DatumCsys)
'        'Dim point1 As NXOpen.Point = CType(datumCsys1.FindObject("POINT 1"), NXOpen.Point)
'        Dim nullNXOpen_Xform As NXOpen.Xform = Nothing
'        Dim point2 As NXOpen.Point = Nothing
'        point2 = workPart.Points.CreatePoint(point1, nullNXOpen_Xform, NXOpen.SmartObject.UpdateOption.AfterModeling)
'        Dim nXObject1 As NXOpen.NXObject = Nothing
'        Dim xform1 As NXOpen.Xform = Nothing
'        xform1 = workPart.Xforms.CreateExtractXform(point1, NXOpen.SmartObject.UpdateOption.AfterModeling, False, nXObject1)
'        Dim point3 As NXOpen.Point = CType(nXObject1, NXOpen.Point)
'        Dim point4 As NXOpen.Point = Nothing
'        point4 = workPart.Points.CreatePoint(point3, nullNXOpen_Xform, NXOpen.SmartObject.UpdateOption.AfterModeling)
'        coordinateNoteBuilder1.TrackingPoint = point4
'        Dim nullNXOpen_View As NXOpen.View = Nothing
'        leaderData1.Leader.SetValue(point4, nullNXOpen_View, ipoint3d)
'        coordinateNoteBuilder1.TrackingPoint = point4
'        leaderData1.Leader.SetValue(point3, nullNXOpen_View, ipoint3d)
'        ' Jog position relocated or jog removed
'        leaderData1.Jogs.Clear()
'        Dim assocOrigin1 As NXOpen.Annotations.Annotation.AssociativeOriginData = Nothing
'        assocOrigin1.OriginType = NXOpen.Annotations.AssociativeOriginType.RelativeToGeometry
'        assocOrigin1.View = nullNXOpen_View
'        Dim modelingView1 As NXOpen.ModelingView = CType(workPart.ModelingViews.FindObject("ISO PLAN"), NXOpen.ModelingView)

'        assocOrigin1.ViewOfGeometry = modelingView1
'        Dim point7 As NXOpen.Point = CType(workPart.Points.FindObject("ENTITY 2 2"), NXOpen.Point)
'        assocOrigin1.PointOnGeometry = point7
'        Dim nullNXOpen_Annotations_Annotation As NXOpen.Annotations.Annotation = Nothing
'        assocOrigin1.VertAnnotation = nullNXOpen_Annotations_Annotation
'        assocOrigin1.VertAlignmentPosition = NXOpen.Annotations.AlignmentPosition.TopLeft
'        assocOrigin1.HorizAnnotation = nullNXOpen_Annotations_Annotation
'        assocOrigin1.HorizAlignmentPosition = NXOpen.Annotations.AlignmentPosition.TopLeft
'        assocOrigin1.AlignedAnnotation = nullNXOpen_Annotations_Annotation
'        assocOrigin1.DimensionLine = 0
'        assocOrigin1.AssociatedView = nullNXOpen_View
'        Dim nullNXOpen_Point As NXOpen.Point = Nothing
'        assocOrigin1.AssociatedPoint = nullNXOpen_Point
'        assocOrigin1.OffsetAnnotation = nullNXOpen_Annotations_Annotation
'        assocOrigin1.OffsetAlignmentPosition = NXOpen.Annotations.AlignmentPosition.TopLeft
'        assocOrigin1.XOffsetFactor = 0.0
'        assocOrigin1.YOffsetFactor = 0.0
'        assocOrigin1.StackAlignmentPosition = NXOpen.Annotations.StackAlignmentPosition.Above
'        coordinateNoteBuilder1.Origin.SetAssociativeOrigin(assocOrigin1)
'        Dim point8 As NXOpen.Point3d = New NXOpen.Point3d(ipoint3d.X * 1, ipoint3d.Y * 1, ipoint3d.Z)
'        coordinateNoteBuilder1.Origin.Origin.SetValue(Nothing, nullNXOpen_View, point8)
'        coordinateNoteBuilder1.Origin.SetInferRelativeToGeometry(True)
'        leaderData1.StubSide = NXOpen.Annotations.LeaderSide.Left
'        Dim point9 As NXOpen.Point3d = New NXOpen.Point3d(ipoint3d.X * 1, ipoint3d.Y * 1, ipoint3d.Z)
'        leaderData1.Leader.SetValue(point3, nullNXOpen_View, point9)
'        Dim nXObject2 As NXOpen.NXObject = Nothing
'        nXObject2 = coordinateNoteBuilder1.Commit()

'        Dim point10 As NXOpen.Point3d = New NXOpen.Point3d(ipoint3d.X * 1, ipoint3d.Y * 1, ipoint3d.Z)
'        leaderData1.Leader.SetValue(point3, nullNXOpen_View, point10)
'        ' Jog position relocated or jog removed
'        leaderData1.Jogs.Clear()
'        coordinateNoteBuilder1.Destroy()
'        workPart.Expressions.Delete(expression1)
'        workPart.Points.DeletePoint(point2)
'        Dim coordinateNoteBuilder2 As NXOpen.Annotations.CoordinateNoteBuilder = Nothing
'        coordinateNoteBuilder2 = workPart.PmiManager.PmiAttributes.CreateCoordinateNoteBuilder(nullNXOpen_Annotations_CoordinateNote)
'        coordinateNoteBuilder2.Origin.SetInferRelativeToGeometry(True)
'        coordinateNoteBuilder2.Origin.Anchor = NXOpen.Annotations.OriginBuilder.AlignmentPosition.MidCenter
'        coordinateNoteBuilder2.Style.DimensionStyle.LimitFitDeviation = "H"
'        coordinateNoteBuilder2.Style.DimensionStyle.LimitFitShaftDeviation = "g"
'        coordinateNoteBuilder2.Style.DisplayStyle.ParallelToScreen = False
'        coordinateNoteBuilder2.Style.DisplayStyle.LockSizeAndPosition = False
'        coordinateNoteBuilder2.Title = "Coordinate Note"
'        coordinateNoteBuilder2.Category = "User Defined"
'        coordinateNoteBuilder2.Identifier = "User Defined"
'        coordinateNoteBuilder2.Revision = "-"
'        coordinateNoteBuilder2.ToggleX = True
'        coordinateNoteBuilder2.StringPrefixX = "x="
'        coordinateNoteBuilder2.ToggleY = True
'        coordinateNoteBuilder2.StringPrefixY = "y="
'        coordinateNoteBuilder2.ToggleZ = True
'        coordinateNoteBuilder2.StringPrefixZ = "z="
'        coordinateNoteBuilder2.StringPrefixI = "I="
'        coordinateNoteBuilder2.StringPrefixJ = "J="
'        coordinateNoteBuilder2.StringPrefixK = "K="
'        coordinateNoteBuilder2.ToggleLabel = True
'        coordinateNoteBuilder2.StringPrefixLabel = iLabel
'        coordinateNoteBuilder2.StringPrefixLevel = "Level="
'        coordinateNoteBuilder2.DecimalPlace = 4
'        coordinateNoteBuilder2.Origin.Plane.PlaneMethod = NXOpen.Annotations.PlaneBuilder.PlaneMethodType.ModelView
'        coordinateNoteBuilder2.Origin.SetInferRelativeToGeometry(True)
'        Dim leaderData2 As NXOpen.Annotations.LeaderData = Nothing
'        leaderData2 = workPart.Annotations.CreateLeaderData()
'        leaderData2.StubSize = 2.0
'        leaderData2.Arrowhead = NXOpen.Annotations.LeaderData.ArrowheadType.OpenArrow
'        leaderData2.VerticalAttachment = NXOpen.Annotations.LeaderVerticalAttachment.Center
'        coordinateNoteBuilder2.Leader.Leaders.Append(leaderData2)
'        leaderData2.StubSide = NXOpen.Annotations.LeaderSide.Right
'        leaderData2.StubSide = NXOpen.Annotations.LeaderSide.Inferred
'        coordinateNoteBuilder2.Origin.SetInferRelativeToGeometry(True)
'        coordinateNoteBuilder2.Origin.SetInferRelativeToGeometry(True)
'        Dim expression2 As NXOpen.Expression = Nothing
'        expression2 = workPart.Expressions.CreateSystemExpressionWithUnits("0", unit1)
'        coordinateNoteBuilder2.Destroy()
'        workPart.Expressions.Delete(expression2)
'        theSession.CleanUpFacetedFacesAndEdges()

'    End Sub

'    Function DistMath(ByVal iX As Integer, ByVal iY As Integer, ByVal iZ As Integer, ByVal jX As Integer, ByVal jY As Integer, ByVal jZ As Integer, ByRef iDist As Integer, ByRef iCheckNear As Boolean)
'        'iDist = Math.Sqrt((iX - jX) ^ 2 + (iY - jY) ^ 2 + (iZ - jZ) ^ 2)
'        iDist = Math.Sqrt((jX - iX) * (jX - iX) + (jY - iY) * (jY - iY) + (jZ - iZ) * (jZ - iZ))
'        If Math.Abs(iZ - jZ) <= 20 Then
'            If Math.Abs(iY - jY) <= 20 Then
'                If Math.Abs(iX - jX) <= 20 Then
'                    iCheckNear = True
'                Else
'                    iCheckNear = False
'                End If
'            Else
'                iCheckNear = False
'            End If
'        Else
'            iCheckNear = False
'        End If
'        Return iCheckNear
'        Return iDist



'    End Function

'    Sub InsertCenterOfGarivtyToDataTable(ByVal iBody As Body, ByVal dtPosition As DataTable)
'        Dim theSession As Session = Session.GetSession()
'        Dim iPartName As String, iPartNo As String, itagPart As String, iFuncNo As String
'        Call iSearchFuncNo(iBody.OwningComponent, iFuncNo)
'        iPartName = iBody.OwningComponent.GetStringAttribute("DB_PART_NAME").ToString
'        iPartNo = iBody.OwningComponent.GetStringAttribute("DB_PART_NO").ToString
'        itagPart = iBody.OwningComponent.Tag

'        Dim thebody(0) As Body
'        thebody(0) = iBody
'        Dim massUnits(4) As Unit
'        massUnits(0) = theSession.Parts.Display.UnitCollection.GetBase("Area")
'        massUnits(1) = theSession.Parts.Display.UnitCollection.GetBase("Volume")
'        massUnits(2) = theSession.Parts.Display.UnitCollection.GetBase("Mass")
'        massUnits(3) = theSession.Parts.Display.UnitCollection.GetBase("Length")
'        Dim myMeasure As MeasureManager = theSession.Parts.Display.MeasureManager()
'        Dim mb As MeasureBodies = Nothing
'        Dim midPt(2) As Double
'        mb = myMeasure.NewMassProperties(massUnits, 0.99, thebody)
'        mb.InformationUnit = MeasureBodies.AnalysisUnit.GramMillimeter
'        midPt(0) = mb.Centroid.X
'        midPt(1) = mb.Centroid.Y
'        midPt(2) = mb.Centroid.Z


'        Dim iCtrPt3d As New Point3d(midPt(0), midPt(1), midPt(2))


'        Call InsertToPositionDataTable(iFuncNo, iPartNo, iPartName, Nothing, "Solid Body", Nothing, Nothing, iBody, iCtrPt3d, dtPosition)

'    End Sub

'    Sub InsertCsysToDataTable(ByVal iCsys As CartesianCoordinateSystem, ByRef DuplicateCsysList As List(Of String), ByVal dtPosition As DataTable)
'        Try
'            Dim iPartName As String = iCsys.OwningComponent.GetStringAttribute("DB_PART_NAME").ToString
'            Dim iPartNo As String = iCsys.OwningComponent.GetStringAttribute("DB_PART_NO").ToString
'            Dim itagCsys As String = iCsys.Tag
'            Dim itagPart As String = iCsys.OwningComponent.Tag
'            Dim iFuncNo As String
'            Call iSearchFuncNo(iCsys.OwningComponent, iFuncNo)
'            Dim iCsysX As Double = Math.Round(iCsys.Origin.X, 6)
'            Dim iCsysY As Double = Math.Round(iCsys.Origin.Y, 6)
'            Dim iCsysZ As Double = Math.Round(iCsys.Origin.Z, 6)
'            Dim iHoleSize As String, iHoleShape As String, iType As String
'            Dim iTagBody As String
'            iType = "Csys"

'            If iCsysX = 0 And iCsysY = 0 And iCsysZ = 0 Then Exit Sub

'            Dim tmpItem As String = iCsysX & "_" & iCsysY & "_" & iCsysZ & "_" & itagPart

'            If DuplicateCsysList.Contains(tmpItem) = False Then
'                DuplicateCsysList.Add(tmpItem)
'                Call InsertToPositionDataTable(iFuncNo, iPartNo, iPartName, iCsys, iType, iHoleShape, iHoleSize, Nothing, Nothing, dtPosition)
'            End If
'        Catch ex As Exception

'        End Try

'    End Sub

'    Sub InsertToPositionDataTable(ByVal iFunctionNo As String, ByVal iPartNo As String, ByVal iPartName As String, ByVal iCsys As CartesianCoordinateSystem,
'                                ByVal iType As String, ByVal iHoleShape As String, ByVal iHolesize As String, ByVal iBody As NXOpen.Body, ByVal iCtrPt3d As Point3d, ByVal dtPosition As DataTable)

'        Dim row As DataRow = dtPosition.NewRow
'        row("Function") = iFunctionNo
'        row("Part Name") = iPartName
'        row("Part No") = iPartNo

'        If iType = "Sheet Body" Then
'            row("Origin X") = Math.Round(iCtrPt3d.X, 6)
'            row("Origin Y") = Math.Round(iCtrPt3d.Y, 6)
'            row("Origin Z") = Math.Round(iCtrPt3d.Z, 6)
'            row("Hole Shape") = iHoleShape
'            row("Hole Size") = iHolesize
'            row("TagPart") = iBody.OwningComponent.Tag
'            row("SheetBodyTag") = iBody.Tag
'        ElseIf iType = "Solid Body" Then

'            row("Origin X") = Math.Round(iCtrPt3d.X, 6)
'            row("Origin Y") = Math.Round(iCtrPt3d.Y, 6)
'            row("Origin Z") = Math.Round(iCtrPt3d.Z, 6)
'            row("Hole Shape") = ""
'            row("TagPart") = iBody.OwningComponent.Tag
'            row("SheetBodyTag") = iBody.Tag

'        Else
'            row("Origin X") = iCsys.Origin.X
'            row("Origin Y") = iCsys.Origin.Y
'            row("Origin Z") = iCsys.Origin.Z
'            row("Hole Shape") = ""
'            row("TagPart") = iCsys.OwningComponent.Tag
'            row("TagCsys") = iCsys.Tag
'            row("Csys Name") = iCsys.Name
'            row("Csys DirX") = iCsys.Orientation.Element.Xx & "," & iCsys.Orientation.Element.Xy & "," & iCsys.Orientation.Element.Xz
'            row("Csys DirY") = iCsys.Orientation.Element.Yx & "," & iCsys.Orientation.Element.Yy & "," & iCsys.Orientation.Element.Yz
'            row("Csys DirZ") = iCsys.Orientation.Element.Zx & "," & iCsys.Orientation.Element.Zy & "," & iCsys.Orientation.Element.Zz
'        End If
'        row("Type") = iType
'        row("Group") = "0"
'        'row("Danmen") = "0"
'        dtPosition.Rows.Add(row)

'    End Sub

'    Sub InsertHoleToDataTable(ByVal iBody As NXOpen.Body, ByRef iSheetBodyOwnningPartTag As List(Of String), ByVal dtGroupOut As DataTable)
'        Dim iPartName As String, iPartNo As String, itagPart As String, iFuncNo As String
'        Dim iComponent As Component
'        Dim position As Point3d
'        Dim matrix As Matrix3x3
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        If iBody.IsSheetBody Then
'            iComponent = iBody.OwningComponent
'            If iSheetBodyOwnningPartTag.Contains(iComponent.Tag) = False Then

'                iSheetBodyOwnningPartTag.Add(iComponent.Tag)
'                iComponent.GetPosition(position, matrix)
'                iCheckTrans = CheckCompTrans(iComponent)

'                Call iSearchFuncNo(iBody.OwningComponent, iFuncNo)
'                iPartName = iBody.OwningComponent.GetStringAttribute("DB_PART_NAME").ToString
'                iPartNo = iBody.OwningComponent.GetStringAttribute("DB_PART_NO").ToString
'                itagPart = iBody.OwningComponent.Tag
'                Dim iCtrPt3d As Point3d, iHoleSize As String, iHoleType As String

'                Call GetInforFormBody(iBody, iCtrPt3d, iHoleSize, iHoleType, dtGroupOut)


'            ElseIf iSheetBodyOwnningPartTag.FindAll(Function(l) l = iComponent.Tag).Count <= 1 Then
'                'Chỉ set những part có tối đa 2 Sheet Body
'                theUFSession.Ui.SetStatus(iComponent.GetStringAttribute("DB_PART_NO").ToString & "/" & iComponent.GetStringAttribute("DB_PART_NAME").ToString)
'                iSheetBodyOwnningPartTag.Add(iComponent.Tag)
'                iComponent.GetPosition(position, matrix)
'                iCheckTrans = CheckCompTrans(iComponent)

'                Call iSearchFuncNo(iBody.OwningComponent, iFuncNo)
'                iPartName = iBody.OwningComponent.GetStringAttribute("DB_PART_NAME").ToString
'                iPartNo = iBody.OwningComponent.GetStringAttribute("DB_PART_NO").ToString
'                itagPart = iBody.OwningComponent.Tag
'                Dim iCtrPt3d As Point3d, iHoleSize As String, iHoleType As String

'                Call GetInforFormBody(iBody, iCtrPt3d, iHoleSize, iHoleType, dtGroupOut)
'                'Dim iPt As Point = workpart.Points.CreatePoint(iCtrPt3d)
'                'iPt.SetVisibility(SmartObject.VisibilityOption.Visible)
'            End If
'        End If

'    End Sub

'    Sub GetInforFormBody(ByVal iBody As NXOpen.Body, ByRef iCtrPt3d As Point3d, ByRef iHoleSize As String, iHoleType As String, ByVal dtGroupOut As DataTable)
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim theUISession As UI = UI.GetUI
'        Dim workpart As Part = theSession.Parts.Work

'        Dim OutTangentEdge() As List(Of Edge)
'        Dim tmpCurveArr() As Curve
'        Dim HaveOutTangentEdge As Boolean = False
'        Call GetTangentEdge(iBody, OutTangentEdge, HaveOutTangentEdge)
'        If HaveOutTangentEdge = False Then Exit Sub
'        If iBody.IsSheetBody Then
'            Dim iPartName As String
'            Dim iPartNo As String
'            Dim iX As Double, iY As Double, iZ As Double
'            Dim iDX As String, iDY As String, iDZ As String
'            Dim itagCsys As String, itagPart As String
'            Dim iFunctionNo As String = Nothing
'            Dim iFuncNo As String
'            Dim iJoinCurveLent As Double
'            Dim iCtrPt3dArr As Point3d()
'            Dim ParmPtArr() As String

'            For Each iEdgeTangentGroup As List(Of Edge) In OutTangentEdge
'                Dim iCheckClosetCurve = False
'                Dim iRadiusList As New List(Of Double)
'                Dim HaveCtrPt As Boolean = False
'                Call iExtractCurve(iEdgeTangentGroup, iCtrPt3dArr, iRadiusList, ParmPtArr, iJoinCurveLent, iCheckClosetCurve, dtGroupOut)
'                If iCheckClosetCurve = True Then
'                    Try
'                        Call iGetCenterPoint(iCtrPt3dArr, iRadiusList, iCtrPt3d, iHoleSize, iHoleType, HaveCtrPt, ParmPtArr, iJoinCurveLent)

'                        If HaveCtrPt = True Then
'                            Call iSearchFuncNo(iBody.OwningComponent, iFuncNo)
'                            iPartName = iBody.OwningComponent.GetStringAttribute("DB_PART_NAME").ToString
'                            iPartNo = iBody.OwningComponent.GetStringAttribute("DB_PART_NO").ToString
'                            Call InsertToPositionDataTable(iFuncNo, iPartNo, iPartName, Nothing, "Sheet Body", iHoleType, iHoleSize, iBody, iCtrPt3d, dtGroupOut)
'                        End If

'                    Catch ex As Exception
'                        lw.WriteLine("Loi: ")
'                        lw.WriteLine(ex.ToString)
'                    End Try
'                End If
'            Next
'        End If
'    End Sub

'    Sub iGetCenterPoint(ByVal iCtrPt3dArr() As Point3d, ByVal iRadiusList As List(Of Double), ByRef iCtrPt3d As Point3d, ByRef iHoleSize As String,
'                       ByRef iHoleType As String, ByRef HaveCtrPt As Boolean, ByRef ParmPtStr() As String, ByRef JoinCurveLent As Double)

'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim theUISession As UI = UI.GetUI
'        Dim workpart As Part = theSession.Parts.Work
'        HaveCtrPt = False
'        Dim iSize As String
'        Dim IsArcType As Boolean, iRadius As Double
'        Dim IsArcTypeArr() As Boolean
'        Dim i As Integer, j As Integer
'        Dim iCtrPtStr As New List(Of String)
'        Dim tmpCtrPtStr As String
'        Dim OtherCurve() As Curve
'        Dim iChuvi As Double
'        Dim iCheckArcCurve As Boolean = False, iCheckOtherCurve As Boolean = False
'        'Dim tmpChuViObl As Double = 0
'        Try
'            'ĐƯỜNG TRÒN
'            If iCtrPt3dArr.Length = 1 Then
'                If (Math.PI * 2 * iRadiusList(0) / JoinCurveLent) > 0.98 Then
'                    If (Math.PI * 2 * iRadiusList(0)) / JoinCurveLent < 1.02 Then

'                        If iRadiusList(0) <= 12.5 Then
'                            iCtrPt3d = iCtrPt3dArr(0)
'                            iHoleSize = 2 * iRadiusList(0)
'                            iHoleType = "Hole"
'                            HaveCtrPt = True
'                        Else
'                            HaveCtrPt = False
'                            Exit Sub
'                        End If


'                    Else
'                        HaveCtrPt = False
'                        Exit Sub
'                    End If
'                Else
'                    HaveCtrPt = False
'                    Exit Sub
'                End If

'            End If
'            'OBLONG HOLE
'            If iCtrPt3dArr.Length = 2 And iRadiusList.Count = 1 Then  'And iRadiusArr(1) = iRadiusArr(0) Then

'                Dim iOblCtr As New Point3d((iCtrPt3dArr(0).X + iCtrPt3dArr(1).X) / 2, (iCtrPt3dArr(0).Y + iCtrPt3dArr(1).Y) / 2, (iCtrPt3dArr(0).Z + iCtrPt3dArr(1).Z) / 2)
'                Dim iKhoangCach2Tam As Double = Math.Sqrt((iCtrPt3dArr(0).X - iCtrPt3dArr(1).X) ^ 2 + (iCtrPt3dArr(0).Y - iCtrPt3dArr(1).Y) ^ 2 + (iCtrPt3dArr(0).Z - iCtrPt3dArr(1).Z) ^ 2)
'                iKhoangCach2Tam = Math.Round(iKhoangCach2Tam, 2)

'                Dim ChuviObl = 2 * iKhoangCach2Tam + 2 * iRadiusList(0) * Math.PI



'                If ChuviObl < 100 Then
'                    If JoinCurveLent / ChuviObl > 0.98 And JoinCurveLent / ChuviObl < 1.02 Then
'                        iCtrPt3d = iOblCtr
'                        iHoleSize = 2 * iRadiusList(0) + iKhoangCach2Tam & "x" & 2 * iRadiusList(0)
'                        iHoleType = "Obl Hole"
'                        HaveCtrPt = True
'                    Else
'                        HaveCtrPt = False
'                        Exit Sub
'                    End If
'                End If



'            End If
'            'OBLONG SQUARE
'            If iCtrPt3dArr.Length = 4 And iRadiusList.Count = 1 Then
'                'lw.WriteLine("Check obl sqr")
'                Dim Chieudai As Double, Chieurong As Double
'                Dim iLen1 As Double, iLen2 As Double, iLen3 As Double, iLen4 As Double
'                iLen1 = Math.Sqrt((iCtrPt3dArr(0).X - iCtrPt3dArr(1).X) ^ 2 + (iCtrPt3dArr(0).Y - iCtrPt3dArr(1).Y) ^ 2 + (iCtrPt3dArr(0).Z - iCtrPt3dArr(1).Z) ^ 2) 'Điểm đầu tiên và điểm thứ 2 trong mảng là đường chéo
'                iLen2 = Math.Sqrt((iCtrPt3dArr(0).X - iCtrPt3dArr(2).X) ^ 2 + (iCtrPt3dArr(0).Y - iCtrPt3dArr(2).Y) ^ 2 + (iCtrPt3dArr(0).Z - iCtrPt3dArr(2).Z) ^ 2) 'Điểm đầu tiên và điểm thứ 3 trong mảng là đường chéo
'                iLen3 = Math.Sqrt((iCtrPt3dArr(0).X - iCtrPt3dArr(3).X) ^ 2 + (iCtrPt3dArr(0).Y - iCtrPt3dArr(3).Y) ^ 2 + (iCtrPt3dArr(0).Z - iCtrPt3dArr(3).Z) ^ 2) 'Điểm đầu tiên và điểm thứ 4 trong mảng là đường chéo
'                'iLen1 là đường dài nhất
'                If iLen1 > iLen2 And iLen1 > iLen3 Then
'                    iLen4 = Math.Sqrt((iCtrPt3dArr(2).X - iCtrPt3dArr(3).X) ^ 2 + (iCtrPt3dArr(2).Y - iCtrPt3dArr(3).Y) ^ 2 + (iCtrPt3dArr(2).Z - iCtrPt3dArr(3).Z) ^ 2)
'                    '2 đường chéo có kích thước không bằng nhau
'                    If iLen1 / iLen4 > 0.98 And iLen1 / iLen4 < 1.02 Then
'                    Else
'                        Exit Sub
'                    End If
'                    'Định lý pitago: cạnh huyền bằng căn bậc 2 tổng bình phương 2 cạnh góc vuông
'                    If iLen1 / Math.Sqrt(iLen2 ^ 2 + iLen3 ^ 2) > 0.98 And iLen1 / Math.Sqrt(iLen2 ^ 2 + iLen3 ^ 2) < 1.02 Then
'                    Else
'                        Exit Sub
'                    End If

'                    iCtrPt3d.X = (iCtrPt3dArr(0).X + iCtrPt3dArr(1).X) / 2
'                    iCtrPt3d.Y = (iCtrPt3dArr(0).Y + iCtrPt3dArr(1).Y) / 2
'                    iCtrPt3d.Z = (iCtrPt3dArr(0).Z + iCtrPt3dArr(1).Z) / 2

'                    If iLen2 >= iLen3 Then
'                        Chieudai = iLen2
'                        Chieurong = iLen3
'                    Else
'                        Chieudai = iLen3
'                        Chieurong = iLen2
'                    End If

'                ElseIf iLen2 > iLen1 And iLen2 > iLen3 Then

'                    iLen4 = Math.Sqrt((iCtrPt3dArr(1).X - iCtrPt3dArr(3).X) ^ 2 + (iCtrPt3dArr(1).Y - iCtrPt3dArr(3).Y) ^ 2 + (iCtrPt3dArr(1).Z - iCtrPt3dArr(3).Z) ^ 2)
'                    '2 đường chéo có kích thước không bằng nhau
'                    If iLen2 / iLen4 > 0.98 And iLen2 / iLen4 < 1.02 Then
'                    Else
'                        Exit Sub
'                    End If

'                    'Định lý pitago: cạnh huyền bằng căn bậc 2 tổng bình phương 2 cạnh góc vuông
'                    If iLen2 / Math.Sqrt(iLen1 ^ 2 + iLen3 ^ 2) > 0.98 And iLen2 / Math.Sqrt(iLen1 ^ 2 + iLen3 ^ 2) < 1.02 Then
'                    Else
'                        Exit Sub
'                    End If
'                    iCtrPt3d.X = (iCtrPt3dArr(0).X + iCtrPt3dArr(2).X) / 2
'                    iCtrPt3d.Y = (iCtrPt3dArr(0).Y + iCtrPt3dArr(2).Y) / 2
'                    iCtrPt3d.Z = (iCtrPt3dArr(0).Z + iCtrPt3dArr(2).Z) / 2

'                    If iLen1 >= iLen3 Then
'                        Chieudai = iLen1
'                        Chieurong = iLen3
'                    Else
'                        Chieudai = iLen3
'                        Chieurong = iLen1
'                    End If

'                ElseIf iLen3 > iLen1 And iLen3 > iLen2 Then
'                    iLen4 = Math.Sqrt((iCtrPt3dArr(1).X - iCtrPt3dArr(2).X) ^ 2 + (iCtrPt3dArr(1).Y - iCtrPt3dArr(2).Y) ^ 2 + (iCtrPt3dArr(1).Z - iCtrPt3dArr(2).Z) ^ 2)
'                    '2 đường chéo có kích thước không bằng nhau
'                    If iLen3 / iLen4 > 0.98 And iLen3 / iLen4 < 1.02 Then
'                    Else
'                        Exit Sub
'                    End If

'                    'Định lý pitago: cạnh huyền bằng căn bậc 2 tổng bình phương 2 cạnh góc vuông
'                    If iLen3 / Math.Sqrt(iLen1 ^ 2 + iLen2 ^ 2) > 0.98 And iLen3 / Math.Sqrt(iLen1 ^ 2 + iLen2 ^ 2) < 1.02 Then
'                    Else
'                        Exit Sub
'                    End If
'                    iCtrPt3d.X = (iCtrPt3dArr(0).X + iCtrPt3dArr(3).X) / 2
'                    iCtrPt3d.Y = (iCtrPt3dArr(0).Y + iCtrPt3dArr(3).Y) / 2
'                    iCtrPt3d.Z = (iCtrPt3dArr(0).Z + iCtrPt3dArr(3).Z) / 2

'                    If iLen1 >= iLen2 Then
'                        Chieudai = iLen1
'                        Chieurong = iLen2
'                    Else
'                        Chieudai = iLen2
'                        Chieurong = iLen1
'                    End If
'                End If

'                Chieudai = Math.Round(Chieudai, 2)
'                Chieurong = Math.Round(Chieurong, 2)

'                If 2 * (Chieudai + Chieurong) < 100 Then
'                    Dim iOblSqrCtr As New Point3d(iCtrPt3d.X, iCtrPt3d.Y, iCtrPt3d.Z)
'                    iCtrPt3d = iOblSqrCtr
'                    iHoleSize = Chieudai & "x" & Chieurong & "x" & "R" & iRadiusList(0)
'                    iHoleType = "Obl Square"
'                    HaveCtrPt = True
'                Else
'                    HaveCtrPt = False
'                End If




'            End If
'        Catch ex As Exception
'            'lw.WriteLine("Error Check obl sqre")
'        End Try
'        'lw.WriteLine("HaveCtrPt: " & HaveCtrPt.ToString)
'        'Nếu không nhận biết được là lỗ, Dùng đường Joincurve để kiểm tra lại xem có là đường tròn không
'        If HaveCtrPt = False Then
'            'lw.WriteLine("La duong kin")
'            'lw.WriteLine("Chieu dai duong kin: " & JoinCurveLent)
'            Dim iArc1() As String, iRadius1 As Double, iCos As Double, Angle_bAc As Double
'            Dim iArc2() As String, iRadius2 As Double, iCos1 As Double, Angle_bAc1 As Double

'            iArc1 = Split(ArcInfo(Split(ParmPtStr(0), ",")(0), Split(ParmPtStr(0), ",")(1), Split(ParmPtStr(0), ",")(2),
'                                  Split(ParmPtStr(1), ",")(0), Split(ParmPtStr(1), ",")(1), Split(ParmPtStr(1), ",")(2),
'                                  Split(ParmPtStr(2), ",")(0), Split(ParmPtStr(2), ",")(1), Split(ParmPtStr(2), ",")(2)), ",")

'            iArc2 = Split(ArcInfo(Split(ParmPtStr(3), ",")(0), Split(ParmPtStr(3), ",")(1), Split(ParmPtStr(3), ",")(2),
'                                  Split(ParmPtStr(4), ",")(0), Split(ParmPtStr(4), ",")(1), Split(ParmPtStr(4), ",")(2),
'                                  Split(ParmPtStr(5), ",")(0), Split(ParmPtStr(5), ",")(1), Split(ParmPtStr(5), ",")(2)), ",")

'            iRadius1 = Math.Round(CType(iArc1(3), Double), 2)
'            iRadius2 = Math.Round(CType(iArc2(3), Double), 2)
'            iRadius = Math.Round((iRadius1 + iRadius2) / 2, 2)


'            'Nếu khoảng cách giữa 2 tâm lớn hơn 0.1mm thì không phải đường tròn
'            'lw.WriteLine("Khoang cach 2 tam: " & Math.Sqrt((CType(iArc1(0), Double) - CType(iArc2(0), Double)) ^ 2 + (CType(iArc1(1), Double) - CType(iArc2(1), Double)) ^ 2 + (CType(iArc1(2), Double) - CType(iArc2(2), Double)) ^ 2))

'            If Math.Sqrt((CType(iArc1(0), Double) - CType(iArc2(0), Double)) ^ 2 + (CType(iArc1(1), Double) - CType(iArc2(1), Double)) ^ 2 + (CType(iArc1(2), Double) - CType(iArc2(2), Double)) ^ 2) > 0.1 Then
'                'lw.WriteLine("Thoat chuong trinh 1")
'                Exit Sub
'            End If

'            If (Math.PI * 2 * iRadius) / JoinCurveLent < 0.98 Or (Math.PI * 2 * iRadius) / JoinCurveLent > 1.02 Then
'                'lw.WriteLine("Thoat chuong trinh 2")
'                Exit Sub
'            End If
'            Dim iCtr(2) As Double
'            If iRadius1 / iRadius2 > 0.98 And iRadius1 / iRadius2 < 1.02 Then

'                IsArcType = True
'                iCtr(0) = (CType(iArc1(0), Double) + CType(iArc2(0), Double)) / 2
'                iCtr(1) = (CType(iArc1(1), Double) + CType(iArc2(1), Double)) / 2
'                iCtr(2) = (CType(iArc1(2), Double) + CType(iArc2(2), Double)) / 2
'                If iCheckTrans = True Then
'                    Dim transMatrix() As Double = {matrix.Xx, matrix.Yx, matrix.Zx, position.X, matrix.Xy, matrix.Yy, matrix.Zy, position.Y, matrix.Xz, matrix.Yz, matrix.Zz, position.Z}
'                    theUFSession.Trns.MapPosition(iCtr, transMatrix)

'                    iCtrPt3d.X = iCtr(0)
'                    iCtrPt3d.Y = iCtr(1)
'                    iCtrPt3d.Z = iCtr(2)
'                Else
'                    iCtrPt3d.X = iArc1(0)
'                    iCtrPt3d.Y = iArc1(1)
'                    iCtrPt3d.Z = iArc1(2)
'                End If

'                'Dim iPt As Point = workpart.Points.CreatePoint(iCtrPt3d)
'                'iPt.SetVisibility(SmartObject.VisibilityOption.Visible)
'                iHoleSize = 2 * iRadius
'                iHoleType = "Hole"
'                HaveCtrPt = True
'                IsArcType = True
'            Else
'                IsArcType = False
'            End If

'        End If
'    End Sub

'    Sub GetTangentEdge(ByVal iBody As NXOpen.Body, ByRef OutTangentEdge() As List(Of Edge), ByRef HaveOutTangentEdge As Boolean)
'        'iBody.Highlight()
'        'lw.WriteLine("GettangentEdge")
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim lw As ListingWindow = theSession.ListingWindow()
'        Dim theUISession As UI = UI.GetUI
'        Dim workpart As Part = theSession.Parts.Work

'        Dim iFreeEdgeStr As New List(Of String)
'        Dim iFreeEdge As New List(Of Edge)
'        Dim boundaryEdge1(-1) As Edge
'        Dim edgeTangentRule1 As EdgeTangentRule
'        Dim scCollector1 As ScCollector = workpart.ScCollectors.CreateCollector

'        Dim iTag As Double
'        Dim midPt(2) As Double
'        Dim iTangentEdgePt As New List(Of String)

'        Dim selectionEdges() As TaggedObject

'        Dim thePart As Part = iBody.OwningComponent.Prototype.OwningPart
'        thePart.LoadFully()
'        Dim theEdges() As Edge = iBody.GetEdges()

'        For Each thisEdge As Edge In theEdges
'            Dim theFaces() As Face = thisEdge.GetFaces()
'            If theFaces.GetLength(0) < 2 Then
'                iFreeEdge.Add(thisEdge)
'                theUFSession.Modl.AskCurveProps(thisEdge.Tag, 0.5, midPt, junk, junk, junk, trash, trash)
'                iFreeEdgeStr.Add(Math.Round(midPt(0), 3) & "," & Math.Round(midPt(1), 3) & "," & Math.Round(midPt(2), 3))
'            End If
'        Next

'        Dim iCount As Integer = 0 ' Đếm số mảng tiếp tuyến


'        Dim iEdgePt As String
'        Dim j As Integer = 1

'        For Each iEdge As Edge In iFreeEdge

'            Dim iOutTangentEdge As New List(Of Edge)

'            If iTangentEdgePt.Count = 0 Then 'Or iTangentEdgePt.Contains(iEdgePt) = False Then                'iEdge.Unhighlight()
'                edgeTangentRule1 = workpart.ScRuleFactory.CreateRuleEdgeTangent(iEdge, Nothing, True, 5, False, False)
'                Dim rules1(0) As NXOpen.SelectionIntentRule
'                rules1(0) = edgeTangentRule1
'                scCollector1.ReplaceRules(rules1, False)
'                Dim tmpEdge As Edge
'                selectionEdges = scCollector1.GetObjects

'                For Each obj As TaggedObject In selectionEdges
'                    tmpEdge = CType(obj, Edge)

'                    theUFSession.Modl.AskCurveProps(tmpEdge.Tag, 0.5, midPt, junk, junk, junk, trash, trash)

'                    If iCheckTrans = True Then
'                        Dim transMatrix() As Double = {matrix.Xx, matrix.Yx, matrix.Zx, position.X, matrix.Xy, matrix.Yy, matrix.Zy, position.Y, matrix.Xz, matrix.Yz, matrix.Zz, position.Z}
'                        theUFSession.Trns.MapPosition(midPt, transMatrix)
'                        iTangentEdgePt.Add(Math.Round(midPt(0), 3) & "," & Math.Round(midPt(1), 3) & "," & Math.Round(midPt(2), 3))
'                    Else
'                        iTangentEdgePt.Add(Math.Round(midPt(0), 3) & "," & Math.Round(midPt(1), 3) & "," & Math.Round(midPt(2), 3))
'                    End If
'                    iOutTangentEdge.Add(tmpEdge)
'                Next

'                ReDim Preserve OutTangentEdge(iCount)
'                OutTangentEdge(iCount) = iOutTangentEdge
'                iCount = iCount + 1
'                HaveOutTangentEdge = True

'            ElseIf iTangentEdgePt.Count > 0 Then
'                theUFSession.Modl.AskCurveProps(iEdge.Tag, 0.5, midPt, junk, junk, junk, trash, trash)
'                If iTangentEdgePt.Contains(Math.Round(midPt(0), 3) & "," & Math.Round(midPt(1), 3) & "," & Math.Round(midPt(2), 3)) = False Then
'                    edgeTangentRule1 = workpart.ScRuleFactory.CreateRuleEdgeTangent(iEdge, Nothing, True, 5, False, False)
'                    Dim rules1(0) As NXOpen.SelectionIntentRule
'                    rules1(0) = edgeTangentRule1
'                    scCollector1.ReplaceRules(rules1, False)
'                    Dim tmpEdge As Edge
'                    selectionEdges = scCollector1.GetObjects

'                    For Each obj As TaggedObject In selectionEdges
'                        tmpEdge = CType(obj, Edge)
'                        theUFSession.Modl.AskCurveProps(tmpEdge.Tag, 0.5, midPt, junk, junk, junk, trash, trash)

'                        If iCheckTrans = True Then
'                            Dim transMatrix() As Double = {matrix.Xx, matrix.Yx, matrix.Zx, position.X, matrix.Xy, matrix.Yy, matrix.Zy, position.Y, matrix.Xz, matrix.Yz, matrix.Zz, position.Z}
'                            theUFSession.Trns.MapPosition(midPt, transMatrix)
'                            iTangentEdgePt.Add(Math.Round(midPt(0), 3) & "," & Math.Round(midPt(1), 3) & "," & Math.Round(midPt(2), 3))
'                            iOutTangentEdge.Add(tmpEdge)
'                        Else
'                            iTangentEdgePt.Add(Math.Round(midPt(0), 3) & "," & Math.Round(midPt(1), 3) & "," & Math.Round(midPt(2), 3))
'                            iOutTangentEdge.Add(tmpEdge)
'                        End If
'                    Next


'                    ReDim Preserve OutTangentEdge(iCount)
'                    OutTangentEdge(iCount) = iOutTangentEdge
'                    HaveOutTangentEdge = True
'                    iCount = iCount + 1
'                End If
'            End If
'        Next

'    End Sub

'    Sub iExtractCurve(ByVal iOutTangenEdge As List(Of Edge), ByRef iCtrPt3dArr() As Point3d,
'                      ByRef iRadiusList As List(Of Double), ByRef ParmPtStr() As String, ByRef JoinCurveLent As Double, ByRef iCheckClosetCurve As Boolean, ByVal dtPosition As DataTable)
'        'lw.WriteLine("Extract curve")
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim lw As ListingWindow = theSession.ListingWindow()
'        Dim theUISession As UI = UI.GetUI
'        Dim workpart As Part = theSession.Parts.Work

'        Dim tagCurve As Tag
'        'Dim tmpCurveArr() As Curve
'        Dim iCount As Integer = 0
'        Dim minDist As Double

'        Dim stPt(2) As Double, edPt(2) As Double
'        Dim stPt1(2) As Double, edPt1(2) As Double
'        Dim tmpCurveArr() As Curve
'        'Dim iPartName1 As String = iOutTangenEdge.Item(0).OwningComponent.GetStringAttribute("DB_PART_NO").ToString
'        'For Each tmpEdge As Edge In iOutTangenEdge
'        '    lw.WriteLine(tmpEdge.OwningComponent.GetStringAttribute("DB_PART_NO").ToString)
'        '    Exit For
'        'Next
'        'lw.WriteLine("iPartName1: " & iPartName1)
'        'Không Wave những đường curve không ở cùng 1 mặt
'        Dim tmpFaceTag As String = iOutTangenEdge.Item(0).GetFaces(0).Tag.ToString
'        If iOutTangenEdge.Count > 1 Then
'            For Each tmpEdge As Edge In iOutTangenEdge
'                'tmpEdge.Highlight()
'                Dim iTestFace As String = tmpEdge.GetFaces(0).Tag.ToString
'                If tmpFaceTag <> iTestFace Then
'                    Exit Sub
'                End If
'            Next
'        End If

'        For Each iEdge As Edge In iOutTangenEdge
'            If iEdge.GetFaces.Length = 1 Then
'                Try
'                    theUFSession.Modl.CreateCurveFromEdge(iEdge.Tag, tagCurve)
'                    ReDim Preserve tmpCurveArr(iCount)
'                    tmpCurveArr(iCount) = CType(NXObjectManager.Get(tagCurve), Curve)
'                    iCount = iCount + 1
'                Catch ex As Exception
'                End Try

'            End If
'        Next
'        Dim iFaceType As Double, iNormalVector(2) As Double
'        Dim tmpPoint(2) As Double
'        Dim iBox(5) As Double
'        Dim tmpRadius As Double
'        Dim rad_data As Double

'        Dim inx As Integer = 0
'        Dim curves() As NXOpen.Tag
'        Dim num_curves As Integer
'        Dim num_joined As Integer
'        Dim n As String = vbCrLf
'        Dim join_type As Integer = 1
'        Dim joined(num_curves) As NXOpen.Tag

'        For Each iCurve3 As Curve In tmpCurveArr
'            ReDim Preserve curves(num_curves)
'            curves(num_curves) = iCurve3.Tag
'            num_curves = num_curves + 1
'        Next

'        theUFSession.Curve.AutoJoinCurves(curves, num_curves, join_type, joined, num_joined)

'        Dim edPt12(2) As Double, stPt12(2) As Double

'        theUFSession.Modl.AskCurveProps(joined(0), 0, stPt12, junk, junk, junk, trash, trash)
'        theUFSession.Modl.AskCurveProps(joined(0), 1, edPt12, junk, junk, junk, trash, trash)
'        JoinCurveLent = CType(NXObjectManager.Get(joined(0)), Curve).GetLength

'        iCheckClosetCurve = False

'        If Math.Sqrt((stPt12(0) - edPt12(0)) ^ 2 + (stPt12(1) - edPt12(1)) ^ 2 + (stPt12(2) - edPt12(2)) ^ 2) <= 0.1 Then
'            iCheckClosetCurve = True
'        End If

'        If iCheckClosetCurve = False Then
'            theUFSession.Obj.DeleteObject(joined(0))
'            GoTo DeleteCurve
'        End If

'        Dim iParmArr() As Double = {0, 1 / 3, 2 / 3, 1 / 6, 1 / 2, 5 / 6}
'        Dim ij As Double

'        For ij = 0 To 5
'            Dim tmpPt(2) As Double
'            theUFSession.Modl.AskCurveProps(joined(0), iParmArr(ij), tmpPt, junk, junk, junk, trash, trash)
'            ReDim Preserve ParmPtStr(ij)
'            ParmPtStr(ij) = tmpPt(0) & "," & tmpPt(1) & "," & tmpPt(2)
'        Next
'        'lw.WriteLine("Delete join curve")
'        theUFSession.Obj.DeleteObject(joined(0))
'        Dim FaceRadius As Double
'        'iOutTangenEdge.Item(0).Highlight()
'        theUFSession.Modl.AskFaceData(iOutTangenEdge.Item(0).GetFaces(0).Tag, iFaceType, tmpPoint, iNormalVector, iBox, FaceRadius, Nothing, Nothing)
'        'lw.WriteLine("iFaceType 111: " & iFaceType)


'        '/////////PHÂN TÍCH CÁC ĐƯỜNG CURVE
'        Dim OtherCurve() As Curve
'        Dim iCtrPtStr As New List(Of String)
'        Dim i As Integer, j As Integer, k As Integer
'        Dim IsArcType As Boolean = False, iCtrPt3d As Point3d, iRadius As Double
'        Dim iCheckArcCurve As Boolean = False, iCheckOtherCurve As Boolean = False, tmpCtrPtStr As String

'        For Each tmpCurve As Curve In tmpCurveArr
'            Call GetArcInfor(tmpCurve, IsArcType, iCtrPt3d, iRadius)
'            'lw.WriteLine("Gia tri ban kinh: " & iRadius)

'            If IsArcType = True Then

'                iCheckArcCurve = True
'                tmpCtrPtStr = Math.Round(iCtrPt3d.X, 1) & Math.Round(iCtrPt3d.Y, 1) & Math.Round(iCtrPt3d.Z, 1)

'                If iCtrPtStr.Contains(tmpCtrPtStr) = False Then
'                    iCtrPtStr.Add(tmpCtrPtStr)
'                    ReDim Preserve iCtrPt3dArr(i)
'                    iCtrPt3dArr(i) = iCtrPt3d
'                    i = i + 1
'                End If

'                If iRadiusList.Contains(iRadius) = False Then
'                    iRadiusList.Add(iRadius)
'                End If
'            Else
'                iCheckOtherCurve = True
'                ReDim Preserve OtherCurve(j)
'                OtherCurve(j) = tmpCurve
'                j = j + 1
'            End If
'        Next


'        If iCtrPt3dArr.Length = 4 And iRadiusList.Count = 3 Then
'            'lw.WriteLine("Lay thong tin Daruma")
'            Dim IsArcType1 As Boolean = False
'            Dim iCtrPt3d1 As Point3d, iRadius1 As Double
'            Dim dRadius() As Double, dCtrPt3d() As Point3d, dCount As Integer


'            For Each tmpCurve As Curve In tmpCurveArr
'                Call GetArcInfor(tmpCurve, IsArcType1, iCtrPt3d1, iRadius1)
'                If IsArcType1 = True Then
'                    ReDim Preserve dRadius(dCount)
'                    dRadius(dCount) = iRadius1

'                    ReDim Preserve dCtrPt3d(dCount)
'                    dCtrPt3d(dCount) = iCtrPt3d1

'                    dCount = dCount + 1
'                End If

'            Next

'            Dim RMax As Double, RMin As Double, RFilet(1) As Double
'            Dim CtrPtMax As Point3d, CtrPtMin As Point3d, CtrPtFilet(1) As Point3d
'            Dim m As Integer
'            For i = 0 To 2
'                For j = i + 1 To 3
'                    If dRadius(i) = dRadius(j) Then
'                        CtrPtFilet(0) = dCtrPt3d(i)
'                        CtrPtFilet(1) = dCtrPt3d(j)
'                        For k = 0 To 2
'                            If k <> i Then
'                                If k <> j Then
'                                    For m = k + 1 To 3
'                                        If m <> i Then
'                                            If m <> j Then
'                                                If dRadius(k) > dRadius(m) Then
'                                                    RMax = dRadius(k)
'                                                    CtrPtMax = dCtrPt3d(k)
'                                                    RMin = dRadius(m)
'                                                    CtrPtMin = dCtrPt3d(m)
'                                                Else
'                                                    RMax = dRadius(m)
'                                                    CtrPtMax = dCtrPt3d(m)
'                                                    RMin = dRadius(k)
'                                                    CtrPtMin = dCtrPt3d(k)
'                                                End If
'                                            End If
'                                        End If
'                                    Next
'                                End If
'                            End If
'                        Next
'                    End If
'                Next
'            Next

'            'lw.WriteLine("Rmax: " & RMax)
'            'lw.WriteLine("RMin: " & RMin)

'            Dim v1 As New Vector3d(CtrPtFilet(0).X - CtrPtFilet(1).X, CtrPtFilet(0).Y - CtrPtFilet(1).Y, CtrPtFilet(0).Z - CtrPtFilet(1).Z)
'            Dim v2 As New Vector3d(CtrPtMax.X - CtrPtMin.X, CtrPtMax.Y - CtrPtMin.Y, CtrPtMax.Z - CtrPtMin.Z)

'            If Math.Round((v1.X * v2.X + v1.Y * v2.Y + v1.Z * v2.Z) / (Math.Sqrt(v1.X ^ 2 + v1.Y ^ 2 + v1.Z ^ 2) * Math.Sqrt(v2.X ^ 2 + v2.Y ^ 2 + v2.Z ^ 2)), 3) = 0 Then
'                Dim iPt As NXOpen.Point = workpart.Points.CreatePoint(CtrPtMin)
'                iPt.SetVisibility(SmartObject.VisibilityOption.Visible)
'                Dim iFuncNo As String
'                Call iSearchFuncNo(OwningComp, iFuncNo)
'                Dim iPartName As String = OwningComp.GetStringAttribute("DB_PART_NAME").ToString
'                Dim iPartNo As String = OwningComp.GetStringAttribute("DB_PART_NO").ToString
'                ''itagPart = iBody.OwningComponent.Tag
'                Call InsertToPositionDataTable(iFuncNo, iPartNo, iPartName, Nothing, "Sheet Body", "Daruma", 2 * RMin, iBody, CtrPtMin, dtPosition)

'            End If
'        End If
'DeleteCurve:
'        Try
'            For Each iCurve1 As Curve In tmpCurveArr
'                theUFSession.Obj.DeleteObject(iCurve1.Tag)
'            Next
'        Catch ex As Exception

'        End Try
'    End Sub

'    Sub GetArcInfor(ByVal iCurve As Curve, ByRef IsArcType As Boolean, ByRef iCtrPt3d As Point3d, ByRef iRadius As Double)
'        'lw.WriteLine("Lay thong tin duong tron")
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim stPt(2) As Double
'        Dim edPt(2) As Double
'        Dim midPt(2) As Double

'        Dim stPt1(2) As Double
'        Dim edPt1(2) As Double
'        Dim midPt1(2) As Double
'        iRadius = 0

'        theUFSession.Modl.AskCurveProps(iCurve.Tag, 0, stPt, junk, junk, junk, trash, trash)
'        theUFSession.Modl.AskCurveProps(iCurve.Tag, 0.5, midPt, junk, junk, junk, trash, trash)
'        theUFSession.Modl.AskCurveProps(iCurve.Tag, 1, edPt, junk, junk, junk, trash, trash)

'        If Math.Round(Math.Sqrt((stPt(0) - edPt(0)) ^ 2 + (stPt(1) - edPt(1)) ^ 2 + (stPt(2) - edPt(2)) ^ 2), 2) = Math.Round(iCurve.GetLength, 2) Then
'            'lw.WriteLine("la duong thang")
'            IsArcType = False
'            Exit Sub
'        ElseIf iCurve.GetLength >= 100 Then
'            IsArcType = False
'            Exit Sub
'        End If
'        'lw.WriteLine("Chieu dai: " & iCurve.GetLength)
'        Try
'            Dim arc_evaluator As System.IntPtr
'            Dim arc_data As NXOpen.UF.UFEval.Arc
'            theUFSession.Eval.Initialize(iCurve.Tag, arc_evaluator)
'            theUFSession.Eval.AskArc(arc_evaluator, arc_data)
'            'lw.WriteLine("La duong tron dep")
'            If iCheckTrans = True Then
'                Dim transMatrix() As Double = {matrix.Xx, matrix.Yx, matrix.Zx, position.X, matrix.Xy, matrix.Yy, matrix.Zy, position.Y, matrix.Xz, matrix.Yz, matrix.Zz, position.Z}
'                theUFSession.Trns.MapPosition(arc_data.center, transMatrix)
'                iCtrPt3d.X = arc_data.center(0)
'                iCtrPt3d.Y = arc_data.center(1)
'                iCtrPt3d.Z = arc_data.center(2)
'            Else

'                iCtrPt3d.X = arc_data.center(0)
'                iCtrPt3d.Y = arc_data.center(1)
'                iCtrPt3d.Z = arc_data.center(2)
'            End If


'            iRadius = Math.Round(arc_data.radius, 2)
'            IsArcType = True

'        Catch ex As Exception
'            'lw.WriteLine("Xet duong tron")

'            Dim tmpRadius1 As Double
'            Dim tmpRadius2 As Double
'            Dim tmpRadius3 As Double

'            Dim tmpRadius4 As Double
'            Dim tmpRadius5 As Double
'            Dim tmpRadius6 As Double

'            theUFSession.Modl.AskCurveProps(iCurve.Tag, 0, stPt, junk, junk, junk, trash, tmpRadius1)
'            theUFSession.Modl.AskCurveProps(iCurve.Tag, 1 / 3, midPt, junk, junk, junk, trash, tmpRadius2)
'            theUFSession.Modl.AskCurveProps(iCurve.Tag, 2 / 3, edPt, junk, junk, junk, trash, tmpRadius3)

'            theUFSession.Modl.AskCurveProps(iCurve.Tag, 1 / 6, stPt1, junk, junk, junk, trash, tmpRadius4)
'            theUFSession.Modl.AskCurveProps(iCurve.Tag, 1 / 2, midPt1, junk, junk, junk, trash, tmpRadius5)
'            theUFSession.Modl.AskCurveProps(iCurve.Tag, 5 / 6, edPt1, junk, junk, junk, trash, tmpRadius6)

'            'If tmpRadius1 / tmpRadius2 < 0.7 Or tmpRadius1 / tmpRadius2 > 1.3 Then
'            '    IsArcType = False
'            '    Exit Sub
'            'End If

'            'If tmpRadius1 / tmpRadius3 < 0.7 Or tmpRadius1 / tmpRadius3 > 1.3 Then
'            '    IsArcType = False
'            '    Exit Sub
'            'End If

'            'If tmpRadius4 / tmpRadius5 < 0.7 Or tmpRadius4 / tmpRadius5 > 1.3 Then
'            '    IsArcType = False
'            '    Exit Sub
'            'End If

'            'If tmpRadius4 / tmpRadius6 < 0.7 Or tmpRadius4 / tmpRadius6 > 1.3 Then
'            '    IsArcType = False
'            '    Exit Sub
'            'End If

'            Dim iArc1() As String, iRadius1 As Double, iCos As Double, Angle_bAc As Double
'            Dim iArc2() As String, iRadius2 As Double, iCos1 As Double, Angle_bAc1 As Double

'            iArc1 = Split(ArcInfo(stPt(0), stPt(1), stPt(2), midPt(0), midPt(1), midPt(2), edPt(0), edPt(1), edPt(2)), ",")
'            iArc2 = Split(ArcInfo(stPt1(0), stPt1(1), stPt1(2), midPt1(0), midPt1(1), midPt1(2), edPt1(0), edPt1(1), edPt1(2)), ",")
'            Dim iCtr(2) As Double

'            iRadius1 = iArc1(3)
'            iRadius2 = iArc2(3)


'            If Math.Sqrt((CType(iArc1(0), Double) - CType(iArc2(0), Double)) ^ 2 + (CType(iArc1(1), Double) - CType(iArc2(1), Double)) ^ 2 + (CType(iArc1(2), Double) - CType(iArc2(2), Double)) ^ 2) > 0.1 Then
'                ''lw.WriteLine("Khoang cach 2 tam qua lon")
'                IsArcType = False
'                Exit Sub
'            End If
'            If iRadius1 / iRadius2 > 0.98 And iRadius1 / iRadius2 < 1.02 Then
'                IsArcType = True
'                iCtr(0) = (CType(iArc1(0), Double) + CType(iArc2(0), Double)) / 2
'                iCtr(1) = (CType(iArc1(1), Double) + CType(iArc2(1), Double)) / 2
'                iCtr(2) = (CType(iArc1(2), Double) + CType(iArc2(2), Double)) / 2
'                iRadius = Math.Round((iRadius1 + iRadius2) / 2, 2)
'                'lw.WriteLine("iRadius: " & iRadius)
'                'lw.WriteLine("")
'                If iCheckTrans = True Then
'                    Dim transMatrix() As Double = {matrix.Xx, matrix.Yx, matrix.Zx, position.X, matrix.Xy, matrix.Yy, matrix.Zy, position.Y, matrix.Xz, matrix.Yz, matrix.Zz, position.Z}
'                    theUFSession.Trns.MapPosition(iCtr, transMatrix)

'                    iCtrPt3d.X = iCtr(0)
'                    iCtrPt3d.Y = iCtr(1)
'                    iCtrPt3d.Z = iCtr(2)
'                Else
'                    iCtrPt3d.X = iArc1(0)
'                    iCtrPt3d.Y = iArc1(1)
'                    iCtrPt3d.Z = iArc1(2)
'                End If
'            Else
'                IsArcType = False
'            End If
'        End Try

'    End Sub

'    Sub D001_DistanceMesure(ByVal iObj1 As NXObject, ByVal iObj2 As NXObject, ByRef iDistance As Double)
'        Dim theSession As Session = Session.GetSession()
'        Dim workpart As Part = theSession.Parts.Work
'        Dim nullUnit As Unit = Nothing
'        Dim theDispObject1 As DisplayableObject = CType(iObj1, DisplayableObject)
'        Dim theDispObject2 As DisplayableObject = CType(iObj2, DisplayableObject)
'        Dim measureDistance1 As MeasureDistance = workpart.MeasureManager.NewDistance(nullUnit, MeasureManager.MeasureType.Minimum, theDispObject1, theDispObject2)
'        iDistance = Math.Round(measureDistance1.Value, 3)
'    End Sub

'    Sub D001_AngleMesure(ByVal iObj1 As NXObject, ByVal iObj2 As NXObject, ByRef iAngle As Double)
'        Dim theSession As Session = Session.GetSession()
'        Dim workpart As Part = theSession.Parts.Work
'        Dim units As Unit = workpart.UnitCollection.GetBase("Angle")
'        Dim angle As MeasureAngle = workpart.MeasureManager.NewAngle(units, iObj1, MeasureManager.EndpointType.EndPoint, iObj2, MeasureManager.EndpointType.EndPoint, True)
'        iAngle = Math.Round(angle.Value, 3)
'    End Sub

'    Sub InsertPositionOutToExcel(ByVal iBui As String, ByVal iGroupNo As String, ByVal iPartNo As String, ByVal X1 As Double, ByVal Y1 As Double,
'                               ByVal Z1 As Double, ByVal imono As String, ByVal iHoletype As String, ByVal iHandan As String,
'                               ByVal xDirect As String, ByVal yDirect As String, ByVal iFunc As String, ByVal OutCsysName As String, ByVal dtDanmenOut As DataTable)
'        Dim row As DataRow = dtDanmenOut.NewRow
'        row("進捗") = ""
'        row("Group") = iGroupNo
'        'row("部位")
'        row("Function") = iFunc
'        row("Part No") = iPartNo
'        row("Origin X") = X1
'        row("Origin Y") = Y1
'        row("Origin Z") = Z1
'        row("締結物") = imono
'        row("Type") = iHoletype
'        'row("判断")
'        row("Csys DirX") = xDirect
'        row("Csys DirY") = yDirect
'        row("CsysPMI") = OutCsysName
'        row("DanmenNo") = ""

'        dtDanmenOut.Rows.Add(row)
'        dtDanmenOut.AcceptChanges()

'    End Sub

'    ''''''締結_断面作成

'    Sub CutDanmenNew(ByVal Partname As String, ByVal iSectDanmen As Component, ByVal iPtStr As String, ByVal xDirect As String, ByVal yDirect As String, ByVal OutCsysName As String, ByRef OutCs As Features.Feature)
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        Dim theSession As Session = Session.GetSession()
'        theSession.Parts.SetWorkComponent(iSectDanmen, partLoadStatus1)

'        Dim workPart As Part = theSession.Parts.Work

'        Dim ts As TimeSpan
'        ts = New TimeSpan(0, 0, 1)
'        Dim tmpGrp As NXOpen.Tag = NXOpen.Tag.Null
'        Dim myGroup As Group
'        Dim numMembers As Integer
'        Dim memberTags() As Tag
'        Dim numOwningGroups As Integer
'        Dim owningGroups() As Tag
'        Dim i As Integer

'        Dim icheck As Integer
'        icheck = 1
'        'theSession.Parts.SetWorkComponent(iSectAssy, NXOpen.PartCollection.RefsetOption.Entire, NXOpen.PartCollection.WorkComponentOption.Visible, partLoadStatus1)
'        Dim iASSNo As String
'        Dim iPart As Component
'        If icheck = 1 Then
'            'workpart = theSession.Parts.Work
'            'Creat_Assy(Partname, iASSNo)
'            'CreateAssyNewLv2(Partname, iPart)
'            iASSNo = iSectDanmen.GetStringAttribute("DB_PART_NO").ToString
'            icheck = 2
'        End If


'        Dim iSectX As Component
'        AddPartToAssy(Partname & "X", iSectX)



'        Call CreateCsysOutput(iPtStr, xDirect, yDirect, OutCsysName, iSectX, OutCs)
'        Dim iSelCoor As CartesianCoordinateSystem
'        For Each iObj As NXOpen.NXObject In OutCs.GetEntities
'            'lw.WriteLine(iObj.GetType.ToString)
'            If TypeOf (iObj) Is CartesianCoordinateSystem Then
'                iSelCoor = iObj
'            End If
'        Next
'        Call iReset()
'        'lw.WriteLine("Bat dau cat mat cat X: " & Now.ToString)
'        Call aCreSecX(iSelCoor)
'        'lw.WriteLine("Ket thuc cat mat cat X: " & Now.ToString)
'        Do
'            workPart = theSession.Parts.Work
'            theUFSession.Obj.CycleObjsInPart(workPart.Tag, UFConstants.UF_group_type, tmpGrp)
'            If tmpGrp = NXOpen.Tag.Null Then
'                Continue Do
'            End If
'            myGroup = Utilities.NXObjectManager.Get(tmpGrp)
'            Dim iName As String = Partname & "X"
'            'lw.WriteLine(myGroup.Name)
'            'lw.WriteLine("Start Rename Sect X" & Partname.ToString & " - " & Now.ToString)
'            If InStr(myGroup.Name.ToString.ToUpper, "SECTION") > 0 And InStr(myGroup.Name.ToString.ToUpper, "DYNAMIC") = 0 Then
'                'lw.WriteLine(myGroup.Name)
'                myGroup.SetName(iName)
'                'lw.WriteLine("End Rename Sect X" & Partname.ToString & " - " & Now.ToString)
'                Exit Do
'            End If
'        Loop

'        Call SaveData()


'        SetWorkPartByNo(iASSNo, "AA")

'        Dim iSectY As Component
'        AddPartToAssy(Partname & "Y", iSectY)
'        Call CreateCsysOutput(iPtStr, xDirect, yDirect, OutCsysName, iSectY, OutCs)
'        Dim iSelCoor1 As CartesianCoordinateSystem
'        For Each iObj As NXOpen.NXObject In OutCs.GetEntities
'            'lw.WriteLine(iObj.GetType.ToString)
'            If TypeOf (iObj) Is CartesianCoordinateSystem Then
'                iSelCoor1 = iObj
'            End If
'        Next
'        Call iReset()
'        'lw.WriteLine("Start Create Sect Y" & Partname.ToString & " - " & Now.ToString)
'        'lw.WriteLine("Bat dau cat mat cat Y: " & Now.ToString)
'        Call aCreSecY(iSelCoor1)
'        'lw.WriteLine("Ket thuc cat mat cat Y: " & Now.ToString)
'        'Dim iPtStr As String = iSelCoor.Origin.X & "," & iSelCoor.Origin.Y & "," & iSelCoor.Origin.Z
'        'Dim OutCsysName As String = Nothing
'        ''Dim isecAuto As Component
'        'Dim OutCs As Features.Feature
'        'Call CreateCsysOutput(iPtStr, xDirect, yDirect, OutCsysName, iSectDanmen, OutCs)

'        Do
'            workPart = theSession.Parts.Work
'            theUFSession.Obj.CycleObjsInPart(workPart.Tag, UFConstants.UF_group_type, tmpGrp)
'            If tmpGrp = NXOpen.Tag.Null Then
'                Continue Do
'            End If
'            myGroup = Utilities.NXObjectManager.Get(tmpGrp)
'            Dim iName As String = Partname & "Y"
'            'lw.WriteLine(myGroup.Name)
'            'lw.WriteLine("Start Rename Sect Y" & Partname.ToString & " - " & Now.ToString)
'            If InStr(myGroup.Name.ToString.ToUpper, "SECTION") > 0 And InStr(myGroup.Name.ToString.ToUpper, "DYNAMIC") = 0 Then
'                'lw.WriteLine(myGroup.Name)
'                myGroup.SetName(iName)
'                'lw.WriteLine("End Rename Sect Y" & Partname.ToString & " - " & Now.ToString)
'                i = i + 1
'                Exit Do

'            End If
'        Loop
'        Call SaveData()
'        SetWorkPartByNo(iASSNo, "AA")

'    End Sub

'    Sub aCreSecX(ByVal iSelCoor As NXOpen.CartesianCoordinateSystem)
'        Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim iMatrix As Matrix3x3 = iSelCoor.Orientation.Element
'        'Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        'Call iReset()
'        ' ----------------------------------------------
'        ' メニュー: 表示(V)->断面(S)->断面を編集(C)...
'        ' ----------------------------------------------
'        Dim dynamicSectionBuilder1 As NXOpen.Display.DynamicSectionBuilder = Nothing
'        dynamicSectionBuilder1 = displayPart.DynamicSections.CreateSectionBuilder(displayPart.ModelingViews.WorkView)
'        dynamicSectionBuilder1.DeferCurveUpdate = False

'        'Dim origin0 As NXOpen.Point3d = New NXOpen.Point3d(0.0, 0.0, 0.0)
'        'Dim normal1 As NXOpen.Vector3d = New NXOpen.Vector3d(0.0, 0.0, 1.0)
'        'Dim plane1 As NXOpen.Plane = Nothing
'        'plane1 = workPart.Planes.CreatePlane(origin0, normal1, NXOpen.SmartObject.UpdateOption.WithinModeling)

'        Dim unit1 As NXOpen.Unit = CType(workPart.UnitCollection.FindObject("MilliMeter"), NXOpen.Unit)

'        'Dim expression1 As NXOpen.Expression = Nothing
'        'expression1 = workPart.Expressions.CreateSystemExpressionWithUnits("0", unit1)

'        'Dim expression2 As NXOpen.Expression = Nothing
'        'expression2 = workPart.Expressions.CreateSystemExpressionWithUnits("0", unit1)

'        'dynamicSectionBuilder1.DefaultPlaneAxis = NXOpen.Display.DynamicSectionTypes.Axis.Z
'        'plane1.SetMethod(NXOpen.PlaneTypes.MethodType.Coincident)

'        dynamicSectionBuilder1.ShowClip = False
'        dynamicSectionBuilder1.CsysType = NXOpen.Display.DynamicSectionTypes.CoordinateSystem.Absolute

'        dynamicSectionBuilder1.DefaultPlaneAxis = NXOpen.Display.DynamicSectionTypes.Axis.Z

'        Dim modelingView1 As NXOpen.ModelingView = Nothing
'        modelingView1 = dynamicSectionBuilder1.View
'        dynamicSectionBuilder1.Type = NXOpen.Display.DynamicSectionTypes.Type.Box

'        dynamicSectionBuilder1.DeferCurveUpdate = False 'True

'        Dim originX As NXOpen.Point3d = New NXOpen.Point3d(iSelCoor.Origin.X, iSelCoor.Origin.Y, iSelCoor.Origin.Z)
'        'modelingView1.SetOrigin(originX)

'        Dim rotMatrix1 As NXOpen.Matrix3x3 = Nothing
'        rotMatrix1.Xx = iMatrix.Zx
'        rotMatrix1.Xy = iMatrix.Zy
'        rotMatrix1.Xz = iMatrix.Zz
'        rotMatrix1.Yx = iMatrix.Yx
'        rotMatrix1.Yy = iMatrix.Yy
'        rotMatrix1.Yz = iMatrix.Yz
'        rotMatrix1.Zx = iMatrix.Xx
'        rotMatrix1.Zy = iMatrix.Xy
'        rotMatrix1.Zz = iMatrix.Xz
'        dynamicSectionBuilder1.SetPlane(originX, originX, rotMatrix1)

'        Dim iDistance As Double = 50

'        Dim iZ1 As New Point3d(iSelCoor.Origin.X + iMatrix.Zx * iDistance, iSelCoor.Origin.Y + iMatrix.Zy * iDistance, iSelCoor.Origin.Z + iMatrix.Zz * iDistance)
'        Dim iZ2 As New Point3d(2 * iSelCoor.Origin.X - iZ1.X, 2 * iSelCoor.Origin.Y - iZ1.Y, 2 * iSelCoor.Origin.Z - iZ1.Z)


'        Dim iY1 As New Point3d(iSelCoor.Origin.X + iMatrix.Yx * iDistance, iSelCoor.Origin.Y + iMatrix.Yy * iDistance, iSelCoor.Origin.Z + iMatrix.Yz * iDistance)
'        Dim iY2 As New Point3d(2 * iSelCoor.Origin.X - iY1.X, 2 * iSelCoor.Origin.Y - iY1.Y, 2 * iSelCoor.Origin.Z - iY1.Z)

'        dynamicSectionBuilder1.SetActivePlane(NXOpen.Display.DynamicSectionTypes.Axis.X, NXOpen.Display.DynamicSectionTypes.ActivePlane.Primary)
'        dynamicSectionBuilder1.SetOrigin(iZ1)

'        dynamicSectionBuilder1.SetActivePlane(NXOpen.Display.DynamicSectionTypes.Axis.X, NXOpen.Display.DynamicSectionTypes.ActivePlane.Secondary)
'        dynamicSectionBuilder1.SetOrigin(iZ2)


'        dynamicSectionBuilder1.SetActivePlane(NXOpen.Display.DynamicSectionTypes.Axis.Y, NXOpen.Display.DynamicSectionTypes.ActivePlane.Primary)
'        dynamicSectionBuilder1.SetOrigin(iY1)

'        dynamicSectionBuilder1.SetActivePlane(NXOpen.Display.DynamicSectionTypes.Axis.Y, NXOpen.Display.DynamicSectionTypes.ActivePlane.Secondary)
'        dynamicSectionBuilder1.SetOrigin(iY2)


'        dynamicSectionBuilder1.SetActivePlane(NXOpen.Display.DynamicSectionTypes.Axis.Z, NXOpen.Display.DynamicSectionTypes.ActivePlane.Primary)
'        dynamicSectionBuilder1.SetOrigin(originX)

'        dynamicSectionBuilder1.SetActivePlane(NXOpen.Display.DynamicSectionTypes.Axis.Z, NXOpen.Display.DynamicSectionTypes.ActivePlane.Secondary)
'        dynamicSectionBuilder1.SetOrigin(originX)


'        dynamicSectionBuilder1.SaveCurves(Nothing)

'        Dim nXObject1 As NXOpen.NXObject = Nothing
'        nXObject1 = dynamicSectionBuilder1.Commit()

'        Dim objects2() As NXOpen.NXObject
'        objects2 = dynamicSectionBuilder1.GetCommittedObjects()

'        'Dim objects3(0) As NXOpen.NXObject
'        'objects3(0) = plane1
'        'Dim nErrs2 As Integer = Nothing
'        'nErrs2 = theSession.UpdateManager.AddToDeleteList(objects3)

'        dynamicSectionBuilder1.Destroy()

'        'Try
'        '    式はまだ使用中です()
'        '    workPart.Expressions.Delete(expression2)
'        'Catch ex As NXException
'        '    ex.AssertErrorCode(1050029)
'        'End Try

'        'Try
'        '    ' 式はまだ使用中です
'        '    workPart.Expressions.Delete(expression1)
'        'Catch ex As NXException
'        '    ex.AssertErrorCode(1050029)
'        'End Try
'        theSession.CleanUpFacetedFacesAndEdges()

'    End Sub

'    Sub aCreSecY(ByVal iSelCoor As NXOpen.CartesianCoordinateSystem)
'        Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim iMatrix As Matrix3x3 = iSelCoor.Orientation.Element
'        'Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        'Call iReset()
'        ' ----------------------------------------------
'        ' メニュー: 表示(V)->断面(S)->断面を編集(C)...
'        ' ----------------------------------------------
'        Dim dynamicSectionBuilder1 As NXOpen.Display.DynamicSectionBuilder = Nothing
'        dynamicSectionBuilder1 = displayPart.DynamicSections.CreateSectionBuilder(displayPart.ModelingViews.WorkView)

'        dynamicSectionBuilder1.DeferCurveUpdate = False

'        'Dim origin0 As NXOpen.Point3d = New NXOpen.Point3d(0.0, 0.0, 0.0)
'        'Dim normal1 As NXOpen.Vector3d = New NXOpen.Vector3d(0.0, 0.0, 1.0)
'        'Dim plane1 As NXOpen.Plane = Nothing
'        'plane1 = workPart.Planes.CreatePlane(origin0, normal1, NXOpen.SmartObject.UpdateOption.WithinModeling)

'        'Dim unit1 As NXOpen.Unit = CType(workPart.UnitCollection.FindObject("MilliMeter"), NXOpen.Unit)

'        'Dim expression1 As NXOpen.Expression = Nothing
'        'expression1 = workPart.Expressions.CreateSystemExpressionWithUnits("0", unit1)
'        'Dim expression2 As NXOpen.Expression = Nothing
'        'expression2 = workPart.Expressions.CreateSystemExpressionWithUnits("0", unit1)
'        dynamicSectionBuilder1.SeriesSpacing = 71.0
'        dynamicSectionBuilder1.DefaultPlaneAxis = NXOpen.Display.DynamicSectionTypes.Axis.Z
'        'plane1.SetMethod(NXOpen.PlaneTypes.MethodType.Coincident)
'        dynamicSectionBuilder1.ShowClip = False
'        dynamicSectionBuilder1.CsysType = NXOpen.Display.DynamicSectionTypes.CoordinateSystem.Absolute
'        dynamicSectionBuilder1.DefaultPlaneAxis = NXOpen.Display.DynamicSectionTypes.Axis.Z
'        Dim modelingView1 As NXOpen.ModelingView = Nothing
'        modelingView1 = dynamicSectionBuilder1.View
'        dynamicSectionBuilder1.Type = NXOpen.Display.DynamicSectionTypes.Type.Box

'        dynamicSectionBuilder1.DeferCurveUpdate = False
'        Dim originX As NXOpen.Point3d = New NXOpen.Point3d(iSelCoor.Origin.X, iSelCoor.Origin.Y, iSelCoor.Origin.Z)
'        modelingView1.SetOrigin(originX)

'        Dim rotMatrix1 As NXOpen.Matrix3x3 = Nothing
'        rotMatrix1.Xx = iMatrix.Xx
'        rotMatrix1.Xy = iMatrix.Xy
'        rotMatrix1.Xz = iMatrix.Xz
'        rotMatrix1.Yx = iMatrix.Zx
'        rotMatrix1.Yy = iMatrix.Zy
'        rotMatrix1.Yz = iMatrix.Zz
'        rotMatrix1.Zx = iMatrix.Yx
'        rotMatrix1.Zy = iMatrix.Yy
'        rotMatrix1.Zz = iMatrix.Yz
'        dynamicSectionBuilder1.SetPlane(originX, originX, rotMatrix1)

'        Dim iDistance As Double = 50

'        Dim iZ1 As New Point3d(iSelCoor.Origin.X + iMatrix.Zx * iDistance, iSelCoor.Origin.Y + iMatrix.Zy * iDistance, iSelCoor.Origin.Z + iMatrix.Zz * iDistance)
'        Dim iZ2 As New Point3d(2 * iSelCoor.Origin.X - iZ1.X, 2 * iSelCoor.Origin.Y - iZ1.Y, 2 * iSelCoor.Origin.Z - iZ1.Z)


'        Dim iX1 As New Point3d(iSelCoor.Origin.X + iMatrix.Xx * iDistance, iSelCoor.Origin.Y + iMatrix.Xy * iDistance, iSelCoor.Origin.Z + iMatrix.Xz * iDistance)
'        Dim iX2 As New Point3d(2 * iSelCoor.Origin.X - iX1.X, 2 * iSelCoor.Origin.Y - iX1.Y, 2 * iSelCoor.Origin.Z - iX1.Z)

'        dynamicSectionBuilder1.SetActivePlane(NXOpen.Display.DynamicSectionTypes.Axis.X, NXOpen.Display.DynamicSectionTypes.ActivePlane.Primary)
'        'Dim origin1 As NXOpen.Point3d = New NXOpen.Point3d(aX1, 0.0, 0)
'        dynamicSectionBuilder1.SetOrigin(iX1)

'        dynamicSectionBuilder1.SetActivePlane(NXOpen.Display.DynamicSectionTypes.Axis.X, NXOpen.Display.DynamicSectionTypes.ActivePlane.Secondary)
'        'Dim origin2 As NXOpen.Point3d = New NXOpen.Point3d(aX2, 0.0, 0)
'        dynamicSectionBuilder1.SetOrigin(iX2)


'        dynamicSectionBuilder1.SetActivePlane(NXOpen.Display.DynamicSectionTypes.Axis.Y, NXOpen.Display.DynamicSectionTypes.ActivePlane.Primary)
'        'Dim origin3 As NXOpen.Point3d = New NXOpen.Point3d(0, aY1, 0)
'        dynamicSectionBuilder1.SetOrigin(iZ1)

'        dynamicSectionBuilder1.SetActivePlane(NXOpen.Display.DynamicSectionTypes.Axis.Y, NXOpen.Display.DynamicSectionTypes.ActivePlane.Secondary)
'        'Dim origin4 As NXOpen.Point3d = New NXOpen.Point3d(0, aY2, 0)
'        dynamicSectionBuilder1.SetOrigin(iZ2)


'        dynamicSectionBuilder1.SetActivePlane(NXOpen.Display.DynamicSectionTypes.Axis.Z, NXOpen.Display.DynamicSectionTypes.ActivePlane.Primary)
'        Dim origin5 As NXOpen.Point3d = New NXOpen.Point3d(iSelCoor.Origin.X, iSelCoor.Origin.Y, iSelCoor.Origin.Z)
'        dynamicSectionBuilder1.SetOrigin(origin5)

'        dynamicSectionBuilder1.SetActivePlane(NXOpen.Display.DynamicSectionTypes.Axis.Z, NXOpen.Display.DynamicSectionTypes.ActivePlane.Secondary)
'        'Dim origin6 As NXOpen.Point3d = New NXOpen.Point3d(0, 0, aZ2)

'        dynamicSectionBuilder1.SetOrigin(origin5)
'        dynamicSectionBuilder1.SaveCurves(Nothing)
'        Dim nXObject1 As NXOpen.NXObject = Nothing
'        nXObject1 = dynamicSectionBuilder1.Commit()
'        Dim objects2() As NXOpen.NXObject
'        objects2 = dynamicSectionBuilder1.GetCommittedObjects()
'        'Dim objects3(0) As NXOpen.NXObject
'        'objects3(0) = plane1
'        'Dim nErrs2 As Integer = Nothing
'        'nErrs2 = theSession.UpdateManager.AddToDeleteList(objects3)
'        dynamicSectionBuilder1.Destroy()
'        'Try
'        '    ' 式はまだ使用中です
'        '    workPart.Expressions.Delete(expression2)
'        'Catch ex As NXException
'        '    ex.AssertErrorCode(1050029)
'        'End Try

'        'Try
'        '    ' 式はまだ使用中です
'        '    workPart.Expressions.Delete(expression1)
'        'Catch ex As NXException
'        '    ex.AssertErrorCode(1050029)
'        'End Try

'        theSession.CleanUpFacetedFacesAndEdges()
'    End Sub
'    '////Tim list trung nhau
'    Sub GetIntersectList(ByVal iPrevList As List(Of String), iNowList As List(Of String), ByVal iVitri1 As String, ByVal iListDataSecret As List(Of String), ByVal iListDataDone As List(Of String))
'        Dim iOpenList As New List(Of String)
'        Dim iCloseList As New List(Of String)

'        For Each item As String In iPrevList
'            If iNowList.Contains(item) = False Then
'                iCloseList.Add(item)
'            End If
'        Next
'        'lw.WriteLine("So part close o vi tri " & iVitri1 & " : " & iCloseList.Count)
'        'lw.WriteLine("part close o vi tri " & iVitri1 & " : " + String.Join(" ", iCloseList))
'        'lw.WriteLine("Bat dau close data: " & Now.ToString)
'        Try
'            Call CLosePartTag(iVitri1, iCloseList, iListDataSecret)
'        Catch ex As Exception

'        End Try

'        'lw.WriteLine("Ket thuc load data: " & Now.ToString)
'        For Each item As String In iNowList
'            If iPrevList.Contains(item) = False Then
'                iOpenList.Add(item)
'            End If
'        Next
'        'lw.WriteLine("Bat dau load data: " & Now.ToString)
'        'lw.WriteLine("So part moi can load: " & iOpenList.Count)
'        'lw.WriteLine("part open o vi tri " & iVitri1 & " : " + String.Join(" ", iOpenList))
'        Call FindAndLoadArrPart(iVitri1, iOpenList, iListDataSecret, iListDataDone)
'        'lw.WriteLine("Ket thuc load data: " & Now.ToString)

'    End Sub

'    Sub FindAndLoadArrPart(ByVal iFuncAssy As String, ByVal PartTagnewList As List(Of String), ByVal iListDataSecret As List(Of String), ByVal iListDataDone As List(Of String))
'        Dim theSession As Session = Session.GetSession()
'        Dim workpart As Part = theSession.Parts.Work
'        Dim i As Integer

'        Dim MetalTrimSht
'        MetalTrimSht = objWorkbook.worksheets("METAL-TRIM Database")
'        Dim MetalList As New List(Of String)
'        For i = 5 To 10000
'            If Len(MetalTrimSht.cells(i, "G").value) = 0 Then Exit For
'            If MetalTrimSht.cells(i, "F").value.ToString = "METAL" Then
'                MetalList.Add(Left(MetalTrimSht.cells(i, "G").value, 6))
'            End If

'            'lw.WriteLine("METAL Function: " & Left(MetalTrimSht.cells(i, "G").value, 6))
'        Next

'        For Each iPartTag As String In PartTagnewList
'            'theUFSession.Ui.SetPrompt("SectCreateDataAssy : " & iFuncAssy)
'            Dim obj As NXOpen.TaggedObject = NXOpen.Utilities.NXObjectManager.Get(iPartTag)
'            Dim TagComp As NXOpen.Assemblies.Component = CType(obj, NXOpen.Assemblies.Component)

'            If InStr(TagComp.GetStringAttribute("DB_PART_NAME").ToString.ToUpper, "ZONE") > 0 Or InStr(TagComp.GetStringAttribute("DB_PART_NO").ToString.ToUpper, "ZONE") > 0 Then

'            Else
'                'icoutShuuhen = icoutShuuhen + 1
'                Try
'                    LoadComponent(TagComp)

'                    'LoadComponent(TagComp)
'                    Dim iTrimMetal As String = ""
'                    Try
'                        Call iSearchFuncNo(TagComp, iTrimMetal)
'                        iTrimMetal = Left(Split(iTrimMetal, "_")(1), 6)

'                        If MetalList.Contains(iTrimMetal) = True Then
'                            iTrimMetal = "METAL"
'                        Else
'                            iTrimMetal = "TRIM"
'                        End If
'                    Catch ex As Exception

'                    End Try

'                    TagComp.Unblank()
'                    'Call ShowComponent()
'                    Dim components1(0) As NXOpen.Assemblies.Component
'                    components1(0) = TagComp
'                    Dim errorList1 As NXOpen.ErrorList = Nothing
'                    errorList1 = TagComp.DisplayComponentsExact(components1)
'                    Dim partName As String = ""
'                    Dim refsetName As String = ""
'                    Dim instanceName As String = ""
'                    Dim origin(2) As Double
'                    Dim csysMatrix(8) As Double
'                    Dim transform(3, 3) As Double
'                    theUFSession.Assem.AskComponentData(TagComp.Tag, partName, refsetName, instanceName, origin, csysMatrix, transform)
'                    Dim partNumber As String = TagComp.GetStringAttribute("DB_PART_NO").ToString
'                    Dim partName1 As String = TagComp.GetStringAttribute("DB_PART_NAME").ToString
'                    Call HideCsys()
'                    For Each CheckSecretData As String In iListDataSecret

'                        If InStr(partNumber, CheckSecretData) > 0 Then
'                            If iListDataDone.Contains(CheckSecretData) = False Then
'                                iListDataDone.Add(CheckSecretData)
'                                theUFSession.Assem.SetWorkOccurrence(TagComp.Tag)
'                                Call CreateSecretPartOffset(TagComp)
'                                theUFSession.Assem.SetWorkOccurrence(iFuncAssy)
'                            End If

'                        End If
'                    Next
'                    Dim j As Integer

'                    Dim partMaterial As String = TagComp.GetStringAttribute("PART_MATERIAL").ToString
'                    Dim PartThickness As String = TagComp.GetStringAttribute("PART_THICKNESS").ToString

'                    Dim tmpComp As Component = TagComp.OwningComponent

'                    'Lấy bangou của 親 khi data Supplier
'                    Dim theComponent As Assemblies.Component = TagComp
'                    Dim tmpName As String, tmpNo As String
'                    If Left(partNumber, 1).ToUpper = "S" Or Left(partNumber, 1).ToUpper = "K" Then
'                        For j = 0 To 10

'                            tmpName = theComponent.GetStringAttribute("DB_PART_Name")
'                            tmpNo = theComponent.GetStringAttribute("DB_PART_No")


'                            If Left(tmpNo, 1) = "S" Or Left(tmpNo, 1) = "K" Then
'                                theComponent = theComponent.OwningComponent
'                            Else
'                                Exit For
'                            End If
'                        Next

'                        If tmpNo <> partNumber Then
'                            'lw.WriteLine(partNumber & "#" & tmpNo)
'                            partNumber = partNumber & "~" & tmpNo
'                            partName1 = partName1 & "~" & tmpName
'                        Else
'                            'lw.WriteLine(partNumber)
'                        End If
'                    End If

'                    Dim thisInstance As NXOpen.Tag = theUFSession.Assem.AskInstOfPartOcc(TagComp.Tag)
'                    theUFSession.Assem.RenameInstance(thisInstance, partName1 & "$" & partNumber & "$" & partMaterial & "$T" & PartThickness & "$" & iTrimMetal)

'                Catch ex As Exception
'                    lw.WriteLine("Loi dat lai ten 断面: " & TagComp.GetStringAttribute("DB_PART_NO").ToString)

'                    lw.WriteLine(ex.ToString)
'                End Try
'            End If

'        Next
'    End Sub

'    Sub FindBoxNearArr(ByVal X1 As Double, ByVal Y1 As Double, ByVal Z1 As Double, ByVal iFunc As String, ByVal PartTagnewList As List(Of String), ByVal dtBoxOut As DataTable)
'        'Input
'        'Tập hợp tất cả Function của xe
'        'OUTPUT
'        'Expand tới level cuối cùng (Để đọc được thông tin Bounding box của part
'        'Tập hợp tất cả thông tin Bounding box của part vào data table
'        'Từ vị trí của 締結, tạo thông tin hộp kích thước 100x100x1000 (Chưa làm, đang so sánh kích thước Bounding Box của Bolt, Nut
'        'So sánh với thông tin từ Data base, nếu hộp tạo từ vị trí 締結 giao với hộp trong data table thì lấy thông tin của các part qua tag
'        'Tập hợp các part trên vào 1 Assy
'        Dim boxConer1 As String
'        Dim boxConer2 As String
'        Dim boxConer3 As String
'        Dim boxConer4 As String
'        Dim PartTag As String
'        Dim itempBox As Integer
'        itempBox = 25
'        'Dim icsDanmen As String
'        boxConer2 = (X1 + itempBox & "," & Y1 + itempBox & "," & Z1 + itempBox)
'        boxConer1 = (X1 - itempBox & "," & Y1 - itempBox & "," & Z1 - itempBox)
'        For Each dt2 As DataRow In dtBoxOut.Rows
'            boxConer3 = dt2("X1").ToString & "," & dt2("Y1").ToString & "," & dt2("Z1").ToString
'            boxConer4 = dt2("X2").ToString & "," & dt2("Y2").ToString & "," & dt2("Z2").ToString
'            'lw.WriteLine("Toa do box " & boxConer3)
'            If KiemtraBoxShuuhen(boxConer1.ToString, boxConer2.ToString, boxConer3.ToString, boxConer4.ToString) = True Then
'                PartTag = dt2("PartTag")
'                If PartTagnewList.Contains(PartTag) = False Then

'                    PartTagnewList.Add(PartTag)
'                End If
'                'lw.WriteLine("hoang: " & shuuhenarr(icountSh, 0))
'            End If
'        Next
'        dtBoxOut.AcceptChanges()
'        'lw.WriteLine("   ")
'    End Sub

'    Sub TrongTamVectorBoltnut(ByVal TagComp As Component, iPtStr As String, ByRef zDirect As String)
'        'lw.WriteLine("Tinh trong tam")
'        Call FitView()
'        Dim theSession As Session = Session.GetSession()
'        Dim dispPart As Part = theSession.Parts.Display
'        Dim workpart As Part = theSession.Parts.Work
'        Dim visibleObjects() As DisplayableObject
'        Try
'            visibleObjects = workpart.Views.WorkView.AskVisibleObjects()
'        Catch ex As Exception
'            visibleObjects = dispPart.Views.WorkView.AskVisibleObjects()
'        End Try
'        Dim Object1Tag As Long
'        Dim Object2Tag As Long
'        Dim iminDist As Double
'        Dim xDirect As String, yDirect As String, OutCsysName As String, OutCsysLabel As String
'        'lw.WriteLine("Tagcomp do trong tam: " & TagComp.GetStringAttribute("DB_PART_NO").ToString)

'        Dim iAssyPMI As Component
'        For Each displayableObject As DisplayableObject In visibleObjects
'            If TypeOf (displayableObject) Is Body And displayableObject.OwningComponent.Tag = TagComp.Tag Then
'                displayableObject.OwningComponent.GetPosition(position, matrix)
'                Dim iBody As NXOpen.Body
'                iBody = CType(displayableObject, Body)
'                If iBody.IsSolidBody Then
'                    'Try
'                    Dim tmpName As String = iBody.OwningComponent.GetStringAttribute("DB_PART_NAME").ToString.ToUpper
'                    If InStr(tmpName, "BOLT") > 0 Or InStr(tmpName, "NUT") > 0 Or InStr(tmpName, "CLIP") > 0 Or InStr(tmpName, "SCREW") > 0 _
'                        Or InStr(tmpName, "SCR") > 0 Or InStr(tmpName, "RIVET") > 0 Or InStr(tmpName, "PLUG") > 0 Or InStr(tmpName, "PIN") > 0 Then
'                        Dim thebody(0) As Body
'                        thebody(0) = iBody
'                        Dim massUnits(4) As Unit
'                        massUnits(0) = theSession.Parts.Display.UnitCollection.GetBase("Area")
'                        massUnits(1) = theSession.Parts.Display.UnitCollection.GetBase("Volume")
'                        massUnits(2) = theSession.Parts.Display.UnitCollection.GetBase("Mass")
'                        massUnits(3) = theSession.Parts.Display.UnitCollection.GetBase("Length")
'                        Dim myMeasure As MeasureManager = theSession.Parts.Display.MeasureManager()
'                        Dim mb As MeasureBodies = Nothing
'                        Dim midPt(2) As Double
'                        mb = myMeasure.NewMassProperties(massUnits, 0.99, thebody)
'                        mb.InformationUnit = MeasureBodies.AnalysisUnit.GramMillimeter

'                        midPt(0) = mb.Centroid.X
'                        midPt(1) = mb.Centroid.Y
'                        midPt(2) = mb.Centroid.Z

'                        'lw.WriteLine("Toa do tam: " & midPt(0) & " - " & midPt(1) & " - " & midPt(2))
'                        'lw.WriteLine("Tag com: " & TagComp.GetStringAttribute("DB_PART_NO").ToString)


'                        '''''Tim Face cua Body chứa điểm gần với CS nhất 
'                        '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'                        Dim iface As NXOpen.Face
'                        Dim iMinface As NXOpen.Face     'mat gan voi Cs nhat
'                        Dim iMin As Double      'khoi tao gia tri khoang cach nho nhat, de tim mat gan voi CS nhat
'                        Dim ObjectFaceTag As Long

'                        Dim faceType As Integer
'                        Dim facePt(2) As Double
'                        Dim faceDir(2) As Double
'                        Dim bbox(5) As Double
'                        Dim faceRadius As Double
'                        Dim faceRadData As Double
'                        Dim normDirection As Integer
'                        iMin = 5
'                        For Each iface In iBody.GetFaces
'                            theUFSession.Modl.AskFaceData(iface.Tag, faceType, facePt, faceDir, bbox, faceRadius, faceRadData, normDirection)
'                            If faceType = 16 Then
'                                'iface.Highlight()
'                                'lw.WriteLine("huong: X: " & Math.Round(faceDir(0), 4) & " Y: " & Math.Round(faceDir(1), 4) & " Z: " & Math.Round(faceDir(2), 4))
'                                'iface.RedisplayObject()
'                                iPtStr = midPt(0) & "," & midPt(1) & "," & midPt(2)
'                                xDirect = "0.0, 0.0, 1.0"
'                                'yDirect = Math.Round(faceDir(0), 4) & "," & Math.Round(faceDir(1), 4) & "," & Math.Round(faceDir(2), 4)
'                                zDirect = Math.Round(faceDir(0), 4) & "," & Math.Round(faceDir(1), 4) & "," & Math.Round(faceDir(2), 4)
'                                OutCsysName = ""
'                                Dim OutCs As Features.Feature
'                                Exit For
'                            End If
'                        Next
'                        'visibleObjects = workpart.Views.WorkView.AskVisibleObjects()
'                    End If
'                    'Catch ex As Exception

'                    'End Try
'                End If
'            End If
'        Next
'    End Sub

'    Function KiemtraBoxShuuhen(ByVal boxConer1 As String, ByVal boxConer2 As String, ByVal boxConer3 As String, ByVal boxConer4 As String) As Boolean
'        Dim iCtrpt1(2) As Double, iCtrPt2(2) As Double 'Tọa độ trọng tâm 2 hình 
'        'Tọa độ trọng tâm 
'        iCtrpt1(0) = (CType(Split(boxConer1, ",")(0), Double) + CType(Split(boxConer2, ",")(0), Double)) / 2
'        iCtrpt1(1) = (CType(Split(boxConer1, ",")(1), Double) + CType(Split(boxConer2, ",")(1), Double)) / 2
'        iCtrpt1(2) = (CType(Split(boxConer1, ",")(2), Double) + CType(Split(boxConer2, ",")(2), Double)) / 2
'        iCtrPt2(0) = (CType(Split(boxConer3, ",")(0), Double) + CType(Split(boxConer4, ",")(0), Double)) / 2
'        iCtrPt2(1) = (CType(Split(boxConer3, ",")(1), Double) + CType(Split(boxConer4, ",")(1), Double)) / 2
'        iCtrPt2(2) = (CType(Split(boxConer3, ",")(2), Double) + CType(Split(boxConer4, ",")(2), Double)) / 2
'        'Khoảng cách 2 tâm
'        Dim LenX = Math.Abs(iCtrpt1(0) - iCtrPt2(0))
'        Dim LenY = Math.Abs(iCtrpt1(1) - iCtrPt2(1))
'        Dim LenZ = Math.Abs(iCtrpt1(2) - iCtrPt2(2))
'        'Một nửa khoảng cách chiều dài các cạnh theo X, Y, Z
'        Dim X12 As Double = Math.Abs(Split(boxConer1, ",")(0) - Split(boxConer2, ",")(0)) / 2
'        Dim Y12 As Double = Math.Abs(Split(boxConer1, ",")(1) - Split(boxConer2, ",")(1)) / 2
'        Dim Z12 As Double = Math.Abs(Split(boxConer1, ",")(2) - Split(boxConer2, ",")(2)) / 2
'        Dim X34 As Double = Math.Abs(Split(boxConer3, ",")(0) - Split(boxConer4, ",")(0)) / 2
'        Dim Y34 As Double = Math.Abs(Split(boxConer3, ",")(1) - Split(boxConer4, ",")(1)) / 2
'        Dim Z34 As Double = Math.Abs(Split(boxConer3, ",")(2) - Split(boxConer4, ",")(2)) / 2
'        'Nếu Khoảng cách 2 tâm theo trục X lớn hơn khoảng cách bé hơn hoặc bằng tổng chiều tổng chiều dài của 2 hộp theo trục X chia 2 thì là 周辺部品
'        If LenX <= (X12 + X34) Then
'            If LenY <= (Y12 + Y34) Then
'                If LenZ <= (Z12 + Z34) Then
'                    KiemtraBoxShuuhen = True
'                Else
'                    KiemtraBoxShuuhen = False
'                End If
'            Else
'                KiemtraBoxShuuhen = False
'            End If
'        Else
'            KiemtraBoxShuuhen = False
'        End If

'    End Function

'    Sub CalculateBoundingBox(ByVal comp As Component, ByRef llc() As Double, ByRef urc() As Double, ByVal abs As CartesianCoordinateSystem, ByVal dtBox As DataTable, ByRef dtBoxOut As DataTable)

'        Dim children() As Component = comp.GetChildren()


'        If children.Length = 0 Then ' process the piece part


'            If InStr(comp.GetStringAttribute("DB_PART_NO").ToString.ToUpper, "ZONE") = 0 Or InStr(comp.GetStringAttribute("DB_PART_NAME").ToString.ToUpper, "ZONE") = 0 Then

'                Dim origin As Point3d = Nothing
'                Dim child_matrix As Matrix3x3 = Nothing
'                comp.GetPosition(origin, child_matrix)
'                Dim obj As Tag = Tag.Null
'                Dim body As Body = Nothing
'                obj = theUFSession.Assem.CycleEntsInPartOcc(comp.Tag, obj)
'                If obj = Tag.Null Then
'                    Dim centroid(2) As Double
'                    Dim corner(2) As Double
'                    Dim orientation(8) As Double
'                    theUFSession.Fltr.AskBoxOfAssy(comp.Tag, centroid, corner, orientation)
'                    Dim clc(2) As Double
'                    Dim crc(2) As Double
'                    theUFSession.Vec3.Sub(centroid, corner, clc)
'                    theUFSession.Vec3.Add(centroid, corner, crc)
'                    ' show each assembly level component bounding box
'                    If Math.Round(clc(0), 1) = 0 And Math.Round(clc(1), 1) = 0 And Math.Round(clc(2), 1) = 0 Then
'                        Dim iPartNo As String = comp.GetStringAttribute("DB_PART_NO").ToString
'                        If iPartNo = "" Then
'                            Dim obj2 As NXOpen.TaggedObject = NXOpen.Utilities.NXObjectManager.Get(comp.Tag)
'                            Dim myComp As NXOpen.Assemblies.Component = CType(obj2, NXOpen.Assemblies.Component)
'                            iPartNo = myComp.DisplayName
'                        End If
'                        If Left(iPartNo, 1) = "S" Or Left(iPartNo, 1) = "K" Or InStr(iPartNo, "+NX") > 0 Then
'                            Try
'                                Call LoadComponent(comp)

'                                Call CloseComponent(comp)
'                            Catch ex As Exception
'                                Call ClosePart(comp)
'                            End Try
'                            theUFSession.Fltr.AskBoxOfAssy(comp.Tag, centroid, corner, orientation)
'                            theUFSession.Vec3.Sub(centroid, corner, clc)
'                            theUFSession.Vec3.Add(centroid, corner, crc)
'                            DrawBox(comp, dtBox, dtBoxOut, clc, crc, , 36) ' 36 = Green
'                        Else
'                            DrawBox(comp, dtBox, dtBoxOut, clc, crc, , 36) ' 36 = Green
'                        End If

'                    Else
'                        DrawBox(comp, dtBox, dtBoxOut, clc, crc, , 36) ' 36 = Green
'                    End If




'                    For ii As Integer = 0 To 2
'                        If clc(ii) < llc(ii) Then llc(ii) = clc(ii)
'                    Next
'                    For ii As Integer = 0 To 2
'                        If crc(ii) > urc(ii) Then urc(ii) = crc(ii)
'                    Next
'                Else
'                    Do Until obj = Tag.Null
'                        Try
'                            body = NXObjectManager.Get(obj)
'                            Dim blc(2) As Double
'                            Dim brc(2) As Double
'                            Dim dirs(2, 2) As Double
'                            Dim delta(2) As Double
'                            theUFSession.Modl.AskBoundingBoxExact(obj, abs.Tag, blc, dirs, delta)
'                            theUFSession.Vec3.Add(blc, delta, brc)

'                            For ii As Integer = 0 To 2
'                                If blc(ii) < llc(ii) Then llc(ii) = blc(ii)
'                            Next
'                            For ii As Integer = 0 To 2
'                                If brc(ii) > urc(ii) Then urc(ii) = brc(ii)
'                            Next
'                            'DrawBox(comp, dtBox, dtBoxOut, blc, brc, , 6) ' 36 = Green
'                            If Math.Round(blc(0), 1) = 0 And Math.Round(blc(1), 1) = 0 And Math.Round(blc(2), 1) = 0 Then
'                                Dim iPartNo As String = comp.GetStringAttribute("DB_PART_NO").ToString
'                                If iPartNo = "" Then
'                                    Dim obj2 As NXOpen.TaggedObject = NXOpen.Utilities.NXObjectManager.Get(comp.Tag)
'                                    Dim myComp As NXOpen.Assemblies.Component = CType(obj2, NXOpen.Assemblies.Component)
'                                    iPartNo = myComp.DisplayName
'                                End If
'                                If Left(iPartNo, 1) = "S" Or Left(iPartNo, 1) = "K" Or InStr(iPartNo, "+NX") > 0 Then
'                                    Try
'                                        Call LoadComponent(comp)

'                                        Call CloseComponent(comp)
'                                    Catch ex As Exception
'                                        Call ClosePart(comp)
'                                    End Try

'                                    theUFSession.Modl.AskBoundingBoxExact(obj, abs.Tag, blc, dirs, delta)
'                                    theUFSession.Vec3.Add(blc, delta, brc)
'                                    DrawBox(comp, dtBox, dtBoxOut, blc, brc, , 6) ' 36 = Green
'                                Else
'                                    DrawBox(comp, dtBox, dtBoxOut, blc, brc, , 6) ' 36 = Green
'                                End If
'                            Else
'                                DrawBox(comp, dtBox, dtBoxOut, blc, brc, , 6) ' 36 = Green
'                            End If
'                            ' show each assembly level body bounding box
'                            'DrawBox(comp, dtBox, dtBoxOut, blc, brc, , 6) ' 6 = Yellow

'                        Catch ex As Exception
'                            ' not a body - skip it
'                        End Try
'                        obj = theUFSession.Assem.CycleEntsInPartOcc(comp.Tag, obj)
'                    Loop
'                End If
'            End If
'        Else ' its a sub-assembly so dig deeper
'            For Each child As Component In children
'                CalculateBoundingBox(child, llc, urc, abs, dtBox, dtBoxOut)
'            Next
'        End If

'    End Sub

'    Sub DrawBox(ByVal icomp As Component, ByVal dtBox As DataTable, ByRef dtBoxOut As DataTable, ByRef llc() As Double, ByRef urc() As Double, Optional ByRef csys As CartesianCoordinateSystem = Nothing, Optional ByVal color As Integer = 186)
'        Dim theSession As Session = Session.GetSession()
'        Dim boxCorner1() As Double = {llc(0), llc(1), llc(2)}
'        Dim boxCorner2() As Double = {urc(0), llc(1), llc(2)}
'        Dim boxCorner3() As Double = {urc(0), llc(1), urc(2)}
'        Dim boxCorner4() As Double = {llc(0), llc(1), urc(2)}
'        Dim boxCorner5() As Double = {llc(0), urc(1), llc(2)}
'        Dim boxCorner6() As Double = {urc(0), urc(1), llc(2)}
'        Dim boxCorner7() As Double = {urc(0), urc(1), urc(2)}
'        Dim boxCorner8() As Double = {llc(0), urc(1), urc(2)}

'        If Not csys Is Nothing Then
'            Dim old_csys As CartesianCoordinateSystem = theSession.Parts.Work.WCS.SetCoordinateSystem(csys)

'            theUFSession.Csys.MapPoint(UFConstants.UF_CSYS_ROOT_WCS_COORDS, boxCorner1, UFConstants.UF_CSYS_ROOT_COORDS, boxCorner1)
'            theUFSession.Csys.MapPoint(UFConstants.UF_CSYS_ROOT_WCS_COORDS, boxCorner2, UFConstants.UF_CSYS_ROOT_COORDS, boxCorner2)
'            theUFSession.Csys.MapPoint(UFConstants.UF_CSYS_ROOT_WCS_COORDS, boxCorner3, UFConstants.UF_CSYS_ROOT_COORDS, boxCorner3)
'            theUFSession.Csys.MapPoint(UFConstants.UF_CSYS_ROOT_WCS_COORDS, boxCorner4, UFConstants.UF_CSYS_ROOT_COORDS, boxCorner4)
'            theUFSession.Csys.MapPoint(UFConstants.UF_CSYS_ROOT_WCS_COORDS, boxCorner5, UFConstants.UF_CSYS_ROOT_COORDS, boxCorner5)
'            theUFSession.Csys.MapPoint(UFConstants.UF_CSYS_ROOT_WCS_COORDS, boxCorner6, UFConstants.UF_CSYS_ROOT_COORDS, boxCorner6)
'            theUFSession.Csys.MapPoint(UFConstants.UF_CSYS_ROOT_WCS_COORDS, boxCorner7, UFConstants.UF_CSYS_ROOT_COORDS, boxCorner7)
'            theUFSession.Csys.MapPoint(UFConstants.UF_CSYS_ROOT_WCS_COORDS, boxCorner8, UFConstants.UF_CSYS_ROOT_COORDS, boxCorner8)

'            theSession.Parts.Work.WCS.SetCoordinateSystem(old_csys)
'        End If

'        If Math.Round(llc(0), 1) = 0 And Math.Round(llc(1), 1) = 0 And Math.Round(llc(2), 1) = 0 Then

'        Else
'            Dim tmpCompName As String = icomp.GetStringAttribute("DB_PART_NAME").ToString.ToUpper

'            Dim row As DataRow
'            row = dtBox.NewRow
'            row("Part No") = icomp.GetStringAttribute("DB_PART_NO").ToString
'            If icomp.GetStringAttribute("DB_PART_NO").ToString = "" Then
'                Dim obj As NXOpen.TaggedObject = NXOpen.Utilities.NXObjectManager.Get(icomp.Tag)
'                Dim myComp As NXOpen.Assemblies.Component = CType(obj, NXOpen.Assemblies.Component)
'                row(dtPrtNo) = myComp.DisplayName
'            End If
'            row(dtPrtName) = icomp.GetStringAttribute("DB_PART_NAME").ToString
'            'lw.WriteLine(row(dtPrtName).ToString)
'            row(dtPrtTag) = icomp.Tag
'            row(dtX1) = llc(0)
'            row(dtY1) = llc(1)
'            row(dtZ1) = llc(2)
'            row(dtX2) = urc(0)
'            row(dtY2) = urc(1)
'            row(dtZ2) = urc(2)

'            If InStr(tmpCompName, "BOLT") > 0 Or InStr(tmpCompName, "NUT") > 0 Then
'                Dim iFuncNo As String
'                row(dtType) = "Bolt_Nut"
'                Call iSearchFuncNo(icomp, iFuncNo)
'                iFuncNo = Mid(iFuncNo, 7, 6)
'                row(dtFunc) = iFuncNo

'                If iFuncNo.ToString <> "" Then
'                    row(dtFunc) = iFuncNo
'                Else
'                    row(dtFunc) = "Khong lay duoc Function: " & icomp.GetStringAttribute("DB_PART_NAME").ToString & " - " & icomp.DisplayName
'                    'lw.WriteLine(" myComp.DisplayName: " & icomp.DisplayName)
'                    'lw.WriteLine("Name: " & icomp.GetStringAttribute("DB_PART_NAME").ToString)
'                End If
'            ElseIf InStr(tmpCompName, "SCREW") > 0 Or InStr(tmpCompName, "SCR") > 0 Then
'                Dim iFuncNo As String
'                row(dtType) = "Screw"
'                Call iSearchFuncNo(icomp, iFuncNo)
'                iFuncNo = Mid(iFuncNo, 7, 6)
'                row(dtFunc) = iFuncNo

'                If iFuncNo.ToString <> "" Then
'                    row(dtFunc) = iFuncNo
'                Else
'                    row(dtFunc) = "Khong lay duoc Function: " & icomp.GetStringAttribute("DB_PART_NAME").ToString & " - " & icomp.DisplayName
'                    'lw.WriteLine(" myComp.DisplayName: " & icomp.DisplayName)
'                    'lw.WriteLine("Name: " & icomp.GetStringAttribute("DB_PART_NAME").ToString)
'                End If
'            ElseIf InStr(tmpCompName, "CLIP") > 0 Then
'                Dim iFuncNo As String
'                row(dtType) = "Clip"
'                Call iSearchFuncNo(icomp, iFuncNo)
'                iFuncNo = Mid(iFuncNo, 7, 6)
'                row(dtFunc) = iFuncNo

'                If iFuncNo.ToString <> "" Then
'                    row(dtFunc) = iFuncNo
'                Else
'                    row(dtFunc) = "Khong lay duoc Function: " & icomp.GetStringAttribute("DB_PART_NAME").ToString & " - " & icomp.DisplayName
'                    'lw.WriteLine(" myComp.DisplayName: " & icomp.DisplayName)
'                    'lw.WriteLine("Name: " & icomp.GetStringAttribute("DB_PART_NAME").ToString)
'                End If
'            ElseIf InStr(tmpCompName, "RIVET") > 0 Then
'                Dim iFuncNo As String
'                row(dtType) = "Rivet"
'                Call iSearchFuncNo(icomp, iFuncNo)
'                iFuncNo = Mid(iFuncNo, 7, 6)
'                row(dtFunc) = iFuncNo

'                If iFuncNo.ToString <> "" Then
'                    row(dtFunc) = iFuncNo
'                Else
'                    row(dtFunc) = "Khong lay duoc Function: " & icomp.GetStringAttribute("DB_PART_NAME").ToString & " - " & icomp.DisplayName
'                    'lw.WriteLine(" myComp.DisplayName: " & icomp.DisplayName)
'                    'lw.WriteLine("Name: " & icomp.GetStringAttribute("DB_PART_NAME").ToString)
'                End If
'            ElseIf InStr(tmpCompName.ToUpper, "PLUG") > 0 Then
'                Dim iFuncNo As String
'                row(dtType) = "PLUG"
'                Call iSearchFuncNo(icomp, iFuncNo)
'                iFuncNo = Mid(iFuncNo, 7, 6)
'                row(dtFunc) = iFuncNo

'                If iFuncNo.ToString <> "" Then
'                    row(dtFunc) = iFuncNo
'                Else
'                    row(dtFunc) = "Khong lay duoc Function: " & icomp.GetStringAttribute("DB_PART_NAME").ToString & " - " & icomp.DisplayName
'                    'lw.WriteLine(" myComp.DisplayName: " & icomp.DisplayName)
'                    'lw.WriteLine("Name: " & icomp.GetStringAttribute("DB_PART_NAME").ToString)
'                End If
'            ElseIf InStr(tmpCompName.ToUpper, "PIN") > 0 Then
'                Dim iFuncNo As String
'                row(dtType) = "PIN"
'                Call iSearchFuncNo(icomp, iFuncNo)
'                iFuncNo = Mid(iFuncNo, 7, 6)
'                row(dtFunc) = iFuncNo

'                If iFuncNo.ToString <> "" Then
'                    row(dtFunc) = iFuncNo
'                Else
'                    row(dtFunc) = "Khong lay duoc Function: " & icomp.GetStringAttribute("DB_PART_NAME").ToString & " - " & icomp.DisplayName
'                    'lw.WriteLine(" myComp.DisplayName: " & icomp.DisplayName)
'                    'lw.WriteLine("Name: " & icomp.GetStringAttribute("DB_PART_NAME").ToString)
'                End If
'            ElseIf InStr(tmpCompName.ToUpper, "GROM") > 0 Or InStr(tmpCompName.ToUpper, "GROMMET") > 0 Then
'                Dim iFuncNo As String
'                row(dtType) = "Grom"
'                Call iSearchFuncNo(icomp, iFuncNo)
'                iFuncNo = Mid(iFuncNo, 7, 6)
'                row(dtFunc) = iFuncNo

'                If iFuncNo.ToString <> "" Then
'                    row(dtFunc) = iFuncNo
'                Else
'                    row(dtFunc) = "Khong lay duoc Function: " & icomp.GetStringAttribute("DB_PART_NAME").ToString & " - " & icomp.DisplayName
'                    'lw.WriteLine(" myComp.DisplayName: " & icomp.DisplayName)
'                    'lw.WriteLine("Name: " & icomp.GetStringAttribute("DB_PART_NAME").ToString)
'                End If
'            End If
'            dtBox.Rows.Add(row)
'            dtBoxOut = dtBox
'        End If


'    End Sub

'    ''''''締結品得データOffset

'    Sub DataBaseSecret(ByRef iListDataSecrect As List(Of String))
'        Dim iTextNoData As String = "65112;63112;63113;73112;73113;73114;80152;80153;82152;82153;76022;76412;76023;76413;78112;78113;84312;84313;90152;90154"
'        Dim i As Integer = 0
'        'Dim iListDataSecrect As New List(Of String)

'        For i = 0 To 19
'            If iListDataSecrect.Contains(Split(iTextNoData, ";")(i)) = False Then
'                iListDataSecrect.Add(Split(iTextNoData, ";")(i))
'            End If

'        Next
'    End Sub

'    Sub CreateSecretPartOffset(ByVal child As Component)
'        Dim theSession As Session = Session.GetSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Try
'            If child.GetStringAttribute("PART_THICKNESS").ToString <> "" Then

'                theComponent = child
'                Dim iThickness As String = theComponent.GetStringAttribute("PART_THICKNESS")
'                Dim inamePart As String = theComponent.GetStringAttribute("DB_PART_NAME")
'                Dim iPartNo As String = theComponent.GetStringAttribute("DB_PART_NO")
'                Dim iRev As String
'                Try
'                    iRev = theComponent.GetStringAttribute("DB_PART_REV")
'                Catch ex As Exception
'                    iRev = ""
'                End Try
'                Try
'                    Call C007_Convert_Z_CS(CoverZ, BodyCheck)
'                Catch
'                End Try
'                If BodyCheck = True Then
'                    Try

'                        Call C007_ThicknessBody(iThickness, child, CoverZ, inamePart, iPartNo)
'                        'ThicknessOutToExcel(child.GetStringAttribute("DB_PART_NAME").ToString, child.GetStringAttribute("DB_PART_NO").ToString, child.GetStringAttribute("PART_THICKNESS").ToString, "〇")
'                    Catch
'                        Try
'                            Call C007_ThicknessBodyFaceDataSecret(iThickness, child, CoverZ, inamePart, iPartNo)
'                            'ThicknessOutToExcel(child.GetStringAttribute("DB_PART_NAME").ToString, child.GetStringAttribute("DB_PART_NO").ToString, child.GetStringAttribute("PART_THICKNESS").ToString, "Face")
'                        Catch
'                            Try
'                                Call C007_ThicknessOneFaceDataSecret(iThickness, child, CoverZ, inamePart, iPartNo)
'                                'ThicknessOutToExcel(child.GetStringAttribute("DB_PART_NAME").ToString, child.GetStringAttribute("DB_PART_NO").ToString, child.GetStringAttribute("PART_THICKNESS").ToString, "Face")
'                            Catch
'                                lw.WriteLine("Part khong tao duoc do day : " & iPartNo & " : " & inamePart & "   T " & iThickness)
'                                Exit Sub
'                                'ThicknessOutToExcel(child.GetStringAttribute("DB_PART_NAME").ToString, child.GetStringAttribute("DB_PART_NO").ToString, child.GetStringAttribute("PART_THICKNESS").ToString, "X")
'                            End Try

'                        End Try

'                    End Try
'                    Try
'                    Catch ex As Exception
'                        lw.WriteLine("Loi saveas: ")
'                        lw.WriteLine(ex.ToString)
'                    End Try
'                Else
'                End If
'            Else
'            End If
'        Catch ex As Exception
'        End Try

'    End Sub

'    Sub C007_ThicknessBodyFaceDataSecret(ByVal ithickness As String, ByVal theComponent As Assemblies.Component, ByVal CoverZ As Boolean, ByVal inamepart As String, ByVal iPartNo As String)
'        Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work
'        Dim Object1Tag As Long
'        Dim Object2Tag As Long
'        Dim Object3Tag As Long
'        Dim bodies As BodyCollection = workPart.Bodies
'        Dim sheetBodies(-1) As Body
'        Dim counter As Integer = 0
'        Dim bodyCount As Integer = bodies.ToArray.Length
'        Dim body1 As NXOpen.Body
'        If bodyCount > 0 Then
'            For Each thisBody As Body In bodies
'                If thisBody.IsSheetBody.Equals(True) Then
'                    If thisBody.IsBlanked.Equals(False) Then
'                        body1 = thisBody
'                        Object2Tag = body1.Tag
'                    End If
'                End If
'            Next
'        End If

'        Dim displayPart As Part = theSession.Parts.Display
'        Dim cp1(2) As Double
'        Dim partFeature As Features.Feature
'        Dim iXx As Double
'        Dim iYy As Double
'        Dim iZz As Double
'        Dim iminDist As Double
'        '''Tim Diem goc cua CS va tim BOdy de Tim Diem tren Body gan voi CS nhat
'        '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'        Dim iSelCoor As NXOpen.CartesianCoordinateSystem
'        Dim CsPoint As Point3d  'Diem goc CS
'        Dim ptObj1 As NXOpen.Point
'        Dim iminD As Double = 9.1
'        Dim iZCS(2) As Double 'huong Z cua CS
'        For Each iSelCoor In theSession.Parts.Work.CoordinateSystems
'            If iSelCoor.Origin.X <> 0 Or iSelCoor.Origin.Y <> 0 Or iSelCoor.Origin.Z <> 0 Then
'                Dim iMatrix As Matrix3x3 = iSelCoor.Orientation.Element
'                CsPoint = New Point3d(iSelCoor.Origin.X, iSelCoor.Origin.Y, iSelCoor.Origin.Z)
'                ptObj1 = workPart.Points.CreatePoint(CsPoint)

'                Object1Tag = ptObj1.Tag

'                Dim solidbody As Body
'                For Each thisBody1 As Body In bodies
'                    If thisBody1.IsSolidBody.Equals(True) Then
'                        If thisBody1.IsBlanked.Equals(False) Then
'                            solidbody = thisBody1
'                            Object3Tag = solidbody.Tag
'                        End If
'                        Dim guess1(2) As Double
'                        Dim guess2(2) As Double
'                        Dim pt1(2) As Double
'                        Dim pt2(2) As Double
'                        Dim minDist As Double
'                        theUFSession.Modl.AskMinimumDist(Object1Tag, Object3Tag, 0, guess1, 0, guess2, minDist, pt1, pt2)
'                        ' pt2 la Diem tren Body gan voi CS nhat ung voi object2tag
'                        iminD = minDist
'                        If minDist <= 9 Then

'                            Exit For

'                        End If

'                    End If
'                Next

'                If iminD > 9 Then
'                    Dim guess1(2) As Double
'                    Dim guess2(2) As Double
'                    Dim pt1(2) As Double
'                    Dim pt2(2) As Double
'                    Dim minDist As Double
'                    theUFSession.Modl.AskMinimumDist(Object1Tag, Object2Tag, 0, guess1, 0, guess2, minDist, pt1, pt2)   ' pt2 la Diem tren Body gan voi CS nhat ung voi object2tag
'                    'lw.WriteLine("Diem gan CS nhat: x: " & pt2(0) & " " & "y: " & pt2(1) & " " & "z: " & pt2(2))
'                    'lw.WriteLine("khoang cach nho nhat: " & minDist.ToString)
'                    Dim Minpoint As Point3d  'Diem gan voi CS nhat tren Body
'                    Dim ptObj2 As NXOpen.Point
'                    Minpoint = New Point3d(pt2(0), pt2(1), pt2(2))
'                    ptObj2 = workPart.Points.CreatePoint(Minpoint)

'                    '''''Tim Face cua Body chứa điểm gần với CS nhất 
'                    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'                    Dim iface As NXOpen.Face
'                    Dim iMinface As NXOpen.Face
'                    Dim ifacecheck As NXOpen.Face
'                    'mat gan voi Cs nhat
'                    Dim iMin As Double      'khoi tao gia tri khoang cach nho nhat, de tim mat gan voi CS nhat
'                    Dim ObjectFaceTag As Long
'                    iMin = 1


'                    Dim faces1(0) As NXOpen.Face
'                    For Each iface In body1.GetFaces
'                        theUFSession.Modl.AskMinimumDist(ptObj2.Tag, iface.Tag, 0, guess1, 0, guess2, minDist, pt1, pt2)
'                        If minDist < iMin Then
'                            'If iMinface.ToString <> iface.ToString Then
'                            iMin = minDist
'                            iMinface = iface
'                        End If
'                    Next
'                    Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'                    theSession.Parts.SetWorkComponent(theComponent, NXOpen.PartCollection.RefsetOption.Entire, NXOpen.PartCollection.WorkComponentOption.Visible, partLoadStatus1)
'                    workPart = theSession.Parts.Work
'                    Dim nullNXOpen_Features_Feature As NXOpen.Features.Feature = Nothing
'                    Dim thickenBuilder1 As NXOpen.Features.ThickenBuilder = Nothing

'                    thickenBuilder1 = workPart.Features.CreateThickenBuilder(nullNXOpen_Features_Feature)
'                    thickenBuilder1.Tolerance = 0.01
'                    thickenBuilder1.FirstOffset.RightHandSide = ithickness
'                    thickenBuilder1.SecondOffset.RightHandSide = "0"
'                    thickenBuilder1.BooleanOperation.Type = NXOpen.GeometricUtilities.BooleanOperation.BooleanType.Create

'                    faces1(0) = iMinface
'                    'Dim faceDumbRule1 As NXOpen.FaceDumbRule = Nothing
'                    'faceDumbRule1 = workPart.ScRuleFactory.CreateRuleFaceDumb(faces1)

'                    Dim boundaryFaces1(-1) As NXOpen.Face
'                    Dim faceTangentRule1 As NXOpen.FaceTangentRule = Nothing
'                    faceTangentRule1 = workPart.ScRuleFactory.CreateRuleFaceTangent(iMinface, boundaryFaces1, 0.5)

'                    Dim rules1(0) As NXOpen.SelectionIntentRule
'                    rules1(0) = faceTangentRule1
'                    thickenBuilder1.FaceCollector.ReplaceRules(rules1, False)
'                    If CoverZ = False Then
'                        thickenBuilder1.ReverseDirection = True
'                    End If
'                    Dim nXObject1 As NXOpen.NXObject = Nothing
'                    nXObject1 = thickenBuilder1.Commit()
'                    thickenBuilder1.Destroy()
'                    theSession.CleanUpFacetedFacesAndEdges()


'                    Dim removeParametersBuilder1 As NXOpen.Features.RemoveParametersBuilder = Nothing
'                    removeParametersBuilder1 = workPart.Features.CreateRemoveParametersBuilder()

'                    Dim body2 As NXOpen.Body = CType(workPart.Bodies.FindObject(nXObject1.JournalIdentifier.ToString), NXOpen.Body)
'                    Dim added1 As Boolean = Nothing
'                    added1 = removeParametersBuilder1.Objects.Add(body2)
'                    Dim nXObject2 As NXOpen.NXObject = Nothing
'                    nXObject2 = removeParametersBuilder1.Commit()

'                    'Exit For
'                End If
'            End If
'            'Exit For
'        Next
'        'lw.WriteLine("Part Tao duoc do day : " & iPartNo & " : " & inamepart & "   T " & ithickness)

'    End Sub

'    Sub C007_ThicknessOneFaceDataSecret(ByVal i As String, ByVal theComponent As Assemblies.Component, ByVal CoverZ As Boolean, ByVal inamepart As String, ByVal iPartNo As String)
'        Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work
'        Dim Object1Tag As Long
'        Dim Object2Tag As Long
'        Dim bodies As BodyCollection = workPart.Bodies
'        Dim sheetBodies(-1) As Body
'        Dim counter As Integer = 0
'        Dim bodyCount As Integer = bodies.ToArray.Length

'        Dim body1 As NXOpen.Body
'        If bodyCount > 0 Then
'            For Each thisBody As Body In bodies
'                If thisBody.IsSheetBody.Equals(True) Then
'                    If thisBody.IsBlanked.Equals(False) Then
'                        body1 = thisBody
'                        Object2Tag = body1.Tag
'                    End If
'                End If
'            Next
'        End If

'        Dim displayPart As Part = theSession.Parts.Display
'        Dim cp1(2) As Double
'        Dim partFeature As Features.Feature
'        Dim iXx As Double
'        Dim iYy As Double
'        Dim iZz As Double
'        Dim iminDist As Double
'        '''Tim Diem goc cua CS va tim BOdy de Tim Diem tren Body gan voi CS nhat
'        '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'        Dim iSelCoor As NXOpen.CartesianCoordinateSystem
'        Dim CsPoint As Point3d  'Diem goc CS
'        Dim ptObj1 As NXOpen.Point
'        Dim ifacecheck As NXOpen.Face = Nothing
'        Dim iZCS(2) As Double 'huong Z cua CS
'        Dim icheck1 As String
'        Dim icheck2 As String


'        Dim iOffsetFace As New List(Of Face)
'        For Each iEdge As Edge In body1.GetEdges
'            Dim theFaces() As Face = iEdge.GetFaces()
'            If theFaces.GetLength(0) < 2 Then
'                iOffsetFace.Add(theFaces(0))
'            End If

'        Next

'        Dim iOffcetComplete As New List(Of String)


'        For Each iSelCoor In theSession.Parts.Work.CoordinateSystems
'            If iSelCoor.Origin.X <> 0 Or iSelCoor.Origin.Y <> 0 Or iSelCoor.Origin.Z <> 0 Then
'                Dim iMatrix As Matrix3x3 = iSelCoor.Orientation.Element
'                CsPoint = New Point3d(iSelCoor.Origin.X, iSelCoor.Origin.Y, iSelCoor.Origin.Z)
'                ptObj1 = workPart.Points.CreatePoint(CsPoint)

'                Object1Tag = ptObj1.Tag

'                Dim guess1(2) As Double
'                Dim guess2(2) As Double
'                Dim pt1(2) As Double
'                Dim pt2(2) As Double
'                Dim minDist As Double
'                theUFSession.Modl.AskMinimumDist(Object1Tag, Object2Tag, 0, guess1, 0, guess2, minDist, pt1, pt2)   ' pt2 la Diem tren Body gan voi CS nhat ung voi object2tag
'                'lw.WriteLine("Diem gan CS nhat: x: " & pt2(0) & " " & "y: " & pt2(1) & " " & "z: " & pt2(2))
'                'lw.WriteLine("khoang cach nho nhat: " & minDist.ToString)
'                Dim Minpoint As Point3d  'Diem gan voi CS nhat tren Body
'                Dim ptObj2 As NXOpen.Point
'                Minpoint = New Point3d(pt2(0), pt2(1), pt2(2))
'                ptObj2 = workPart.Points.CreatePoint(Minpoint)

'                '''''Tim Face cua Body chứa điểm gần với CS nhất 
'                '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'                Dim iface As NXOpen.Face
'                Dim iMinface As NXOpen.Face

'                'mat gan voi Cs nhat
'                Dim iMin As Double      'khoi tao gia tri khoang cach nho nhat, de tim mat gan voi CS nhat
'                Dim ObjectFaceTag As Long
'                iMin = 1

'                Dim faces1(0) As NXOpen.Face
'                For Each iface In iOffsetFace 'body1.GetFaces
'                    theUFSession.Modl.AskMinimumDist(ptObj2.Tag, iface.Tag, 0, guess1, 0, guess2, minDist, pt1, pt2)
'                    If minDist < iMin Then
'                        'If iMinface.ToString <> iface.ToString Then
'                        iMin = minDist
'                        iMinface = iface
'                        icheck1 = iMinface.Tag.ToString

'                    End If
'                Next
'                If icheck1 <> icheck2 Then
'                    'End If
'                    If iOffcetComplete.Contains(iMinface.Tag) = False Then
'                        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'                        theSession.Parts.SetWorkComponent(theComponent, NXOpen.PartCollection.RefsetOption.Entire, NXOpen.PartCollection.WorkComponentOption.Visible, partLoadStatus1)
'                        workPart = theSession.Parts.Work
'                        Dim nullNXOpen_Features_Feature As NXOpen.Features.Feature = Nothing
'                        Dim thickenBuilder1 As NXOpen.Features.ThickenBuilder = Nothing

'                        thickenBuilder1 = workPart.Features.CreateThickenBuilder(nullNXOpen_Features_Feature)
'                        thickenBuilder1.Tolerance = 0.01
'                        thickenBuilder1.FirstOffset.RightHandSide = i
'                        thickenBuilder1.SecondOffset.RightHandSide = "0"
'                        thickenBuilder1.BooleanOperation.Type = NXOpen.GeometricUtilities.BooleanOperation.BooleanType.Create

'                        faces1(0) = iMinface
'                        Dim faceDumbRule1 As NXOpen.FaceDumbRule = Nothing
'                        faceDumbRule1 = workPart.ScRuleFactory.CreateRuleFaceDumb(faces1)

'                        Dim rules1(0) As NXOpen.SelectionIntentRule
'                        rules1(0) = faceDumbRule1
'                        thickenBuilder1.FaceCollector.ReplaceRules(rules1, False)
'                        If CoverZ = False Then
'                            thickenBuilder1.ReverseDirection = True
'                        End If
'                        Dim nXObject1 As NXOpen.NXObject = Nothing
'                        nXObject1 = thickenBuilder1.Commit()
'                        thickenBuilder1.Destroy()
'                        theSession.CleanUpFacetedFacesAndEdges()
'                        icheck2 = iMinface.Tag.ToString
'                        Dim removeParametersBuilder1 As NXOpen.Features.RemoveParametersBuilder = Nothing
'                        removeParametersBuilder1 = workPart.Features.CreateRemoveParametersBuilder()
'                        Dim body2 As NXOpen.Body = CType(workPart.Bodies.FindObject(nXObject1.JournalIdentifier.ToString), NXOpen.Body)
'                        Dim added1 As Boolean = Nothing
'                        added1 = removeParametersBuilder1.Objects.Add(body2)
'                        Dim nXObject2 As NXOpen.NXObject = Nothing
'                        nXObject2 = removeParametersBuilder1.Commit()
'                        iOffcetComplete.Add(iMinface.Tag)
'                    Else

'                    End If
'                End If
'            End If
'        Next
'    End Sub

'    ''''''締結Picture 断面

'    Sub Take_Picture()

'        Dim theSession As Session = Session.GetSession()
'        Dim theUfSession As UFSession = UFSession.GetUFSession
'        Dim workpart As Part = theSession.Parts.Work
'        Dim disPart As Part = theSession.Parts.Display
'        Dim iRootComp As Component = workpart.ComponentAssembly.RootComponent
'        iRootComp.Blank()
'        Dim tmpCs As NXOpen.CartesianCoordinateSystem
'        Dim myGroup As NXObject
'        Dim iRootPath As String = "D:\nxcad\scratch\2022_DB0_069_Picture"

'        Call iResetFolder(iRootPath)
'        Dim ts As TimeSpan
'        ts = New TimeSpan(0, 0, 1)

'        For Each iChild As Component In iRootComp.GetChildren
'            iChild.Blank()
'            Dim tmpGrp As NXOpen.Tag = NXOpen.Tag.Null

'            theUfSession.Obj.CycleObjsInPart(iChild.Prototype.OwningPart.Tag, UFConstants.UF_coordinate_system_type, tmpGrp)

'            myGroup = Utilities.NXObjectManager.Get(tmpGrp)
'            tmpCs = CType(myGroup, NXOpen.CartesianCoordinateSystem)


'            For Each iChild1 As Component In iChild.GetChildren

'                Dim iSectName As String = iChild1.GetStringAttribute("DB_PART_NAME").ToString

'                iSectName = Right(iSectName, 1)

'                Call XoayMatPhang(tmpCs, iSectName)

'                iChild1.Unblank()

'                theUfSession.Disp.MakeDisplayUpToDate()

'                Call FitView()
'                workpart.Views.Refresh()
'                workpart.ModelingViews.WorkView.Regenerate()

'                workpart.ModelingViews.WorkView.UpdateDisplay()

'                'theUfSession.Disp.Refresh()

'                Dim iSavePath As String
'                iSavePath = iRootPath & "\" & iChild1.GetStringAttribute("DB_PART_NAME").ToString & ".png"
'                Call ChupAnh(iSavePath)

'                iChild1.Blank()

'            Next
'        Next


'    End Sub

'    Sub iResetFolder(ByVal iFolderPath As String)

'        'Dim iFolderPath As String = "D:\nxcad\scratch\2022_DB0_069_Picture1"

'        If Not Directory.Exists(iFolderPath) Then
'            System.IO.Directory.CreateDirectory(iFolderPath)
'            Return
'        End If

'        Dim files() As String
'        files = Directory.GetFileSystemEntries(iFolderPath)
'        For Each element As String In files
'            If (Not Directory.Exists(element)) Then
'                File.Delete(Path.Combine(iFolderPath, Path.GetFileName(element)))
'            End If
'        Next
'    End Sub

'    Sub XoayMatPhang(ByVal tmpCs As NXOpen.CartesianCoordinateSystem, iSectName As String)
'        Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work

'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim matrix1 As NXOpen.Matrix3x3 = Nothing
'        Dim translation1 As NXOpen.Point3d
'        If iSectName = "X" Then
'            matrix1.Xx = tmpCs.Orientation.Element.Yx
'            matrix1.Xy = tmpCs.Orientation.Element.Yy
'            matrix1.Xz = tmpCs.Orientation.Element.Yz

'            matrix1.Yx = tmpCs.Orientation.Element.Zx
'            matrix1.Yy = tmpCs.Orientation.Element.Zy
'            matrix1.Yz = tmpCs.Orientation.Element.Zz

'            matrix1.Zx = tmpCs.Orientation.Element.Xx
'            matrix1.Zy = tmpCs.Orientation.Element.Xy
'            matrix1.Zz = tmpCs.Orientation.Element.Xz
'            workPart.ModelingViews.WorkView.Orient(matrix1)

'            translation1.X = tmpCs.Origin.X + 200 * tmpCs.Orientation.Element.Yx
'            translation1.Y = tmpCs.Origin.Y + 200 * tmpCs.Orientation.Element.Yy
'            translation1.Z = tmpCs.Origin.Z + 200 * tmpCs.Orientation.Element.Yz
'            workPart.ModelingViews.WorkView.SetRotationTranslationScale(matrix1, translation1, 1)
'        ElseIf iSectName = "Y" Then

'            matrix1.Xx = tmpCs.Orientation.Element.Xx
'            matrix1.Xy = tmpCs.Orientation.Element.Xy
'            matrix1.Xz = tmpCs.Orientation.Element.Xz

'            matrix1.Yx = tmpCs.Orientation.Element.Zx
'            matrix1.Yy = tmpCs.Orientation.Element.Zy
'            matrix1.Yz = tmpCs.Orientation.Element.Zz

'            matrix1.Zx = -tmpCs.Orientation.Element.Yx
'            matrix1.Zy = -tmpCs.Orientation.Element.Yy
'            matrix1.Zz = -tmpCs.Orientation.Element.Yz

'            translation1.X = tmpCs.Origin.X + 200 * tmpCs.Orientation.Element.Xx
'            translation1.Y = tmpCs.Origin.Y + 200 * tmpCs.Orientation.Element.Xy
'            translation1.Z = tmpCs.Origin.Z + 200 * tmpCs.Orientation.Element.Xz

'            workPart.ModelingViews.WorkView.SetRotationTranslationScale(matrix1, translation1, 1)

'        End If
'        Try
'            displayPart.ModelingViews.WorkView.FitAfterShowOrHide(NXOpen.View.ShowOrHideType.HideOnly)
'        Catch ex As Exception
'            workPart.ModelingViews.WorkView.FitAfterShowOrHide(NXOpen.View.ShowOrHideType.HideOnly)
'        End Try

'    End Sub

'    Sub ChupAnh(ByVal iSavePath As String)
'        Dim theSession As Session = Session.GetSession()
'        Dim theUfSession As UFSession = UFSession.GetUFSession()
'        If IsNothing(theSession.Parts.BaseWork) Then 'active part required
'            Return
'        End If
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As Part = theSession.Parts.Display
'        theSession.DisplayManager.HideByType("SHOW_HIDE_TYPE_DATUMS", DisplayManager.ShowHideScope.AnyInAssembly)

'        Dim tempScreenshot As String
'        Dim tempLocation As String = IO.Path.GetTempPath
'        tempScreenshot = IO.Path.Combine(tempLocation, "NXscreenshot.png")

'        Try
'            workPart.Views.FitAll()
'        Catch ex As Exception
'            displayPart.Views.FitAll()
'        End Try
'        Try
'            ExpScrShotToImg(tempScreenshot)
'        Catch ex As Exception

'            Return
'        End Try

'        CropScreenshot(tempScreenshot, 2, iSavePath)

'    End Sub

'    Sub ExpScrShotToImg(ByVal fileImageInfo As String)
'        Dim theSession As Session = Session.GetSession()
'        Dim theUfSession As UFSession = UFSession.GetUFSession()
'        Dim wcsVisible As Boolean = theSession.Parts.BaseDisplay.WCS.Visibility
'        Dim triadVisible As Integer = theSession.Preferences.ScreenVisualization.TriadVisibility
'        Dim dispModelViewNames As Boolean = theSession.Parts.BaseDisplay.Preferences.NamesBorderVisualization.ShowModelViewNames
'        Dim dispModelViewimgPlusBorders As Boolean = theSession.Parts.BaseDisplay.Preferences.NamesBorderVisualization.ShowModelViewBorders

'        'theSession.Parts.BaseDisplay.WCS.Visibility = True 'turn off the WCS
'        'theSession.Preferences.ScreenVisualization.TriadVisibility = 0  'turn off triad
'        'theSession.Parts.BaseDisplay.Preferences.NamesBorderVisualization.ShowModelViewBorders = True
'        'theSession.Parts.BaseDisplay.Preferences.NamesBorderVisualization.ShowModelViewNames = False


'        Try
'            theUfSession.Disp.CreateImage(fileImageInfo, UFDisp.ImageFormat.Png, UFDisp.BackgroundColor.White)
'        Catch ex As Exception
'            MsgBox(ex.Message & ControlChars.NewLine & "'" & fileImageInfo & "' can not be created")
'            Throw New Exception("Screenshot can not be created")
'        Finally
'            theSession.Parts.BaseDisplay.WCS.Visibility = wcsVisible
'            theSession.Preferences.ScreenVisualization.TriadVisibility = triadVisible
'            theSession.Parts.BaseDisplay.Preferences.NamesBorderVisualization.ShowModelViewBorders = dispModelViewimgPlusBorders
'            theSession.Parts.BaseDisplay.Preferences.NamesBorderVisualization.ShowModelViewNames = dispModelViewNames
'        End Try

'        theSession.Parts.BaseDisplay.WCS.Visibility = True  'turn off the WCS
'        theSession.Preferences.ScreenVisualization.TriadVisibility = 1  'turn off triad
'        theSession.Parts.BaseDisplay.Preferences.NamesBorderVisualization.ShowModelViewBorders = True 'turn off view imgPlusBorder
'        'theSession.Parts.BaseDisplay.Preferences.NamesBorderVisualization.ShowModelViewNames = False  'turn off view name
'    End Sub

'    Sub CropScreenshot(ByVal fileImageInfo As String, ByVal imgPlusBorderWidth As Integer, ByVal iSavePath As String)
'        Dim theSession As Session = Session.GetSession()
'        Dim theUfSession As UFSession = UFSession.GetUFSession()
'        Dim imgInput As New Bitmap(fileImageInfo)
'        Dim imgPixelMinX As Integer = imgInput.Width
'        Dim imgPixelMinY As Integer = imgInput.Height
'        Dim imgPixelMaxX As Integer = 0
'        Dim imgPixelMaxY As Integer = 0
'        Dim bckgrndColor As Color = Color.White
'        Dim boderColor As Color = Color.White
'        Dim c As Color
'        Dim i As Integer = 0

'        Do While (i < imgInput.Width)
'            Dim j As Integer = 0
'            Do While (j < imgInput.Height)
'                c = imgInput.GetPixel(i, j)
'                Dim r As Integer = 0
'                r = Convert.ToInt32(c.R)
'                Dim g As Integer = 0
'                g = Convert.ToInt32(c.G)
'                Dim b As Integer = 0
'                b = Convert.ToInt32(c.B)
'                Dim ans As Integer = ((r + g + b) / 3)
'                If (ans > 254) Then

'                    r = 255
'                    g = 255
'                    b = 255
'                Else
'                    r = 0
'                    g = 0
'                    b = 0
'                End If
'                c = Color.FromArgb(r, g, b)
'                imgInput.SetPixel(i, j, c)
'                j = (j + 1)
'            Loop
'            i = (i + 1)
'        Loop

'        For y As Integer = 0 To imgInput.Height - 1
'            For x As Integer = 0 To imgInput.Width - 1
'                If imgInput.GetPixel(x, y).ToArgb <> bckgrndColor.ToArgb Then
'                    If x < imgPixelMinX Then
'                        imgPixelMinX = x
'                    ElseIf x + 1 > imgPixelMaxX Then
'                        imgPixelMaxX = x + 1
'                    End If
'                    If y < imgPixelMinY Then
'                        imgPixelMinY = y
'                    ElseIf y + 1 > imgPixelMaxY Then
'                        imgPixelMaxY = y + 1
'                    End If
'                End If
'            Next
'        Next
'        Dim rect As New Rectangle
'        Dim croppedZone As Bitmap
'        Try
'            rect = New Rectangle(imgPixelMinX - 5, imgPixelMinY - 5, imgPixelMaxX - imgPixelMinX + 10, imgPixelMaxY - imgPixelMinY + 10)
'            croppedZone = imgInput.Clone(rect, imgInput.PixelFormat)
'        Catch
'            rect = New Rectangle(imgPixelMinX, imgPixelMinY, imgPixelMaxX - imgPixelMinX, imgPixelMaxY - imgPixelMinY)
'            croppedZone = imgInput.Clone(rect, imgInput.PixelFormat)
'        End Try
'        Dim imgPlusBorder As New Bitmap(croppedZone.Width + (2 * imgPlusBorderWidth), croppedZone.Height + (2 * imgPlusBorderWidth), croppedZone.PixelFormat)
'        Dim gr As Graphics = Graphics.FromImage(imgPlusBorder)
'        Using myBrush As Brush = New SolidBrush(boderColor)
'            gr.FillRectangle(myBrush, 0, 0, imgPlusBorder.Width, imgPlusBorder.Height)
'        End Using
'        Dim xImage As Integer = imgPlusBorder.Width - croppedZone.Width - imgPlusBorderWidth
'        Dim yImage As Integer = imgPlusBorder.Height - croppedZone.Height - imgPlusBorderWidth
'        gr.CompositingMode = Drawing2D.CompositingMode.SourceOver
'        gr.DrawImage(croppedZone, New Drawing.Point(xImage, yImage))
'        imgInput.Dispose()
'        croppedZone.Dispose()
'        gr.Dispose()

'        Dim iTextName As String
'        imgPlusBorder.Save(iSavePath, Imaging.ImageFormat.Png)

'    End Sub

'    ''''''締結DataTable, Print To Excel

'    Sub CreateThickWaringDatatable(ByRef dtThick As DataTable)
'        Dim dtThickWaring As New DataTable

'        dtThickWaring.Columns.Add("Function No")
'        dtThickWaring.Columns.Add("Part Name")
'        dtThickWaring.Columns.Add("Part No")
'        dtThickWaring.Columns.Add("Type")
'        dtThickWaring.Columns.Add("Thickness")
'        dtThickWaring.Columns.Add("Comment")

'        dtThick = dtThickWaring

'    End Sub

'    Sub CreateInforLineDataTable(ByRef dtInforLineOut As DataTable)
'        'Tạo bảng Group Vị trí cắt↓↓↓↓↓↓↓
'        Dim dtInforLine As New DataTable

'        dtInforLine.Columns.Add("Sect")
'        dtInforLine.Columns.Add("GroupName")
'        dtInforLine.Columns.Add("Group Tag")
'        dtInforLine.Columns.Add("Object Tag")
'        dtInforLine.Columns.Add("Line length", Type.GetType("System.Double"))
'        dtInforLine.Columns.Add("Xd", Type.GetType("System.Double"))
'        dtInforLine.Columns.Add("Yd", Type.GetType("System.Double"))
'        dtInforLine.Columns.Add("Zd", Type.GetType("System.Double"))
'        dtInforLine.Columns.Add("Xm", Type.GetType("System.Double"))
'        dtInforLine.Columns.Add("Ym", Type.GetType("System.Double"))
'        dtInforLine.Columns.Add("Zm", Type.GetType("System.Double"))
'        dtInforLine.Columns.Add("Xc", Type.GetType("System.Double"))
'        dtInforLine.Columns.Add("Yc", Type.GetType("System.Double"))
'        dtInforLine.Columns.Add("Zc", Type.GetType("System.Double"))
'        dtInforLine.Columns.Add("Vx", Type.GetType("System.Double"))
'        dtInforLine.Columns.Add("Vy", Type.GetType("System.Double"))
'        dtInforLine.Columns.Add("Vz", Type.GetType("System.Double"))
'        dtInforLine.Columns.Add("TypeLine")
'        dtInforLine.Columns.Add("d1", Type.GetType("System.Double")) ''Loại lỗ: 丸穴, Obl穴, 四角い穴
'        dtInforLine.Columns.Add("a1")
'        dtInforLine.Columns.Add("Result")
'        dtInforLine.Columns.Add("Xg", Type.GetType("System.Double"))
'        dtInforLine.Columns.Add("Yg", Type.GetType("System.Double"))
'        dtInforLine.Columns.Add("Zg", Type.GetType("System.Double"))
'        dtInforLine.Columns.Add("Hole Size")
'        dtInforLine.Columns.Add("Hole Type")
'        dtInforLine.Columns.Add("DistTemp", Type.GetType("System.Double"))
'        dtInforLine.Columns.Add("CtrLineX")
'        dtInforLine.Columns.Add("CtrLineY")
'        dtInforLine.Columns.Add("CtrLineTag")
'        dtInforLine.Columns.Add("CtrUnmatch")
'        dtInforLine.Columns.Add("BoltCL")


'        dtInforLineOut = dtInforLine

'    End Sub

'    Sub CreatePositionDataTable(ByRef dtGroupOut As DataTable, ByRef dtDanmenOut As DataTable)

'        Dim dtPosition As New DataTable
'        'Tạo bảng Group Vị trí cắt↓↓↓↓↓↓↓
'        dtPosition.Columns.Add("Function")
'        dtPosition.Columns.Add("Part No")
'        dtPosition.Columns.Add("Part Name")
'        dtPosition.Columns.Add("Origin X", Type.GetType("System.Double"))
'        dtPosition.Columns.Add("Origin Y", Type.GetType("System.Double"))
'        dtPosition.Columns.Add("Origin Z", Type.GetType("System.Double"))
'        dtPosition.Columns.Add("Type")
'        dtPosition.Columns.Add("Hole Shape") ''Loại lỗ: 丸穴, Obl穴, 四角い穴
'        dtPosition.Columns.Add("Hole size")
'        dtPosition.Columns.Add("TagCsys")
'        dtPosition.Columns.Add("TagPart")
'        dtPosition.Columns.Add("SheetBodyTag")
'        dtPosition.Columns.Add("Create Direct Y")
'        dtPosition.Columns.Add("Create Direct Z")
'        dtPosition.Columns.Add("Csys Name")
'        dtPosition.Columns.Add("Csys DirX")
'        dtPosition.Columns.Add("Csys DirY")
'        dtPosition.Columns.Add("Csys DirZ")
'        dtPosition.Columns.Add("Bounding Point1")
'        dtPosition.Columns.Add("Bounding Point2")
'        dtPosition.Columns.Add("Group", Type.GetType("System.Int32"))
'        'dtPosition.Columns.Add("Danmen", Type.GetType("System.Int32"))
'        dtPosition.Columns.Add("Create Section Csys")
'        dtPosition.Columns.Add("Part(A, B, C, D)")
'        dtPosition.Columns.Add("締結Type")
'        dtPosition.Columns.Add("CsysPMI")

'        'Tạo bảng OutPut Vị trí cắt mặt cắt↓↓↓↓↓↓↓
'        Dim dtPosiOut As New DataTable
'        dtPosiOut.Columns.Add("進捗")
'        dtPosiOut.Columns.Add("Group")
'        'dtPosiOut.Columns.Add("部位")
'        dtPosiOut.Columns.Add("Function")
'        dtPosiOut.Columns.Add("Part No")
'        dtPosiOut.Columns.Add("Origin X", Type.GetType("System.Double"))
'        dtPosiOut.Columns.Add("Origin Y", Type.GetType("System.Double"))
'        dtPosiOut.Columns.Add("Origin Z", Type.GetType("System.Double"))
'        dtPosiOut.Columns.Add("締結物")
'        dtPosiOut.Columns.Add("Type")
'        dtPosiOut.Columns.Add("CsysPMI")
'        dtPosiOut.Columns.Add("Csys DirX")
'        dtPosiOut.Columns.Add("Csys DirY")
'        'dtPosiOut.Columns.Add("Function")
'        dtPosiOut.Columns.Add("DanmenNo")

'        dtGroupOut = dtPosition
'        dtDanmenOut = dtPosiOut
'    End Sub

'    Sub CreateDataTableBox(ByRef dtBox As DataTable)
'        Dim dtBox1 As New DataTable
'        dtBox1.Columns.Add("Part No")
'        dtBox1.Columns.Add("Part Name")
'        dtBox1.Columns.Add("PartTag")
'        dtBox1.Columns.Add("X1")
'        dtBox1.Columns.Add("Y1")
'        dtBox1.Columns.Add("Z1")
'        dtBox1.Columns.Add("X2")
'        dtBox1.Columns.Add("Y2")
'        dtBox1.Columns.Add("Z2")
'        dtBox1.Columns.Add("Function")
'        dtBox1.Columns.Add("Type")
'        dtBox = dtBox1

'    End Sub

'    Sub PrintBoxWaring(ByVal dtPosiOut As DataTable)
'        Dim iposi As Integer
'        Dim ArrData(100000, 11) As Object
'        For iposi = 0 To dtPosiOut.Rows.Count - 1
'            ArrData(iposi, 0) = dtPosiOut.Rows(iposi).Item("Part No").ToString
'            ArrData(iposi, 1) = dtPosiOut.Rows(iposi).Item("Part Name").ToString
'            ArrData(iposi, 2) = dtPosiOut.Rows(iposi).Item("PartTag").ToString
'            ArrData(iposi, 3) = dtPosiOut.Rows(iposi).Item("X1").ToString
'            ArrData(iposi, 4) = dtPosiOut.Rows(iposi).Item("Y1").ToString
'            ArrData(iposi, 5) = dtPosiOut.Rows(iposi).Item("Z1").ToString
'            ArrData(iposi, 6) = dtPosiOut.Rows(iposi).Item("X2").ToString
'            ArrData(iposi, 7) = dtPosiOut.Rows(iposi).Item("Y2").ToString
'            ArrData(iposi, 8) = dtPosiOut.Rows(iposi).Item("Z2").ToString
'            ArrData(iposi, 9) = dtPosiOut.Rows(iposi).Item("Function").ToString
'            ArrData(iposi, 10) = dtPosiOut.Rows(iposi).Item("Type").ToString
'        Next
'        Dim objWorksheetIn2 = objWorkbook.worksheets("BoxData")
'        Const xlDown As Long = -4121
'        Dim lngLastRow As Long
'        lngLastRow = objWorksheetIn2.Cells(1, 1).End(xlDown).Row + 1
'        If lngLastRow = 1048577 Then '
'            lngLastRow = 2
'        End If
'        If dtPosiOut.Rows.Count = 0 Then Exit Sub
'        objWorksheetIn2.range("A" & lngLastRow).resize(dtPosiOut.Rows.Count - 1 + 1, 11).value = ArrData
'    End Sub

'    Sub GetInputFunctionshuuhen(ByRef dtFunctionIn As DataTable, ByRef iAfterNameThick As String)
'        Dim dtIn As New DataTable()
'        Dim objWorksheetIn = objWorkbook.worksheets("周辺Function")
'        Dim i As Integer
'        Dim DataArray(1000000, 5) As Object
'        Const xlDown As Long = -4121

'        'dtIn.Columns.Add("Function Name")
'        dtIn.Columns.Add("車体/周辺")
'        dtIn.Columns.Add("Offset必要")
'        dtIn.Columns.Add("Function Group")
'        dtIn.Columns.Add("Function")
'        dtIn.Columns.Add("Function No")
'        dtIn.Columns.Add("Output")
'        iAfterNameThick = objWorksheetIn.Cells(4, 3).Value
'        Dim row As DataRow
'        Dim lngLastRow As Long
'        lngLastRow = objWorksheetIn.Cells(8, 4).End(xlDown).Row
'        For i = 9 To lngLastRow

'            row = dtIn.NewRow
'            DataArray(i - 9, 0) = objWorksheetIn.Cells(i, 2).Value
'            DataArray(i - 9, 1) = objWorksheetIn.Cells(i, 3).Value
'            DataArray(i - 9, 2) = objWorksheetIn.Cells(i, 4).Value
'            DataArray(i - 9, 3) = objWorksheetIn.Cells(i, 5).Value
'            DataArray(i - 9, 4) = objWorksheetIn.Cells(i, 6).Value

'            row("車体/周辺") = DataArray(i - 9, 0).ToString
'            row("Offset必要") = DataArray(i - 9, 1).ToString
'            row("Function Group") = DataArray(i - 9, 2).ToString
'            row("Function") = DataArray(i - 9, 3).ToString
'            row("Function No") = DataArray(i - 9, 4).ToString
'            row("Output") = ""

'            dtIn.Rows.Add(row)
'        Next

'        dtFunctionIn = dtIn
'        dtFunctionIn.AcceptChanges()
'    End Sub

'    Sub iPrintDtFuncInToExcel(ByVal dtFunctionIn)
'        Dim l As Integer
'        Dim DataArrIn(100000, 2) As Object
'        For l = 0 To dtFunctionIn.Rows.Count - 1
'            DataArrIn(l, 0) = dtFunctionIn.Rows(l).Item("Function No").ToString
'            'DataArrIn(l, 1) = dtFunctionIn.Rows(l).Item("進捗").ToString
'        Next
'        Dim lngLastRow As Long
'        Dim objWorksheetIn1 = objWorkbook.worksheets("Input")
'        objWorksheetIn1.range("B9").resize(dtFunctionIn.Rows.Count - 1 + 1, 1).value = DataArrIn
'    End Sub

'    Sub iPrintAssyDanmenOutToExcel(ByVal dtFunctionIn)
'        Dim l As Integer
'        Dim DataArrIn(100000, 2) As Object
'        For l = 0 To dtFunctionIn.Rows.Count - 1
'            DataArrIn(l, 0) = dtFunctionIn.Rows(l).Item(dtAssyDanmen).ToString
'            'DataArrIn(l, 1) = dtFunctionIn.Rows(l).Item("進捗").ToString
'        Next

'        Dim lngLastRow As Long
'        Dim objWorksheetIn1 = objWorkbook.worksheets("Input")
'        objWorksheetIn1.range("D9").resize(dtFunctionIn.Rows.Count - 1 + 1, 1).value = DataArrIn

'    End Sub

'    Sub iPrintDtGroupingOut(dtOut As DataTable)
'        Dim l As Integer
'        Dim dataArray(100000, 24)
'        For l = 0 To dtOut.Rows.Count - 1
'            'lw.WriteLine(dtOut.Rows(l).Item("Part Name").ToString)
'            dataArray(l, 0) = dtOut.Rows(l).Item("Function").ToString
'            dataArray(l, 1) = dtOut.Rows(l).Item("Part Name").ToString
'            dataArray(l, 2) = dtOut.Rows(l).Item("Part No").ToString
'            dataArray(l, 3) = dtOut.Rows(l).Item("Origin X").ToString
'            dataArray(l, 4) = dtOut.Rows(l).Item("Origin Y").ToString
'            dataArray(l, 5) = dtOut.Rows(l).Item("Origin Z").ToString
'            dataArray(l, 6) = dtOut.Rows(l).Item("Type").ToString
'            dataArray(l, 7) = dtOut.Rows(l).Item("Hole Shape").ToString
'            dataArray(l, 8) = dtOut.Rows(l).Item("Hole size").ToString
'            dataArray(l, 9) = dtOut.Rows(l).Item("TagCsys").ToString
'            dataArray(l, 10) = dtOut.Rows(l).Item("TagPart").ToString
'            dataArray(l, 11) = dtOut.Rows(l).Item("SheetBodyTag").ToString
'            dataArray(l, 12) = dtOut.Rows(l).Item("Create Direct Y").ToString
'            dataArray(l, 13) = dtOut.Rows(l).Item("Create Direct Z").ToString
'            dataArray(l, 14) = dtOut.Rows(l).Item("Csys Name").ToString
'            dataArray(l, 15) = dtOut.Rows(l).Item("Csys DirX").ToString
'            dataArray(l, 16) = dtOut.Rows(l).Item("Csys DirY").ToString
'            dataArray(l, 17) = dtOut.Rows(l).Item("Csys DirZ").ToString
'            dataArray(l, 18) = dtOut.Rows(l).Item("Bounding Point1").ToString
'            dataArray(l, 19) = dtOut.Rows(l).Item("Bounding Point2").ToString
'            dataArray(l, 20) = dtOut.Rows(l).Item("Group").ToString
'            dataArray(l, 21) = dtOut.Rows(l).Item("Create Section Csys").ToString
'            dataArray(l, 22) = dtOut.Rows(l).Item("Part(A, B, C, D)").ToString
'            dataArray(l, 23) = dtOut.Rows(l).Item("締結Type").ToString
'            dataArray(l, 24) = dtOut.Rows(l).Item("CsysPMI").ToString
'        Next
'        objExcel.visible = True
'        'Dim objWorkbook = objExcel.Workbooks.Open(ExcelOut)
'        Dim objWorksheetIn2 = objWorkbook.worksheets("締結グルーピング")
'        Const xlDown As Long = -4121
'        Dim lngLastRow As Long
'        lngLastRow = objWorksheetIn2.Cells(1, 2).End(xlDown).Row + 1

'        If lngLastRow = 1048577 Then '
'            lngLastRow = 2
'        End If
'        If dtOut.Rows.Count = 0 Then Exit Sub
'        objWorksheetIn2.range("A" & lngLastRow).resize(dtOut.Rows.Count - 1 + 1, 25).value = dataArray
'    End Sub

'    Sub iPrintPositionToExcel(ByVal dtPosition As DataTable)
'        Dim l As Integer
'        Dim dataArray(100000, 24)
'        For l = 0 To dtPosition.Rows.Count - 1
'            'lw.WriteLine(dtOut.Rows(l).Item("Part Name").ToString)
'            dataArray(l, 0) = dtPosition.Rows(l).Item("Function").ToString
'            dataArray(l, 1) = dtPosition.Rows(l).Item("Part Name").ToString
'            dataArray(l, 2) = dtPosition.Rows(l).Item("Part No").ToString
'            dataArray(l, 3) = dtPosition.Rows(l).Item("Origin X").ToString
'            dataArray(l, 4) = dtPosition.Rows(l).Item("Origin Y").ToString
'            dataArray(l, 5) = dtPosition.Rows(l).Item("Origin Z").ToString
'            dataArray(l, 6) = dtPosition.Rows(l).Item("Type").ToString
'            dataArray(l, 7) = dtPosition.Rows(l).Item("Hole Shape").ToString
'            dataArray(l, 8) = dtPosition.Rows(l).Item("Hole size").ToString
'            dataArray(l, 9) = dtPosition.Rows(l).Item("TagCsys").ToString
'            dataArray(l, 10) = dtPosition.Rows(l).Item("TagPart").ToString
'            dataArray(l, 11) = dtPosition.Rows(l).Item("SheetBodyTag").ToString
'            dataArray(l, 12) = dtPosition.Rows(l).Item("Create Direct Y").ToString
'            dataArray(l, 13) = dtPosition.Rows(l).Item("Create Direct Z").ToString
'            dataArray(l, 14) = dtPosition.Rows(l).Item("Csys Name").ToString
'            dataArray(l, 15) = dtPosition.Rows(l).Item("Csys DirX").ToString
'            dataArray(l, 16) = dtPosition.Rows(l).Item("Csys DirY").ToString
'            dataArray(l, 17) = dtPosition.Rows(l).Item("Csys DirZ").ToString
'            dataArray(l, 18) = dtPosition.Rows(l).Item("Bounding Point1").ToString
'            dataArray(l, 19) = dtPosition.Rows(l).Item("Bounding Point2").ToString
'            dataArray(l, 20) = dtPosition.Rows(l).Item("Group").ToString
'            dataArray(l, 21) = dtPosition.Rows(l).Item("Create Section Csys").ToString
'            dataArray(l, 22) = dtPosition.Rows(l).Item("Part(A, B, C, D)").ToString

'        Next
'        Dim objWorksheetIn2 = objWorkbook.worksheets("Data Position")
'        Const xlDown As Long = -4121
'        Dim lngLastRow As Long
'        lngLastRow = objWorksheetIn2.Cells(1, 3).End(xlDown).Row + 1

'        If lngLastRow = 1048577 Then '
'            lngLastRow = 2
'        End If

'        If dtPosition.Rows.Count = 0 Then Exit Sub

'        objWorksheetIn2.range("A2").resize(dtPosition.Rows.Count - 1 + 1, 24).value = dataArray

'    End Sub

'    Sub PrintThickWaring(ByVal dtPosiOut As DataTable)
'        Dim iposi As Integer
'        Dim ArrData(10000, 6) As Object
'        For iposi = 0 To dtPosiOut.Rows.Count - 1
'            ArrData(iposi, 0) = dtPosiOut.Rows(iposi).Item("Function No").ToString
'            ArrData(iposi, 1) = dtPosiOut.Rows(iposi).Item("Part Name").ToString
'            ArrData(iposi, 2) = dtPosiOut.Rows(iposi).Item("Part No").ToString
'            ArrData(iposi, 3) = dtPosiOut.Rows(iposi).Item("Type").ToString
'            ArrData(iposi, 4) = dtPosiOut.Rows(iposi).Item("Thickness").ToString
'            ArrData(iposi, 5) = dtPosiOut.Rows(iposi).Item("Comment").ToString
'        Next
'        Dim objWorksheetIn2 = objWorkbook.worksheets("板厚付けWaring")
'        Const xlDown As Long = -4121
'        Dim lngLastRow As Long
'        lngLastRow = objWorksheetIn2.Cells(1, 1).End(xlDown).Row + 1
'        If lngLastRow = 1048577 Then '
'            lngLastRow = 2
'        End If
'        If dtPosiOut.Rows.Count = 0 Then Exit Sub
'        objWorksheetIn2.range("A" & lngLastRow).resize(dtPosiOut.Rows.Count - 1 + 1, 6).value = ArrData
'    End Sub


'    Sub iPrintDanmenOut(ByVal dtPosiOut As DataTable)
'        Dim iposi As Integer
'        Dim ArrData(1000000, 12) As Object
'        For iposi = 0 To dtPosiOut.Rows.Count - 1
'            ArrData(iposi, 0) = "'" & dtPosiOut.Rows(iposi).Item("Group").ToString
'            ArrData(iposi, 1) = dtPosiOut.Rows(iposi).Item("Function").ToString
'            ArrData(iposi, 2) = dtPosiOut.Rows(iposi).Item("Part No").ToString
'            ArrData(iposi, 3) = dtPosiOut.Rows(iposi).Item("Origin X").ToString
'            ArrData(iposi, 4) = dtPosiOut.Rows(iposi).Item("Origin Y").ToString
'            ArrData(iposi, 5) = dtPosiOut.Rows(iposi).Item("Origin Z").ToString
'            'ArrData(iposi, 6) = "'" & dtPosiOut.Rows(iposi).Item("締結物").ToString
'            ArrData(iposi, 6) = ""
'            'ArrData(iposi, 7) = dtPosiOut.Rows(iposi).Item("Type").ToString
'            ArrData(iposi, 7) = ""
'            ArrData(iposi, 8) = dtPosiOut.Rows(iposi).Item("Csys DirX").ToString
'            ArrData(iposi, 9) = dtPosiOut.Rows(iposi).Item("Csys DirY").ToString
'            ArrData(iposi, 10) = dtPosiOut.Rows(iposi).Item("DanmenNo").ToString
'        Next
'        Dim objWorksheetIn2 = objWorkbook.worksheets("Output")
'        Const xlDown As Long = -4121
'        Dim lngLastRow As Long
'        lngLastRow = objWorksheetIn2.Cells(25, 3).End(xlDown).Row + 1
'        If lngLastRow = 1048577 Then '
'            lngLastRow = 26
'        End If
'        If dtPosiOut.Rows.Count = 0 Then Exit Sub
'        objWorksheetIn2.range("C" & lngLastRow).resize(dtPosiOut.Rows.Count - 1 + 1, 12).value = ArrData
'    End Sub


'    Sub iPrintDanmeCompletetoExcel(ByVal dtPosiOut As DataTable)
'        Dim DtArray(1000000, 2) As Object
'        Dim l As Integer = 0
'        For Each dtROut As DataRow In dtPosiOut.Rows
'            DtArray(l, 0) = dtROut("DanmenNo").ToString
'            DtArray(l, 1) = dtROut("tiendo").ToString
'            l = l + 1
'        Next
'        Dim objWorksheetIn2 = objWorkbook.worksheets("断面作成")
'        objWorksheetIn2.range("J9").resize(dtPosiOut.Rows.Count - 1 + 1, 2).value = DtArray
'    End Sub

'    Sub iPrintInforLine(ByVal dtPosiOut As DataTable)
'        Dim iposi As Integer
'        Dim jqk As Integer = 0
'        Dim ArrData(100000, 30) As Object

'        For iposi = 0 To dtPosiOut.Rows.Count - 1
'            ArrData(iposi, 0) = dtPosiOut.Rows(iposi).Item("Sect").ToString
'            ArrData(iposi, 1) = dtPosiOut.Rows(iposi).Item("GroupName").ToString
'            ArrData(iposi, 2) = dtPosiOut.Rows(iposi).Item("Group Tag").ToString
'            ArrData(iposi, 3) = dtPosiOut.Rows(iposi).Item("Object Tag").ToString
'            ArrData(iposi, 4) = dtPosiOut.Rows(iposi).Item("Line length").ToString
'            ArrData(iposi, 5) = dtPosiOut.Rows(iposi).Item("Xd").ToString
'            ArrData(iposi, 6) = dtPosiOut.Rows(iposi).Item("Yd").ToString
'            ArrData(iposi, 7) = dtPosiOut.Rows(iposi).Item("Zd").ToString
'            ArrData(iposi, 8) = dtPosiOut.Rows(iposi).Item("Xm").ToString
'            ArrData(iposi, 9) = dtPosiOut.Rows(iposi).Item("Ym").ToString
'            ArrData(iposi, 10) = dtPosiOut.Rows(iposi).Item("Zm").ToString
'            ArrData(iposi, 11) = dtPosiOut.Rows(iposi).Item("Xc").ToString
'            ArrData(iposi, 12) = dtPosiOut.Rows(iposi).Item("Yc").ToString
'            ArrData(iposi, 13) = dtPosiOut.Rows(iposi).Item("Zc").ToString
'            ArrData(iposi, 14) = dtPosiOut.Rows(iposi).Item("Vx").ToString
'            ArrData(iposi, 15) = dtPosiOut.Rows(iposi).Item("Vy").ToString
'            ArrData(iposi, 16) = dtPosiOut.Rows(iposi).Item("Vz").ToString
'            ArrData(iposi, 17) = dtPosiOut.Rows(iposi).Item("TypeLine").ToString
'            ArrData(iposi, 18) = dtPosiOut.Rows(iposi).Item("d1").ToString
'            ArrData(iposi, 19) = dtPosiOut.Rows(iposi).Item("a1").ToString

'            If dtPosiOut.Rows(iposi).Item("Result").ToString = "1" Then
'                dtPosiOut.Rows(iposi).Item("Result") = ""
'            ElseIf dtPosiOut.Rows(iposi).Item("Result").ToString = "2" Then
'                dtPosiOut.Rows(iposi).Item("Result") = ""
'            End If
'            ArrData(iposi, 20) = dtPosiOut.Rows(iposi).Item("Result").ToString
'            ArrData(iposi, 21) = dtPosiOut.Rows(iposi).Item("Xg").ToString
'            ArrData(iposi, 22) = dtPosiOut.Rows(iposi).Item("Yg").ToString
'            ArrData(iposi, 23) = dtPosiOut.Rows(iposi).Item("Zg").ToString
'            ArrData(iposi, 24) = dtPosiOut.Rows(iposi).Item("Hole Size").ToString
'            ArrData(iposi, 25) = dtPosiOut.Rows(iposi).Item("Hole Type").ToString
'            ArrData(iposi, 26) = dtPosiOut.Rows(iposi).Item("CtrLineX").ToString
'            ArrData(iposi, 27) = dtPosiOut.Rows(iposi).Item("CtrLineY").ToString
'            ArrData(iposi, 28) = dtPosiOut.Rows(iposi).Item("CtrUnmatch").ToString
'            ArrData(iposi, 29) = dtPosiOut.Rows(iposi).Item("BoltCL").ToString
'        Next

'        Dim objWorksheetIn2 = objWorkbook.worksheets("Data 線断面")
'        Const xlDown As Long = -4121
'        Dim lngLastRow As Long

'        lngLastRow = objWorksheetIn2.Cells(8, 2).End(xlDown).Row + 1

'        If lngLastRow = 1048577 Then '
'            lngLastRow = 9
'        End If

'        If dtPosiOut.Rows.Count = 0 Then Exit Sub
'        objWorksheetIn2.range("B" & 9).resize(dtPosiOut.Rows.Count - 1 + 1, 30).value = ArrData

'    End Sub

'    Sub ExportDirtoOutPut(ByVal dtInforLineOut As DataTable, ByVal i As Integer)

'        Dim objWorksheetOut = objWorkbook.worksheets("Output")
'        Dim iBoltNo As String, iNutNo As String, iClipNo As String, iClipName As String, iOther As String, iNameOther As String, iMono As String, iScrew As String
'        Dim i001_01 As String, i001_02 As String, i001_03 As String, i001_04 As String, i001_05 As String, i001_06 As String, i001_07 As String, i001_14 As String, i001_08 As String
'        Dim i001_09 As String, i001_10 As String, i001_11 As String, i001_12 As String, i001_13 As String, i002_01 As String, i002_02 As String, i002_03 As String
'        Dim i003_01 As String, i003_02 As String, i003_03 As String, i004_01 As String, i004_02 As String, i004_03 As String, i011_01 As String, i016_01 As String
'        Dim iMetalA As String, iMetalB As String, iMetalC As String, iMetalD As String, iMetalE As String
'        If Len(objWorksheetOut.cells(i, "C").value) = 0 Then Exit Sub
'        Dim icheckOK As Boolean = False, icheckNG As Boolean = False, icheckCA As Boolean
'        For Each dtOut As DataRow In dtInforLineOut.Rows
'            If Left(Split(dtOut("Sect").ToString, "_")(2), 6) = Right(objWorksheetOut.cells(i, "C").value, 6) Then
'                Try
'                    If InStr(dtOut("Hole Type").ToString, "A_DirX") > 0 Then
'                        i001_01 = dtOut("Hole Size").ToString
'                        i001_09 = dtOut("GroupName").ToString
'                        Try
'                            iMetalA = Split(dtOut("GroupName").ToString, "$")(4)
'                        Catch ex As Exception
'                            iMetalA = ""
'                        End Try

'                    End If
'                    If InStr(dtOut("Hole Type").ToString, "A_DirY") > 0 Then
'                        i001_02 = dtOut("Hole Size").ToString
'                    End If
'                    If InStr(dtOut("Hole Type").ToString, "B_DirX") > 0 Then
'                        i001_03 = dtOut("Hole Size").ToString
'                        i001_10 = dtOut("GroupName").ToString
'                        Try
'                            iMetalB = Split(dtOut("GroupName").ToString, "$")(4)
'                        Catch ex As Exception
'                            iMetalB = ""
'                        End Try
'                    End If
'                    If InStr(dtOut("Hole Type").ToString, "B_DirY") > 0 Then
'                        i001_04 = dtOut("Hole Size").ToString
'                    End If
'                    If InStr(dtOut("Hole Type").ToString, "C_DirX") > 0 Then
'                        i002_01 = dtOut("Hole Size").ToString
'                        i002_03 = dtOut("GroupName").ToString
'                        Try
'                            iMetalC = Split(dtOut("GroupName").ToString, "$")(4)
'                        Catch ex As Exception
'                            iMetalC = ""
'                        End Try
'                    End If
'                    If InStr(dtOut("Hole Type").ToString, "C_DirY") > 0 Then
'                        i002_02 = dtOut("Hole Size").ToString
'                    End If
'                    If InStr(dtOut("Hole Type").ToString, "D_DirX") > 0 Then
'                        i003_01 = dtOut("Hole Size").ToString
'                        i003_03 = dtOut("GroupName").ToString
'                        Try
'                            iMetalD = Split(dtOut("GroupName").ToString, "$")(4)
'                        Catch ex As Exception
'                            iMetalD = ""
'                        End Try
'                    End If
'                    If InStr(dtOut("Hole Type").ToString, "D_DirY") > 0 Then
'                        i003_02 = dtOut("Hole Size").ToString
'                    End If
'                    If InStr(dtOut("Hole Type").ToString, "E_DirX") > 0 Then
'                        i004_01 = dtOut("Hole Size").ToString
'                        i004_03 = dtOut("GroupName").ToString
'                        Try
'                            iMetalE = Split(dtOut("GroupName").ToString, "$")(4)
'                        Catch ex As Exception
'                            iMetalE = ""
'                        End Try
'                    End If
'                    If InStr(dtOut("Hole Type").ToString, "E_DirY") > 0 Then
'                        i004_02 = dtOut("Hole Size").ToString
'                    End If
'                    If InStr(dtOut("Hole Type").ToString.ToUpper, "NUT") > 0 Then
'                        i001_11 = dtOut("GroupName").ToString
'                        iNutNo = Split(dtOut("GroupName").ToString, "$")(1)
'                    End If
'                    If InStr(dtOut("Hole Type").ToString.ToUpper, "SCREW") > 0 Then
'                        'i001_11 = dtOut("GroupName").ToString
'                        iBoltNo = Split(dtOut("GroupName").ToString, "$")(1)
'                        iScrew = "SCR"
'                    End If
'                    If InStr(dtOut("Hole Type").ToString.ToUpper, "BOLT") > 0 Or InStr(dtOut("Hole Type").ToString.ToUpper, "STUD-BALL") > 0 Then
'                        i001_12 = dtOut("GroupName").ToString
'                        iBoltNo = Split(dtOut("GroupName").ToString, "$")(1)
'                    End If
'                    If InStr(dtOut("Hole Type").ToString.ToUpper, "CLIP") > 0 Then
'                        iClipNo = Split(dtOut("GroupName").ToString, "$")(1)
'                        iClipName = "Clip"
'                    End If
'                    If InStr(dtOut("Hole Type").ToString.ToUpper, "PIN") > 0 Then
'                        iOther = Split(dtOut("GroupName").ToString, "$")(1)
'                        iNameOther = "Pin"
'                    End If
'                    If InStr(dtOut("Hole Type").ToString.ToUpper, "RIVET") > 0 Then
'                        iOther = Split(dtOut("GroupName").ToString, "$")(1)
'                        iNameOther = "Rivet"
'                    End If
'                    If InStr(dtOut("Hole Type").ToString.ToUpper, "GROM") > 0 Then
'                        iOther = Split(dtOut("GroupName").ToString, "$")(1)
'                        iNameOther = "Grom"
'                    End If
'                    If InStr(dtOut("Hole Type").ToString.ToUpper, "PLUG") > 0 Then
'                        iOther = Split(dtOut("GroupName").ToString, "$")(1)
'                        iNameOther = "Plug"
'                    End If
'                    If InStr(dtOut("Hole Type").ToString, "Mono有り") > 0 Then
'                        iMono = Split(dtOut("GroupName").ToString, "$")(1)
'                    End If
'                    If InStr(dtOut("Hole Type").ToString, "Mono無し") > 0 Then
'                        iMono = "Mono無し"
'                        i001_08 = "CA"
'                    End If

'                    If dtOut("CtrUnmatch").ToString = "OK" Then
'                        icheckOK = True
'                    ElseIf dtOut("CtrUnmatch").ToString = "NG" Then
'                        icheckNG = True
'                    ElseIf dtOut("CtrUnmatch").ToString = "CA" Then
'                        icheckCA = True
'                    End If

'                    'If dtOut("CtrUnmatch").ToString = "NG" Then
'                    '    i001_08 = "NG"
'                    'End If
'                    If dtOut("CtrLineY").ToString = "CL" Then
'                        If Right(dtOut("Sect").ToString, 1) = "X" Then
'                            i001_05 = dtOut("BoltCL").ToString
'                        ElseIf Right(dtOut("Sect").ToString, 1) = "Y" Then
'                            i001_06 = dtOut("BoltCL").ToString
'                        End If
'                    End If
'                    If dtOut("Hole Type").ToString = "Thread Dim" Then
'                        If Right(dtOut("Sect").ToString, 1) = "X" Then
'                            i001_07 = dtOut("Hole Size").ToString
'                        ElseIf Right(dtOut("Sect").ToString, 1) = "Y" Then
'                            i001_14 = dtOut("Hole Size").ToString
'                        End If
'                    End If
'                Catch ex As Exception

'                End Try


'            End If


'        Next

'        If icheckOK = True Then
'            If icheckNG = True Then
'                i001_08 = "NG"
'            Else
'                If icheckCA = True Then
'                    i001_08 = "CA"
'                Else
'                    i001_08 = "OK"
'                End If

'            End If
'        Else
'            If icheckCA = True Then
'                i001_08 = "CA"
'            Else
'                i001_08 = "NG"
'            End If

'        End If

'        objWorksheetOut.cells(i, "N").value = iBoltNo
'        objWorksheetOut.cells(i, "O").value = iScrew
'        objWorksheetOut.cells(i, "W").value = iNutNo

'        If iClipNo = Nothing Then
'            objWorksheetOut.cells(i, "AK").value = iOther
'        Else
'            objWorksheetOut.cells(i, "AK").value = iClipNo
'        End If
'        If iClipName = Nothing Then
'            objWorksheetOut.cells(i, "AS").value = iNameOther
'        Else
'            objWorksheetOut.cells(i, "AS").value = iClipName
'        End If

'        objWorksheetOut.cells(i, "AV").value = i001_01
'        objWorksheetOut.cells(i, "AW").value = i001_02
'        objWorksheetOut.cells(i, "AX").value = i001_03
'        objWorksheetOut.cells(i, "AY").value = i001_04
'        objWorksheetOut.cells(i, "AZ").value = i001_05
'        objWorksheetOut.cells(i, "BA").value = i001_06
'        objWorksheetOut.cells(i, "BB").value = i001_07
'        objWorksheetOut.cells(i, "BC").value = i001_14
'        objWorksheetOut.cells(i, "BD").value = i001_08
'        objWorksheetOut.cells(i, "BE").value = i001_09
'        objWorksheetOut.cells(i, "BF").value = i001_10
'        objWorksheetOut.cells(i, "BG").value = iNutNo
'        objWorksheetOut.cells(i, "BH").value = iBoltNo
'        objWorksheetOut.cells(i, "BI").value = i001_13
'        objWorksheetOut.cells(i, "BJ").value = i002_01
'        objWorksheetOut.cells(i, "BK").value = i002_02
'        objWorksheetOut.cells(i, "BL").value = i002_03
'        objWorksheetOut.cells(i, "BM").value = i003_01
'        objWorksheetOut.cells(i, "BN").value = i003_02
'        objWorksheetOut.cells(i, "BO").value = i003_03
'        objWorksheetOut.cells(i, "BP").value = i004_01
'        objWorksheetOut.cells(i, "BQ").value = i004_02
'        objWorksheetOut.cells(i, "BR").value = i004_03
'        objWorksheetOut.cells(i, "BS").value = iClipNo
'        objWorksheetOut.cells(i, "BT").value = iMono
'        objWorksheetOut.cells(i, "BU").value = iMetalA
'        objWorksheetOut.cells(i, "BV").value = iMetalB
'        objWorksheetOut.cells(i, "BW").value = iMetalC
'        objWorksheetOut.cells(i, "BX").value = iMetalD
'        objWorksheetOut.cells(i, "BY").value = iMetalE

'    End Sub

'    '''''NXOpen.FunctionASSY
'    Function DistBPointandVector(ByVal x01 As Double, ByVal y01 As Double, ByVal z01 As Double, ByVal x02 As Double, ByVal y02 As Double, ByVal z02 As Double) As Double
'        ' Define the two points and the direction vector
'        Dim x1 As Double = x01
'        Dim y1 As Double = y01
'        Dim z1 As Double = z01
'        Dim x2 As Double = x02
'        Dim y2 As Double = y02
'        Dim z2 As Double = z02
'        Dim v1 As Double = x01 - x02
'        Dim v2 As Double = y01 - y02
'        Dim v3 As Double = z01 - z02
'        ' Calculate the projection of the vector between the points onto the direction vector
'        Dim proj As Double = ((x2 - x1) * v1 + (y2 - y1) * v2 + (z2 - z1) * v3) / (v1 ^ 2 + v2 ^ 2 + v3 ^ 2)
'        ' Calculate the distance between the points in the direction of the direction vector
'        DistBPointandVector = Math.Sqrt((proj * v1) ^ 2 + (proj * v2) ^ 2 + (proj * v3) ^ 2)
'    End Function

'    Function DistanceBetweenPointandVector(ByVal iPtCs As Point3d, ByVal iPtCtr As Point3d, iDirect As Vector3d) As Double
'        ' Define the two points and the direction vector
'        Dim x1 As Double = iPtCs.X
'        Dim y1 As Double = iPtCs.Y
'        Dim z1 As Double = iPtCs.Z
'        Dim x2 As Double = iPtCtr.X
'        Dim y2 As Double = iPtCtr.Y
'        Dim z2 As Double = iPtCtr.Z
'        Dim v1 As Double = iDirect.X
'        Dim v2 As Double = iDirect.Y
'        Dim v3 As Double = iDirect.Z
'        ' Calculate the projection of the vector between the points onto the direction vector
'        Dim proj As Double = ((x2 - x1) * v1 + (y2 - y1) * v2 + (z2 - z1) * v3) / (v1 ^ 2 + v2 ^ 2 + v3 ^ 2)
'        ' Calculate the distance between the points in the direction of the direction vector
'        DistanceBetweenPointandVector = Math.Sqrt((proj * v1) ^ 2 + (proj * v2) ^ 2 + (proj * v3) ^ 2)
'    End Function

'    Function DistanceOf2Pt(ByVal iPt1 As Point3d, ByVal iPt2 As Point3d) As Double
'        DistanceOf2Pt = Math.Round(Math.Sqrt((iPt1.X - iPt2.X) ^ 2 + (iPt1.Y - iPt2.Y) ^ 2 + (iPt1.Z - iPt2.Z) ^ 2), 2)
'    End Function

'    Function ArcInfo(ByVal x1 As Double, ByVal y1 As Double, ByVal z1 As Double, ByVal x2 As Double, ByVal y2 As Double, ByVal z2 As Double, ByVal x3 As Double, ByVal y3 As Double, ByVal z3 As Double) As String
'        Dim v1x As Double, v1y As Double, v1z As Double         'Vector AB(v1x,v1y,v1z)
'        Dim v2x As Double, v2y As Double, v2z As Double         'Vector AC(v2x,v2y,v2z)
'        Dim vXpt As Double                                      ' Toa do x, y, z vector Phap tuyen
'        Dim vYpt As Double
'        Dim vZpt As Double
'        Dim tt1x As Double, tt1y As Double, tt1z As Double
'        Dim tt2x As Double, tt2y As Double, tt2z As Double
'        Dim x0 As Double, y0 As Double, z0 As Double
'        Dim detA As Double, detA1 As Double, detA2 As Double, detA3 As Double
'        Dim d1x As Double, d2y As Double, d3z As Double
'        Dim iR As Double    'Ban kinh duong tron
'        x0 = x1
'        y0 = y1
'        z0 = z1
'        tt1x = (x1 + x2) / 2
'        tt1y = (y1 + y2) / 2
'        tt1z = (z1 + z2) / 2
'        tt2x = (x1 + x3) / 2
'        tt2y = (y1 + y3) / 2
'        tt2z = (z1 + z3) / 2
'        v1x = x2 - x1
'        v1y = y2 - y1
'        v1z = z2 - z1
'        v2x = x3 - x1
'        v2y = y3 - y1
'        v2z = z3 - z1
'        vXpt = v1y * v2z - v1z * v2y                                    'vXpt   vYpt    vZpt    d1x
'        vYpt = v1z * v2x - v1x * v2z                                    'v1x    v1y     v1z     d2y
'        vZpt = v1x * v2y - v1y * v2x                                    'v2x    v2y     v2z     d3z
'        d1x = vXpt * x0 + vYpt * y0 + vZpt * z0
'        d2y = v1x * tt1x + v1y * tt1y + v1z * tt1z
'        d3z = v2x * tt2x + v2y * tt2y + v2z * tt2z
'        detA = CalDet(vXpt, vYpt, vZpt, v1x, v1y, v1z, v2x, v2y, v2z)
'        detA1 = CalDet(d1x, vYpt, vZpt, d2y, v1y, v1z, d3z, v2y, v2z)
'        detA2 = CalDet(vXpt, d1x, vZpt, v1x, d2y, v1z, v2x, d3z, v2z)
'        detA3 = CalDet(vXpt, vYpt, d1x, v1x, v1y, d2y, v2x, v2y, d3z)
'        iR = Math.Round(Math.Sqrt((detA1 / detA - x0) ^ 2 + (detA2 / detA - y0) ^ 2 + (detA3 / detA - z0) ^ 2), 3)
'        ArcInfo = detA1 / detA & "," & detA2 / detA & "," & detA3 / detA & "," & iR
'    End Function

'    Function CalDet(ByVal a11 As Double, ByVal a12 As Double, ByVal a13 As Double, ByVal a21 As Double, ByVal a22 As Double, ByVal a23 As Double, ByVal a31 As Double, ByVal a32 As Double, ByVal a33 As Double) As Double
'        CalDet = a11 * a22 * a33 + a12 * a23 * a31 + a13 * a21 * a32 - a13 * a22 * a31 - a12 * a21 * a33 - a11 * a23 * a32
'    End Function

'    Function CheckCompTrans(ByVal iComponent As Component) As Boolean
'        Dim matrix As Matrix3x3
'        Dim position As Point3d

'        iComponent.GetPosition(position, matrix)
'        If position.X = 0 And position.Y = 0 And position.Z = 0 Then
'            If matrix.Xx = 1 And matrix.Yy = 1 And matrix.Zz = 1 Then
'                CheckCompTrans = False
'            Else
'                CheckCompTrans = True
'            End If
'        Else
'            CheckCompTrans = True
'        End If

'    End Function

'    Sub CreateNewWindow()

'        Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display

'        Dim fileNew1 As NXOpen.FileNew = Nothing
'        fileNew1 = theSession.Parts.FileNew()
'        fileNew1.TemplateFileName = "@DB/assembly-mm-template_NX11/A"
'        fileNew1.UseBlankTemplate = False
'        fileNew1.ApplicationName = "AssemblyTemplate"
'        fileNew1.Units = NXOpen.Part.Units.Millimeters
'        fileNew1.RelationType = "master"
'        fileNew1.UsesMasterModel = "No"
'        fileNew1.TemplateType = NXOpen.FileNewTemplateType.Item
'        fileNew1.TemplatePresentationName = "Assembly"
'        fileNew1.ItemType = "CAD"
'        fileNew1.Specialization = ""
'        fileNew1.SetCanCreateAltrep(False)
'        Dim partOperationCreateBuilder1 As NXOpen.PDM.PartOperationCreateBuilder = Nothing
'        partOperationCreateBuilder1 = theSession.PdmSession.CreateCreateOperationBuilder(NXOpen.PDM.PartOperationBuilder.OperationType.Create)
'        fileNew1.SetPartOperationCreateBuilder(partOperationCreateBuilder1)
'        partOperationCreateBuilder1.SetOperationSubType(NXOpen.PDM.PartOperationCreateBuilder.OperationSubType.FromTemplate)
'        partOperationCreateBuilder1.SetModelType("master")
'        partOperationCreateBuilder1.SetItemType("CAD")
'        Dim logicalobjects1() As NXOpen.PDM.LogicalObject
'        partOperationCreateBuilder1.CreateLogicalObjects(logicalobjects1)

'        Dim sourceobjects1() As NXOpen.NXObject
'        sourceobjects1 = logicalobjects1(0).GetUserAttributeSourceObjects()

'        'partOperationCreateBuilder1.DefaultDestinationFolder = ":Automate"

'        Dim sourceobjects2() As NXOpen.NXObject
'        sourceobjects2 = logicalobjects1(0).GetUserAttributeSourceObjects()
'        partOperationCreateBuilder1.SetOperationSubType(NXOpen.PDM.PartOperationCreateBuilder.OperationSubType.FromTemplate)
'        Dim sourceobjects3() As NXOpen.NXObject
'        sourceobjects3 = logicalobjects1(0).GetUserAttributeSourceObjects()

'        Dim objects1(0) As NXOpen.NXObject
'        objects1(0) = logicalobjects1(0)
'        Dim errorList1 As NXOpen.ErrorList = Nothing
'        errorList1 = partOperationCreateBuilder1.AutoAssignAttributes(objects1)

'        errorList1.Dispose()
'        Dim errorList2 As NXOpen.ErrorList = Nothing
'        errorList2 = partOperationCreateBuilder1.GetOperationFailures()


'        fileNew1.MasterFileName = ""
'        fileNew1.MakeDisplayedPart = True
'        partOperationCreateBuilder1.ValidateLogicalObjectsToCommit()

'        Dim logicalobjects2(0) As NXOpen.PDM.LogicalObject
'        logicalobjects2(0) = logicalobjects1(0)
'        partOperationCreateBuilder1.CreateSpecificationsForLogicalObjects(logicalobjects2)

'        Dim errorList3 As NXOpen.ErrorList = Nothing
'        errorList3 = partOperationCreateBuilder1.GetOperationFailures()

'        Dim nXObject1 As NXOpen.NXObject = Nothing
'        nXObject1 = fileNew1.Commit()

'        workPart = theSession.Parts.Work ' NML41907957
'        displayPart = theSession.Parts.Display ' NML41907957
'        Dim errorList4 As NXOpen.ErrorList = Nothing
'        errorList4 = partOperationCreateBuilder1.GetOperationFailures()

'        fileNew1.Destroy()
'        theSession.CleanUpFacetedFacesAndEdges()

'        ' ----------------------------------------------
'        '   Menu: Tools->Journal->Stop Recording
'        ' ----------------------------------------------

'    End Sub

'    Sub CreateNewWindow(ByVal iNewPartName As String)
'        Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display


'        Dim fileNew1 As NXOpen.FileNew = Nothing
'        fileNew1 = theSession.Parts.FileNew()

'        fileNew1.TemplateFileName = "@DB/assembly-mm-template_NX11/A"

'        fileNew1.UseBlankTemplate = False

'        fileNew1.ApplicationName = "AssemblyTemplate"

'        fileNew1.Units = NXOpen.Part.Units.Millimeters

'        fileNew1.RelationType = "master"

'        fileNew1.UsesMasterModel = "No"

'        fileNew1.TemplateType = NXOpen.FileNewTemplateType.Item

'        fileNew1.TemplatePresentationName = "Assembly"

'        fileNew1.ItemType = "CAD"

'        fileNew1.Specialization = ""

'        fileNew1.SetCanCreateAltrep(False)

'        Dim partOperationCreateBuilder1 As NXOpen.PDM.PartOperationCreateBuilder = Nothing
'        partOperationCreateBuilder1 = theSession.PdmSession.CreateCreateOperationBuilder(NXOpen.PDM.PartOperationBuilder.OperationType.Create)

'        fileNew1.SetPartOperationCreateBuilder(partOperationCreateBuilder1)

'        partOperationCreateBuilder1.SetOperationSubType(NXOpen.PDM.PartOperationCreateBuilder.OperationSubType.FromTemplate)

'        partOperationCreateBuilder1.SetModelType("master")

'        partOperationCreateBuilder1.SetItemType("CAD")

'        Dim logicalobjects1() As NXOpen.PDM.LogicalObject
'        partOperationCreateBuilder1.CreateLogicalObjects(logicalobjects1)

'        Dim sourceobjects1() As NXOpen.NXObject
'        sourceobjects1 = logicalobjects1(0).GetUserAttributeSourceObjects()

'        'partOperationCreateBuilder1.DefaultDestinationFolder = ":Automate"

'        Dim sourceobjects2() As NXOpen.NXObject
'        sourceobjects2 = logicalobjects1(0).GetUserAttributeSourceObjects()

'        partOperationCreateBuilder1.SetOperationSubType(NXOpen.PDM.PartOperationCreateBuilder.OperationSubType.FromTemplate)

'        Dim sourceobjects3() As NXOpen.NXObject
'        sourceobjects3 = logicalobjects1(0).GetUserAttributeSourceObjects()

'        Dim objects1(0) As NXOpen.NXObject
'        objects1(0) = logicalobjects1(0)
'        Dim errorList1 As NXOpen.ErrorList = Nothing
'        errorList1 = partOperationCreateBuilder1.AutoAssignAttributes(objects1)

'        errorList1.Dispose()
'        Dim errorList2 As NXOpen.ErrorList = Nothing
'        errorList2 = partOperationCreateBuilder1.GetOperationFailures()

'        Dim objects2(-1) As NXOpen.NXObject
'        Dim attributePropertiesBuilder1 As NXOpen.AttributePropertiesBuilder = Nothing
'        attributePropertiesBuilder1 = theSession.AttributeManager.CreateAttributePropertiesBuilder(workPart, objects2, NXOpen.AttributePropertiesBuilder.OperationType.None)

'        Dim objects3(0) As NXOpen.NXObject
'        objects3(0) = sourceobjects1(0)
'        attributePropertiesBuilder1.SetAttributeObjects(objects3)

'        attributePropertiesBuilder1.Title = "DB_PART_NAME"

'        attributePropertiesBuilder1.Category = "CAD"

'        attributePropertiesBuilder1.StringValue = iNewPartName

'        Dim changed1 As Boolean = Nothing
'        changed1 = attributePropertiesBuilder1.CreateAttribute()

'        fileNew1.MasterFileName = ""

'        fileNew1.MakeDisplayedPart = True

'        partOperationCreateBuilder1.ValidateLogicalObjectsToCommit()

'        Dim logicalobjects2(0) As NXOpen.PDM.LogicalObject
'        logicalobjects2(0) = logicalobjects1(0)
'        partOperationCreateBuilder1.CreateSpecificationsForLogicalObjects(logicalobjects2)

'        Dim errorList3 As NXOpen.ErrorList = Nothing
'        errorList3 = partOperationCreateBuilder1.GetOperationFailures()

'        Dim nXObject1 As NXOpen.NXObject = Nothing
'        nXObject1 = fileNew1.Commit()

'        workPart = theSession.Parts.Work ' CreateNewWindow
'        displayPart = theSession.Parts.Display ' CreateNewWindow
'        Dim errorList4 As NXOpen.ErrorList = Nothing
'        errorList4 = partOperationCreateBuilder1.GetOperationFailures()

'        fileNew1.Destroy()

'        attributePropertiesBuilder1.Destroy()

'        ' ----------------------------------------------
'        '   Dialog Begin Add Component
'        ' ----------------------------------------------





'    End Sub

'    Function CreatTopAssyLv1(myName As String, ByRef iSectAuto As Component) As Assemblies.Component
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        Dim theSession As Session = Session.GetSession()
'        Dim fileNewX As FileNew
'        Dim partLoadStatusX As PartLoadStatus
'        Dim createNewComponentBuilderX As Assemblies.CreateNewComponentBuilder
'        Dim myPart As Assemblies.Component
'        Dim nXObjectX As NXObject
'        Dim workpart As Part = theSession.Parts.Work
'        fileNewX = CreatPart(myName)

'        theSession.Parts.SetWorkComponent(myPart, partLoadStatusX)
'        workpart = theSession.Parts.Work
'        partLoadStatusX.Dispose()
'        createNewComponentBuilderX = workpart.AssemblyManager.CreateNewComponentBuilder()
'        createNewComponentBuilderX.NewFile = fileNewX

'        iSectAuto = createNewComponentBuilderX.Commit()
'        Dim component1 As Assemblies.Component = CType(iSectAuto, Assemblies.Component)       'Set workpart sau khi tao
'        theSession.Parts.SetWorkComponent(component1, partLoadStatus1)
'        workpart = theSession.Parts.Work
'        createNewComponentBuilderX.Destroy()
'        CreatTopAssyLv1 = myPart
'    End Function

'    Sub CreateAssyNewLv2(ByVal iCompName As String, ByRef iOutComp As Component)
'        Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim fileNew1 As NXOpen.FileNew = Nothing
'        fileNew1 = theSession.Parts.FileNew()
'        fileNew1.TemplateFileName = "@DB/assembly-mm-template_NX11/A"
'        fileNew1.UseBlankTemplate = False
'        fileNew1.ApplicationName = "AssemblyTemplate"
'        fileNew1.Units = NXOpen.Part.Units.Millimeters
'        fileNew1.RelationType = "master"
'        fileNew1.UsesMasterModel = "No"
'        fileNew1.TemplateType = NXOpen.FileNewTemplateType.Item
'        fileNew1.TemplatePresentationName = "Assembly"
'        fileNew1.ItemType = "CAD"
'        fileNew1.Specialization = ""
'        fileNew1.SetCanCreateAltrep(False)
'        fileNew1.MasterFileName = ""
'        fileNew1.MakeDisplayedPart = False
'        Dim partOperationCreateBuilder1 As NXOpen.PDM.PartOperationCreateBuilder = Nothing
'        partOperationCreateBuilder1 = theSession.PdmSession.CreateCreateOperationBuilder(NXOpen.PDM.PartOperationBuilder.OperationType.Create)
'        fileNew1.SetPartOperationCreateBuilder(partOperationCreateBuilder1)
'        partOperationCreateBuilder1.SetOperationSubType(NXOpen.PDM.PartOperationCreateBuilder.OperationSubType.FromTemplate)
'        partOperationCreateBuilder1.SetModelType("master")
'        partOperationCreateBuilder1.SetItemType("CAD")

'        Dim logicalobjects1() As NXOpen.PDM.LogicalObject
'        partOperationCreateBuilder1.CreateLogicalObjects(logicalobjects1)
'        Dim sourceobjects1() As NXOpen.NXObject
'        sourceobjects1 = logicalobjects1(0).GetUserAttributeSourceObjects()
'        Dim sourceobjects2() As NXOpen.NXObject
'        sourceobjects2 = logicalobjects1(0).GetUserAttributeSourceObjects()
'        partOperationCreateBuilder1.SetOperationSubType(NXOpen.PDM.PartOperationCreateBuilder.OperationSubType.FromTemplate)
'        Dim sourceobjects3() As NXOpen.NXObject
'        sourceobjects3 = logicalobjects1(0).GetUserAttributeSourceObjects()

'        Dim objects1(0) As NXOpen.NXObject
'        objects1(0) = logicalobjects1(0)
'        Dim errorList1 As NXOpen.ErrorList = Nothing
'        errorList1 = partOperationCreateBuilder1.AutoAssignAttributes(objects1)

'        errorList1.Dispose()
'        Dim errorList2 As NXOpen.ErrorList = Nothing
'        errorList2 = partOperationCreateBuilder1.GetOperationFailures()

'        Dim objects2(-1) As NXOpen.NXObject
'        Dim attributePropertiesBuilder1 As NXOpen.AttributePropertiesBuilder = Nothing
'        attributePropertiesBuilder1 = theSession.AttributeManager.CreateAttributePropertiesBuilder(workPart, objects2, NXOpen.AttributePropertiesBuilder.OperationType.None)

'        Dim objects3(0) As NXOpen.NXObject
'        objects3(0) = sourceobjects1(0)
'        attributePropertiesBuilder1.SetAttributeObjects(objects3)
'        attributePropertiesBuilder1.Title = "DB_PART_NAME"
'        attributePropertiesBuilder1.Category = "CAD"
'        attributePropertiesBuilder1.StringValue = iCompName
'        Dim changed1 As Boolean = Nothing
'        changed1 = attributePropertiesBuilder1.CreateAttribute()

'        fileNew1.MasterFileName = ""
'        fileNew1.MakeDisplayedPart = False
'        partOperationCreateBuilder1.ValidateLogicalObjectsToCommit()
'        Dim logicalobjects2(0) As NXOpen.PDM.LogicalObject
'        logicalobjects2(0) = logicalobjects1(0)
'        partOperationCreateBuilder1.CreateSpecificationsForLogicalObjects(logicalobjects2)
'        attributePropertiesBuilder1.Destroy()

'        Dim createNewComponentBuilder1 As NXOpen.Assemblies.CreateNewComponentBuilder = Nothing
'        createNewComponentBuilder1 = workPart.AssemblyManager.CreateNewComponentBuilder()
'        createNewComponentBuilder1.ReferenceSet = NXOpen.Assemblies.CreateNewComponentBuilder.ComponentReferenceSetType.EntirePartOnly
'        createNewComponentBuilder1.ReferenceSetName = "Entire Part"

'        createNewComponentBuilder1.NewFile = fileNew1
'        Dim nXObject1 As NXOpen.NXObject = Nothing
'        nXObject1 = createNewComponentBuilder1.Commit()

'        'Dim iComp As Component = CType(nXObject1, Component)

'        iOutComp = CType(nXObject1, Component)
'        createNewComponentBuilder1.Destroy()
'        Dim component1 As Assemblies.Component = CType(nXObject1, Assemblies.Component)       'Set workpart sau khi tao
'        theSession.Parts.SetWorkComponent(component1, partLoadStatus1)
'        partLoadStatus1.Dispose()
'        nXObject1 = Nothing
'        theSession.CleanUpFacetedFacesAndEdges()

'    End Sub

'    Sub CreateAssyNoName(ByVal strName As String, strNo As String, ByRef iOutComp As Component)
'        Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work

'        Dim displayPart As NXOpen.Part = theSession.Parts.Display

'        Dim markId1 As NXOpen.Session.UndoMarkId = Nothing
'        markId1 = theSession.SetUndoMark(NXOpen.Session.MarkVisibility.Visible, "Create New Component")

'        Dim markId2 As NXOpen.Session.UndoMarkId = Nothing
'        markId2 = theSession.SetUndoMark(NXOpen.Session.MarkVisibility.Visible, "Start")

'        Dim fileNew1 As NXOpen.FileNew = Nothing
'        fileNew1 = theSession.Parts.FileNew()

'        fileNew1.TemplateFileName = "@DB/assembly-mm-template_NX11/A"

'        fileNew1.UseBlankTemplate = False

'        fileNew1.ApplicationName = "AssemblyTemplate"

'        fileNew1.Units = NXOpen.Part.Units.Millimeters

'        fileNew1.RelationType = "master"

'        fileNew1.UsesMasterModel = "No"

'        fileNew1.TemplateType = NXOpen.FileNewTemplateType.Item

'        fileNew1.TemplatePresentationName = "Assembly"

'        fileNew1.ItemType = "CAD"

'        fileNew1.Specialization = ""

'        fileNew1.SetCanCreateAltrep(False)

'        Dim partOperationCreateBuilder1 As NXOpen.PDM.PartOperationCreateBuilder = Nothing
'        partOperationCreateBuilder1 = theSession.PdmSession.CreateCreateOperationBuilder(NXOpen.PDM.PartOperationBuilder.OperationType.Create)

'        fileNew1.SetPartOperationCreateBuilder(partOperationCreateBuilder1)

'        partOperationCreateBuilder1.SetOperationSubType(NXOpen.PDM.PartOperationCreateBuilder.OperationSubType.FromTemplate)

'        partOperationCreateBuilder1.SetModelType("master")

'        partOperationCreateBuilder1.SetItemType("CAD")

'        Dim logicalobjects1() As NXOpen.PDM.LogicalObject
'        partOperationCreateBuilder1.CreateLogicalObjects(logicalobjects1)

'        Dim sourceobjects1() As NXOpen.NXObject
'        sourceobjects1 = logicalobjects1(0).GetUserAttributeSourceObjects()


'        Dim sourceobjects2() As NXOpen.NXObject
'        sourceobjects2 = logicalobjects1(0).GetUserAttributeSourceObjects()

'        partOperationCreateBuilder1.SetOperationSubType(NXOpen.PDM.PartOperationCreateBuilder.OperationSubType.FromTemplate)

'        Dim sourceobjects3() As NXOpen.NXObject
'        sourceobjects3 = logicalobjects1(0).GetUserAttributeSourceObjects()

'        theSession.SetUndoMarkName(markId2, "New Component File Dialog")

'        Dim objects1(0) As NXOpen.NXObject
'        objects1(0) = logicalobjects1(0)
'        Dim errorList1 As NXOpen.ErrorList = Nothing
'        errorList1 = partOperationCreateBuilder1.AutoAssignAttributes(objects1)

'        errorList1.Dispose()
'        Dim errorList2 As NXOpen.ErrorList = Nothing
'        errorList2 = partOperationCreateBuilder1.GetOperationFailures()

'        Dim objects2(-1) As NXOpen.NXObject
'        Dim attributePropertiesBuilder1 As NXOpen.AttributePropertiesBuilder = Nothing
'        attributePropertiesBuilder1 = theSession.AttributeManager.CreateAttributePropertiesBuilder(workPart, objects2, NXOpen.AttributePropertiesBuilder.OperationType.None)

'        Dim objects3(0) As NXOpen.NXObject
'        objects3(0) = sourceobjects1(0)
'        attributePropertiesBuilder1.SetAttributeObjects(objects3)

'        attributePropertiesBuilder1.Title = "DB_PART_NO"

'        attributePropertiesBuilder1.Category = "CAD"

'        attributePropertiesBuilder1.StringValue = strNo

'        Dim changed1 As Boolean = Nothing
'        changed1 = attributePropertiesBuilder1.CreateAttribute()

'        attributePropertiesBuilder1.Title = "DB_PART_NAME"

'        attributePropertiesBuilder1.StringValue = strName

'        Dim changed2 As Boolean = Nothing
'        changed2 = attributePropertiesBuilder1.CreateAttribute()

'        Dim markId3 As NXOpen.Session.UndoMarkId = Nothing
'        markId3 = theSession.SetUndoMark(NXOpen.Session.MarkVisibility.Invisible, "New Component File")

'        theSession.DeleteUndoMark(markId3, Nothing)

'        Dim markId4 As NXOpen.Session.UndoMarkId = Nothing
'        markId4 = theSession.SetUndoMark(NXOpen.Session.MarkVisibility.Invisible, "New Component File")

'        fileNew1.MasterFileName = ""

'        fileNew1.MakeDisplayedPart = False

'        partOperationCreateBuilder1.ValidateLogicalObjectsToCommit()

'        Dim logicalobjects2(0) As NXOpen.PDM.LogicalObject
'        logicalobjects2(0) = logicalobjects1(0)
'        partOperationCreateBuilder1.CreateSpecificationsForLogicalObjects(logicalobjects2)

'        Dim errorList3 As NXOpen.ErrorList = Nothing
'        errorList3 = partOperationCreateBuilder1.GetOperationFailures()

'        theSession.DeleteUndoMark(markId4, Nothing)

'        theSession.SetUndoMarkName(markId2, "New Component File")

'        attributePropertiesBuilder1.Destroy()

'        Dim markId5 As NXOpen.Session.UndoMarkId = Nothing
'        markId5 = theSession.SetUndoMark(NXOpen.Session.MarkVisibility.Visible, "Start")

'        Dim createNewComponentBuilder1 As NXOpen.Assemblies.CreateNewComponentBuilder = Nothing
'        createNewComponentBuilder1 = workPart.AssemblyManager.CreateNewComponentBuilder()

'        createNewComponentBuilder1.NewComponentName = "NML41911506"

'        createNewComponentBuilder1.ReferenceSet = NXOpen.Assemblies.CreateNewComponentBuilder.ComponentReferenceSetType.EntirePartOnly

'        createNewComponentBuilder1.ReferenceSetName = "Entire Part"

'        theSession.SetUndoMarkName(markId5, "Create New Component Dialog")

'        createNewComponentBuilder1.NewComponentName = strName

'        ' ----------------------------------------------
'        '   Dialog Begin Create New Component
'        ' ----------------------------------------------
'        Dim markId6 As NXOpen.Session.UndoMarkId = Nothing
'        markId6 = theSession.SetUndoMark(NXOpen.Session.MarkVisibility.Invisible, "Create New Component")

'        theSession.DeleteUndoMark(markId6, Nothing)

'        Dim markId7 As NXOpen.Session.UndoMarkId = Nothing
'        markId7 = theSession.SetUndoMark(NXOpen.Session.MarkVisibility.Invisible, "Create New Component")

'        createNewComponentBuilder1.NewFile = fileNew1

'        Dim markId8 As NXOpen.Session.UndoMarkId = Nothing
'        markId8 = theSession.SetUndoMark(NXOpen.Session.MarkVisibility.Visible, "Create New component")

'        Dim nXObject1 As NXOpen.NXObject = Nothing
'        nXObject1 = createNewComponentBuilder1.Commit()

'        theSession.DeleteUndoMark(markId7, Nothing)

'        theSession.SetUndoMarkName(markId5, "Create New Component")

'        createNewComponentBuilder1.Destroy()

'        theSession.DeleteUndoMark(markId8, Nothing)

'        theSession.DeleteUndoMarksUpToMark(markId2, Nothing, False)

'        ' ----------------------------------------------
'        '   Menu: Tools->Journal->Stop Recording
'        ' ----------------------------------------------
'    End Sub

'    Function CreatPart(partName As String) As FileNew
'        Dim theSession As Session = Session.GetSession()
'        Dim partFromTemplateBuilderX As PDM.PartFromTemplateBuilder
'        Dim databaseAttributeManagerX As PDM.DatabaseAttributeManager
'        Dim fileNewX As FileNew
'        partFromTemplateBuilderX = theSession.Parts.PDMPartManager.NewPartFromTemplateBuilder()
'        partFromTemplateBuilderX.SetContextOperation(PDM.PartBuilder.Operation.AssemblyCreateNewComponent)
'        fileNewX = theSession.Parts.FileNew()
'        theSession.PdmSession.SetDefaultFolder("Newstuff")
'        partFromTemplateBuilderX.CreatePartSpec("CAD", Nothing, Nothing, "master", "")
'        databaseAttributeManagerX = partFromTemplateBuilderX.NewDatabaseAttributeManager()
'        databaseAttributeManagerX.SetAttribute("DB_PART_NAME", partName)
'        databaseAttributeManagerX.StoreAttributes()
'        databaseAttributeManagerX.Dispose()
'        fileNewX.TemplateFileName = "@DB/assembly-mm-template_NX11/A"
'        fileNewX.UseBlankTemplate = False
'        fileNewX.ApplicationName = "AssemblyTemplate"
'        fileNewX.Units = NXOpen.Part.Units.Millimeters
'        fileNewX.RelationType = "master"
'        fileNewX.UsesMasterModel = "No"
'        fileNewX.TemplateType = NXOpen.FileNewTemplateType.Item
'        fileNewX.TemplatePresentationName = "Assembly"
'        fileNewX.ItemType = "CAD"
'        fileNewX.Specialization = ""
'        fileNewX.SetCanCreateAltrep(False)
'        fileNewX.UseBlankTemplate = False
'        fileNewX.MakeDisplayedPart = False
'        CreatPart = fileNewX
'    End Function

'    Sub iSearchFuncNo(ByVal icomp As Component, ByRef iFuncNo As String)
'        Dim tmpFunc As String = icomp.OwningComponent.GetStringAttribute("DB_PART_NO").ToString
'        Try
'            If icomp.OwningComponent.GetStringAttribute("DB_SEED_PART_USED").ToString = "TOP-ASSEMBLY-MM-TEMPLATE,A" Then
'                iFuncNo = tmpFunc
'                Exit Sub
'            ElseIf Len(Split(tmpFunc, "_")(1)) = 9 And Right(Split(tmpFunc, "_")(1), 3) = "---" Then
'                iFuncNo = tmpFunc
'                Exit Sub
'            Else
'                icomp = icomp.OwningComponent
'                Call iSearchFuncNo(icomp, iFuncNo)
'            End If
'        Catch ex As Exception
'            Try
'                Call iSearchFuncNo(icomp.OwningComponent, iFuncNo)
'            Catch ex1 As Exception
'                iFuncNo = "T000A_G00000---_000_000"
'            End Try
'        End Try
'    End Sub

'    Public Function AddComponentByNoPDM(parentNo As String, childNo As String)
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        Dim theSession As Session = Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work
'        theSession.Parts.SetNonmasterSeedPartData("@DB/" & childNo)
'        basePart1 = theSession.Parts.OpenBase("@DB/" & childNo, partLoadStatus1)
'        partLoadStatus1.Dispose()
'        part1 = CType(basePart1, Part)
'        orientation1.Xx = 1.0
'        orientation1.Xy = 0.0
'        orientation1.Xz = 0.0
'        orientation1.Yx = 0.0
'        orientation1.Yy = 1.0
'        orientation1.Yz = 0.0
'        orientation1.Zx = 0.0
'        orientation1.Zy = 0.0
'        orientation1.Zz = 1.0
'        Dim part2 As Part = CType(theSession.Parts.FindObject("@DB/" & parentNo), Part)
'        theSession.Parts.SetWork(part2)
'        workPart = theSession.Parts.Work
'        component1 = workPart.ComponentAssembly.AddComponent(part1, "None", "", basePoint1, orientation1, -1, partLoadStatus1)
'        partLoadStatus1.Dispose()
'        Return AddComponentByNoPDM
'    End Function

'    Public Function AddComponentByNoASSY(parentNo As String, childNo As String)
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        Dim theSession As Session = Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work
'        part1 = CType(theSession.Parts.FindObject("@DB/" & childNo), Part)
'        orientation1.Xx = 1.0
'        orientation1.Xy = 0.0
'        orientation1.Xz = 0.0
'        orientation1.Yx = 0.0
'        orientation1.Yy = 1.0
'        orientation1.Yz = 0.0
'        orientation1.Zx = 0.0
'        orientation1.Zy = 0.0
'        orientation1.Zz = 1.0
'        Dim part2 As Part = CType(theSession.Parts.FindObject("@DB/" & parentNo), Part)
'        theSession.Parts.SetWork(part2)
'        workPart = theSession.Parts.Work
'        component1 = workPart.ComponentAssembly.AddComponent(part1, "None", "", basePoint1, orientation1, -1, partLoadStatus1)
'        partLoadStatus1.Dispose()
'        Return AddComponentByNoASSY
'    End Function

'    Sub AddCompoToAssy(ByVal iTopNo As String, ByVal iAddComp As String)
'        Try
'            AddComponentByNoPDM(iTopNo, iAddComp & "/" & GetRev(iAddComp))
'        Catch
'            AddComponentByNoASSY(iTopNo, iAddComp & "/" & GetRev(iAddComp))
'        End Try
'    End Sub

'    Public Function AddThickComponentByNoPDM(parentNo As String, childNo As String, ByVal iKakunoComp As Component)
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        Dim theSession As Session = Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work
'        theSession.Parts.SetNonmasterSeedPartData("@DB/" & childNo)
'        basePart1 = theSession.Parts.OpenBase("@DB/" & childNo, partLoadStatus1)
'        partLoadStatus1.Dispose()
'        part1 = CType(basePart1, Part)

'        Dim position As Point3d
'        Dim matrix As Matrix3x3

'        iKakunoComp.GetPosition(position, matrix)
'        orientation1.Xx = matrix.Xx
'        orientation1.Xy = matrix.Xy
'        orientation1.Xz = matrix.Xz
'        orientation1.Yx = matrix.Yx
'        orientation1.Yy = matrix.Yy
'        orientation1.Yz = matrix.Yz
'        orientation1.Zx = matrix.Zx
'        orientation1.Zy = matrix.Zy
'        orientation1.Zz = matrix.Zz
'        Dim part2 As Part = CType(theSession.Parts.FindObject("@DB/" & parentNo), Part)
'        theSession.Parts.SetWork(part2)
'        workPart = theSession.Parts.Work
'        component1 = workPart.ComponentAssembly.AddComponent(part1, "None", "", position, orientation1, -1, partLoadStatus1)
'        partLoadStatus1.Dispose()
'        Return AddThickComponentByNoPDM
'    End Function

'    Public Function AddThickComponentByNoASSY(parentNo As String, childNo As String, ByVal iKakunoComp As Component)
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        Dim theSession As Session = Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work
'        part1 = CType(theSession.Parts.FindObject("@DB/" & childNo), Part)
'        Dim position As Point3d
'        Dim matrix As Matrix3x3

'        iKakunoComp.GetPosition(position, matrix)
'        orientation1.Xx = matrix.Xx
'        orientation1.Xy = matrix.Xy
'        orientation1.Xz = matrix.Xz
'        orientation1.Yx = matrix.Yx
'        orientation1.Yy = matrix.Yy
'        orientation1.Yz = matrix.Yz
'        orientation1.Zx = matrix.Zx
'        orientation1.Zy = matrix.Zy
'        orientation1.Zz = matrix.Zz

'        Dim part2 As Part = CType(theSession.Parts.FindObject("@DB/" & parentNo), Part)
'        theSession.Parts.SetWork(part2)
'        workPart = theSession.Parts.Work
'        component1 = workPart.ComponentAssembly.AddComponent(part1, "None", "", position, orientation1, -1, partLoadStatus1)
'        partLoadStatus1.Dispose()
'        Return AddThickComponentByNoASSY
'    End Function

'    Public Function GetRev(ByVal partname As String)
'        Dim revision As String
'        Dim theUfSession As UFSession = UFSession.GetUFSession()
'        Dim ugmgr As UFUgmgr = theUfSession.Ugmgr
'        Dim revcount As Integer
'        Dim revstr() As Tag = Nothing
'        Dim parttag As Tag
'        Dim prtName As String
'        Dim prtDecs As String
'        Try
'            ugmgr.AskPartTag(partname, parttag)
'            ugmgr.ListPartRevisions(parttag, revcount, revstr)
'            ugmgr.AskPartRevisionId(revstr(revcount - 1), revision)
'        Catch ex As Exception
'            'MsgBox("Error occurred loading part number " & partname)
'        End Try
'        GetRev = revision
'    End Function

'    Sub GetPartName(ByVal prtNo As String, ByRef prtName As String)
'        Dim revision As String
'        Dim theUfSession As UFSession = UFSession.GetUFSession()
'        Dim ugmgr As UFUgmgr = theUfSession.Ugmgr
'        Dim revcount As Integer
'        Dim revstr() As Tag = Nothing
'        Dim parttag As Tag
'        Dim prtDesc As String
'        Dim prtDecs As String
'        Try
'            ugmgr.AskPartTag(prtNo, parttag)
'            ugmgr.AskPartNameDesc(parttag, prtName, prtDecs)
'        Catch ex As Exception
'            'MsgBox("Error occurred loading part number " & partname)
'        End Try

'    End Sub

'    Sub ExpandComp(ByVal iComp As Component)
'        For Each iChild As Component In iComp.GetChildren
'            Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'            Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'            'theSession.Parts.SetWorkComponent(iChild, partLoadStatus1)
'            Dim workPart As NXOpen.Part = theSession.Parts.Work
'            Dim displayPart As NXOpen.Part = theSession.Parts.Display
'            Dim components1(0) As NXOpen.Assemblies.Component

'            components1(0) = iChild
'            workPart.ComponentAssembly.RootComponent.UpdateStructure(components1, -1, True)
'            Call ExpandComp(iChild)
'        Next
'    End Sub

'    Sub OpenPart(ByVal iPartNo As String)

'        Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'        Dim dispPart As Part = theSession.Parts.Display
'        Dim workpart As Part = theSession.Parts.Work

'        Dim basePart1 As NXOpen.BasePart = Nothing
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        Dim iRev As String
'        iRev = GetRev(iPartNo)

'        Try
'            basePart1 = theSession.Parts.OpenBaseDisplay("@DB/" & iPartNo & "/" & iRev, partLoadStatus1)
'        Catch ex As Exception
'            Try
'                Dim status1 As NXOpen.PartCollection.SdpsStatus = Nothing
'                Dim part1 As NXOpen.Part = CType(theSession.Parts.FindObject("@DB/" & iPartNo & "/" & iRev), NXOpen.Part)
'                status1 = theSession.Parts.SetDisplay(part1, False, True, partLoadStatus1)
'                partLoadStatus1.Dispose()
'            Catch ex1 As Exception
'                lw.WriteLine("Loi")
'                lw.WriteLine(ex1.ToString)
'            End Try
'        End Try
'        Dim rootComp As Component = theSession.Parts.Work.ComponentAssembly.RootComponent
'        Try
'            theUFSession.Ui.SetPrompt("Load Data: " & rootComp.GetStringAttribute("DB_PART_NO").ToString)
'            Call LoadAssyComponent(rootComp)
'            theUFSession.Ui.SetPrompt("全パートにする: " & rootComp.GetStringAttribute("DB_PART_NO").ToString)
'            Call SetZenPart(rootComp)
'            Call ShowCsys()
'        Catch ex As Exception
'            lw.WriteLine(ex.ToString)
'            'Exit Sub
'        End Try
'    End Sub

'    Sub LoadAssyComponent(ByVal icomponent As Component)
'        Dim theSession As Session = Session.GetSession()

'        For Each iChild As Component In icomponent.GetChildren

'            If InStr(iChild.GetStringAttribute("DB_PART_NAME").ToUpper, "ZONE") = 0 Or InStr(iChild.GetStringAttribute("DB_PART_NO").ToUpper, "ZONE") = 0 Then
'                Dim openStatus1() As Assemblies.ComponentAssembly.OpenComponentStatus = Nothing
'                Dim partLoadStatus1 As PartLoadStatus = Nothing
'                Dim componentsToOpen1() As Assemblies.Component = {iChild}
'                Dim children() As Component = iChild.GetChildren()

'                Try
'                    partLoadStatus1 = theSession.Parts.Display.ComponentAssembly.OpenComponents(
'                    Assemblies.ComponentAssembly.OpenOption.WholeAssembly, componentsToOpen1, openStatus1)
'                Catch ex As Exception
'                    partLoadStatus1 = theSession.Parts.Work.ComponentAssembly.OpenComponents(
'                        Assemblies.ComponentAssembly.OpenOption.WholeAssembly, componentsToOpen1, openStatus1)
'                End Try
'                ReportLoadStatus(partLoadStatus1)
'                iChild.Unblank()
'            Else
'            End If
'            Call LoadAssyComponent(iChild)
'        Next
'    End Sub

'    Sub LoadAssyComponentToOffset(ByVal icomponent As Component)
'        Dim theSession As Session = Session.GetSession()

'        For Each iChild As Component In icomponent.GetChildren

'            If InStr(iChild.GetStringAttribute("DB_PART_NAME").ToUpper, "ZONE") = 0 Or InStr(iChild.GetStringAttribute("DB_PART_NO").ToUpper, "ZONE") = 0 Then
'                Dim openStatus1() As Assemblies.ComponentAssembly.OpenComponentStatus = Nothing
'                Dim partLoadStatus1 As PartLoadStatus = Nothing
'                Dim componentsToOpen1() As Assemblies.Component = {iChild}
'                Dim children() As Component = iChild.GetChildren()

'                Try
'                    partLoadStatus1 = theSession.Parts.Display.ComponentAssembly.OpenComponents(
'                    Assemblies.ComponentAssembly.OpenOption.WholeAssembly, componentsToOpen1, openStatus1)
'                Catch ex As Exception
'                    partLoadStatus1 = theSession.Parts.Work.ComponentAssembly.OpenComponents(
'                        Assemblies.ComponentAssembly.OpenOption.WholeAssembly, componentsToOpen1, openStatus1)
'                End Try
'                ReportLoadStatus(partLoadStatus1)
'                iChild.Unblank()
'            Else

'            End If


'            Call LoadAssyComponent(iChild)
'        Next
'    End Sub

'    Sub LoadComponent(ByVal icomponent As Component)
'        Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'        Dim workPart1 As NXOpen.Part = theSession.Parts.Work
'        Dim displayPart1 As NXOpen.Part = theSession.Parts.Display
'        Dim componentsToOpen1(0) As NXOpen.Assemblies.Component
'        componentsToOpen1(0) = icomponent
'        Dim option1 As Boolean = Nothing
'        option1 = theSession.Parts.LoadOptions.UsePartialLoading
'        Dim openStatus1() As NXOpen.Assemblies.ComponentAssembly.OpenComponentStatus
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        Try
'            partLoadStatus1 = workPart1.ComponentAssembly.OpenComponents(NXOpen.Assemblies.ComponentAssembly.OpenOption.WholeAssembly, componentsToOpen1, openStatus1)
'        Catch ex As Exception
'            partLoadStatus1 = displayPart1.ComponentAssembly.OpenComponents(NXOpen.Assemblies.ComponentAssembly.OpenOption.ComponentOnly, componentsToOpen1, openStatus1)
'        End Try

'        partLoadStatus1.Dispose()

'    End Sub

'    Sub ReportLoadStatus(ByVal loadStatus As PartLoadStatus)
'        If loadStatus.NumberUnloadedParts > 0 Then
'            Echo("  Load notes:")
'            For ii As Integer = 0 To loadStatus.NumberUnloadedParts - 1
'                Echo("    " & loadStatus.GetPartName(ii) & " - " &
'                     loadStatus.GetStatusDescription(ii))
'            Next
'            Echo("")
'        End If
'    End Sub

'    Sub SetZenPart(ByVal icomponent As Component)
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim lw As ListingWindow = theSession.ListingWindow()
'        Dim theUISession As UI = UI.GetUI
'        Dim workpart As Part = theSession.Parts.Work

'        For Each iChild As Component In icomponent.GetChildren

'            If iChild.ReferenceSet.ToString() <> "Entire Part" Then
'                Dim componentsToOpen1() As Assemblies.Component = {iChild}
'                Dim errorList1 As NXOpen.ErrorList = Nothing
'                errorList1 = workpart.ComponentAssembly.ReplaceReferenceSetInOwners("Entire Part", componentsToOpen1)
'            End If
'            Call SetZenPart(iChild)
'        Next

'    End Sub

'    Sub SetZenAssy(ByVal icomponent As Component)
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim lw As ListingWindow = theSession.ListingWindow()
'        Dim theUISession As UI = UI.GetUI
'        Dim workpart As Part = theSession.Parts.Work

'        For Each iChild As Component In icomponent.GetChildren

'            If iChild.GetChildren.Length.ToString <> "" Then
'                If iChild.ReferenceSet.ToString() <> "Entire Part" Then
'                    Dim componentsToOpen1() As Assemblies.Component = {iChild}
'                    Dim errorList1 As NXOpen.ErrorList = Nothing
'                    errorList1 = workpart.ComponentAssembly.ReplaceReferenceSetInOwners("Entire Part", componentsToOpen1)
'                End If
'            End If

'            Call SetZenAssy(iChild)
'        Next

'    End Sub

'    Sub iSaveTopAssy(ByVal iTop As Component)
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'        theSession.Parts.SetWorkComponent(iTop, partLoadStatus1)
'        Dim workPart As NXOpen.Part = theSession.Parts.Work

'        Dim displayPart As NXOpen.Part = theSession.Parts.Display

'        Dim markId1 As NXOpen.Session.UndoMarkId = Nothing
'        markId1 = theSession.SetUndoMark(NXOpen.Session.MarkVisibility.Visible, "Make Work Part")

'        Dim nullNXOpen_Assemblies_Component As NXOpen.Assemblies.Component = Nothing


'        theSession.Parts.SetWorkComponent(nullNXOpen_Assemblies_Component, NXOpen.PartCollection.RefsetOption.Entire, NXOpen.PartCollection.WorkComponentOption.Visible, partLoadStatus1)

'        workPart = theSession.Parts.Work
'        partLoadStatus1.Dispose()
'        theSession.SetUndoMarkName(markId1, "Make Work Part")

'        ' ----------------------------------------------
'        '   Menu: File->Save
'        ' ----------------------------------------------
'        Dim partSaveStatus1 As NXOpen.PartSaveStatus = Nothing
'        partSaveStatus1 = workPart.Save(NXOpen.BasePart.SaveComponents.True, NXOpen.BasePart.CloseAfterSave.False)

'        partSaveStatus1.Dispose()
'    End Sub

'    Sub ShowCsys()
'        Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work

'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim numberShown1 As Integer = Nothing
'        numberShown1 = theSession.DisplayManager.ShowByType("SHOW_HIDE_TYPE_CSYS", NXOpen.DisplayManager.ShowHideScope.AnyInAssembly)
'        workPart.ModelingViews.WorkView.FitAfterShowOrHide(NXOpen.View.ShowOrHideType.ShowOnly)

'    End Sub

'    Sub HideCsys()
'        Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work

'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim numberHidden1 As Integer = Nothing
'        numberHidden1 = theSession.DisplayManager.HideByType("SHOW_HIDE_TYPE_DATUMS", NXOpen.DisplayManager.ShowHideScope.AnyInAssembly)
'        Try
'            workPart.ModelingViews.WorkView.FitAfterShowOrHide(NXOpen.View.ShowOrHideType.HideOnly)
'        Catch ex As Exception
'            displayPart.ModelingViews.WorkView.FitAfterShowOrHide(NXOpen.View.ShowOrHideType.HideOnly)
'        End Try

'    End Sub

'    Sub FitView()
'        Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'        Dim dispPart As Part = theSession.Parts.Display
'        Dim workpart As Part = theSession.Parts.Work
'        Try
'            workpart.ModelingViews.WorkView.Fit()
'        Catch ex As Exception
'            dispPart.ModelingViews.WorkView.Fit()
'        End Try
'    End Sub

'    Sub Echo(ByVal output As String)
'        Dim theSession As Session = Session.GetSession()
'        theSession.ListingWindow.Open()
'        theSession.ListingWindow.WriteLine(output)
'        theSession.LogFile.WriteLine(output)
'    End Sub

'    Sub iReset()
'        Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim dynamicSectionBuilder1 As NXOpen.Display.DynamicSectionBuilder = Nothing
'        dynamicSectionBuilder1 = displayPart.DynamicSections.CreateSectionBuilder(displayPart.ModelingViews.WorkView)

'        dynamicSectionBuilder1.DeferCurveUpdate = False
'        Dim origin1 As NXOpen.Point3d = New NXOpen.Point3d(0.0, 0.0, 0.0)
'        Dim normal1 As NXOpen.Vector3d = New NXOpen.Vector3d(0.0, 0.0, 1.0)
'        Dim plane1 As NXOpen.Plane = Nothing
'        plane1 = workPart.Planes.CreatePlane(origin1, normal1, NXOpen.SmartObject.UpdateOption.WithinModeling)
'        Dim unit1 As NXOpen.Unit = CType(workPart.UnitCollection.FindObject("MilliMeter"), NXOpen.Unit)
'        Dim expression1 As NXOpen.Expression = Nothing
'        expression1 = workPart.Expressions.CreateSystemExpressionWithUnits("0", unit1)
'        Dim expression2 As NXOpen.Expression = Nothing
'        expression2 = workPart.Expressions.CreateSystemExpressionWithUnits("0", unit1)
'        dynamicSectionBuilder1.SeriesSpacing = 115.0
'        plane1.SetMethod(NXOpen.PlaneTypes.MethodType.Coincident)
'        dynamicSectionBuilder1.CsysType = NXOpen.Display.DynamicSectionTypes.CoordinateSystem.Absolute
'        dynamicSectionBuilder1.DefaultPlaneAxis = NXOpen.Display.DynamicSectionTypes.Axis.Z
'        dynamicSectionBuilder1.DeferCurveUpdate = False
'        dynamicSectionBuilder1.RestoreView()
'        Dim modelingView1 As NXOpen.ModelingView = Nothing
'        modelingView1 = dynamicSectionBuilder1.View
'        dynamicSectionBuilder1.ShowClip = False
'        modelingView1.DisplaySectioningToggle = False

'        Dim objects1(0) As NXOpen.NXObject
'        objects1(0) = plane1
'        Dim nErrs2 As Integer = Nothing
'        nErrs2 = theSession.UpdateManager.AddToDeleteList(objects1)

'        dynamicSectionBuilder1.Destroy()

'        Try
'            ' 式はまだ使用中です
'            workPart.Expressions.Delete(expression2)
'        Catch ex As NXException
'            ex.AssertErrorCode(1050029)
'        End Try

'        Try
'            ' 式はまだ使用中です
'            workPart.Expressions.Delete(expression1)
'        Catch ex As NXException
'            ex.AssertErrorCode(1050029)
'        End Try

'        Dim dynamicSectionBuilder2 As NXOpen.Display.DynamicSectionBuilder = Nothing
'        dynamicSectionBuilder2 = displayPart.DynamicSections.CreateSectionBuilder(modelingView1)

'        dynamicSectionBuilder2.DeferCurveUpdate = False

'        dynamicSectionBuilder2.SetDefaults()

'        Dim origin2 As NXOpen.Point3d = New NXOpen.Point3d(0.0, 0.0, 0.0)
'        Dim normal2 As NXOpen.Vector3d = New NXOpen.Vector3d(0.0, 0.0, 1.0)
'        Dim plane2 As NXOpen.Plane = Nothing
'        plane2 = workPart.Planes.CreatePlane(origin2, normal2, NXOpen.SmartObject.UpdateOption.WithinModeling)

'        Dim expression3 As NXOpen.Expression = Nothing
'        expression3 = workPart.Expressions.CreateSystemExpressionWithUnits("0", unit1)

'        Dim expression4 As NXOpen.Expression = Nothing
'        expression4 = workPart.Expressions.CreateSystemExpressionWithUnits("0", unit1)

'        plane2.SetMethod(NXOpen.PlaneTypes.MethodType.Coincident)

'        dynamicSectionBuilder2.SeriesSpacing = 115.0

'        dynamicSectionBuilder2.ShowClip = True

'        dynamicSectionBuilder2.CsysType = NXOpen.Display.DynamicSectionTypes.CoordinateSystem.Absolute

'        dynamicSectionBuilder2.DefaultPlaneAxis = NXOpen.Display.DynamicSectionTypes.Axis.Z

'        Dim mincornerpt2 As NXOpen.Point3d = New NXOpen.Point3d(-638.17734054998, -1725.3128719394242, -627.39696278561667)
'        Dim maxcornerpt2 As NXOpen.Point3d = New NXOpen.Point3d(3962.9451772981074, 356.0161699649214, 420.31118496620138)
'        dynamicSectionBuilder2.SetBoundingBox(mincornerpt2, maxcornerpt2)

'        dynamicSectionBuilder2.SetDefaultPlane()

'        dynamicSectionBuilder2.DeferCurveUpdate = False

'        Dim nXObject1 As NXOpen.NXObject = Nothing
'        nXObject1 = dynamicSectionBuilder2.Commit()

'        Dim objects2() As NXOpen.NXObject
'        objects2 = dynamicSectionBuilder2.GetCommittedObjects()

'        Dim objects3(0) As NXOpen.NXObject
'        objects3(0) = plane2
'        Dim nErrs4 As Integer = Nothing
'        nErrs4 = theSession.UpdateManager.AddToDeleteList(objects3)

'        dynamicSectionBuilder2.Destroy()

'        Try
'            ' 式はまだ使用中です
'            workPart.Expressions.Delete(expression4)
'        Catch ex As NXException
'            ex.AssertErrorCode(1050029)
'        End Try

'        Try
'            ' 式はまだ使用中です
'            workPart.Expressions.Delete(expression3)
'        Catch ex As NXException
'            ex.AssertErrorCode(1050029)
'        End Try

'        theSession.CleanUpFacetedFacesAndEdges()

'    End Sub

'    Function CheckExcelImport(ByVal iPathFile As String, ByVal iMessage As String) As Boolean
'        If System.IO.File.Exists(iPathFile) Then
'            Kill(CheckExist)
'            CheckExcelImport = True
'        Else
'            MsgBox(iMessage, vbExclamation)
'            CheckExcelImport = False
'        End If
'    End Function

'    Sub SaveData()

'        Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work

'        'Dim displayPart As NXOpen.Part = theSession.Parts.Display

'        ' ----------------------------------------------
'        '   Menu: File->Save
'        ' ----------------------------------------------
'        Dim partSaveStatus1 As NXOpen.PartSaveStatus = Nothing
'        partSaveStatus1 = workPart.Save(NXOpen.BasePart.SaveComponents.True, NXOpen.BasePart.CloseAfterSave.False)

'        partSaveStatus1.Dispose()
'        ' ----------------------------------------------
'        '   Menu: Tools->Journal->Stop Recording
'        ' ----------------------------------------------

'    End Sub

'    Function SaveAsNewNamePart(ByVal prtName As String, ByVal prtNo As String)
'        Dim theSession As Session = Session.GetSession
'        Dim partOperationBuilder1 As PDM.PartOperationBuilder
'        Dim selectedparts1(0) As BasePart
'        Dim failedparts1() As BasePart
'        Dim logicalobjects1() As PDM.LogicalObject
'        Dim sourceobjects1() As NXObject
'        Dim objects1(-1) As NXObject
'        Dim attributePropertiesBuilder1 As AttributePropertiesBuilder
'        Dim errorList1 As ErrorList
'        Dim errorList2 As ErrorList
'        Dim nXObject1 As NXObject
'        Dim errorList3 As ErrorList
'        Dim workPart As Part = theSession.Parts.Work
'        partOperationBuilder1 = theSession.PdmSession.CreateOperationBuilder(PDM.PartOperationBuilder.OperationType.SaveAs)
'        partOperationBuilder1.ReplaceAllComponents = True
'        partOperationBuilder1.DependentFileSaveAsOption = PDM.PartOperationBuilder.DependentFileSaveAs.All
'        partOperationBuilder1.SetDialogOperation(PDM.PartOperationBuilder.OperationType.SaveAs)
'        selectedparts1(0) = workPart
'        partOperationBuilder1.SetSelectedParts(selectedparts1, failedparts1)
'        partOperationBuilder1.CreateLogicalObjects(logicalobjects1)
'        sourceobjects1 = logicalobjects1(0).GetUserAttributeSourceObjects()
'        attributePropertiesBuilder1 = theSession.AttributeManager.CreateAttributePropertiesBuilder(workPart, objects1, AttributePropertiesBuilder.OperationType.SaveAs)
'        attributePropertiesBuilder1.SetAttributeObjects(sourceobjects1)
'        attributePropertiesBuilder1.Title = "DB_PART_REV"
'        attributePropertiesBuilder1.Category = "CAD Revision"
'        attributePropertiesBuilder1.DataType = AttributePropertiesBaseBuilder.DataTypeOptions.String
'        attributePropertiesBuilder1.StringValue = "AA"

'        attributePropertiesBuilder1.SetAttributeObjects(sourceobjects1)
'        attributePropertiesBuilder1.Title = "DB_PART_NO"
'        attributePropertiesBuilder1.Category = "CAD"
'        attributePropertiesBuilder1.DataType = AttributePropertiesBaseBuilder.DataTypeOptions.String
'        attributePropertiesBuilder1.StringValue = prtNo
'        attributePropertiesBuilder1.CreateAttribute()

'        attributePropertiesBuilder1.SetAttributeObjects(sourceobjects1)
'        attributePropertiesBuilder1.Title = "DB_PART_NAME"
'        attributePropertiesBuilder1.Category = "CAD"
'        attributePropertiesBuilder1.DataType = AttributePropertiesBaseBuilder.DataTypeOptions.String
'        attributePropertiesBuilder1.StringValue = prtName
'        attributePropertiesBuilder1.CreateAttribute()

'        errorList1 = partOperationBuilder1.AutoAssignAttributes(logicalobjects1)
'        partOperationBuilder1.ValidateLogicalObjectsToCommit()
'        errorList2 = partOperationBuilder1.GetOperationFailures()
'        theSession.PdmSession.SetDefaultFolder("Newstuff")
'        nXObject1 = partOperationBuilder1.Commit()

'        errorList3 = partOperationBuilder1.GetOperationFailures()
'        errorList3.Dispose()
'        partOperationBuilder1.Destroy()
'        attributePropertiesBuilder1.Destroy()
'        theSession.CleanUpFacetedFacesAndEdges()

'    End Function

'    Sub CLosePartTag(ByVal iVitri As String, ByVal PartTagnewList As List(Of String), ByVal iListDataSecret As List(Of String))

'        For Each iShuuhenPart As String In PartTagnewList
'            Dim obj As NXOpen.TaggedObject = NXOpen.Utilities.NXObjectManager.Get(iShuuhenPart)
'            Dim TagComp As NXOpen.Assemblies.Component = CType(obj, NXOpen.Assemblies.Component)
'            theUFSession.Ui.SetPrompt("Close  : " & TagComp.GetStringAttribute("DB_PART_NO").ToString)
'            Dim iCheckHintoku As Boolean = False
'            For Each CheckSecret As String In iListDataSecret
'                If InStr(TagComp.GetStringAttribute("DB_PART_NO").ToString, CheckSecret) > 0 Then
'                    iCheckHintoku = True
'                End If
'            Next
'            If iCheckHintoku = False Then
'                Try
'                    TagComp.Blank()
'                    ClosePart(TagComp)
'                Catch ex As Exception
'                    ClosePart(TagComp)
'                End Try
'            End If


'        Next
'    End Sub

'    Sub ClosePart(icomp As Component)
'        Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim componentsToClose1(0) As NXOpen.Assemblies.Component
'        componentsToClose1(0) = icomp
'        Dim partCloseStatus1 As NXOpen.PartCloseStatus = Nothing
'        partCloseStatus1 = workPart.ComponentAssembly.CloseComponents(componentsToClose1, NXOpen.BasePart.CloseWholeTree.False, NXOpen.Assemblies.ComponentAssembly.CloseModified.True)

'        Dim numUnclosedParts1 As Integer = Nothing
'        numUnclosedParts1 = partCloseStatus1.NumberUnclosedParts
'        partCloseStatus1.Dispose()

'    End Sub

'    Sub SetWorkPartByNo(ByVal partNo As String, ByVal iRev As String)
'        Dim theSession As Session = Session.GetSession()
'        Dim part1 As Part = CType(theSession.Parts.FindObject("@DB/" & partNo & "/" & iRev), Part)
'        theSession.Parts.SetWork(part1)
'    End Sub

'    Function AddPartToAssy(myName As String, ByRef component1 As Component) As Assemblies.Component
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        Dim theSession As Session = Session.GetSession()
'        Dim dispPart As Part = theSession.Parts.Display
'        Dim workpart As Part = theSession.Parts.Work
'        Dim fileNew1 As FileNew
'        Dim createNewComponentBuilder1 As Assemblies.CreateNewComponentBuilder
'        Dim myPart As Assemblies.Component
'        Dim nXObject1 As NXObject

'        fileNew1 = CreatPart(myName)

'        createNewComponentBuilder1 = workpart.AssemblyManager.CreateNewComponentBuilder()
'        createNewComponentBuilder1.ReferenceSet = Assemblies.CreateNewComponentBuilder.ComponentReferenceSetType.EntirePartOnly
'        createNewComponentBuilder1.NewComponentName = myName
'        createNewComponentBuilder1.NewFile = fileNew1

'        nXObject1 = createNewComponentBuilder1.Commit()

'        createNewComponentBuilder1.Destroy()
'        AddPartToAssy = dispPart.ComponentAssembly.RootComponent

'        component1 = CType(nXObject1, Assemblies.Component)       'Set workpart sau khi tao
'        theSession.Parts.SetWorkComponent(component1, partLoadStatus1)
'        nXObject1 = Nothing
'        partLoadStatus1.Dispose()
'    End Function

'    Sub SetShowExact(ByVal icomponent As Component)
'        For Each iChild As Component In icomponent.GetChildren
'            Dim components2() As Assemblies.Component = {iChild}
'            Dim errorList2 As NXOpen.ErrorList = Nothing
'            errorList2 = icomponent.DisplayComponentsExact(components2)
'            Call SetShowExact(iChild)
'        Next
'    End Sub

'    Sub CloseComponent(icomp As Component)
'        Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim componentsToClose1(100000) As NXOpen.Assemblies.Component
'        Dim jcls As Integer = -1
'        DeQuyComponent(icomp, componentsToClose1, jcls)
'        ReDim Preserve componentsToClose1(jcls)
'        Dim partCloseStatus1 As NXOpen.PartCloseStatus = Nothing
'        partCloseStatus1 = workPart.ComponentAssembly.CloseComponents(componentsToClose1, NXOpen.BasePart.CloseWholeTree.False, NXOpen.Assemblies.ComponentAssembly.CloseModified.True)

'        Dim numUnclosedParts1 As Integer = Nothing
'        numUnclosedParts1 = partCloseStatus1.NumberUnclosedParts
'        partCloseStatus1.Dispose()

'    End Sub

'    Sub DeQuyComponent(icomp As Component, components() As Assemblies.Component, ByRef jcls As Integer)

'        For Each iChild As Component In icomp.GetChildren()

'            jcls = jcls + 1
'            components(jcls) = iChild

'            DeQuyComponent(iChild, components, jcls)

'        Next
'    End Sub

'    Public Function AddCompByNoCopy(parentNo As String, childNo As String, ByVal iAddComp As Component)
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        Dim theSession As Session = Session.GetSession()
'        Dim workpart As Part = theSession.Parts.Work
'        part1 = CType(theSession.Parts.FindObject("@DB/" & childNo), Part)
'        Dim position As Point3d
'        Dim matrix As Matrix3x3
'        Dim ChildNo1 As String = iAddComp.GetStringAttribute("DB_PART_NO").ToString
'        Dim iGroupName As String = iAddComp.GetStringAttribute("DB_PART_NAME").ToString


'        iAddComp.GetPosition(position, matrix)
'        orientation1.Xx = matrix.Xx
'        orientation1.Xy = matrix.Xy
'        orientation1.Xz = matrix.Xz
'        orientation1.Yx = matrix.Yx
'        orientation1.Yy = matrix.Yy
'        orientation1.Yz = matrix.Yz
'        orientation1.Zx = matrix.Zx
'        orientation1.Zy = matrix.Zy
'        orientation1.Zz = matrix.Zz

'        Dim part2 As Part = CType(theSession.Parts.FindObject("@DB/" & parentNo), Part)
'        theSession.Parts.SetWork(part2)
'        workpart = theSession.Parts.Work
'        component1 = workpart.ComponentAssembly.AddComponent(part1, "None", iGroupName, position, matrix, -1, partLoadStatus1)

'        'component1 = workPart.ComponentAssembly.AddComponent(
'        partLoadStatus1.Dispose()
'        Return AddCompByNoCopy
'    End Function

'    Public Function AddBoltNut(parentNo As String, childNo As String, ByVal iAddComp As Component, ByVal ipoint As String, idirect As String)
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        Dim theSession As Session = Session.GetSession()
'        Dim workpart As Part = theSession.Parts.Work
'        part1 = CType(theSession.Parts.FindObject("@DB/" & childNo), Part)
'        Dim position As Point3d
'        Dim matrix As Matrix3x3
'        Dim ChildNo1 As String = iAddComp.GetStringAttribute("DB_PART_NO").ToString
'        Dim iGroupName As String

'        If Len(ChildNo1) > 15 Then
'            iGroupName = iAddComp.GetStringAttribute("DB_PART_NAME").ToString & "$" & Left(iAddComp.GetStringAttribute("DB_PART_NO").ToString, 11) _
'                & "$" & iAddComp.GetStringAttribute("PART_MATERIAL").ToString & "$" & iAddComp.GetStringAttribute("PART_THICKNESS").ToString & "$" & ipoint & "$" & idirect
'        Else
'            iGroupName = iAddComp.GetStringAttribute("DB_PART_NAME").ToString & "$" & iAddComp.GetStringAttribute("DB_PART_NO").ToString _
'                & "$" & iAddComp.GetStringAttribute("PART_MATERIAL").ToString & "$" & iAddComp.GetStringAttribute("PART_THICKNESS").ToString & "$" & ipoint & "$" & idirect
'        End If
'        iAddComp.GetPosition(position, matrix)
'        orientation1.Xx = 1.0
'        orientation1.Xy = 0.0
'        orientation1.Xz = 0.0
'        orientation1.Yx = 0.0
'        orientation1.Yy = 1.0
'        orientation1.Yz = 0.0
'        orientation1.Zx = 0.0
'        orientation1.Zy = 0.0

'        orientation1.Zz = 1.0


'        Dim part2 As Part = CType(theSession.Parts.FindObject("@DB/" & parentNo), Part)
'        theSession.Parts.SetWork(part2)
'        workpart = theSession.Parts.Work
'        component1 = workpart.ComponentAssembly.AddComponent(part1, "None", iGroupName, position, matrix, -1, partLoadStatus1)

'        'component1 = workPart.ComponentAssembly.AddComponent(
'        partLoadStatus1.Dispose()
'        Return AddBoltNut
'    End Function

'    Function MinDist2Obj(ByVal obj1 As String, ByVal obj2 As String, ByRef Mindist As Double, ByRef ipt1 As Point3d, ByRef ipt2 As Point3d)
'        Dim Object1Tag As Long = CType(obj1, Long)
'        Dim Object2Tag As Long = CType(obj2, Long)
'        Dim guess1(2) As Double
'        Dim guess2(2) As Double
'        Dim pt1(2) As Double
'        Dim pt2(2) As Double
'        'Dim minDist As Double
'        theUFSession.Modl.AskMinimumDist(Object1Tag, Object2Tag, 0, guess1, 0, guess2, Mindist, pt1, pt2)
'        ipt1 = New Point3d(pt1(0), pt1(1), pt1(2))
'        ipt2 = New Point3d(pt2(0), pt2(1), pt2(2))
'    End Function

'    Function AskAllBodies(ByVal thePart As Part) As String
'        Dim ufs As UFSession = UFSession.GetUFSession()
'        Dim thebodies As String
'        Try
'            Dim BodyTag As Tag = NXOpen.Tag.Null
'            Do
'                ufs.Obj.CycleObjsInPart(thePart.Tag, UFConstants.UF_solid_type, BodyTag)
'                If BodyTag = NXOpen.Tag.Null Then
'                    Exit Do
'                End If
'                Dim theType As Integer, theSubtype As Integer
'                ufs.Obj.AskTypeAndSubtype(BodyTag, theType, theSubtype)
'                If theSubtype = UFConstants.UF_solid_body_subtype Then
'                    thebodies = BodyTag
'                End If
'            Loop While True
'        Catch ex As NXException
'            lw.WriteLine(ex.ErrorCode & ex.Message)
'        End Try
'        Return thebodies
'    End Function

'    Sub ShowComponent()
'        Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work

'        Dim displayPart As NXOpen.Part = theSession.Parts.Display

'        ' ----------------------------------------------
'        '   Menu: Edit->Show and Hide->Show and Hide...
'        ' ----------------------------------------------
'        Dim markId1 As NXOpen.Session.UndoMarkId = Nothing
'        markId1 = theSession.SetUndoMark(NXOpen.Session.MarkVisibility.Visible, "Start")

'        theSession.SetUndoMarkName(markId1, "Show and Hide Dialog")

'        Dim markId2 As NXOpen.Session.UndoMarkId = Nothing
'        markId2 = theSession.SetUndoMark(NXOpen.Session.MarkVisibility.Visible, "Show Components")

'        Dim numberShown1 As Integer = Nothing
'        numberShown1 = theSession.DisplayManager.ShowByType("SHOW_HIDE_TYPE_COMPONENTS", NXOpen.DisplayManager.ShowHideScope.AnyInAssembly)

'        Dim nErrs1 As Integer = Nothing
'        nErrs1 = theSession.UpdateManager.DoUpdate(markId2)

'        Dim exists1 As Boolean = Nothing
'        exists1 = theSession.DoesUndoMarkExist(markId2, "Show Components")

'        theSession.DeleteUndoMark(markId2, "Show Components")
'        Try
'            workPart.ModelingViews.WorkView.FitAfterShowOrHide(NXOpen.View.ShowOrHideType.ShowOnly)
'        Catch ex As Exception
'            displayPart.ModelingViews.WorkView.FitAfterShowOrHide(NXOpen.View.ShowOrHideType.ShowOnly)
'        End Try


'        theSession.SetUndoMarkName(markId1, "Show and Hide")

'        theSession.DeleteUndoMark(markId1, Nothing)
'    End Sub

'    '''''''Menatsu
'    Sub Create_Menatsu()
'        Dim theSession As Session = Session.GetSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim theUfSession As UFSession = UFSession.GetUFSession()
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing


'        Dim objWorksheetOutput = objWorkbook.worksheets("Output")
'        Const xlDown As Long = -4121
'        Dim lngLastRow As Long

'        lngLastRow = objWorksheetOutput.Cells(25, 3).End(xlDown).Row

'        If lngLastRow = 1048576 Then '
'            Exit Sub
'        End If

'        Dim iListBangouMenatsu As New List(Of String)
'        'Dim iDanmen_Menatsu() As String, iDemDanmen As Integer = 0
'        Call Get_dtExcelOut()         'Database kết quả chạy Tool những bước trước (Sheet Output)
'        Dim iListMenatsu As New List(Of String)
'        Call List_Vitri_Menatsu(iListMenatsu)
'        Call Create_dtMenatsu()
'        'Dim iWidthBolt As Double = 24, iWidthNut As Double = 14
'        Dim objWorksheetIn2 = objWorkbook.worksheets("Data 線断面")
'        objWorksheetIn2.Range("B9:AK999999").ClearContents()
'        ObjWsOut.Range("CK26:CP10000").ClearContents()
'        'Tìm 2 cạnh Bolt Nut
'        Dim iBoltCurve() As Curve, iNutCurve() As Curve, iDistance As Double

'        ''Shagyou top Assy
'        Try
'            theSession.Parts.SetWorkComponent(workPart.ComponentAssembly.RootComponent, partLoadStatus1)
'            workPart = theSession.Parts.Work
'        Catch ex As Exception

'        End Try


'        ''Tạo Assy chứa các Danmen Menatsu, nếu tìm thấy đã có 1 assy tên "Menatsu" trong đó thì k tạo nữa
'        Dim iCompAssyMenatsu As Component

'        For Each iChild As Component In workPart.ComponentAssembly.RootComponent.GetChildren
'            If iChild.GetStringAttribute("DB_PART_NAME").ToString = "Menatsu" Then
'                iCheckExist = True
'                iCompAssyMenatsu = iChild
'                'lw.WriteLine("dsdsfsf: " & iCompAssyMenatsu.GetStringAttribute("DB_PART_NO").ToString)
'                Exit For
'            End If
'        Next
'        If iCheckExist = False Then
'            Call CreateAssyNewLv2("Menatsu", iCompAssyMenatsu)

'            ''Shagyou top Assy
'            theSession.Parts.SetWorkComponent(workPart.ComponentAssembly.RootComponent, partLoadStatus1)
'            workPart = theSession.Parts.Work
'            Call SaveData()
'            Call Delete_OldInfo()                     'xóa dữ liệu cũ File Excel
'        End If

'        'GoTo iHere

'        ''Shagyou Assy Danmen Teiketsu "Section Auto"
'        Dim iCompAssyDanmenTeiketsu As Component
'        theSession.Parts.SetWorkComponent(workPart.ComponentAssembly.RootComponent, partLoadStatus1)
'        workPart = theSession.Parts.Work
'        For Each iChild As Component In workPart.ComponentAssembly.RootComponent.GetChildren
'            If iChild.GetStringAttribute("DB_PART_NAME").ToString = "Section Auto" Then
'                iCompAssyDanmenTeiketsu = iChild
'                theSession.Parts.SetWorkComponent(iCompAssyDanmenTeiketsu, partLoadStatus1)
'                workPart = theSession.Parts.Work
'                Exit For
'            End If
'        Next





'        Dim iDanmen As String       'iDanmen mặc định là Y, nhưng nếu đo đạc tính toán trên danmen Y bị lỗi => tính trên Danmen X
'        Dim iCompMenatsu() As Component, iDemMenatsu As Integer = 0
'        'lw.WriteLine(lngLastRow)
'        Dim q As Integer
'        For q = 26 To lngLastRow
'            'lw.WriteLine("aaaaqqqqq: " & objWorksheetOutput.Cells(q, 3).value.ToString)
'            ''If IsNothing(objWorksheetOutput.Cells(q, 225).Value.ToString) = True Then
'            'lw.WriteLine("adfdasfdsafas: " & objWorksheetOutput.Cells(q, 225).Value)
'            If objWorksheetOutput.Cells(q, 225).Value = "" Then
'                'lw.WriteLine("haha")
'                For Each iChild As Component In iCompAssyDanmenTeiketsu.GetChildren
'                    Dim iOut As Boolean = False
'                    iDanmen = "Y"
'                    'lw.WriteLine("aaaa: " & objWorksheetOutput.Cells(q, 3).value.ToString & "_" & Right(iChild.GetStringAttribute("DB_PART_NAME").ToString, 6).ToString)
'                    If objWorksheetOutput.Cells(q, 3).value.ToString = Right(iChild.GetStringAttribute("DB_PART_NAME").ToString, 6).ToString Then     'Chỉ tính toán những trường hợp được đã được xác định lọai Menatsu và chưa tính menatsu (trong trường hợp lần chạy menatsu trước đang chạy bị lỗi và tiếp tục chạy tiếp)
'                        If iListMenatsu.Contains(Right(iChild.GetStringAttribute("DB_PART_NAME").ToString, 6).ToString) = True Then     'Nếu có trong List những mặt cần tính Menatsu thì tính, nếu không có trong List thì điền "-"

'                            dtMenatsu.Clear()
'                            'lw.WriteLine("Check part: " & iChild.GetStringAttribute("DB_PART_NAME").ToString)
'                            For Each iChild1 As Component In iChild.GetChildren
'                                'lw.WriteLine(iChild1.GetStringAttribute("DB_PART_NAME").ToString)
'                                Try
'                                    If Right(iChild1.GetStringAttribute("DB_PART_NAME").ToString, 1) = iDanmen Then
'                                        Dim iListBuhinMenatsu As New List(Of String)
'                                        iCheckCorrect = True
'                                        iDemMenNo = 1
'                                        iCheckBolt_Washer = False
'                                        iCheckNut_Washer = False
'                                        theSession.Parts.SetWorkComponent(iChild1, partLoadStatus1)
'                                        workPart = theSession.Parts.Work
'                                        lw.WriteLine("Check part: " & iChild1.GetStringAttribute("DB_PART_NAME").ToString)
'                                        Dim dtInforLineOut As New DataTable
'                                        Call CreateInforLineDataTable(dtInforLineOut)
'                                        Dim tmpCsys As NXOpen.CartesianCoordinateSystem
'                                        'Lấy thông tin các curve trong Group
'                                        Call TakeInforLine(dtInforLineOut, tmpCsys, iChild)
'                                        Call iPrintInforLine(dtInforLineOut)
'                                        Dim iZCS(2) As Double
'                                        Dim iMatrix As Matrix3x3 = tmpCsys.Orientation.Element
'                                        iZCS(0) = iMatrix.Zx.ToString
'                                        iZCS(1) = iMatrix.Zy.ToString
'                                        iZCS(2) = iMatrix.Zz.ToString
'                                        Dim iVectorZ As Vector3d = New Vector3d(iZCS(0), iZCS(1), iZCS(2))
'                                        Dim iXCS(2) As Double
'                                        Dim iiMatrix As Matrix3x3 = tmpCsys.Orientation.Element
'                                        iXCS(0) = iiMatrix.Xx.ToString
'                                        iXCS(1) = iiMatrix.Xy.ToString
'                                        iXCS(2) = iiMatrix.Xz.ToString
'                                        Dim iVectorX As Vector3d = New Vector3d(iXCS(0), iXCS(1), iXCS(2))
'                                        Dim iOriPoint As NXOpen.Point = workPart.Points.CreatePoint(tmpCsys.Origin)


'                                        '''Call iPrintInforLine(dtInforLineOut)

'                                        Dim iGroupTagList As New List(Of String)

'                                        'Tìm các đường song song với trục Z của Csys
'                                        Call FindLineNearCsys(dtInforLineOut, iGroupTagList)
'                                        dtInforLineOut.AcceptChanges()

'                                        'Tạo Datatable những đường song song với trục Z của Csys
'                                        Dim iGrNameList As New List(Of String)
'                                        Dim iGrSectList As New List(Of String)
'                                        Dim iGrTagList As New List(Of String)

'                                        Dim tmpDt As DataTable = dtInforLineOut
'                                        Dim dtView3 As New DataView(tmpDt)
'                                        dtView3.Sort = "d1"
'                                        tmpDt = dtView3.ToTable
'                                        For Each row As DataRow In tmpDt.Rows
'                                            If iGrNameList.Contains(row("GroupName").ToString) = False Then
'                                                iGrNameList.Add(row("GroupName").ToString)
'                                            End If
'                                            If iGrSectList.Contains(row("Sect").ToString) = False Then
'                                                iGrSectList.Add(row("Sect").ToString)
'                                            End If
'                                            If iGrTagList.Contains(row("Group Tag").ToString) = False Then
'                                                iGrTagList.Add(row("Group Tag").ToString)
'                                            End If
'                                        Next
'                                        '''Try
'                                        Call XoaTrung(iGrSectList, dtInforLineOut, iGrNameList)
'                                        '''Catch ex As Exception
'                                        '''    iCheckCorrect = False
'                                        '''    lw.WriteLine(ex.ToString)
'                                        '''    'Exit For
'                                        '''End Try
'                                        'lw.WriteLine("haha")
'                                        Dim iText As String
'                                        'Call iPrintInforLine(dtInforLineOut.DefaultView.ToTable)
'                                        Call 締結物確定(iGrSectList, iGrNameList, dtInforLineOut, dtInforLineOut, iText, tmpCsys, iGrTagList)
'                                        'lw.WriteLine("aaaaaaaaaa")
'                                        '''If iDanmen = "Y" Then
'                                        '''    Call iPrintInforLine(dtInforLineOut)       '20231110
'                                        '''End If




'                                        ''''''''''''''''''Lấy thông tin Bolt Nut, DimA các kiểu
'                                        Dim iBoltNo As String = "", iNutNo As String = ""
'                                        Dim iFixPartTypeBolt As String = ""
'                                        Dim iFixPartTypeNut As String = ""
'                                        Dim iDimBolt As Double = 0, iDimNut As Double = 0
'                                        Dim iBoltMaterial As String, iNutMaterial As String
'                                        '''Try
'                                        '''    'Tìm khe hở giữa Bolt-Nut và các đường của Bolt, Nut dùng để đo khe hở ấy
'                                        '''    '番号 của Bolt và Nut
'                                        Call GetBoltNutDistance_1(dtInforLineOut, iBoltCurve, iNutCurve, iDistance, tmpCsys, iBoltNo, iFixPartTypeBolt, iDimBolt, iBoltMaterial, iNutNo, iFixPartTypeNut, iDimNut, iNutMaterial, iListBuhinMenatsu)                   'Tìm cạnh bắt đầu đường 45 độ của Bolt Nut ở đây

'                                        'For Each iCurve As Curve In iBoltCurve
'                                        '    iCurve.Highlight()
'                                        'Next
'                                        'For Each iCurve As Curve In iNutCurve
'                                        '    iCurve.Highlight()
'                                        'Next

'                                        'Exit Sub

'                                        'lw.WriteLine(iCheckCorrect)
'                                        'lw.WriteLine(iCheckCorrect & "_" & iDimBolt & "_" & iDimNut)
'                                        If iCheckCorrect = False Or iDimBolt = 0 Or iDimNut = 0 Then
'                                            iCheckCorrect = False
'                                            lw.WriteLine("Khong co hoac thieu thong tin Bolt Nut")
'                                            Exit For
'                                        End If
'                                        '''    '''''''''''''Lay 2 Curve o day
'                                        '''Catch ex As Exception
'                                        '''    lw.WriteLine(ex.ToString())
'                                        '''    Exit For
'                                        '''End Try



'                                        'lw.WriteLine("iDim: " & iDimBolt & "_" & iDimNut)
'                                        'lw.WriteLine("material: " & iBoltMaterial & "_" & iNutMaterial)
'                                        'Tìm tâm của Nut (tương đối)
'                                        Dim iNutCtrPoint3d As Point3d

'                                        Call XacDinhTam_Nut(dtInforLineOut, iNutCtrPoint3d)


'                                        'Tìm Vector chỉ hướng chuẩn của mặt cắt
'                                        Dim iBaseVector3dTG As Vector3d = New Vector3d(iNutCtrPoint3d.X - tmpCsys.Origin.X, iNutCtrPoint3d.Y - tmpCsys.Origin.Y, iNutCtrPoint3d.Z - tmpCsys.Origin.Z)
'                                        Dim iBaseVector3d As Vector3d
'                                        If CosOf2Vector_1(iVectorZ, iBaseVector3dTG) > 0 Then
'                                            iBaseVector3d = iVectorZ
'                                        Else
'                                            iBaseVector3d = New Vector3d(-1 * iVectorZ.X, -1 * iVectorZ.Y, -1 * iVectorZ.Z)
'                                        End If

'                                        'Xac dinh cac duong Curve(cua buhin A,B,C,...) giao voi duong 45 do
'                                        Dim iTagCurveGiao45() As Tag, iTagGroupGiao45() As Tag  'mảng chứa thông tin Group tương ứng của iTagCurveGiao45()
'                                        Dim i As Integer, j As Integer
'                                        Dim iPoint3dDoPMI1() As Point3d, iPoint3dDoPMI2() As Point3d    'Diem do PMI D
'                                        Dim iPoint3dDoPMI3() As Point3d, iPoint3dDoPMI4() As Point3d    'Diem do PMI d
'                                        Dim iArrHoleArea() As Double    '???

'                                        'Tính đường kính lỗ Washer
'                                        '''Try
'                                        If iCheckBolt_Washer = True Then
'                                            Call TinhDuongKinhLoWasher(dtInforLineOut, iBoltCurve)
'                                        ElseIf iCheckNut_Washer = True Then
'                                            Call TinhDuongKinhLoWasher(dtInforLineOut, iNutCurve)
'                                        End If
'                                        '''Catch ex As Exception
'                                        '''    iCheckCorrect = False
'                                        '''    lw.WriteLine(ex.ToString)
'                                        '''    Exit For
'                                        '''End Try

'                                        '''If iCheckCorrect = False Then
'                                        '''    lw.WriteLine("Exit For 222")
'                                        '''    Exit For
'                                        '''End If
'                                        'Exit Sub

'                                        'Xóa chỉ thị PMI dư thừa                    '20231226
'                                        Try
'                                            Call DelPMI_Menatsu(iListBuhinMenatsu, 1)
'                                        Catch ex As Exception
'                                            lw.WriteLine(ex.ToString)
'                                        End Try

'                                        '

'                                        For i = 0 To 1
'                                            '''lw.WriteLine("i: " & i)
'                                            '''Try
'                                            Call XacDinhCacCurveGiaoDuong45do(dtInforLineOut, iBoltCurve, iNutCurve, iVectorZ, i, iTagCurveGiao45, iListBuhinMenatsu)
'                                            '''Catch ex As Exception
'                                            '''    iCheckCorrect = False
'                                            '''    lw.WriteLine(ex.ToString)
'                                            '''    Exit For
'                                            '''End Try


'                                            'lw.WriteLine("iTagCurveGiao45: " & UBound(iTagCurveGiao45))
'                                            'For Each iTag As Tag In iTagCurveGiao45
'                                            '    Dim iCurve As Curve = NXObjectManager.Get(iTag)
'                                            '    iCurve.Highlight()
'                                            'Next
'                                            'Exit Sub

'                                            Try
'                                                If UBound(iTagCurveGiao45) < 5 Then
'                                                    iCheckCorrect = False
'                                                    lw.WriteLine("Exit For 1")
'                                                    Exit For
'                                                End If
'                                            Catch ex As Exception
'                                                iCheckCorrect = False
'                                                lw.WriteLine("Exit For 111")
'                                                Exit For
'                                            End Try

'                                            'Tao duong Curve 45 do
'                                            Dim iCurve45() As Curve                 'iCurve45(0): ve tu bolt, iCurve45(1): ve tu nut
'                                            '''Try
'                                            Call TaoCurve45do(iDimBolt, iDimNut, tmpCsys, iBaseVector3d, iTagCurveGiao45, iCurve45)
'                                            '''Catch ex As Exception
'                                            '''    iCheckCorrect = False
'                                            '''    lw.WriteLine(ex.ToString)
'                                            '''    Exit For
'                                            '''End Try


'                                            'Tim giao diem voi duong Curve 45 do
'                                            Dim iPoint3dGiaoBolt() As Point3d, iPoint3dGiaoNut() As Point3d
'                                            '''Try


'                                            'Tìm GroupTag() của iTagCurveGiao45 (mảng này phục vụ mục đích phân biệt đâu là CL 1mm, đâu là buhin độ dày 1mm: Nếu khoảng cách 2)
'                                            '20231107
'                                            Call Get_GroupTag(dtInforLineOut, iTagCurveGiao45, iTagGroupGiao45)

'                                            Call TimGiaoDiemVoiDuong45Do(iTagCurveGiao45, iTagGroupGiao45, iCurve45, iPoint3dGiaoBolt, iPoint3dGiaoNut)
'                                            '''Catch ex As Exception
'                                            '''    iCheckCorrect = False
'                                            '''    lw.WriteLine(ex.ToString)
'                                            '''    Exit For
'                                            '''End Try


'                                            'lw.WriteLine("Ubound　iPoint3dGiao: " & UBound(iPoint3dGiaoBolt) & "_" & UBound(iPoint3dGiaoNut))
'                                            '''Try
'                                            If i = 0 Then
'                                                Call TimDiemDoPMI_Menatsu(iPoint3dGiaoBolt, iPoint3dGiaoNut, tmpCsys, iPoint3dDoPMI1)
'                                                Call TimDiemDoPMI_d(iTagCurveGiao45, tmpCsys.Origin, iVectorZ, iPoint3dDoPMI3)
'                                            Else
'                                                Call TimDiemDoPMI_Menatsu(iPoint3dGiaoBolt, iPoint3dGiaoNut, tmpCsys, iPoint3dDoPMI2)
'                                                Call TimDiemDoPMI_d(iTagCurveGiao45, tmpCsys.Origin, iVectorZ, iPoint3dDoPMI4)
'                                            End If
'                                            '''Catch ex As Exception
'                                            '''    iCheckCorrect = False
'                                            '''    lw.WriteLine(ex.ToString)
'                                            '''    Exit For
'                                            '''End Try


'                                            'If i = 1 Then
'                                            '    Call PrintdtMenatsu()
'                                            '    Exit Sub
'                                            'End If

'                                        Next

'                                        If iCheckCorrect = True Then
'                                            'Xóa chỉ thị PMI dư thừa                    '20231226
'                                            Try
'                                                Call DelPMI_Menatsu(iListBuhinMenatsu, 2)
'                                            Catch ex As Exception
'                                                lw.WriteLine(ex.ToString)
'                                            End Try

'                                            Dim iDimensionOutside() As Double
'                                            Dim iNumtemp As Double = 50         '20
'                                            For i = 0 To UBound(iPoint3dDoPMI1)
'                                                Dim ip1 As NXOpen.Point = workPart.Points.CreatePoint(iPoint3dDoPMI1(i))
'                                                ip1.SetVisibility(SmartObject.VisibilityOption.Visible)
'                                                Dim ip2 As NXOpen.Point = workPart.Points.CreatePoint(iPoint3dDoPMI2(i))
'                                                ip2.SetVisibility(SmartObject.VisibilityOption.Visible)
'                                                '''Mặc định là Nut Weld, nếu là Bolt Weld thì thứ tự kích thước D đảo ngược lại
'                                                Dim iBaseVector3d_Reverse As Vector3d = New Vector3d(-1 * iBaseVector3d.X, -1 * iBaseVector3d.Y, -1 * iBaseVector3d.Z)
'                                                If iFixPartTypeBolt.ToUpper = "BOLT WELD" Then
'                                                    lw.WriteLine("Bolt Weld")
'                                                    Call PMIPointAndPointNew(iPoint3dDoPMI1(i), iPoint3dDoPMI2(i), "Y", tmpCsys, iNumtemp, Nothing, iBaseVector3d, "D" & UBound(iPoint3dDoPMI1) + 1 - i & ":")
'                                                    'd cho vào đoạn này
'                                                    Call PMIPointAndPointNew(iPoint3dDoPMI3(i), iPoint3dDoPMI4(i), "Y", tmpCsys, iNumtemp, Nothing, iBaseVector3d_Reverse, "d" & UBound(iPoint3dDoPMI1) + 1 - i & ":")
'                                                Else
'                                                    Call PMIPointAndPointNew(iPoint3dDoPMI1(i), iPoint3dDoPMI2(i), "Y", tmpCsys, iNumtemp, Nothing, iBaseVector3d, "D" & i + 1 & ":")
'                                                    'd cho vào đoạn này
'                                                    Call PMIPointAndPointNew(iPoint3dDoPMI3(i), iPoint3dDoPMI4(i), "Y", tmpCsys, iNumtemp, Nothing, iBaseVector3d_Reverse, "d" & i + 1 & ":")
'                                                End If

'                                                ReDim Preserve iDimensionOutside(i)
'                                                Call GetLength2Point3D(iPoint3dDoPMI1(i), iPoint3dDoPMI2(i), iDimensionOutside(i))
'                                                iNumtemp += 6
'                                            Next
'                                            'lw.WriteLine("idimensionoutside: " & UBound(iDimensionOutside))
'                                            'lw.WriteLine("haha")
'                                            'Exit Sub
'                                            'Call PrintdtMenatsu()
'                                            ''''''Mặc định là Nut weld, Nếu là Bolt weld thì sắp xếp mảng iDimensionOutside ngược lại


'                                            Dim iDimConvert() As Double, iGroupName As String = "", iGroupTag As String = ""
'                                            If iFixPartTypeBolt.ToUpper = "BOLT WELD" Then
'                                                ReDim iDimConvert(UBound(iDimensionOutside))
'                                                Dim iDem As Integer = 0, iLast As Integer = UBound(iDimensionOutside)
'                                                For iDem = 0 To iLast
'                                                    iDimConvert(iDem) = iDimensionOutside(iLast - iDem)
'                                                Next
'                                                iDimensionOutside = iDimConvert
'                                                'Điền thông tin Bolt Nut và Vật liệu Bolt Nut
'                                                For Each dtRow As DataRow In dtMenatsu.Rows
'                                                    If dtRow("MEN NO") = 1 Then
'                                                        dtRow("MATERIAL") = iNutMaterial
'                                                        Call Get_GroupName_GroupTag(dtInforLineOut, iNutNo, iGroupName, iGroupTag)
'                                                        dtRow("GROUP NAME") = iGroupName
'                                                        dtRow("GROUP TAG") = iGroupTag
'                                                    End If
'                                                    If dtRow("MEN NO") = 2 And iCheckNut_Washer = True And IsDBNull(dtRow("GROUP NAME")) = True Then    'Nếu là Rokkaku thì vật liệu của Washer là S50CM = 650...
'                                                        dtRow("GROUP NAME") = iGroupName
'                                                        dtRow("GROUP TAG") = iGroupTag
'                                                        dtRow("MATERIAL") = "S50CM"
'                                                    End If
'                                                    If dtRow("MEN NO") = iDemMenNo Then
'                                                        dtRow("MATERIAL") = iBoltMaterial
'                                                        Call Get_GroupName_GroupTag(dtInforLineOut, iBoltNo, iGroupName, iGroupTag)
'                                                        dtRow("GROUP NAME") = iGroupName
'                                                        dtRow("GROUP TAG") = iGroupTag
'                                                    End If
'                                                Next
'                                            Else
'                                                For Each dtRow As DataRow In dtMenatsu.Rows
'                                                    If dtRow("MEN NO") = 1 Then
'                                                        dtRow("MATERIAL") = iBoltMaterial
'                                                        Call Get_GroupName_GroupTag(dtInforLineOut, iBoltNo, iGroupName, iGroupTag)
'                                                        dtRow("GROUP NAME") = iGroupName
'                                                        dtRow("GROUP TAG") = iGroupTag
'                                                    End If
'                                                    'lw.WriteLine("isNothing: " & IsDBNull(dtRow("GROUP NAME")).ToString)
'                                                    If dtRow("MEN NO") = 2 And iCheckBolt_Washer = True And IsDBNull(dtRow("GROUP NAME")) = True Then    'Nếu là Rokkaku thì vật liệu của Washer là S50CM = 650...
'                                                        dtRow("GROUP NAME") = iGroupName
'                                                        dtRow("GROUP TAG") = iGroupTag
'                                                        dtRow("MATERIAL") = "S50CM"
'                                                    End If
'                                                    If dtRow("MEN NO") = iDemMenNo Then
'                                                        dtRow("MATERIAL") = iNutMaterial
'                                                        Call Get_GroupName_GroupTag(dtInforLineOut, iNutNo, iGroupName, iGroupTag)
'                                                        dtRow("GROUP NAME") = iGroupName
'                                                        dtRow("GROUP TAG") = iGroupTag
'                                                    End If
'                                                Next
'                                            End If

'                                            'Điền thông số Dimension Outside vào dtMenatsu
'                                            Dim iVitri As String = Right(iChild.GetStringAttribute("DB_PART_NAME").ToString, 6)
'                                            Call Menatsu_Calculate(iVitri, iDimensionOutside)
'                                            Call Export_to_Excel_Menatsu(iChild.GetStringAttribute("DB_PART_NAME").ToString, iDimensionOutside) ''

'                                            'Exit Sub        '20231114

'                                            ' add part sang iCompAssyMenatsu, Lưu đổi tên
'                                            Dim iName As String = iChild1.GetStringAttribute("DB_PART_NAME").ToString
'                                            'lw.WriteLine(iChild1.GetStringAttribute("DB_PART_NO").ToString & "/" & GetRev(iChild1.GetStringAttribute("DB_PART_NO").ToString))

'                                            Try
'                                                AddComponentByNoPDM(iCompAssyMenatsu.GetStringAttribute("DB_PART_NO").ToString & "/AA", iChild1.GetStringAttribute("DB_PART_NO").ToString & "/" & GetRev(iChild1.GetStringAttribute("DB_PART_NO").ToString))
'                                            Catch
'                                                AddComponentByNoASSY(iCompAssyMenatsu.GetStringAttribute("DB_PART_NO").ToString & "/AA", iChild1.GetStringAttribute("DB_PART_NO").ToString & "/" & GetRev(iChild1.GetStringAttribute("DB_PART_NO").ToString))
'                                            End Try
'                                            'lw.WriteLine("iName: " & iName)

'                                            theSession.Parts.SetWorkComponent(iCompAssyMenatsu, partLoadStatus1)
'                                            workPart = theSession.Parts.Work
'                                            For Each iChild11 As Component In iCompAssyMenatsu.GetChildren
'                                                If iChild11.GetStringAttribute("DB_PART_NAME").ToString = iName Then
'                                                    theSession.Parts.SetWorkComponent(iChild11, partLoadStatus1)
'                                                    workPart = theSession.Parts.Work
'                                                    Call SaveAsNewNamePart(iName & "_MENATSU")
'                                                End If
'                                            Next

'                                            theSession.Parts.SetWorkComponent(iCompAssyMenatsu, partLoadStatus1)
'                                            workPart = theSession.Parts.Work

'                                            Call SaveData()

'                                            For Each iChild11 As Component In iCompAssyMenatsu.GetChildren
'                                                If iListBangouMenatsu.Contains(iChild11.GetStringAttribute("DB_PART_NO").ToString) = False Then
'                                                    objWorksheetOutput.Cells(q, "HQ") = iChild11.GetStringAttribute("DB_PART_NO").ToString
'                                                    'lw.WriteLine("Noooooo:   " & iChild11.GetStringAttribute("DB_PART_NO").ToString)
'                                                    iListBangouMenatsu.Add(iChild11.GetStringAttribute("DB_PART_NO").ToString)
'                                                    iOut = True
'                                                End If
'                                            Next

'                                            ''''''''''''''''''''''''''đếm hiệu quả''''''''''''''''''''''''''''''''''''
'                                            Dim EIWToolLibrary = System.Reflection.Assembly.LoadFile("D:\nxcad\scratch\VehiclePlanMacro\VPG-Sysytem.dll")
'                                            Dim VPGToolList = System.Activator.CreateInstance(EIWToolLibrary.GetExportedTypes(0))
'                                            Try
'                                                VPGToolList.VPG_System_Check()
'                                            Catch ex As Exception
'                                                MsgBox("VPG-System.dllがありません", vbExclamation)
'                                                Exit Sub
'                                            End Try
'                                            VPGToolList.aCountAAA("277")
'                                            '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

'                                            'Call PrintdtMenatsu()
'                                            If iCheckCorrect = True Then
'                                                Exit For
'                                            End If
'                                        Else
'                                            iDanmen = "X"
'                                        End If
'                                    End If
'                                Catch ex As Exception
'                                    iDanmen = "X"
'                                    lw.WriteLine(ex.ToString)
'                                    iCheckCorrect = False
'                                End Try
'                            Next

'                            If iCheckCorrect = False Then   'Bất kỳ thứ gì làm quá trình đo đạc bị lỗi => vị trí này CA
'                                Dim row As DataRow
'                                row = dtMenatsu.NewRow
'                                row("VI TRI") = Right(iChild.GetStringAttribute("DB_PART_NAME").ToString, 6).ToString
'                                row("HANDAN") = "CA"
'                                dtMenatsu.Rows.Add(row)
'                                objWorksheetOutput.Cells(q, "HQ") = "-"     '20231026
'                            Else

'                            End If
'                            Call PrintdtMenatsu()
'                            Exit For

'                        Else
'                            objWorksheetOutput.Cells(q, "HQ") = "-"     '20231102
'                            Exit For
'                        End If
'                    End If
'                    If iOut = True Then
'                        Exit For
'                    End If
'                Next
'            End If
'        Next


'        ''ihere:


'        Dim iDemDanmenMenatsu As Integer = 0            'Kiểm tra xem có bao nhiêu Danmen Menatsu, Nếu k có thì k cần chạy bước chụp ảnh
'        For Each iChild As Component In iCompAssyMenatsu.GetChildren
'            'lw.WriteLine(iChild.GetStringAttribute("DB_PART_NAME").ToString)
'            iDemDanmenMenatsu = iDemDanmenMenatsu + 1
'        Next
'        If iDemDanmenMenatsu = 0 Then
'            Exit Sub
'        End If

'        'Chụp ảnh Menatsu
'        ''Shagyou Assy Menatsu Danmen
'        Try
'            theSession.Parts.SetWorkComponent(iCompAssyMenatsu, partLoadStatus1)
'            workPart = theSession.Parts.Work
'        Catch ex As Exception

'        End Try
'        'Make Displayed Part
'        Try
'            Dim status1 As NXOpen.PartCollection.SdpsStatus = Nothing
'            Dim workpart1 As Part = theSession.Parts.Work
'            Dim iPart As Part = workpart1
'            Dim part1 As NXOpen.Part = iPart
'            status1 = theSession.Parts.SetDisplay(part1, False, True, partLoadStatus1)
'            partLoadStatus1.Dispose()
'        Catch ex As Exception
'            lw.WriteLine(ex.ToString)
'            Exit Sub
'        End Try

'        'Create Pictures
'        Try
'            Call CreatePic()
'        Catch ex As Exception
'            lw.WriteLine(ex.ToString)
'            Exit Sub
'        End Try



'        'Call Run_CreateFile_Output_matome()

'        ''Call DienBangouMenatsuSangExcel()

'    End Sub

'    Sub DelPMI_Menatsu(ByVal iListBuhinMenatsu As List(Of String), ByVal iNumberDel As Integer)         'iNumberDel = 1 -> Xóa hết PMI kích thước; iNumberDel = 2 -> Xóa PMI Annotation
'        Dim theSession As Session = Session.GetSession()
'        If IsNothing(theSession.Parts.Work) Then
'            'active part required
'            Return
'        End If

'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As Part = theSession.Parts.Display
'        Dim currentScale As Double = displayPart.ModelingViews.WorkView.Scale

'        Dim lw As ListingWindow = theSession.ListingWindow
'        lw.Open()

'        'For Each ist As String In iListBuhinMenatsu
'        '    lw.WriteLine("ist:" & ist)
'        'Next

'        Dim i As Integer = 0
'        For Each myPmi As Annotations.Pmi In workPart.PmiManager.Pmis
'            Dim imyPmi
'            For Each imyPmi In myPmi.GetDisplayInstances
'                'imyPmi.Highlight()
'                'lw.WriteLine(imyPmi.GetType.ToString)
'                If imyPmi.GetType.ToString <> "NXOpen.Annotations.PmiLabel" And iNumberDel = 1 Then         'Xóa PMI kích thước
'                    Dim markId2 As NXOpen.Session.UndoMarkId = Nothing
'                    markId2 = theSession.SetUndoMark(NXOpen.Session.MarkVisibility.Visible, "Delete")
'                    Dim objects1(0) As NXOpen.NXObject
'                    objects1(0) = myPmi
'                    Dim nErrs1 As Integer = Nothing
'                    nErrs1 = theSession.UpdateManager.AddToDeleteList(objects1)
'                    Dim notifyOnDelete2 As Boolean = Nothing
'                    notifyOnDelete2 = theSession.Preferences.Modeling.NotifyOnDelete
'                    Dim nErrs2 As Integer = Nothing
'                    nErrs2 = theSession.UpdateManager.DoUpdate(markId2)
'                ElseIf imyPmi.GetType.ToString = "NXOpen.Annotations.PmiLabel" And iNumberDel = 2 Then      'Xóa PMI Annotation buhin thừa
'                    Dim iPmi As NXOpen.Annotations.PmiLabel
'                    'iPmi = NXObjectManager.Get(Split(imyPmi.ToString, " ")(1))
'                    iPmi = imyPmi
'                    'lw.WriteLine("ipmiCount: " & UBound(iPmi.GetText()))
'                    Dim iString As String = Nothing
'                    For Each iStr As String In iPmi.GetText
'                        iString = iString & "$" & iStr
'                    Next
'                    'lw.WriteLine(iString)
'                    Dim iCheckDelPMI As Boolean = True
'                    For Each ist As String In iListBuhinMenatsu
'                        'lw.WriteLine("ist: " & Split(ist, "$")(0) & "_" & iString)
'                        If InStr(iString, Split(ist, "$")(0)) <> 0 Then
'                            iCheckDelPMI = False
'                            Exit For
'                        End If
'                    Next

'                    If iCheckDelPMI = True Then
'                        Dim markId2 As NXOpen.Session.UndoMarkId = Nothing
'                        markId2 = theSession.SetUndoMark(NXOpen.Session.MarkVisibility.Visible, "Delete")
'                        Dim objects1(0) As NXOpen.NXObject
'                        objects1(0) = myPmi
'                        Dim nErrs1 As Integer = Nothing
'                        nErrs1 = theSession.UpdateManager.AddToDeleteList(objects1)
'                        Dim notifyOnDelete2 As Boolean = Nothing
'                        notifyOnDelete2 = theSession.Preferences.Modeling.NotifyOnDelete
'                        Dim nErrs2 As Integer = Nothing
'                        nErrs2 = theSession.UpdateManager.DoUpdate(markId2)
'                    End If

'                    'iPmi.Highlight()
'                    'lw.WriteLine(Split(imyPmi.ToString, " ")(1))
'                End If
'                'Exit For
'            Next

'            'Exit Sub


'            'Dim dispInst() As Annotations.Annotation = myPmi.GetDisplayInstances
'            'For Each thisDispInst As Annotations.Annotation In dispInst

'            'Next

'        Next
'        Try
'            workPart.ModelingViews.WorkView.Regenerate()
'            workPart.ModelingViews.WorkView.UpdateDisplay()
'        Catch ex As Exception
'            displayPart.ModelingViews.WorkView.Regenerate()
'            displayPart.ModelingViews.WorkView.UpdateDisplay()
'        End Try
'    End Sub

'    Sub TimDiemDoPMI_d(ByVal iTagCurveGiao45() As Tag, ByVal iPoint3dCsys As Point3d, ByVal iVectorZ As Vector3d, ByRef iPoint3dDoPMI() As Point3d)

'        If iCheckBolt_Washer = True Then
'            'Trường hợp Bolt Washer
'            Dim iDem As Integer = 0, i As Integer
'            Dim iPoint3dTG1 As Point3d, iPoint3dTG2 As Point3d, iP3dWashTG1 As Point3d, iP3dWashTG2 As Point3d  'biến trung gian
'            '
'            ''Tìm điểm đo d của Bolt Washer: là giao điểm giữa iTagCurveGiao45(0) và đường vuông góc với trục Z đi qua iP3dWashTG1
'            Call Start_End_Mid_Point_ForCurve(NXObjectManager.Get(iTagCurveGiao45(1)), iPoint3dTG1, iPoint3dTG2, Nothing)
'            If Distance_Point_to_Line(iPoint3dTG1, iPoint3dCsys, iVectorZ) < Distance_Point_to_Line(iPoint3dTG2, iPoint3dCsys, iVectorZ) Then
'                iP3dWashTG1 = iPoint3dTG1
'                'ReDim Preserve iPoint3dDoPMI(iDem)
'                'iPoint3dDoPMI(iDem) = iPoint3dTG1
'            Else
'                iP3dWashTG1 = iPoint3dTG2
'                'ReDim Preserve iPoint3dDoPMI(iDem)
'                'iPoint3dDoPMI(iDem) = iPoint3dTG2
'            End If
'            Call Create_LineEquation_From_Point_And_DirectionVector_1(iP3dWashTG1, iVectorZ, 5, iP3dWashTG2)
'            Call Start_End_Mid_Point_ForCurve(NXObjectManager.Get(iTagCurveGiao45(0)), iPoint3dTG1, iPoint3dTG2, Nothing)
'            ReDim Preserve iPoint3dDoPMI(iDem)
'            Call Timgiaodiem2duongthang(iPoint3dTG1, iPoint3dTG2, iP3dWashTG1, iP3dWashTG2, iPoint3dDoPMI(iDem))

'            iDem = iDem + 1
'            'Tìm Curve có khoảng cách đến trục Z za hơn, điểm nằm trên Curve này và gần với trục Z nhất là điểm cần tìm
'            For i = 1 To UBound(iTagCurveGiao45) - 2 Step 2
'                Dim iP3d(3) As Point3d, iP3dTG As Point3d
'                Call Start_End_Mid_Point_ForCurve(NXObjectManager.Get(iTagCurveGiao45(i)), iP3d(0), iP3d(1), Nothing)
'                Call Start_End_Mid_Point_ForCurve(NXObjectManager.Get(iTagCurveGiao45(i + 1)), iP3d(2), iP3d(3), Nothing)
'                Dim iDist1 As Double, iDist2 As Double, iP3dTG1 As Point3d, iP3dTG2 As Point3d          'khoảng cách của từng Curve đến trục Z
'                iDist1 = Distance_Point_to_Line(iP3d(0), iPoint3dCsys, iVectorZ)
'                iP3dTG1 = iP3d(0)
'                If iDist1 > Distance_Point_to_Line(iP3d(1), iPoint3dCsys, iVectorZ) Then
'                    iDist1 = Distance_Point_to_Line(iP3d(1), iPoint3dCsys, iVectorZ)
'                    iP3dTG1 = iP3d(1)
'                End If
'                iDist2 = Distance_Point_to_Line(iP3d(2), iPoint3dCsys, iVectorZ)
'                iP3dTG2 = iP3d(2)
'                If iDist2 > Distance_Point_to_Line(iP3d(3), iPoint3dCsys, iVectorZ) Then
'                    iDist2 = Distance_Point_to_Line(iP3d(3), iPoint3dCsys, iVectorZ)
'                    iP3dTG2 = iP3d(3)
'                End If
'                If iDist1 >= iDist2 Then
'                    iP3dTG = iP3dTG1
'                Else
'                    iP3dTG = iP3dTG2
'                End If
'                ReDim Preserve iPoint3dDoPMI(iDem)
'                iPoint3dDoPMI(iDem) = iP3dTG
'                iDem = iDem + 1
'            Next
'            '
'            Call Start_End_Mid_Point_ForCurve(NXObjectManager.Get(iTagCurveGiao45(UBound(iTagCurveGiao45) - 1)), iPoint3dTG1, iPoint3dTG2, Nothing)
'            If Distance_Point_to_Line(iPoint3dTG1, iPoint3dCsys, iVectorZ) < Distance_Point_to_Line(iPoint3dTG2, iPoint3dCsys, iVectorZ) Then
'                ReDim Preserve iPoint3dDoPMI(iDem)
'                iPoint3dDoPMI(iDem) = iPoint3dTG1
'            Else
'                ReDim Preserve iPoint3dDoPMI(iDem)
'                iPoint3dDoPMI(iDem) = iPoint3dTG2
'            End If


'        ElseIf iCheckNut_Washer = True Then
'            'Trường hợp Bolt Washer
'            Dim iDem As Integer = 0, i As Integer
'            Dim iPoint3dTG1 As Point3d, iPoint3dTG2 As Point3d, iP3dWashTG1 As Point3d, iP3dWashTG2 As Point3d  'biến trung gian
'            '
'            Call Start_End_Mid_Point_ForCurve(NXObjectManager.Get(iTagCurveGiao45(1)), iPoint3dTG1, iPoint3dTG2, Nothing)
'            If Distance_Point_to_Line(iPoint3dTG1, iPoint3dCsys, iVectorZ) < Distance_Point_to_Line(iPoint3dTG2, iPoint3dCsys, iVectorZ) Then
'                ReDim Preserve iPoint3dDoPMI(iDem)
'                iPoint3dDoPMI(iDem) = iPoint3dTG1
'            Else
'                ReDim Preserve iPoint3dDoPMI(iDem)
'                iPoint3dDoPMI(iDem) = iPoint3dTG2
'            End If
'            iDem = iDem + 1
'            'Tìm Curve có khoảng cách đến trục Z za hơn, điểm nằm trên Curve này và gần với trục Z nhất là điểm cần tìm
'            For i = 2 To UBound(iTagCurveGiao45) - 1 Step 2
'                Dim iP3d(3) As Point3d, iP3dTG As Point3d
'                Call Start_End_Mid_Point_ForCurve(NXObjectManager.Get(iTagCurveGiao45(i)), iP3d(0), iP3d(1), Nothing)
'                Call Start_End_Mid_Point_ForCurve(NXObjectManager.Get(iTagCurveGiao45(i + 1)), iP3d(2), iP3d(3), Nothing)
'                Dim iDist1 As Double, iDist2 As Double, iP3dTG1 As Point3d, iP3dTG2 As Point3d          'khoảng cách của từng Curve đến trục Z
'                iDist1 = Distance_Point_to_Line(iP3d(0), iPoint3dCsys, iVectorZ)
'                iP3dTG1 = iP3d(0)
'                If iDist1 > Distance_Point_to_Line(iP3d(1), iPoint3dCsys, iVectorZ) Then
'                    iDist1 = Distance_Point_to_Line(iP3d(1), iPoint3dCsys, iVectorZ)
'                    iP3dTG1 = iP3d(1)
'                End If
'                iDist2 = Distance_Point_to_Line(iP3d(2), iPoint3dCsys, iVectorZ)
'                iP3dTG2 = iP3d(2)
'                If iDist2 > Distance_Point_to_Line(iP3d(3), iPoint3dCsys, iVectorZ) Then
'                    iDist2 = Distance_Point_to_Line(iP3d(3), iPoint3dCsys, iVectorZ)
'                    iP3dTG2 = iP3d(3)
'                End If
'                If iDist1 >= iDist2 Then
'                    iP3dTG = iP3dTG1
'                Else
'                    iP3dTG = iP3dTG2
'                End If
'                ReDim Preserve iPoint3dDoPMI(iDem)
'                iPoint3dDoPMI(iDem) = iP3dTG
'                iDem = iDem + 1
'            Next
'            '
'            ''Tìm điểm đo d của Bolt Washer: là giao điểm giữa iTagCurveGiao45(UBound(iTagCurveGiao45)) và đường vuông góc với trục Z đi qua iP3dWashTG1
'            Call Start_End_Mid_Point_ForCurve(NXObjectManager.Get(iTagCurveGiao45(UBound(iTagCurveGiao45) - 1)), iPoint3dTG1, iPoint3dTG2, Nothing)
'            If Distance_Point_to_Line(iPoint3dTG1, iPoint3dCsys, iVectorZ) < Distance_Point_to_Line(iPoint3dTG2, iPoint3dCsys, iVectorZ) Then
'                iP3dWashTG1 = iPoint3dTG1
'                'ReDim Preserve iPoint3dDoPMI(iDem)
'                'iPoint3dDoPMI(iDem) = iPoint3dTG1
'            Else
'                iP3dWashTG1 = iPoint3dTG2
'                'ReDim Preserve iPoint3dDoPMI(iDem)
'                'iPoint3dDoPMI(iDem) = iPoint3dTG2
'            End If
'            Call Create_LineEquation_From_Point_And_DirectionVector_1(iP3dWashTG1, iVectorZ, 5, iP3dWashTG2)
'            Call Start_End_Mid_Point_ForCurve(NXObjectManager.Get(iTagCurveGiao45(UBound(iTagCurveGiao45))), iPoint3dTG1, iPoint3dTG2, Nothing)
'            ReDim Preserve iPoint3dDoPMI(iDem)
'            Call Timgiaodiem2duongthang(iPoint3dTG1, iPoint3dTG2, iP3dWashTG1, iP3dWashTG2, iPoint3dDoPMI(iDem))

'        ElseIf iCheckBolt_Washer = False And iCheckNut_Washer = False Then
'            'Trường hợp không có Washer
'            Dim iDem As Integer = 0, i As Integer
'            Dim iPoint3dTG1 As Point3d, iPoint3dTG2 As Point3d, iPoint3dTG3 As Point3d, iPoint3dTG4 As Point3d  'biến trung gian
'            '
'            Call Start_End_Mid_Point_ForCurve(NXObjectManager.Get(iTagCurveGiao45(1)), iPoint3dTG1, iPoint3dTG2, Nothing)
'            If Distance_Point_to_Line(iPoint3dTG1, iPoint3dCsys, iVectorZ) < Distance_Point_to_Line(iPoint3dTG2, iPoint3dCsys, iVectorZ) Then
'                ReDim Preserve iPoint3dDoPMI(iDem)
'                iPoint3dDoPMI(iDem) = iPoint3dTG1
'            Else
'                ReDim Preserve iPoint3dDoPMI(iDem)
'                iPoint3dDoPMI(iDem) = iPoint3dTG2
'            End If
'            iDem = iDem + 1
'            'Tìm Curve có khoảng cách đến trục Z za hơn, điểm nằm trên Curve này và gần với trục Z nhất là điểm cần tìm
'            For i = 2 To UBound(iTagCurveGiao45) - 2 Step 2
'                Dim iP3d(3) As Point3d, iP3dTG As Point3d
'                Call Start_End_Mid_Point_ForCurve(NXObjectManager.Get(iTagCurveGiao45(i)), iP3d(0), iP3d(1), Nothing)
'                Call Start_End_Mid_Point_ForCurve(NXObjectManager.Get(iTagCurveGiao45(i + 1)), iP3d(2), iP3d(3), Nothing)
'                Dim iDist1 As Double, iDist2 As Double, iP3dTG1 As Point3d, iP3dTG2 As Point3d          'khoảng cách của từng Curve đến trục Z
'                iDist1 = Distance_Point_to_Line(iP3d(0), iPoint3dCsys, iVectorZ)
'                iP3dTG1 = iP3d(0)
'                If iDist1 > Distance_Point_to_Line(iP3d(1), iPoint3dCsys, iVectorZ) Then
'                    iDist1 = Distance_Point_to_Line(iP3d(1), iPoint3dCsys, iVectorZ)
'                    iP3dTG1 = iP3d(1)
'                End If
'                iDist2 = Distance_Point_to_Line(iP3d(2), iPoint3dCsys, iVectorZ)
'                iP3dTG2 = iP3d(2)
'                If iDist2 > Distance_Point_to_Line(iP3d(3), iPoint3dCsys, iVectorZ) Then
'                    iDist2 = Distance_Point_to_Line(iP3d(3), iPoint3dCsys, iVectorZ)
'                    iP3dTG2 = iP3d(3)
'                End If
'                If iDist1 >= iDist2 Then
'                    iP3dTG = iP3dTG1
'                Else
'                    iP3dTG = iP3dTG2
'                End If
'                ReDim Preserve iPoint3dDoPMI(iDem)
'                iPoint3dDoPMI(iDem) = iP3dTG
'                iDem = iDem + 1
'            Next
'            '
'            Call Start_End_Mid_Point_ForCurve(NXObjectManager.Get(iTagCurveGiao45(UBound(iTagCurveGiao45) - 1)), iPoint3dTG1, iPoint3dTG2, Nothing)
'            If Distance_Point_to_Line(iPoint3dTG1, iPoint3dCsys, iVectorZ) < Distance_Point_to_Line(iPoint3dTG2, iPoint3dCsys, iVectorZ) Then
'                ReDim Preserve iPoint3dDoPMI(iDem)
'                iPoint3dDoPMI(iDem) = iPoint3dTG1
'            Else
'                ReDim Preserve iPoint3dDoPMI(iDem)
'                iPoint3dDoPMI(iDem) = iPoint3dTG2
'            End If
'        End If
'    End Sub

'    Function Distance_Point_to_Line(ByVal iPoint3d As Point3d, ByVal iPointLine3d As Point3d, ByVal iVector3d As Vector3d) As Double
'        'Đo khoảng cách từ điểm iPoint3d tới đường thẳng có iPointLine3d nằm trên đường thẳng và nhận iVector3d làm Vector chỉ phương 
'        Distance_Point_to_Line = Math.Round(Do_dai_Vector(Tich_co_huong_2_vector(Create_DirectionVector_From_2_Point3D(iPoint3d, iPointLine3d), iVector3d)) / Do_dai_Vector(iVector3d), 3)
'    End Function
'    Function Do_dai_Vector(ByVal iVector3D As Vector3d) As Double
'        Do_dai_Vector = Math.Sqrt(iVector3D.X ^ 2 + iVector3D.Y ^ 2 + iVector3D.Z ^ 2)
'    End Function
'    Function Tich_co_huong_2_vector(ByVal iVector3D1 As Vector3d, ByVal iVector3D2 As Vector3d) As Vector3d
'        Tich_co_huong_2_vector.X = iVector3D1.Y * iVector3D2.Z - iVector3D1.Z * iVector3D2.Y
'        Tich_co_huong_2_vector.Y = iVector3D1.Z * iVector3D2.X - iVector3D1.X * iVector3D2.Z
'        Tich_co_huong_2_vector.Z = iVector3D1.X * iVector3D2.Y - iVector3D1.Y * iVector3D2.X
'    End Function

'    Sub Run_CreateFile_Output_Matome()
'        objExcel.Run("Handan")
'    End Sub

'    Sub Create_dtMenatsu()

'        Dim sub_dtMenatsu As New DataTable
'        sub_dtMenatsu.Columns.Add("VI TRI")
'        sub_dtMenatsu.Columns.Add("GROUP NAME")
'        sub_dtMenatsu.Columns.Add("GROUP TAG")
'        sub_dtMenatsu.Columns.Add("MEN NO")
'        sub_dtMenatsu.Columns.Add("HOLE DIA X")
'        sub_dtMenatsu.Columns.Add("HOLE DIA Y")
'        sub_dtMenatsu.Columns.Add("HOLE TYPE")
'        sub_dtMenatsu.Columns.Add("HOLE AREA")
'        sub_dtMenatsu.Columns.Add("DIMENSION OUTSIDE")
'        sub_dtMenatsu.Columns.Add("OUTSIDE AREA")
'        sub_dtMenatsu.Columns.Add("MENATSU AREA")
'        sub_dtMenatsu.Columns.Add("MATERIAL")
'        sub_dtMenatsu.Columns.Add("HANDAN")
'        sub_dtMenatsu.Columns.Add("BANGOU DATA")
'        dtMenatsu = sub_dtMenatsu
'    End Sub

'    Sub Add_Infor_dtMenatsu(ByVal iDataRow As DataRow, ByVal iDemMenNo As Integer)
'        'l
'        'Gắn giá trị vào dtMenatsu
'        Dim dtView_Vitri As New DataView(dtExcelOut)
'        dtView_Vitri.RowFilter = "[Vitri] like " & "'%" & Left(Right(iDataRow("Sect"), 7), 6).ToString & "%'"
'        Dim iArrTrans_getHoleSize(4) As String         'chuyển thông tin từ row thành các phần tử trong mảng
'        For Each iDtRow As DataRow In dtView_Vitri.ToTable.Rows
'            iArrTrans_getHoleSize(0) = iDtRow("AInfor") & "@_" & iDtRow("HoleADiaX") & "@_" & iDtRow("HoleADiaY") & "@_" & iDtRow("HoleAType")
'            iArrTrans_getHoleSize(1) = iDtRow("BInfor") & "@_" & iDtRow("HoleBDiaX") & "@_" & iDtRow("HoleBDiaY") & "@_" & iDtRow("HoleBType")
'            iArrTrans_getHoleSize(2) = iDtRow("CInfor") & "@_" & iDtRow("HoleCDiaX") & "@_" & iDtRow("HoleCDiaY") & "@_" & iDtRow("HoleCType")
'            iArrTrans_getHoleSize(3) = iDtRow("DInfor") & "@_" & iDtRow("HoleDDiaX") & "@_" & iDtRow("HoleDDiaY") & "@_" & iDtRow("HoleDType")
'            iArrTrans_getHoleSize(4) = iDtRow("EInfor") & "@_" & iDtRow("HoleEDiaX") & "@_" & iDtRow("HoleEDiaY") & "@_" & iDtRow("HoleEType")
'        Next

'        Dim row As DataRow
'        row = dtMenatsu.NewRow
'        row("VI TRI") = Left(Right(iDataRow("Sect"), 7), 6).ToString
'        row("GROUP NAME") = iDataRow("GroupName").ToString
'        row("GROUP TAG") = iDataRow("Group Tag").ToString
'        row("MEN NO") = iDemMenNo

'        Try
'            row("MATERIAL") = Split(iDataRow("GroupName").ToString, "$")(2)
'        Catch ex As Exception
'            row("MATERIAL") = ""
'        End Try
'        'lw.WriteFullline("So vong lap")

'        For Each iString As String In iArrTrans_getHoleSize
'            'lw.WriteLine("abc: " & iString)
'            If Split(iString, "@_")(0) = iDataRow("GroupName").ToString Then
'                'lw.WriteLine("alo")
'                row("HOLE DIA X") = Math.Round(CType(Split(iString, "@_")(1), Double), 1)
'                row("HOLE DIA Y") = Math.Round(CType(Split(iString, "@_")(2), Double), 1)
'                row("HOLE TYPE") = Split(iString, "@_")(3)
'                If Split(iString, "@_")(3) = "丸穴" Then
'                    Dim iArea As Double
'                    iArea = 3.14159 * CType(Split(iString, "@_")(1), Double) * CType(Split(iString, "@_")(2), Double) / 4
'                    row("HOLE AREA") = iArea
'                    'iHoleArea = iArea
'                    'row("MENATSU AREA") =
'                ElseIf Split(iString, "@_")(3) = "OBL" Then
'                    Dim iArea As Double
'                    Dim iR As Double        'kích thước nhỏ hơn là bán kính đường tròn
'                    Dim iLong As Double
'                    If CType(Split(iString, "@_")(1), Double) >= CType(Split(iString, "@_")(2), Double) Then
'                        iR = CType(Split(iString, "@_")(2), Double)
'                        iLong = CType(Split(iString, "@_")(1), Double)
'                    Else
'                        iR = CType(Split(iString, "@_")(1), Double)
'                        iLong = CType(Split(iString, "@_")(2), Double)
'                    End If
'                    iArea = (3.14159 * iR * iR / 4) + iR * (iLong - iR)
'                    row("HOLE AREA") = iArea

'                    'iHoleArea = iArea
'                End If
'                'lw.WriteLine("16522_" & iDemMenNo)
'            End If
'        Next

'        'lw.WriteLine("lap")
'        dtMenatsu.Rows.Add(row)



'    End Sub

'    Sub PrintdtMenatsu()
'        Dim i As Integer
'        Dim icot As Integer = 13
'        Dim ArrData(100000, icot) As Object

'        For i = 0 To dtMenatsu.Rows.Count - 1
'            ArrData(i, 0) = dtMenatsu.Rows(i).Item("VI TRI").ToString
'            ArrData(i, 1) = dtMenatsu.Rows(i).Item("GROUP NAME").ToString
'            ArrData(i, 2) = dtMenatsu.Rows(i).Item("GROUP TAG").ToString
'            ArrData(i, 3) = dtMenatsu.Rows(i).Item("MEN NO").ToString
'            ArrData(i, 4) = dtMenatsu.Rows(i).Item("HOLE DIA X").ToString
'            ArrData(i, 5) = dtMenatsu.Rows(i).Item("HOLE DIA Y").ToString
'            ArrData(i, 6) = dtMenatsu.Rows(i).Item("HOLE TYPE").ToString
'            ArrData(i, 7) = dtMenatsu.Rows(i).Item("HOLE AREA").ToString
'            ArrData(i, 8) = dtMenatsu.Rows(i).Item("DIMENSION OUTSIDE").ToString
'            ArrData(i, 9) = dtMenatsu.Rows(i).Item("OUTSIDE AREA").ToString
'            ArrData(i, 10) = dtMenatsu.Rows(i).Item("MENATSU AREA").ToString
'            ArrData(i, 11) = dtMenatsu.Rows(i).Item("MATERIAL").ToString
'            ArrData(i, 12) = dtMenatsu.Rows(i).Item("HANDAN").ToString
'            ArrData(i, 13) = dtMenatsu.Rows(i).Item("BANGOU DATA").ToString
'        Next

'        Dim objWorksheetdtMenatsu = objWorkbook.worksheets("dtMenatsu")
'        Const xlDown As Long = -4121
'        Dim lngLastRow As Long

'        lngLastRow = objWorksheetdtMenatsu.Cells(2, 2).End(xlDown).Row + 1

'        If lngLastRow = 1048577 Then '
'            lngLastRow = 3
'        End If

'        If dtMenatsu.Rows.Count = 0 Then Exit Sub
'        'objWorksheetIn2.range("B" & 9).resize(dtPosiOut.Rows.Count - 1 + 1, 31).value = ArrData
'        objWorksheetdtMenatsu.range("B" & lngLastRow).resize(dtMenatsu.Rows.Count, 14).value = ArrData
'    End Sub

'    Sub DoKichThuocTheoPhuongVaTinhGoc_CurveAndCurve(ByVal iLine1 As String, ByVal iLine2 As String, ByVal iVector As Vector3d, ByRef giatri As Double, ByRef Giatrigoc As Double)
'        Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim CsPoint1 As Point3d  'Diem goc CS
'        Dim ipoint As NXOpen.Point

'        ipoint = workPart.Points.CreatePoint(CsPoint1)
'        Dim obj1 As NXOpen.TaggedObject = NXOpen.Utilities.NXObjectManager.Get(iLine1)
'        Dim obj2 As NXOpen.TaggedObject = NXOpen.Utilities.NXObjectManager.Get(iLine2)
'        Dim myLine1 As Curve, myLine2 As Curve

'        Dim junk(2) As Double, trash As Double
'        Dim EndPt(2) As Double
'        Dim StrPt(2) As Double
'        Dim EndPt1(2) As Double
'        Dim StrPt1(2) As Double
'        theUFSession.Modl.AskCurveProps(obj1.Tag, 0, StrPt, junk, junk, junk, trash, trash)
'        theUFSession.Modl.AskCurveProps(obj1.Tag, 1, EndPt, junk, junk, junk, trash, trash)
'        theUFSession.Modl.AskCurveProps(obj2.Tag, 0, StrPt1, junk, junk, junk, trash, trash)
'        theUFSession.Modl.AskCurveProps(obj2.Tag, 1, EndPt1, junk, junk, junk, trash, trash)

'        Dim iPt1 As Point3d, iPt2 As Point3d, iPt3 As Point3d, iPt4 As Point3d

'        iPt1 = New Point3d(StrPt(0), StrPt(1), StrPt(2))
'        iPt2 = New Point3d(EndPt(0), EndPt(1), EndPt(2))
'        iPt3 = New Point3d(StrPt1(0), StrPt1(1), StrPt1(2))
'        iPt4 = New Point3d(EndPt1(0), EndPt1(1), EndPt1(2))

'        Giatrigoc = CosOf2Line(iPt1, iPt2, iPt3, iPt4)
'        Giatrigoc = Math.Abs(Giatrigoc)
'        CsPoint1 = New Point3d(EndPt(0), EndPt(1), EndPt(2))


'        myLine1 = CType(obj1, NXOpen.Curve)
'        myLine2 = CType(obj2, NXOpen.Curve)

'        Dim nullNXOpen_NXObject As NXOpen.NXObject = Nothing
'        Dim measureDistanceBuilder1 As NXOpen.MeasureDistanceBuilder = Nothing
'        measureDistanceBuilder1 = workPart.MeasureManager.CreateMeasureDistanceBuilder(nullNXOpen_NXObject)
'        measureDistanceBuilder1.Mtype = NXOpen.MeasureDistanceBuilder.MeasureType.Minimum
'        Dim unit1 As NXOpen.Unit = CType(workPart.UnitCollection.FindObject("MilliMeter"), NXOpen.Unit)
'        Dim expression1 As NXOpen.Expression = Nothing
'        expression1 = workPart.Expressions.CreateSystemExpressionWithUnits("0", unit1)
'        Dim direction1 As NXOpen.Direction = Nothing
'        direction1 = workPart.Directions.CreateDirection(ipoint, iVector)
'        measureDistanceBuilder1.ProjectionVector = direction1
'        measureDistanceBuilder1.Object1.Value = myLine1
'        measureDistanceBuilder1.Object2.Value = myLine2
'        Dim object1 As Object = CType(myLine1, Object)
'        Dim object2 As Object = CType(myLine2, Object)
'        Dim measureDistance1 As NXOpen.MeasureDistance = Nothing
'        measureDistance1 = workPart.MeasureManager.NewDistance(unit1, myLine1, myLine2, direction1)



'        giatri = measureDistance1.Value
'        Dim datadeleted1 As Boolean = Nothing
'        datadeleted1 = theSession.DeleteTransientDynamicSectionCutData()
'        measureDistanceBuilder1.Destroy()
'        workPart.Expressions.Delete(expression1)
'    End Sub
'    Sub GetBoltNutDistance_1(ByVal dtInforLineOut As DataTable, ByRef iBoltCurve() As Curve, ByRef iNutCurve() As Curve, ByRef iDistance As Double, ByVal tmpCsys As NXOpen.CartesianCoordinateSystem, ByRef iBoltNo As String, ByRef iFixPartTypeBolt As String, ByRef iDimBolt As Double, ByRef iBoltMaterial As String, ByRef iNutNo As String, ByRef iFixPartTypeNut As String, ByRef iDimNut As Double, ByRef iNutMaterial As String, ByVal iListBuhinMenatsu As List(Of String))
'        Dim theSession As Session = Session.GetSession()
'        Dim workpart As Part = theSession.Parts.Work
'        Dim iRootComp As Component = workpart.ComponentAssembly.RootComponent
'        Dim ObjWsOut = objWorkbook.worksheets("Output")
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing


'        Dim iZCS(2) As Double
'        Dim iMatrix As Matrix3x3 = tmpCsys.Orientation.Element
'        iZCS(0) = iMatrix.Zx.ToString
'        iZCS(1) = iMatrix.Zy.ToString
'        iZCS(2) = iMatrix.Zz.ToString
'        Dim iVectorZ As Vector3d = New Vector3d(iZCS(0), iZCS(1), iZCS(2))
'        Dim iXCS(2) As Double
'        Dim iiMatrix As Matrix3x3 = tmpCsys.Orientation.Element
'        iXCS(0) = iiMatrix.Xx.ToString
'        iXCS(1) = iiMatrix.Xy.ToString
'        iXCS(2) = iiMatrix.Xz.ToString
'        Dim iVectorX As Vector3d = New Vector3d(iXCS(0), iXCS(1), iXCS(2))


'        'Dim iBoltNo As String = "", iNutNo As String = ""
'        Dim iCheckBoltHeadShape_Washer As Boolean, iCheckNutHeadShape_Washer As Boolean
'        'Lọc những đường để đo ネジ部
'        Dim dtView_Thread As New DataView(dtInforLineOut)
'        dtView_Thread.RowFilter = "[Hole Type] like '%Thread%'"

'        'Lọc những những đường ở Sect Y
'        Dim dtView_Thread_Y As New DataView(dtView_Thread.ToTable)
'        dtView_Thread_Y.RowFilter = "[Sect] like '%Y%'"

'        Dim iCsysPoint As NXOpen.Point = workpart.Points.CreatePoint(tmpCsys.Origin)
'        Dim Bolt_Tag As String, Nut_Tag As String

'        For Each dt_Row As DataRow In dtView_Thread_Y.ToTable.Rows
'            If InStr(dt_Row("GroupName").ToString, "NUT") > 0 Then
'                Nut_Tag = dt_Row("Group Tag").ToString
'            End If

'            If InStr(dt_Row("GroupName").ToString, "BOLT") > 0 Then
'                Bolt_Tag = dt_Row("Group Tag").ToString
'            End If
'        Next
'        'lw.WriteLine(Bolt_Tag.ToString)

'        Dim dtView_SectY As New DataView(dtInforLineOut)
'        dtView_SectY.RowFilter = "[Sect] like '%Y%'"

'        Dim dtView_BoltAndNut As New DataView(dtView_SectY.ToTable)
'        dtView_BoltAndNut.RowFilter = "([GroupName] like '%NUT%' OR [GroupName] like '%BOLT%')"

'        Dim dtView_VuongGoc As New DataView(dtView_BoltAndNut.ToTable)
'        dtView_VuongGoc.RowFilter = String.Format("[a1] like '%{0}'", 0)

'        Dim dtView_NutData As New DataView(dtView_VuongGoc.ToTable)
'        dtView_NutData.RowFilter = "[GroupName] like '%NUT%'"
'        dtView_NutData.Sort = "d1"

'        ''''''''''''''''''''''''''''''''''''''Lấy Curve Nut'''''''''''''''''''''''''''''''''''''''''''''
'        'trường hợp có nhiều hơn 2 curve thỏa mãn thì mỗi bên lấy 1 curve bất kỳ
'        Dim iDem As Integer = 0

'        For Each Nut_dtRow As DataRow In dtView_NutData.ToTable.Rows
'            Dim iCurveTG As Curve
'            iCurveTG = CType(NXObjectManager.Get(Double.Parse(Nut_dtRow("Object Tag").ToString)), Curve)
'            If iCurveTG.GetLength > 1 Then
'                ReDim Preserve iNutCurve(iDem)
'                iNutCurve(iDem) = iCurveTG
'                iNutNo = Split(Nut_dtRow("GroupName").ToString, "$")(1)
'                iDem = iDem + 1
'                If iDem = 2 Then
'                    Exit For
'                End If
'            End If
'        Next




'        '''''''''Tìm 2 Curve tạo thành lỗ của buhin gần với Nut nhất, 2 Curve này song song với trục Z, không phải Bolt, Nut, Khoảng cách đến hệ tọa độ ngắn nhất
'        '''''''''Sau đó tìm ra 2 Curve của Nut vuông góc với trục Z, khoảng cách đến 2 Curve tìm được ở trên là ngắn nhất
'        ''''''Tìm 2 Curve tạo thành lỗ của buhin gần với Nut nhất
'        ''''Tìm Curve đầu tiên
'        '''Dim dtView_SongsongZ As New DataView(dtView_SectY.ToTable)
'        '''dtView_SongsongZ.RowFilter = String.Format("[a1] like '%{1}'", 0)
'        '''dtView_SongsongZ.Sort = "d1"
'        '''Dim iTagCurveSubNut(1) As Tag
'        '''For Each idtRow As DataRow In dtView_SongsongZ.ToTable.Rows
'        '''    If InStr(idtRow("GroupName").ToString.ToUpper, "BOLT") = 0 And InStr(idtRow("GroupName").ToString.ToUpper, "NUT") = 0 Then
'        '''        iTagCurveSubNut(0) = idtRow("Group Tag")
'        '''    End If
'        '''Next
'        ''''Curve thứ 2 không được trùng với Curve đầu tiên (Khoảng cách với Curve đầu tiên <> 0)
'        '''For Each idtRow As DataRow In dtView_SongsongZ.ToTable.Rows
'        '''    If InStr(idtRow("GroupName").ToString.ToUpper, "BOLT") = 0 And InStr(idtRow("GroupName").ToString.ToUpper, "NUT") = 0 Then
'        '''        Dim guess1(2) As Double
'        '''        Dim guess2(2) As Double
'        '''        Dim pt1(2) As Double
'        '''        Dim pt2(2) As Double
'        '''        Dim minDist As Double
'        '''        theUFSession.Modl.AskMinimumDist(idtRow("Group Tag"), iTagCurveSubNut(0), 0, guess1, 0, guess2, minDist, pt1, pt2)
'        '''        If minDist > 1 Then         'Curve thứ 2 k trùng với Curve đầu tiên thì Mindist <> 0 là được, nhưng để > 1 phòng trường hợp có sai số
'        '''            iTagCurveSubNut(1) = idtRow("Group Tag")
'        '''        End If
'        '''    End If
'        '''Next
'        '''''''''Tìm ra 2 Curve của Nut
'        '''Dim iTagCurveNutTG(1) As Tag
'        '''Dim l As Integer
'        '''For l = 0 To UBound(iTagCurveSubNut)
'        '''    Dim iMinLen As Double = 13072023
'        '''    For Each Nut_dtRow As DataRow In dtView_NutData.ToTable.Rows
'        '''        Dim guess1(2) As Double
'        '''        Dim guess2(2) As Double
'        '''        Dim pt1(2) As Double
'        '''        Dim pt2(2) As Double
'        '''        Dim minDist As Double
'        '''        theUFSession.Modl.AskMinimumDist(Nut_dtRow("Group Tag"), iTagCurveSubNut(l), 0, guess1, 0, guess2, minDist, pt1, pt2)
'        '''        'Khoảng cách đến 2 Curve tìm được ở trên là ngắn nhất
'        '''        If iMinLen > minDist Then
'        '''            iMinLen = minDist
'        '''            iTagCurveNutTG(l) = Nut_dtRow("Group Tag")
'        '''            iNutNo = Split(Nut_dtRow("GroupName").ToString, "$")(1)
'        '''        End If
'        '''    Next
'        '''Next
'        '''For l = 0 To UBound(iTagCurveNutTG)
'        '''    ReDim Preserve iNutCurve(iDem)
'        '''    iNutCurve(iDem) = CType(NXObjectManager.Get(Double.Parse(iTagCurveNutTG(l))), Curve)
'        '''    iDem = iDem + 1
'        '''Next




'        'Lấy thông tin Nut
'        If iNutNo = "" Then
'            lw.WriteLine("Không lấy được Nut No")
'            iCheckCorrect = False
'            Exit Sub
'        End If
'        Call CheckBoltNutInfor(iNutNo, iFixPartTypeNut, iDimNut, iCheckNutHeadShape_Washer, iNutMaterial)
'        If iListBuhinMenatsu.Contains(iNutNo) = False Then
'            iListBuhinMenatsu.Add(iNutNo)
'        End If

'        If iCheckCorrect = False Then
'            Exit Sub
'        End If
'        Dim l As Integer
'        'Trường hợp Nut là Rokkaku: tìm thêm 2 Curve của Washer: là 2 Curve vuông góc với trục Z, khoảng cách tới 2 Curve Nut tìm ở trên ngắn nhất và <> 0, khoảng cách theo phương Z <> 0
'        If iCheckNutHeadShape_Washer = True Then
'            iCheckNut_Washer = True
'            For l = 0 To 1
'                Dim iCurveNutTG As Curve
'                Dim iDis As Double, iAngle As Double
'                Dim iMinLen As Double = 13072023
'                For Each Nut_dtRow As DataRow In dtView_NutData.ToTable.Rows
'                    Call DoKichThuocTheoPhuongVaTinhGoc_CurveAndCurve(iNutCurve(l).Tag, Nut_dtRow("Object Tag").ToString, iVectorZ, iDis, iAngle)
'                    If iDis > 0.1 Then      'Khoảng cách theo phương Z <> 0 ( > 0.1 để phòng sai số)
'                        Dim guess1(2) As Double
'                        Dim guess2(2) As Double
'                        Dim pt1(2) As Double
'                        Dim pt2(2) As Double
'                        Dim minDist As Double
'                        theUFSession.Modl.AskMinimumDist(Nut_dtRow("Group Tag"), iNutCurve(l).Tag, 0, guess1, 0, guess2, minDist, pt1, pt2)
'                        'Khoảng cách đến 2 Curve tìm được ở trên là ngắn nhất
'                        If iMinLen > minDist Then
'                            iMinLen = minDist
'                            iCurveNutTG = NXObjectManager.Get(Nut_dtRow("Group Tag"))
'                        End If
'                    End If
'                Next
'                ReDim Preserve iNutCurve(iDem)
'                iNutCurve(iDem) = iCurveNutTG
'                iDem = iDem + 1
'            Next
'        End If



'        '''''''''''''''''''''''''''Lấy Curve Bolt''''''''''''''''''''''''''''''''''''''''''''''''''
'        'dtView_BoltAndNut.RowFilter = "([GroupName] like '%NUT%' OR [GroupName] like '%BOLT%')"

'        Dim dtView_BoltData As New DataView(dtView_VuongGoc.ToTable)
'        dtView_BoltData.RowFilter = "[GroupName] like '%BOLT%' AND [Line length] > 1.9"       'Chiều dài Curve >= 2 để loại bỏ những curve nhỏ, rác


'        'Dim iPointOriginCsys As NXOpen.Point = workpart.Points.CreatePoint(tmpCsys.Origin)
'        Dim tmpDis 'Khoảng cách giữa đường của Nut và các đường của Bolt
'        Dim tmpAngle As Double 'Gía trị góc
'        Dim iBoltNutDist1 As Double = 1000   'Khoảng cách từ Bolt tới Nut (Khoảng cách nhỏ nhất)

'        '''''''''''''''''''''''''''''Từ chỗ này trở xuống chưa làm tối ưu code :)))'''''''''''''''''''''''''''''''''''''

'        Dim tmpDt_Bolt As DataTable = dtView_BoltData.ToTable
'        For Each Bolt_dtRow As DataRow In tmpDt_Bolt.Rows
'            Dim iChua As Double
'            'Call DoKichThuocTheoPhuongVaTinhGoc_CurveAndCurve(iPointOriginCsys.Tag, Bolt_dtRow("Object Tag").ToString, iVectorX, iChua, Nothing)    'Điều kiện khoảng cách đo từ Curve tới Csys theo phương X > 1 để loại trừ những curve ở dưới cùng của Bolt
'            'If iChua > 1 Then
'            Call DoKichThuocTheoPhuongVaTinhGoc_CurveAndCurve(iNutCurve(0).Tag, Bolt_dtRow("Object Tag").ToString, iVectorZ, tmpDis, tmpAngle)
'            Bolt_dtRow("Hole Size") = Math.Round(tmpDis, 1)         'Add giá trị vào tmpDt_Bolt
'            Bolt_dtRow("Xg") = Math.Abs(tmpAngle).ToString
'            If Math.Round(Math.Abs(tmpAngle), 3) = 1 Then
'                'lw.WriteLine("tmpDis: " & tmpDis)
'                If Math.Round(tmpDis, 1) < iBoltNutDist1 Then
'                    iBoltNutDist1 = Math.Round(tmpDis, 1)                   '20231110: Thay đổi làm Tròn iBoltNutDist1 về 1 chữ số 
'                End If
'            End If
'            'End If
'        Next

'        iDistance = iBoltNutDist1
'        'lw.WriteLine("idistance: " & iDistance)
'        Dim dtView2_BoltData As New DataView(tmpDt_Bolt)
'        dtView2_BoltData.RowFilter = "[Hole Size] like '" & iDistance & "'" ' "[Hole Size] = " & iBoltNutDist.ToString  '"[Group Tag] like '%" & iTag & "%'"  '''''''Lọc lấy 2 curve của Bolt gần Nut nhất
'        'Call iPrintInforLine(tmpDt_Bolt)            '20231110
'        iDem = 0
'        Dim iiBoltCurve() As Curve
'        For Each tmpRow As DataRow In dtView2_BoltData.ToTable.Rows
'            ReDim Preserve iiBoltCurve(iDem)
'            iiBoltCurve(iDem) = NXObjectManager.Get(Double.Parse(tmpRow("Object Tag").ToString))
'            'iiBoltCurve(iDem).Highlight()
'            iBoltNo = Split(tmpRow("GroupName").ToString, "$")(1)
'            iDem = iDem + 1
'            'If iDem = 2 Then
'            '    Exit For
'            'End If
'        Next
'        'Lấy thông tin Bolt
'        If iBoltNo = "" Then
'            lw.WriteLine("Không lấy được Bolt No")
'            iCheckCorrect = False
'            Exit Sub
'        End If
'        'lw.WriteLine(iBoltNo)
'        Call CheckBoltNutInfor(iBoltNo, iFixPartTypeBolt, iDimBolt, iCheckBoltHeadShape_Washer, iBoltMaterial)
'        If iListBuhinMenatsu.Contains(iBoltNo) = False Then
'            iListBuhinMenatsu.Add(iBoltNo)
'        End If
'        'lw.WriteLine("iDimBolt: " & iDimBolt)
'        If iCheckCorrect = False Then
'            Exit Sub
'        End If
'        'trường hợp có nhiều hơn 2 curve thỏa mãn thì mỗi bên lấy 1 curve bất kỳ
'        iDem = 0
'        ReDim Preserve iBoltCurve(iDem)
'        iBoltCurve(iDem) = iiBoltCurve(0)

'        'iBoltCurve(iDem).Highlight()

'        'lw.WriteLine("ubound(iiBoltCurve): " & UBound(iiBoltCurve))

'        Dim iiMidPoint As NXOpen.Point3d
'        Call Start_End_Mid_Point_ForCurve(iBoltCurve(iDem), Nothing, Nothing, iiMidPoint)
'        Dim iiVector3D As Vector3d = Create_DirectionVector_From_2_Point3D(tmpCsys.Origin, iiMidPoint)
'        Dim iiAngle As Double
'        iiAngle = CosOf2Vector_1(iVectorX, iiVector3D)
'        iDem += 1
'        Dim i As Integer
'        For i = 1 To UBound(iiBoltCurve)
'            Dim iMidPoint As NXOpen.Point3d
'            Call Start_End_Mid_Point_ForCurve(iiBoltCurve(i), Nothing, Nothing, iMidPoint)
'            Dim iVector3D As Vector3d = Create_DirectionVector_From_2_Point3D(tmpCsys.Origin, iMidPoint)
'            Dim iAngle As Double
'            iAngle = CosOf2Vector_1(iVectorX, iVector3D)
'            If iiAngle > 0 And iAngle < 0 Or iiAngle < 0 And iAngle > 0 Then
'                ReDim Preserve iBoltCurve(iDem)
'                iBoltCurve(iDem) = iiBoltCurve(i)
'                'iBoltCurve(iDem).Highlight()
'                iDem = iDem + 1
'                Exit For
'            End If
'        Next

'        'Trường hợp Bolt Rokkaku
'        ''Tìm cạnh thuộc Bolt có khoảng cách tới Nut ngắn thứ 2
'        '''Tìm iBoltNutDist2 để lọc ở dưới
'        Dim iBoltNutDist2 As Double = 10000    'Khoảng cách từ cạnh cần đo Washer tới Nut (khoảng cách nhỏ thứ 2)
'        For Each Bolt_dtRow As DataRow In tmpDt_Bolt.Rows
'            Call DoKichThuocTheoPhuongVaTinhGoc_CurveAndCurve(iBoltCurve(0).Tag, Bolt_dtRow("Object Tag").ToString, iVectorZ, tmpDis, tmpAngle)
'            Bolt_dtRow("Hole Size") = Math.Round(tmpDis, 3)         'Add giá trị vào tmpDt_Bolt
'            Bolt_dtRow("Xg") = Math.Abs(tmpAngle).ToString
'            'If Math.Round(Math.Abs(tmpAngle), 3) = 1 Then
'            If Math.Round(Math.Abs(tmpAngle), 3) = 1 And Math.Round(tmpDis, 3) < iBoltNutDist2 And Math.Round(tmpDis, 0) <> 0 Then         'And Math.Round(tmpDis, 3) <> iBoltNutDist1
'                iBoltNutDist2 = Math.Round(tmpDis, 3)
'            End If
'            'End If
'        Next

'        lw.WriteLine("boltnutDist12: " & iBoltNutDist1 & "_" & iBoltNutDist2)
'        '130420130723

'        If iCheckBoltHeadShape_Washer = True Then
'            'lw.WriteLine("sddddddddddddddddddddddddddd")
'            iCheckBolt_Washer = True
'            'lw.WriteLine("iBoltNutDist2: " & iBoltNutDist2)
'            'iPrintInforLine(tmpDt_Bolt)
'            Dim dtView2_BoltDataRokkaku As New DataView(tmpDt_Bolt)
'            dtView2_BoltDataRokkaku.RowFilter = "[Hole Size] like '%" & iBoltNutDist2 & "%'" ' "[Hole Size] = " & iBoltNutDist.ToString  '"[Group Tag] like '%" & iTag & "%'"  '''''''Lọc lấy 2 curve của Bolt gần Nut nhất
'            dtView2_BoltDataRokkaku.Sort = "Hole Size"          '20231213   Thay sort bằng  "Hole Size = " & iBoltNutDist2 hoặc "Hole Size = '" & iBoltNutDist2 & "'"
'            'iPrintInforLine(dtView2_BoltDataRokkaku.ToTable)
'            Dim iiDem As Integer = 0
'            'Dim iiBoltCurve() As Curve
'            For Each tmpRow As DataRow In dtView2_BoltDataRokkaku.ToTable.Rows
'                ReDim Preserve iiBoltCurve(iiDem)
'                iiBoltCurve(iiDem) = NXObjectManager.Get(Double.Parse(tmpRow("Object Tag").ToString))
'                iiDem = iiDem + 1
'            Next

'            'trường hợp có nhiều hơn 2 curve thỏa mãn thì mỗi bên lấy 1 curve bất kỳ
'            'iDem = 0
'            ReDim Preserve iBoltCurve(iDem)
'            iBoltCurve(iDem) = iiBoltCurve(0)
'            iBoltCurve(iDem).Highlight()
'            'Dim iiMidPoint As NXOpen.Point3d
'            Call Start_End_Mid_Point_ForCurve(iBoltCurve(iDem), Nothing, Nothing, iiMidPoint)
'            iiVector3D = Create_DirectionVector_From_2_Point3D(tmpCsys.Origin, iiMidPoint)
'            'Dim iiiAngle As Double
'            iiAngle = CosOf2Vector_1(iVectorX, iiVector3D)
'            iDem += 1
'            'Dim i As Integer
'            For i = 1 To UBound(iiBoltCurve)
'                Dim iMidPoint As NXOpen.Point3d
'                Call Start_End_Mid_Point_ForCurve(iiBoltCurve(i), Nothing, Nothing, iMidPoint)
'                Dim iVector3D As Vector3d = Create_DirectionVector_From_2_Point3D(tmpCsys.Origin, iMidPoint)
'                Dim iAngle As Double
'                iAngle = CosOf2Vector_1(iVectorX, iVector3D)
'                If iiAngle > 0 And iAngle < 0 Or iiAngle < 0 And iAngle > 0 Then
'                    ReDim Preserve iBoltCurve(iDem)
'                    iBoltCurve(iDem) = iiBoltCurve(i)
'                    'iBoltCurve(iDem).Highlight()
'                    iDem = iDem + 1
'                    Exit For
'                End If
'            Next
'        End If

'    End Sub

'    Function CosOf2Vector_1(ByVal iVector1 As Vector3d, ByVal iVector2 As Vector3d) As Double

'        CosOf2Vector_1 = (iVector1.X * iVector2.X + iVector1.Y * iVector2.Y + iVector1.Z * iVector2.Z) / Math.Sqrt((iVector1.X ^ 2 + iVector1.Y ^ 2 + iVector1.Z ^ 2) * (iVector2.X ^ 2 + iVector2.Y ^ 2 + iVector2.Z ^ 2))
'    End Function
'    Sub Start_End_Mid_Point_ForCurve(ByVal iCurve As Curve, ByRef iStart3d As NXOpen.Point3d, ByRef iEnd3d As NXOpen.Point3d, ByRef iMid3d As NXOpen.Point3d)
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display

'        Dim objects1(0) As NXOpen.NXObject
'        Dim stPt(2) As Double
'        Dim edPt(2) As Double
'        Dim junk3(2) As Double
'        Dim junk1 As Double
'        theUFSession.Modl.AskCurveProps(iCurve.Tag, 0, stPt, junk3, junk3, junk3, junk1, junk1)
'        iStart3d.X = stPt(0)
'        iStart3d.Y = stPt(1)
'        iStart3d.Z = stPt(2)


'        theUFSession.Modl.AskCurveProps(iCurve.Tag, 1, stPt, junk3, junk3, junk3, junk1, junk1)
'        iEnd3d.X = stPt(0)
'        iEnd3d.Y = stPt(1)
'        iEnd3d.Z = stPt(2)


'        theUFSession.Modl.AskCurveProps(iCurve.Tag, 1 / 2, stPt, junk3, junk3, junk3, junk1, junk1)
'        iMid3d.X = stPt(0)
'        iMid3d.Y = stPt(1)
'        iMid3d.Z = stPt(2)


'    End Sub


'    Function SaveAsNewNamePart(ByVal prtName As String)
'        Dim theSession As Session = Session.GetSession
'        Dim partOperationBuilder1 As PDM.PartOperationBuilder
'        Dim selectedparts1(0) As BasePart
'        Dim failedparts1() As BasePart
'        Dim logicalobjects1() As PDM.LogicalObject
'        Dim sourceobjects1() As NXObject
'        Dim objects1(-1) As NXObject
'        Dim attributePropertiesBuilder1 As AttributePropertiesBuilder
'        Dim errorList1 As ErrorList
'        Dim errorList2 As ErrorList
'        Dim nXObject1 As NXObject
'        Dim errorList3 As ErrorList
'        Dim workPart As Part = theSession.Parts.Work
'        partOperationBuilder1 = theSession.PdmSession.CreateOperationBuilder(PDM.PartOperationBuilder.OperationType.SaveAs)
'        partOperationBuilder1.ReplaceAllComponents = True
'        partOperationBuilder1.DependentFileSaveAsOption = PDM.PartOperationBuilder.DependentFileSaveAs.All
'        partOperationBuilder1.SetDialogOperation(PDM.PartOperationBuilder.OperationType.SaveAs)
'        selectedparts1(0) = workPart
'        partOperationBuilder1.SetSelectedParts(selectedparts1, failedparts1)
'        partOperationBuilder1.CreateLogicalObjects(logicalobjects1)
'        sourceobjects1 = logicalobjects1(0).GetUserAttributeSourceObjects()
'        attributePropertiesBuilder1 = theSession.AttributeManager.CreateAttributePropertiesBuilder(workPart, objects1, AttributePropertiesBuilder.OperationType.SaveAs)
'        attributePropertiesBuilder1.SetAttributeObjects(sourceobjects1)
'        attributePropertiesBuilder1.Title = "DB_PART_REV"
'        attributePropertiesBuilder1.Category = "CAD Revision"
'        attributePropertiesBuilder1.DataType = AttributePropertiesBaseBuilder.DataTypeOptions.String
'        attributePropertiesBuilder1.StringValue = "AA"

'        'attributePropertiesBuilder1.SetAttributeObjects(sourceobjects1)
'        'attributePropertiesBuilder1.Title = "DB_PART_NO"
'        'attributePropertiesBuilder1.Category = "CAD"
'        'attributePropertiesBuilder1.DataType = AttributePropertiesBaseBuilder.DataTypeOptions.String
'        'attributePropertiesBuilder1.StringValue = prtNo
'        'attributePropertiesBuilder1.CreateAttribute()

'        attributePropertiesBuilder1.SetAttributeObjects(sourceobjects1)
'        attributePropertiesBuilder1.Title = "DB_PART_NAME"
'        attributePropertiesBuilder1.Category = "CAD"
'        attributePropertiesBuilder1.DataType = AttributePropertiesBaseBuilder.DataTypeOptions.String
'        attributePropertiesBuilder1.StringValue = prtName
'        attributePropertiesBuilder1.CreateAttribute()

'        errorList1 = partOperationBuilder1.AutoAssignAttributes(logicalobjects1)
'        partOperationBuilder1.ValidateLogicalObjectsToCommit()
'        errorList2 = partOperationBuilder1.GetOperationFailures()
'        theSession.PdmSession.SetDefaultFolder("Newstuff")
'        nXObject1 = partOperationBuilder1.Commit()

'        errorList3 = partOperationBuilder1.GetOperationFailures()
'        errorList3.Dispose()
'        partOperationBuilder1.Destroy()
'        attributePropertiesBuilder1.Destroy()
'        theSession.CleanUpFacetedFacesAndEdges()
'    End Function
'    Sub Get_GroupTag(ByVal dtInforLineOut As DataTable, ByVal iCurveTag() As Tag, ByRef iGroupTag() As Tag)

'        Dim i As Integer = 0
'        For i = 0 To UBound(iCurveTag)
'            Dim idtView_GroupTag As New DataView(dtInforLineOut)
'            idtView_GroupTag.RowFilter = "[Object Tag] like " & "'%" & iCurveTag(i) & "%'"
'            ReDim Preserve iGroupTag(i)
'            iGroupTag(i) = idtView_GroupTag.ToTable.Rows(0)(2)
'        Next



'    End Sub

'    Sub DienBangouMenatsuSangExcel()

'        Dim objWorksheetdtMenatsu = objWorkbook.worksheets("dtMenatsu")
'        Const xlDown As Long = -4121
'        Dim lngLastRow As Long

'        lngLastRow = objWorksheetdtMenatsu.Cells(2, 2).End(xlDown).Row

'        If lngLastRow = 1048576 Then '
'            lngLastRow = 3
'        End If

'        Dim i As Integer
'        For i = 3 To lngLastRow
'            For Each iString As String In iBangouMenatsu
'                'lw.WriteLine(CType(Split(iString, "@@")(0), Integer).ToString & "_" & objWorksheetdtMenatsu.Cells(i, 2).value.ToString)
'                If CType(Split(iString, "@@")(0), Integer).ToString = objWorksheetdtMenatsu.Cells(i, 2).value.ToString Then
'                    objWorksheetdtMenatsu.Cells(i, "O") = Split(iString, "@@")(1)
'                    Exit For
'                End If
'            Next

'        Next


'    End Sub

'    Sub CreatePic()
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim lw As ListingWindow = theSession.ListingWindow
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        lw = theSession.ListingWindow
'        lw.Open()
'        Try
'            Dim modelingView11 As NXOpen.ModelingView = Nothing
'            modelingView11 = workPart.ModelingViews.WorkView
'            modelingView11.Orient(NXOpen.View.Canned.Left, NXOpen.View.ScaleAdjustment.Current)
'        Catch ex As Exception
'            Dim modelingView11 As NXOpen.ModelingView = Nothing
'            modelingView11 = displayPart.ModelingViews.WorkView
'            modelingView11.Orient(NXOpen.View.Canned.Left, NXOpen.View.ScaleAdjustment.Current)
'        End Try
'        Call Take_Picture_Menatsu()
'    End Sub

'    Sub Show_All()
'        Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work

'        Dim displayPart As NXOpen.Part = theSession.Parts.Display

'        ' ----------------------------------------------
'        '   Menu: Edit->Show and Hide->Show and Hide...
'        ' ----------------------------------------------
'        Dim markId1 As NXOpen.Session.UndoMarkId = Nothing
'        markId1 = theSession.SetUndoMark(NXOpen.Session.MarkVisibility.Visible, "Start")

'        theSession.SetUndoMarkName(markId1, "Show and Hide Dialog")

'        Dim markId2 As NXOpen.Session.UndoMarkId = Nothing
'        markId2 = theSession.SetUndoMark(NXOpen.Session.MarkVisibility.Visible, "Show All")

'        Dim numberShown1 As Integer = Nothing
'        numberShown1 = theSession.DisplayManager.ShowByType("SHOW_HIDE_TYPE_ALL", NXOpen.DisplayManager.ShowHideScope.AnyInAssembly)

'        Dim nErrs1 As Integer = Nothing
'        nErrs1 = theSession.UpdateManager.DoUpdate(markId2)

'        workPart.ModelingViews.WorkView.FitAfterShowOrHide(NXOpen.View.ShowOrHideType.ShowOnly)

'        theSession.SetUndoMarkName(markId1, "Show and Hide")

'        theSession.DeleteUndoMark(markId1, Nothing)
'    End Sub

'    Sub Take_Picture_Menatsu()
'        'Sub Take_Picture_Menatsu(ByVal iDanmen_Menatsu() As String)
'        Dim theSession As Session = Session.GetSession()
'        Dim theUfSession As UFSession = UFSession.GetUFSession
'        Dim workpart As Part = theSession.Parts.Work
'        Dim disPart As Part = theSession.Parts.Display
'        Dim iRootComp As Component = workpart.ComponentAssembly.RootComponent
'        Call Show_All()
'        iRootComp.Blank()

'        Dim tmpCs As NXOpen.CartesianCoordinateSystem
'        Dim myGroup As NXObject
'        Dim iRootPath As String = "D:\nxcad\scratch\2022_DB0_069_Picture\Menatsu"
'        'If iCheckExist = False Then
'        Call iResetFolder(iRootPath)
'        'End If

'        Dim ts As TimeSpan
'        ts = New TimeSpan(0, 0, 1)
'        Dim i As Integer
'        For Each iChild As Component In iRootComp.GetChildren
'            'For i = 0 To UBound(iDanmen_Menatsu)
'            '    If iChild.GetStringAttribute("DB_PART_NO").ToString = iDanmen_Menatsu(i) Then


'            'For Each idtRow As DataRow In dtMenatsu.Rows
'            '    l
'            'Next

'            ReDim Preserve iBangouMenatsu(idemBangouMenatsu)
'            iBangouMenatsu(idemBangouMenatsu) = Left(Split(iChild.GetStringAttribute("DB_PART_NAME").ToString, "_")(2), 6) & "@@" & iChild.GetStringAttribute("DB_PART_NO").ToString
'            idemBangouMenatsu += 1
'            'iChild.Blank()
'            Dim tmpGrp As NXOpen.Tag = NXOpen.Tag.Null

'            theUfSession.Obj.CycleObjsInPart(iChild.Prototype.OwningPart.Tag, UFConstants.UF_coordinate_system_type, tmpGrp)

'            myGroup = Utilities.NXObjectManager.Get(tmpGrp)
'            tmpCs = CType(myGroup, NXOpen.CartesianCoordinateSystem)

'            Dim iSectName As String = iChild.GetStringAttribute("DB_PART_NAME").ToString

'            iSectName = Right(Split(iSectName, "_")(2), 1)

'            Call XoayMatPhang(tmpCs, iSectName)


'            iChild.Unblank()


'            theUfSession.Disp.MakeDisplayUpToDate()

'            Call FitView()
'            workpart.Views.Refresh()
'            workpart.ModelingViews.WorkView.Regenerate()

'            workpart.ModelingViews.WorkView.UpdateDisplay()

'            'theUfSession.Disp.Refresh()

'            Dim iSavePath As String
'            iSavePath = iRootPath & "\" & iChild.GetStringAttribute("DB_PART_NAME").ToString & ".png"
'            Call ChupAnh_HideCsys(iSavePath)
'            'Exit Sub
'            iChild.Blank()



'            '    End If
'            'Next

'        Next


'    End Sub

'    Sub ChupAnh_HideCsys(ByVal iSavePath As String)         'Chụp ảnh chỉ Hide CSYS, vẫn hiện điểm
'        Dim theSession As Session = Session.GetSession()
'        Dim theUfSession As UFSession = UFSession.GetUFSession()
'        If IsNothing(theSession.Parts.BaseWork) Then 'active part required
'            Return
'        End If
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As Part = theSession.Parts.Display
'        theSession.DisplayManager.HideByType("SHOW_HIDE_TYPE_CSYS", DisplayManager.ShowHideScope.AnyInAssembly)

'        Dim tempScreenshot As String
'        Dim tempLocation As String = IO.Path.GetTempPath
'        tempScreenshot = IO.Path.Combine(tempLocation, "NXscreenshot.png")

'        Try
'            workPart.Views.FitAll()
'        Catch ex As Exception
'            displayPart.Views.FitAll()
'        End Try
'        Try
'            ExpScrShotToImg(tempScreenshot)
'        Catch ex As Exception

'            Return
'        End Try

'        CropScreenshot(tempScreenshot, 2, iSavePath)

'    End Sub
'    Sub Get_GroupName_GroupTag(ByVal dtInforLineOut As DataTable, ByVal iNo As String, ByRef iGroupName As String, ByRef iGroupTag As String)

'        Dim dtView_iNo As New DataView(dtInforLineOut)
'        dtView_iNo.RowFilter = "[GroupName] like " & "'%" & iNo & "%'"
'        For Each iDtRow As DataRow In dtView_iNo.ToTable.Rows
'            iGroupName = iDtRow("GroupName")
'            iGroupTag = iDtRow("Group Tag")
'            Exit For
'        Next

'    End Sub

'    Sub List_Vitri_Menatsu(ByRef iListMenatsu As List(Of String))
'        Dim dtView_MenatsuType As New DataView(dtExcelOut)
'        dtView_MenatsuType.RowFilter = "([MenatsuTaishou] like 'C' OR [MenatsuTaishou] like 'H')"
'        For Each iDataRow As DataRow In dtView_MenatsuType.ToTable.Rows
'            If iListMenatsu.Contains(iDataRow("Vitri")) = False Then
'                'lw.WriteLine("Vitri: " & iDataRow("Vitri"))
'                iListMenatsu.Add(iDataRow("Vitri"))
'            End If
'        Next
'    End Sub

'    Sub Delete_OldInfo()    'Xóa những dữ liệu cũ của File Excel
'        Dim objWorksheetdtMenatsu = objWorkbook.worksheets("dtMenatsu")
'        If objWorksheetdtMenatsu.FilterMode = True Then
'            objWorksheetdtMenatsu.ShowAllData
'        End If
'        objWorksheetdtMenatsu.Range("B3:Z999999").ClearContents()
'    End Sub
'    Sub TinhDuongKinhLoWasher(ByVal dtInforLineOut As DataTable, ByVal iCurve() As Curve)       'duongkinhloWasher

'        'Tim 


'        'Đường kính lỗ Washer 
'        Dim guess1(2) As Double
'        Dim guess2(2) As Double
'        Dim pt1(2) As Double
'        Dim pt2(2) As Double
'        Dim minDist As Double
'        theUFSession.Modl.AskMinimumDist(iCurve(0).Tag, iCurve(1).Tag, 0, guess1, 0, guess2, minDist, pt1, pt2)
'        Dim iHoleWasherDia As Double    'Đường kính lỗ Washer
'        iHoleWasherDia = minDist

'        For Each idtRow As DataRow In dtInforLineOut.Rows
'            Dim row As DataRow
'            row = dtMenatsu.NewRow
'            row("VI TRI") = Left(Right(idtRow("Sect"), 7), 6).ToString
'            'row("GROUP NAME") = idtRow("GroupName").ToString
'            'row("GROUP TAG") = idtRow("Group Tag").ToString
'            row("MEN NO") = iDemMenNo
'            row("HOLE DIA X") = Math.Round(iHoleWasherDia, 1)
'            row("HOLE DIA Y") = Math.Round(iHoleWasherDia, 1)
'            row("HOLE TYPE") = "丸穴"
'            Dim iArea As Double
'            iArea = 3.14159 * Math.Round(iHoleWasherDia, 1) * Math.Round(iHoleWasherDia, 1) / 4
'            row("HOLE AREA") = iArea
'            dtMenatsu.Rows.Add(row)
'            If iDemMenNo > 1 Then
'                Exit For
'            End If
'            iDemMenNo = iDemMenNo + 1
'        Next

'        ''Bolt Washer chia làm 2 loại: không có 2 cạnh tạo thành lỗ của Washer; có 2 cạnh tạo thành lỗ Washer
'        'Dim iCheckBoltTypeWasher As Boolean       'Biến check loại lỗ Washer

'        'Dim i As Integer
'        'Dim iVitri As String
'        'Dim dtView_SectY As New DataView(dtInforLineOut)
'        'dtView_SectY.RowFilter = "[Sect] like '%Y%'"
'        ''Tính đường kính lỗ của Washer -> add giá trị vào database
'        ''Logic: Tìm 2 curve để đo đường kính d của washer
'        '''Tìm những curve trong Group Bolt, song song với trục Z (a1=1), độ dài nhỏ hơn 6mm, có khoảng cách với iBoltCurve(i) = 0 
'        ''''Tìm curve trong Bolt Group
'        'Dim dtView_Bolt As New DataView(dtView_SectY.ToTable)
'        'dtView_Bolt.RowFilter = "[GroupName] like '%bolt%'"
'        ''''Song song trục Z
'        'Dim dtView_SsZ As New DataView(dtView_Bolt.ToTable)
'        'dtView_SsZ.RowFilter = "[a1] like '%1%'"
'        ''''Độ dài nhỏ hơn 6mm
'        'Dim dtView_Nhohon6 As New DataView(dtView_SsZ.ToTable)
'        'dtView_Nhohon6.RowFilter = "[Line length] < 6"
'        ''''khoảng cách với iBoltCurve(i) = 0

'        'Dim iCurveHoleWasher() As Tag, iDemChua As Integer = 0
'        'Dim iGroupTagFilter As String   'Mảng để lọc lấy những Curve thỏa mãn
'        'For Each iRow As DataRow In dtView_Nhohon6.ToTable.Rows
'        '    Dim iTagCurveChua As Tag = iRow("Object Tag").ToString
'        '    Dim guess1(2) As Double
'        '    Dim guess2(2) As Double
'        '    Dim pt1(2) As Double
'        '    Dim pt2(2) As Double
'        '    Dim minDist As Double
'        '    For i = 0 To 1
'        '        theUFSession.Modl.AskMinimumDist(iBoltCurve(i).Tag, iTagCurveChua, 0, guess1, 0, guess2, minDist, pt1, pt2)         'Mỗi bên lấy 1 Curve => 2 bên là đủ 2 curve
'        '        'iBoltCurve(i).Highlight()
'        '        'lw.WriteLine("mindist: " & minDist)
'        '        If Math.Round(minDist, 2) = 0 Then
'        '            iGroupTagFilter = iGroupTagFilter & "[Object Tag] like " & "'%" & iTagCurveChua & "%' OR "
'        '        End If
'        '    Next

'        'Next
'        'iGroupTagFilter = Left(iGroupTagFilter, Len(iGroupTagFilter) - 4)
'        ''lw.WriteLine(iGroupTagFilter)
'        ''Lọc những curve trong iGroupTagFilter thỏa mãn những điều kiện ở trên -> 2 so sánh khoảng cách tới trục tọa độ, 2 curve gần trục tọa độ nhất là 2 Curve cần tìm
'        'Dim dtView_WasherHoleDia As New DataView(dtInforLineOut)
'        'dtView_WasherHoleDia.RowFilter = iGroupTagFilter
'        'dtView_WasherHoleDia.Sort = "d1"
'        ''Call iPrintInforLine(dtView_WasherHoleDia.ToTable)
'        'For Each idtRow As DataRow In dtView_WasherHoleDia.ToTable.Rows
'        '    Dim iTagCurveChua As Tag = idtRow("Object Tag").ToString
'        '    ReDim Preserve iCurveHoleWasher(iDemChua)
'        '    iCurveHoleWasher(iDemChua) = iTagCurveChua
'        '    'Dim iCurve As Curve = NXObjectManager.Get(iCurveHoleWasher(iDemChua))
'        '    'iCurve.Highlight()
'        '    'iCurveHoleWasher(iDemChua) = NXObjectManager.Get(iTagCurveChua)
'        '    iDemChua = iDemChua + 1
'        '    If iDemChua > 1 Then
'        '        Exit For
'        '    End If
'        'Next

'        ''Đo đường kính lỗ Washer
'        'Dim iHoleWasherDia As Double    'Đường kính lỗ Washer
'        'Dim iguess1(2) As Double
'        'Dim iguess2(2) As Double
'        'Dim ipt1(2) As Double
'        'Dim ipt2(2) As Double
'        'theUFSession.Modl.AskMinimumDist(iCurveHoleWasher(0), iCurveHoleWasher(1), 0, iguess1, 0, iguess2, iHoleWasherDia, ipt1, ipt2)         'Mỗi bên lấy 1 Curve => 2 bên là đủ 2 curve
'        'iHoleWasherDia = Math.Round(iHoleWasherDia, 3)
'        ''lw.WriteLine("iHoleWasherDia: " & iHoleWasherDia)

'        ''Phát hiện trường hợp Bolt Washer thuộc loại không có 2 cạnh tạo thành lỗ của Washer: [giả định Dwasher/H > 1.3 (Chỗ này cần tìm bằng chứng chứng minh)] => thuộc loại không có 2 cạnh tạo thành lỗ của Washer
'        ''lw.WriteLine("iDimH: " & iDimH)
'        'If iHoleWasherDia / iDimH > 1.3 Then
'        '    iHoleWasherDia = iDimH
'        'End If

'        ''Add info vào dtMenatsu: add 2 Curve đầu trong dtView_WasherHoleDia.ToTable
'        'For Each idtRow As DataRow In dtView_WasherHoleDia.ToTable.Rows
'        '    Dim row As DataRow
'        '    row = dtMenatsu.NewRow
'        '    row("VI TRI") = Left(Right(idtRow("Sect"), 7), 6).ToString
'        '    row("GROUP NAME") = idtRow("GroupName").ToString
'        '    row("GROUP TAG") = idtRow("Group Tag").ToString
'        '    row("MEN NO") = iDemMenNo
'        '    row("HOLE DIA X") = iHoleWasherDia
'        '    row("HOLE DIA Y") = iHoleWasherDia
'        '    row("HOLE TYPE") = "丸穴"
'        '    Dim iArea As Double
'        '    iArea = Math.PI * iHoleWasherDia * iHoleWasherDia / 4
'        '    row("HOLE AREA") = iArea
'        '    dtMenatsu.Rows.Add(row)
'        '    If iDemMenNo > 1 Then
'        '        Exit For
'        '    End If
'        '    Try
'        '        row("MATERIAL") = Split(idtRow("GroupName").ToString, "$")(2)
'        '    Catch ex As Exception
'        '        row("MATERIAL") = ""
'        '    End Try

'        '    iDemMenNo = iDemMenNo + 1
'        'Next
'        '''''''''''''''''''''''''''''''
'    End Sub

'    Sub Menatsu_Calculate(ByVal iVitri As String, ByVal iDimensionOutside() As Double)             'tìm d nhỏ để tính menatsu
'        Dim i As Integer = 1
'        Dim iMen1 As Double, iMen2 As Double                'biến so sánh tại những vị trí có 2 mặt menatsu giáp nhau, mặt nào có Menatsu Area nhỏ hơn thì là menatsu cần tìm
'        Dim iMenTG() As Double, iDemMen As Integer = 0        'Tập hợp kết quả đo Menatsu vào 1 mảng
'        For Each dtRow As DataRow In dtMenatsu.Rows
'            If dtRow("VI TRI") = iVitri Then
'                For i = 1 To UBound(iDimensionOutside) + 1
'                    If dtRow("MEN NO").ToString = i.ToString Then
'                        dtRow("DIMENSION OUTSIDE") = Math.Round(iDimensionOutside(i - 1), 1)
'                        dtRow("OUTSIDE AREA") = Math.Round(iDimensionOutside(i - 1), 1) ^ 2 * 3.14159 / 4
'                        dtRow("MENATSU AREA") = CType(dtRow("OUTSIDE AREA"), Double) - CType(dtRow("HOLE AREA"), Double)

'                        'Check trường hợp lỗ OBL dài hơn D
'                        If CType(dtRow("HOLE DIA X"), Double) > CType(dtRow("DIMENSION OUTSIDE"), Double) Or CType(dtRow("HOLE DIA Y"), Double) > CType(dtRow("DIMENSION OUTSIDE"), Double) Then
'                            dtRow("HANDAN") = "CA"
'                            lw.WriteLine("Kích thước lỗ OBL dài hơn D")
'                        End If

'                        ReDim Preserve iMenTG(iDemMen)
'                        iMenTG(iDemMen) = CType(dtRow("OUTSIDE AREA"), Double) - CType(dtRow("HOLE AREA"), Double)
'                        iDemMen = iDemMen + 1
'                        Exit For
'                    End If

'                Next
'            End If
'        Next
'        'Loại bỏ những kết quả menatsu trong mảng iMenTG() không thỏa mãn, đưa giá trị vào mảng iMen() (Mặt Menatsu là mặt có Menatsu Area nhỏ hơn)
'        Dim iMen() As Double
'        iDemMen = 0
'        ReDim Preserve iMen(iDemMen)
'        iMen(iDemMen) = iMenTG(0)
'        iDemMen = iDemMen + 1
'        Try
'            For i = 1 To UBound(iMenTG) - 1 Step 2
'                If iMenTG(i) < iMenTG(i + 1) Then
'                    ReDim Preserve iMen(iDemMen)
'                    iMen(iDemMen) = iMenTG(i)
'                    iDemMen = iDemMen + 1
'                Else
'                    ReDim Preserve iMen(iDemMen)
'                    iMen(iDemMen) = iMenTG(i + 1)
'                    iDemMen = iDemMen + 1
'                End If
'            Next
'        Catch ex As Exception

'        End Try
'        ReDim Preserve iMen(iDemMen)
'        iMen(iDemMen) = iMenTG(UBound(iMenTG))
'        For Each idbl As Double In iMen
'            lw.WriteLine("idbl: " & idbl)
'        Next

'        'Đưa giá trị trong Mảng iMen() vào dtMenatsu
'        'Sử dụng List để loại bỏ trường hợp menatsu area ở 2 mặt giáp nhau có kết quả bằng nhau(do đường kính lỗ d bằng nhau) dẫn tới điền 2 kết quả menatsu trong khi chỉ được điền 1
'        Dim iList As New List(Of String)
'        For Each dtRow As DataRow In dtMenatsu.Rows
'            If dtRow("VI TRI") = iVitri Then
'                Dim iCheck As Boolean = False
'                For i = 0 To UBound(iMen)
'                    If dtRow("MENATSU AREA").ToString = iMen(i).ToString Then
'                        If iList.Contains(iMen(i).ToString & "_" & dtRow("MEN NO")) = False Then
'                            iList.Add(iMen(i).ToString & "_" & dtRow("MEN NO"))
'                            iCheck = True
'                            Exit For
'                        End If
'                    End If
'                Next
'                If iCheck = False Then
'                    dtRow("MENATSU AREA") = ""
'                End If
'            End If
'        Next
'    End Sub

'    Sub Get_dtExcelOut()

'        'Tạo datatable từ file Excel Output ổ D

'        Dim colVitri As Integer = 3
'        Dim colCSFuncNo As Integer = 4
'        Dim colCSPartNo As Integer = 5
'        Dim colX As Integer = 6
'        Dim colY As Integer = 7
'        Dim colZ As Integer = 8
'        Dim colXZ As Integer = 11
'        Dim colYZ As Integer = 12
'        Dim colDanmenBangou As Integer = 13
'        Dim colBoltNo As Integer = 14
'        Dim colNutNo As Integer = 23
'        Dim colClipNo As Integer = 37
'        Dim colMenatsuTaishou As Integer = 47
'        Dim colHoleADiaX As Integer = 48
'        Dim colHoleADiaY As Integer = 49
'        Dim colHoleBDiaX As Integer = 50
'        Dim colHoleBDiaY As Integer = 51
'        Dim colCtrUnMatch As Integer = 56
'        Dim colAInfor As Integer = 57
'        Dim colBInfor As Integer = 58
'        Dim colNutInfor As Integer = 59
'        Dim colBoltInfor As Integer = 60
'        Dim colHoleCDiaX As Integer = 62
'        Dim colHoleCDiaY As Integer = 63
'        Dim colCInfor As Integer = 64
'        Dim colHoleDDiaX As Integer = 65
'        Dim colHoleDDiaY As Integer = 66
'        Dim colDInfor As Integer = 67
'        Dim colHoleEDiaX As Integer = 68
'        Dim colHoleEDIaY As Integer = 69
'        Dim colEInfor As Integer = 70
'        Dim colHoleAType As Integer = 78
'        Dim colHoleBType As Integer = 79
'        Dim colHoleCType As Integer = 80
'        Dim colHoleDType As Integer = 81
'        Dim colHoleEType As Integer = 82


'        Dim i As Integer
'        Dim DataArray(1000000, 35) As Object
'        Dim dtOut As New DataTable
'        dtOut.Columns.Add("Vitri")
'        dtOut.Columns.Add("CSFuncNo")
'        dtOut.Columns.Add("CSPartNo")
'        dtOut.Columns.Add("X")
'        dtOut.Columns.Add("Y")
'        dtOut.Columns.Add("Z")
'        dtOut.Columns.Add("XZ")
'        dtOut.Columns.Add("YZ")
'        dtOut.Columns.Add("DanmenBangou")
'        dtOut.Columns.Add("BoltNo")
'        dtOut.Columns.Add("NutNo")
'        dtOut.Columns.Add("ClipNo")
'        dtOut.Columns.Add("MenatsuTaishou")
'        dtOut.Columns.Add("HoleADiaX")
'        dtOut.Columns.Add("HoleADiaY")
'        dtOut.Columns.Add("HoleBDiaX")
'        dtOut.Columns.Add("HoleBDiaY")
'        dtOut.Columns.Add("CtrUnMatch")
'        dtOut.Columns.Add("AInfor")
'        dtOut.Columns.Add("BInfor")
'        dtOut.Columns.Add("NutInfor")
'        dtOut.Columns.Add("BoltInfor")
'        dtOut.Columns.Add("HoleCDiaX")
'        dtOut.Columns.Add("HoleCDiaY")
'        dtOut.Columns.Add("CInfor")
'        dtOut.Columns.Add("HoleDDiaX")
'        dtOut.Columns.Add("HoleDDiaY")
'        dtOut.Columns.Add("DInfor")
'        dtOut.Columns.Add("HoleEDiaX")
'        dtOut.Columns.Add("HoleEDIaY")
'        dtOut.Columns.Add("EInfor")
'        dtOut.Columns.Add("HoleAType")
'        dtOut.Columns.Add("HoleBType")
'        dtOut.Columns.Add("HoleCType")
'        dtOut.Columns.Add("HoleDType")
'        dtOut.Columns.Add("HoleEType")
'        Dim row As DataRow
'        Dim lngLastRow As Long
'        lngLastRow = ObjWsOut.Cells(26, colVitri).End(xlDown).Row
'        If lngLastRow = 1048576 Then '
'            lngLastRow = 26
'        End If
'        'lw.WriteLine(lngLastRow)
'        'Exit Sub
'        For i = 26 To lngLastRow
'            row = dtOut.NewRow
'            Try
'                DataArray(i - 26, 0) = ObjWsOut.Cells(i, colVitri).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 1) = ObjWsOut.Cells(i, colCSFuncNo).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 2) = ObjWsOut.Cells(i, colCSPartNo).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 3) = ObjWsOut.Cells(i, colX).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 4) = ObjWsOut.Cells(i, colY).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 5) = ObjWsOut.Cells(i, colZ).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 6) = ObjWsOut.Cells(i, colXZ).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 7) = ObjWsOut.Cells(i, colYZ).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 8) = ObjWsOut.Cells(i, colDanmenBangou).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 9) = ObjWsOut.Cells(i, colBoltNo).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 10) = ObjWsOut.Cells(i, colNutNo).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 11) = ObjWsOut.Cells(i, colClipNo).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 12) = ObjWsOut.Cells(i, colMenatsuTaishou).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 13) = ObjWsOut.Cells(i, colHoleADiaX).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 14) = ObjWsOut.Cells(i, colHoleADiaY).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 15) = ObjWsOut.Cells(i, colHoleBDiaX).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 16) = ObjWsOut.Cells(i, colHoleBDiaY).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 17) = ObjWsOut.Cells(i, colCtrUnMatch).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 18) = ObjWsOut.Cells(i, colAInfor).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 19) = ObjWsOut.Cells(i, colBInfor).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 20) = ObjWsOut.Cells(i, colNutInfor).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 21) = ObjWsOut.Cells(i, colBoltInfor).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 22) = ObjWsOut.Cells(i, colHoleCDiaX).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 23) = ObjWsOut.Cells(i, colHoleCDiaY).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 24) = ObjWsOut.Cells(i, colCInfor).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 25) = ObjWsOut.Cells(i, colHoleDDiaX).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 26) = ObjWsOut.Cells(i, colHoleDDiaY).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 27) = ObjWsOut.Cells(i, colDInfor).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 28) = ObjWsOut.Cells(i, colHoleEDiaX).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 29) = ObjWsOut.Cells(i, colHoleEDIaY).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 30) = ObjWsOut.Cells(i, colEInfor).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 31) = ObjWsOut.Cells(i, colHoleAType).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 32) = ObjWsOut.Cells(i, colHoleBType).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 33) = ObjWsOut.Cells(i, colHoleCType).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 34) = ObjWsOut.Cells(i, colHoleDType).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 35) = ObjWsOut.Cells(i, colHoleEType).Value
'            Catch ex As Exception

'            End Try
'            '''
'            'lw.WriteLine(i)
'            'lw.WriteLine(DataArray(i - 26, 0).ToString)
'            Try
'                row("Vitri") = DataArray(i - 26, 0).ToString
'            Catch ex As Exception
'                row("Vitri") = ""
'            End Try
'            Try
'                row("CSFuncNo") = DataArray(i - 26, 1).ToString
'            Catch ex As Exception
'                row("CSFuncNo") = ""
'            End Try
'            Try
'                row("CSPartNo") = DataArray(i - 26, 2).ToString
'            Catch ex As Exception
'                row("CSPartNo") = ""
'            End Try
'            Try
'                row("X") = DataArray(i - 26, 3).ToString
'            Catch ex As Exception
'                row("X") = ""
'            End Try
'            Try
'                row("Y") = DataArray(i - 26, 4).ToString
'            Catch ex As Exception
'                row("Y") = ""
'            End Try
'            Try
'                row("Z") = DataArray(i - 26, 5).ToString
'            Catch ex As Exception
'                row("Z") = ""
'            End Try
'            Try
'                row("XZ") = DataArray(i - 26, 6).ToString
'            Catch ex As Exception
'                row("XZ") = ""
'            End Try
'            Try
'                row("YZ") = DataArray(i - 26, 7).ToString
'            Catch ex As Exception
'                row("YZ") = ""
'            End Try
'            Try
'                row("DanmenBangou") = DataArray(i - 26, 8).ToString
'            Catch ex As Exception
'                row("DanmenBangou") = ""
'            End Try
'            Try
'                row("BoltNo") = DataArray(i - 26, 9).ToString
'            Catch ex As Exception
'                row("BoltNo") = ""
'            End Try
'            Try
'                row("NutNo") = DataArray(i - 26, 10).ToString
'            Catch ex As Exception
'                row("NutNo") = ""
'            End Try
'            Try
'                row("ClipNo") = DataArray(i - 26, 11).ToString
'            Catch ex As Exception
'                row("ClipNo") = ""
'            End Try
'            Try
'                row("MenatsuTaishou") = DataArray(i - 26, 12).ToString
'            Catch ex As Exception
'                row("MenatsuTaishou") = ""
'            End Try
'            Try
'                row("HoleADiaX") = DataArray(i - 26, 13).ToString
'            Catch ex As Exception
'                row("HoleADiaX") = ""
'            End Try
'            Try
'                row("HoleADiaY") = DataArray(i - 26, 14).ToString
'            Catch ex As Exception
'                row("HoleADiaY") = ""
'            End Try
'            Try
'                row("HoleBDiaX") = DataArray(i - 26, 15).ToString
'            Catch ex As Exception
'                row("HoleBDiaX") = ""
'            End Try
'            Try
'                row("HoleBDiaY") = DataArray(i - 26, 16).ToString
'            Catch ex As Exception
'                row("HoleBDiaY") = ""
'            End Try
'            Try
'                row("CtrUnMatch") = DataArray(i - 26, 17).ToString
'            Catch ex As Exception
'                row("CtrUnMatch") = ""
'            End Try
'            Try
'                row("AInfor") = DataArray(i - 26, 18).ToString
'            Catch ex As Exception
'                row("AInfor") = ""
'            End Try
'            Try
'                row("BInfor") = DataArray(i - 26, 19).ToString
'            Catch ex As Exception
'                row("BInfor") = ""
'            End Try
'            Try
'                row("NutInfor") = DataArray(i - 26, 20).ToString
'            Catch ex As Exception
'                row("NutInfor") = ""
'            End Try
'            Try
'                row("BoltInfor") = DataArray(i - 26, 21).ToString
'            Catch ex As Exception
'                row("BoltInfor") = ""
'            End Try
'            Try
'                row("HoleCDiaX") = DataArray(i - 26, 22).ToString
'            Catch ex As Exception
'                row("HoleCDiaX") = ""
'            End Try
'            Try
'                row("HoleCDiaY") = DataArray(i - 26, 23).ToString
'            Catch ex As Exception
'                row("HoleCDiaY") = ""
'            End Try
'            Try
'                row("CInfor") = DataArray(i - 26, 24).ToString
'            Catch ex As Exception
'                row("CInfor") = ""
'            End Try
'            Try
'                row("HoleDDiaX") = DataArray(i - 26, 25).ToString
'            Catch ex As Exception
'                row("HoleDDiaX") = ""
'            End Try
'            Try
'                row("HoleDDiaY") = DataArray(i - 26, 26).ToString
'            Catch ex As Exception
'                row("HoleDDiaY") = ""
'            End Try
'            Try
'                row("DInfor") = DataArray(i - 26, 27).ToString
'            Catch ex As Exception
'                row("DInfor") = ""
'            End Try
'            Try
'                row("HoleEDiaX") = DataArray(i - 26, 28).ToString
'            Catch ex As Exception
'                row("HoleEDiaX") = ""
'            End Try
'            Try
'                row("HoleEDIaY") = DataArray(i - 26, 29).ToString
'            Catch ex As Exception
'                row("HoleEDIaY") = ""
'            End Try
'            Try
'                row("EInfor") = DataArray(i - 26, 30).ToString
'            Catch ex As Exception
'                row("EInfor") = ""
'            End Try
'            Try
'                row("HoleAType") = DataArray(i - 26, 31).ToString
'            Catch ex As Exception
'                row("HoleAType") = ""
'            End Try
'            Try
'                row("HoleBType") = DataArray(i - 26, 32).ToString
'            Catch ex As Exception
'                row("HoleBType") = ""
'            End Try
'            Try
'                row("HoleCType") = DataArray(i - 26, 33).ToString
'            Catch ex As Exception
'                row("HoleCType") = ""
'            End Try
'            Try
'                row("HoleDType") = DataArray(i - 26, 34).ToString
'            Catch ex As Exception
'                row("HoleDType") = ""
'            End Try
'            Try
'                row("HoleEType") = DataArray(i - 26, 35).ToString
'            Catch ex As Exception
'                row("HoleEType") = ""
'            End Try
'            dtOut.Rows.Add(row)
'        Next
'        dtExcelOut = dtOut
'    End Sub

'    Sub Export_to_Excel_Menatsu(ByVal iCompName As String, ByVal iDimension() As Double)
'        Dim i As Integer, j As Integer
'        Dim iStartRow As Integer = 26, iStartCol As Integer = 89
'        Dim lngLastRow As Long
'        lngLastRow = ObjWsOut.Cells(iStartRow, 3).End(xlDown).Row
'        For i = iStartRow To lngLastRow
'            If ObjWsOut.Cells(i, 3).Value = Right(iCompName, 6) Then
'                For j = 0 To UBound(iDimension)
'                    ObjWsOut.Cells(i, j + iStartCol).Value = iDimension(j)
'                Next
'                Exit For
'            End If
'        Next
'    End Sub

'    Sub PMIPointAndPointNew(ByVal ipoint3d1 As Point3d, ByVal ipoint3d2 As Point3d, ByVal icheckSect As String, ByVal tmpCsys As CartesianCoordinateSystem, ByVal iNumtemp As Double, ByVal iCheckHole As String, ByVal iVectorPMI As Vector3d, ByVal iStringDist As String)
'        Dim theSession As Session = Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim theUI As NXOpen.UI = NXOpen.UI.GetUI()
'        Dim idatum As NXOpen.DatumPlane
'        Dim idatumXZ As DatumPlane
'        Dim idatumYZ As DatumPlane
'        Dim CsPoint1 As Point3d  'Diem goc CS
'        Dim point1 As NXOpen.Point

'        CsPoint1 = ipoint3d1
'        point1 = workPart.Points.CreatePoint(CsPoint1)

'        Dim CsPoint2 As Point3d  'Diem goc CS
'        Dim point2 As NXOpen.Point
'        CsPoint2 = ipoint3d2
'        point2 = workPart.Points.CreatePoint(CsPoint2)



'        'theUI.VisualizationLinePreferences.UpdateLineFontObjects(False)
'        displayPart.Preferences.LineVisualization.ShowWidths = True
'        Dim nullNXOpen_Annotations_Dimension As NXOpen.Annotations.Dimension = Nothing
'        Dim pmiLinearDimensionBuilder1 As NXOpen.Annotations.PmiLinearDimensionBuilder = Nothing
'        pmiLinearDimensionBuilder1 = workPart.Dimensions.CreatePmiLinearDimensionBuilder(nullNXOpen_Annotations_Dimension)
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(False)
'        pmiLinearDimensionBuilder1.Origin.Anchor = NXOpen.Annotations.OriginBuilder.AlignmentPosition.MidCenter
'        Dim iNumLayout As Integer
'        If iCheckHole = "C" Then
'            pmiLinearDimensionBuilder1.Measurement.Method = NXOpen.Annotations.DimensionMeasurementBuilder.MeasurementMethod.Cylindrical
'        ElseIf iCheckHole = "CL" Then
'            pmiLinearDimensionBuilder1.Measurement.Method = NXOpen.Annotations.DimensionMeasurementBuilder.MeasurementMethod.PointToPoint
'        Else
'            pmiLinearDimensionBuilder1.Measurement.Method = NXOpen.Annotations.DimensionMeasurementBuilder.MeasurementMethod.PointToPoint
'        End If
'        pmiLinearDimensionBuilder1.Origin.Plane.PlaneMethod = NXOpen.Annotations.PlaneBuilder.PlaneMethodType.ModelView
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        Dim nullNXOpen_Direction As NXOpen.Direction = Nothing
'        pmiLinearDimensionBuilder1.Measurement.Direction = nullNXOpen_Direction
'        Dim nullNXOpen_View As NXOpen.View = Nothing
'        pmiLinearDimensionBuilder1.Measurement.DirectionView = nullNXOpen_View
'        pmiLinearDimensionBuilder1.Style.DimensionStyle.NarrowDisplayType = NXOpen.Annotations.NarrowDisplayOption.None
'        pmiLinearDimensionBuilder1.FirstAssociativity.SetValue(NXOpen.InferSnapType.SnapType.Exist, point1, displayPart.ModelingViews.WorkView, Nothing, Nothing, nullNXOpen_View, Nothing)
'        pmiLinearDimensionBuilder1.FirstAssociativity.SetValue(NXOpen.InferSnapType.SnapType.Exist, point1, displayPart.ModelingViews.WorkView, Nothing, Nothing, nullNXOpen_View, Nothing)
'        Dim objects1(0) As NXOpen.NXObject
'        objects1(0) = point1
'        pmiLinearDimensionBuilder1.AssociatedObjects.Nxobjects.SetArray(objects1)
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        Dim dimensionlinearunits11 As NXOpen.Annotations.DimensionUnit = Nothing
'        dimensionlinearunits11 = pmiLinearDimensionBuilder1.Style.UnitsStyle.DimensionLinearUnits
'        Dim dimensionlinearunits12 As NXOpen.Annotations.DimensionUnit = Nothing
'        dimensionlinearunits12 = pmiLinearDimensionBuilder1.Style.UnitsStyle.DimensionLinearUnits
'        pmiLinearDimensionBuilder1.FirstAssociativity.SetValue(NXOpen.InferSnapType.SnapType.Mid, point1, displayPart.ModelingViews.WorkView, Nothing, Nothing, nullNXOpen_View, Nothing)
'        pmiLinearDimensionBuilder1.SecondAssociativity.SetValue(NXOpen.InferSnapType.SnapType.Mid, point2, displayPart.ModelingViews.WorkView, Nothing, Nothing, nullNXOpen_View, Nothing)

'        Dim objects2(1) As NXOpen.NXObject
'        objects2(0) = point1
'        objects2(1) = point2
'        pmiLinearDimensionBuilder1.AssociatedObjects.Nxobjects.SetArray(objects2)
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiLinearDimensionBuilder1.Origin.Plane.PlaneMethod = NXOpen.Annotations.PlaneBuilder.PlaneMethodType.UserDefined
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        'Dim xform1 As NXOpen.Xform = CType(workPart.FindObject("ENTITY 219 2"), NXOpen.Xform)
'        'Dim iDatumPlane As NXOpen.DatumPlane
'        Dim point3 As Point3d

'        Dim ZVector As Vector3d = New Vector3d(tmpCsys.Orientation.Element.Zx, tmpCsys.Orientation.Element.Zy, tmpCsys.Orientation.Element.Zz)
'        Dim iOrigin As Point3d = New Point3d(tmpCsys.Origin.X, tmpCsys.Origin.Y, tmpCsys.Origin.Z)
'        Dim xform2 As NXOpen.Xform = Nothing
'        xform2 = workPart.Xforms.CreateXformFromCurrentView(NXOpen.SmartObject.UpdateOption.AfterModeling, 1.0)
'        Dim orientation1 As NXOpen.Matrix3x3 = Nothing
'        'orientation1.Xx = -0.0
'        'orientation1.Xy = -0.0
'        'orientation1.Xz = -1.0
'        'orientation1.Yx = 0.0
'        'orientation1.Yy = -1.0
'        'orientation1.Yz = 0.0
'        'orientation1.Zx = -1.0
'        'orientation1.Zy = 0.0
'        'orientation1.Zz = 0.0
'        Dim X1 As Double
'        Dim Y1 As Double
'        Dim Z1 As Double

'        ''point3 = New Point3d(tmpCsys.Origin.X, tmpCsys.Origin.Y, tmpCsys.Origin.Z)
'        If Right(icheckSect, 1) = "X" Then
'            'iDatumPlane = CType(workPart.Datums.FindObject("DATUM_CSYS(0) YZ plane"), NXOpen.DatumPlane)
'            orientation1.Xx = tmpCsys.Orientation.Element.Yx
'            orientation1.Xy = tmpCsys.Orientation.Element.Yy
'            orientation1.Xz = tmpCsys.Orientation.Element.Yz

'            orientation1.Yx = tmpCsys.Orientation.Element.Zx
'            orientation1.Yy = tmpCsys.Orientation.Element.Zy
'            orientation1.Yz = tmpCsys.Orientation.Element.Zz

'            orientation1.Zx = tmpCsys.Orientation.Element.Xx
'            orientation1.Zy = tmpCsys.Orientation.Element.Xy
'            orientation1.Zz = tmpCsys.Orientation.Element.Xz

'            X1 = iOrigin.X + iNumtemp * iVectorPMI.X
'            Y1 = iOrigin.Y + iNumtemp * iVectorPMI.Y
'            Z1 = iOrigin.Z + iNumtemp * iVectorPMI.Z


'            X1 = X1 - 20 * tmpCsys.Orientation.Element.Yx
'            Y1 = Y1 - 20 * tmpCsys.Orientation.Element.Yy
'            Z1 = Z1 - 20 * tmpCsys.Orientation.Element.Yz


'            'X1 = X1 + orientation1.Zx * 20
'            'Y1 = Y1 + orientation1.Zy * 20
'            'Z1 = Z1 + orientation1.Zz * 20

'            'point3 = New Point3d(iDatumPlane.Origin.X + iNumtemp, iDatumPlane.Origin.Y + iNumtemp, iDatumPlane.Origin.Z + iNumtemp)
'            ''Create_LineEquation_From_Point_And_DirectionVector(point3, iVectorPMI, iNumtemp, point3)
'        ElseIf Right(icheckSect, 1) = "Y" Then
'            'iDatumPlane = CType(workPart.Datums.FindObject("DATUM_CSYS(0) XZ plane"), NXOpen.DatumPlane)
'            orientation1.Xx = tmpCsys.Orientation.Element.Xx
'            orientation1.Xy = tmpCsys.Orientation.Element.Xy
'            orientation1.Xz = tmpCsys.Orientation.Element.Xz

'            orientation1.Yx = tmpCsys.Orientation.Element.Zx
'            orientation1.Yy = tmpCsys.Orientation.Element.Zy
'            orientation1.Yz = tmpCsys.Orientation.Element.Zz

'            orientation1.Zx = tmpCsys.Orientation.Element.Yx
'            orientation1.Zy = tmpCsys.Orientation.Element.Yy
'            orientation1.Zz = tmpCsys.Orientation.Element.Yz

'            X1 = iOrigin.X + iNumtemp * iVectorPMI.X
'            Y1 = iOrigin.Y + iNumtemp * iVectorPMI.Y
'            Z1 = iOrigin.Z + iNumtemp * iVectorPMI.Z

'            X1 = X1 - 20 * tmpCsys.Orientation.Element.Xx
'            Y1 = Y1 - 20 * tmpCsys.Orientation.Element.Xy
'            Z1 = Z1 - 20 * tmpCsys.Orientation.Element.Xz
'            'point3 = New Point3d(iOrigin.X + 5 + iNumtemp * iVectorPMI.X, iOrigin.Y + iNumtemp * iVectorPMI.Y, iOrigin.Z + iNumtemp * iVectorPMI.Z)
'            'point3 = New Point3d(iDatumPlane.Origin.X + iNumtemp, iDatumPlane.Origin.Y + iNumtemp, iDatumPlane.Origin.Z + iNumtemp)
'            ''Create_LineEquation_From_Point_And_DirectionVector(point3, iVectorPMI, iNumtemp, point3)
'        End If

'        point3 = New Point3d(X1, Y1, Z1)
'        Dim ipt As NXOpen.Point = workPart.Points.CreatePoint(point3)

'        'ipt.SetVisibility(SmartObject.VisibilityOption.Visible)

'        Dim origin1 As NXOpen.Point3d = point3
'        xform2.SetOrigin(origin1)
'        xform2.SetOrientation(orientation1)

'        'Dim ipt As NXOpen.Point = workPart.Points.CreatePoint(point3)

'        'ipt.SetVisibility(SmartObject.VisibilityOption.Visible)

'        'xform1 = workPart.Xforms.CreateXform(iDatumPlane, NXOpen.SmartObject.UpdateOption.AfterModeling)
'        'Dim cartesianCoordinateSystem1 As NXOpen.CartesianCoordinateSystem = Nothing
'        'cartesianCoordinateSystem1 = workPart.CoordinateSystems.CreateCoordinateSystem(xform1, NXOpen.SmartObject.UpdateOption.AfterModeling)


'        Dim cartesianCoordinateSystem1 As NXOpen.CartesianCoordinateSystem = Nothing
'        cartesianCoordinateSystem1 = workPart.CoordinateSystems.CreateCoordinateSystem(xform2, NXOpen.SmartObject.UpdateOption.AfterModeling)

'        pmiLinearDimensionBuilder1.Origin.Plane.UserDefinedPlane = xform2

'        'pmiLinearDimensionBuilder1.Origin.Plane.UserDefinedPlane = xform1
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)

'        Dim assocOrigin1 As NXOpen.Annotations.Annotation.AssociativeOriginData = Nothing
'        assocOrigin1.OriginType = NXOpen.Annotations.AssociativeOriginType.RelativeToGeometry
'        'assocOrigin1.OriginType = NXOpen.Annotations.AssociativeOriginType.Drag
'        assocOrigin1.View = nullNXOpen_View
'        assocOrigin1.ViewOfGeometry = nullNXOpen_View
'        Dim nullNXOpen_Point As NXOpen.Point = Nothing

'        assocOrigin1.PointOnGeometry = ipt
'        Dim nullNXOpen_Annotations_Annotation As NXOpen.Annotations.Annotation = Nothing
'        assocOrigin1.VertAnnotation = nullNXOpen_Annotations_Annotation
'        assocOrigin1.VertAlignmentPosition = NXOpen.Annotations.AlignmentPosition.TopLeft
'        assocOrigin1.HorizAnnotation = nullNXOpen_Annotations_Annotation
'        assocOrigin1.HorizAlignmentPosition = NXOpen.Annotations.AlignmentPosition.TopLeft
'        assocOrigin1.AlignedAnnotation = nullNXOpen_Annotations_Annotation
'        assocOrigin1.DimensionLine = 0
'        assocOrigin1.AssociatedView = nullNXOpen_View
'        assocOrigin1.AssociatedPoint = nullNXOpen_Point
'        assocOrigin1.OffsetAnnotation = nullNXOpen_Annotations_Annotation
'        assocOrigin1.OffsetAlignmentPosition = NXOpen.Annotations.AlignmentPosition.TopLeft
'        assocOrigin1.XOffsetFactor = 0.0
'        assocOrigin1.YOffsetFactor = 0.0
'        assocOrigin1.StackAlignmentPosition = NXOpen.Annotations.StackAlignmentPosition.Above
'        pmiLinearDimensionBuilder1.Origin.SetAssociativeOrigin(assocOrigin1)
'        pmiLinearDimensionBuilder1.Origin.Origin.SetValue(Nothing, nullNXOpen_View, point3)

'        'pmiLinearDimensionBuilder1.Style.LetteringStyle.DimensionTextSize = 3
'        pmiLinearDimensionBuilder1.Style.LetteringStyle.DimensionTextSize = 3
'        pmiLinearDimensionBuilder1.Style.LetteringStyle.DimensionTextAspectRatio = 0.6
'        pmiLinearDimensionBuilder1.Style.LetteringStyle.DimensionTextCharSpaceFactor = 0.6
'        'pmiLinearDimensionBuilder1.Style.LetteringStyle.GeneralTextSize = 1.5
'        pmiLinearDimensionBuilder1.Style.LineArrowStyle.ArrowheadLength = 3

'        pmiLinearDimensionBuilder1.Style.DimensionStyle.DimensionValuePrecision = 1
'        pmiLinearDimensionBuilder1.Style.DimensionStyle.AngularDimensionValuePrecision = 1

'        pmiLinearDimensionBuilder1.Style.UnitsStyle.DisplayTrailingZeros = True                 '20231107

'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiLinearDimensionBuilder1.Style.LineArrowStyle.LeaderOrientation = NXOpen.Annotations.LeaderSide.Left
'        pmiLinearDimensionBuilder1.Style.DimensionStyle.TextCentered = False
'        Dim lines1(0) As String             'Hiển thị chữ phía trước PMI kích thước
'        lines1(0) = iStringDist
'        pmiLinearDimensionBuilder1.AppendedText.SetBefore(lines1)
'        pmiLinearDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)

'        Dim displayModification1 As NXOpen.DisplayModification = Nothing
'        displayModification1 = theSession.DisplayManager.NewDisplayModification()
'        displayModification1.ApplyToAllFaces = True
'        displayModification1.ApplyToOwningParts = True
'        'displayModification1.NewColor = 31
'        'displayModification1.NewFont = NXOpen.DisplayableObject.ObjectFont.Solid
'        'displayModification1.NewWidth = NXOpen.DisplayableObject.ObjectWidth.Three
'        Dim nXObject1(0) As NXOpen.DisplayableObject
'        nXObject1(0) = pmiLinearDimensionBuilder1.Commit()
'        displayModification1.Apply(nXObject1)
'        displayModification1.Dispose()
'        pmiLinearDimensionBuilder1.Destroy()

'        theSession.CleanUpFacetedFacesAndEdges()

'    End Sub

'    Sub XacDinhTam_Nut(ByVal dtInforLineOut As DataTable, ByRef iNutCtrPoint3d As Point3d)        'Xác định tương đối tâm của Nut
'        Dim dtView_SectY As New DataView(dtInforLineOut)
'        dtView_SectY.RowFilter = "[Sect] like '%Y%'"

'        Dim dtView_Nut As New DataView(dtView_SectY.ToTable)
'        dtView_Nut.RowFilter = "[GroupName] like '%NUT%'"

'        Dim dtView_VuongGoc As New DataView(dtView_Nut.ToTable)
'        dtView_VuongGoc.RowFilter = "[a1] like '%1%'"

'        dtView_VuongGoc.Sort = "d1"

'        Dim iDem As Integer = 0
'        Dim iMidPoint3d() As Point3d
'        For Each iDtRow As DataRow In dtView_VuongGoc.ToTable.Rows
'            ReDim Preserve iMidPoint3d(iDem)
'            iMidPoint3d(iDem).X = iDtRow("Xm")
'            iMidPoint3d(iDem).Y = iDtRow("Ym")
'            iMidPoint3d(iDem).Z = iDtRow("Zm")
'            iDem = iDem + 1
'            If iDem = 2 Then
'                Exit For
'            End If
'        Next

'        iNutCtrPoint3d.X = (iMidPoint3d(0).X + iMidPoint3d(1).X) / 2
'        iNutCtrPoint3d.Y = (iMidPoint3d(0).Y + iMidPoint3d(1).Y) / 2
'        iNutCtrPoint3d.Z = (iMidPoint3d(0).Z + iMidPoint3d(1).Z) / 2
'    End Sub

'    Sub XacDinhCacCurveGiaoDuong45do(ByVal dtInforLineOut As DataTable, ByVal iBoltCurve() As Curve, ByVal iNutCurve() As Curve, ByVal iVectorZ As Vector3d, ByVal iCheckAddInfordtMenatsu As Integer, ByRef iTagCurveGiao45() As Tag, ByVal iListBuhinMenatsu As List(Of String))      'Buhin được sắp xếp theo thứ tự từ Bolt tính đi (mặc định là Nut weld)
'        Dim theSession As Session = Session.GetSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim theUfSession As UFSession = UFSession.GetUFSession()


'        'Call iPrintInforLine(dtInforLineOut)
'        Dim i As Integer
'        Dim dtView_SectY As New DataView(dtInforLineOut)
'        dtView_SectY.RowFilter = "[Sect] like '%Y%'"

'        Dim dtView_HoleType As New DataView(dtView_SectY.ToTable)
'        dtView_HoleType.RowFilter = "[Hole Type] like '%_Dir%'"
'        dtView_HoleType.Sort = "Hole Type"
'        Dim iBuhinList As New List(Of String)
'        For Each iRow As DataRow In dtView_HoleType.ToTable.Rows
'            If iBuhinList.Contains(iRow("Group Tag").ToString) = False Then
'                iBuhinList.Add(iRow("Group Tag").ToString)
'            End If
'        Next

'        Dim iGroupTagFilter As String
'        For Each iGroupTag As String In iBuhinList
'            iGroupTagFilter = iGroupTagFilter & "[Group Tag] like " & "'%" & iGroupTag & "%' OR "
'        Next

'        iGroupTagFilter = Left(iGroupTagFilter, Len(iGroupTagFilter) - 4)
'        'lw.WriteLine("GRtagFilter: " & iGroupTagFilter)

'        Dim dtView_GroupTag As New DataView(dtView_SectY.ToTable)
'        dtView_GroupTag.RowFilter = iGroupTagFilter
'        Dim dtView_VuonggocZ As New DataView(dtView_GroupTag.ToTable)
'        dtView_VuonggocZ.RowFilter = "[a1] like '%0%'"

'        'Tìm các cạnh của Buhin giao với đường 45 độ
'        Dim idem As Integer = 0
'        ReDim Preserve iTagCurveGiao45(idem)

'        '''Đưa Curve Bolt vào mảng iTagCurveGiao45
'        ''''''''''''''''''''''''''''''''''''''''''Xác định Curve đầu tiên để bắt đầu vẽ Curve 45 độ'''''''''''''''''''''''''''''''''''''''''''''''
'        ''''''''Trường hợp Bolt Rokkaku: có sẵn 2 curve của Bolt trong mảng iBoltcurve rồi, giờ chỉ lấy ra thôi. Có 2 curve thì lấy curve nào gần với iBoltCurve(iCheckAddInfordtMenatsu + 2) hơn
'        'lw.WriteLine("Ubound: " & UBound(iBoltCurve))
'        If iCheckBolt_Washer = True Then
'            iTagCurveGiao45(idem) = iBoltCurve(iCheckAddInfordtMenatsu + 2).Tag
'            'Dim iiiCurveTG As Curve = NXObjectManager.Get(iTagCurveGiao45(idem))
'            'iiiCurveTG.Highlight()
'            'lw.WriteLine("iiCurveTG: " & iTagCurveGiao45(idem))
'            idem = idem + 1
'            Dim iminDist As Double = 13072023
'            Dim iCurveTG As Curve
'            For i = 0 To 1
'                Dim guess1(2) As Double
'                Dim guess2(2) As Double
'                Dim pt1(2) As Double
'                Dim pt2(2) As Double
'                Dim minDist As Double
'                theUfSession.Modl.AskMinimumDist(iBoltCurve(iCheckAddInfordtMenatsu + 2).Tag, iBoltCurve(i).Tag, 0, guess1, 0, guess2, minDist, pt1, pt2)
'                If minDist < iminDist Then
'                    iminDist = minDist
'                    iCurveTG = iBoltCurve(i)
'                End If
'            Next
'            ReDim Preserve iTagCurveGiao45(idem)
'            iTagCurveGiao45(idem) = iCurveTG.Tag
'            'Dim iiCurveTG As Curve = NXObjectManager.Get(iTagCurveGiao45(idem))
'            'iiCurveTG.Highlight()
'            'lw.WriteLine("iiCurveTG: " & iTagCurveGiao45(idem))
'            idem = idem + 1
'        Else
'            iTagCurveGiao45(idem) = iBoltCurve(iCheckAddInfordtMenatsu).Tag
'            idem = idem + 1
'        End If
'        ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

'        'Tìm cạnh của buhin awase với Bolt
'        Dim iCheck As Boolean = False, iListObjTagTG As New List(Of String), iListGrouptagTG As New List(Of String)

'        '''Dim iHoleArea1 As Double = 0, iHoleArea2 As Double = 0
'        'Dim idemcheck As Integer = 1
'        Do
'            'lw.WriteLine("1")
'            iCheck = False
'            Dim iGroupTagTG As String = ""   ', iGroupTagTG1 As String 
'            ''''''
'            Dim iLenTG1 As Double = 13042000, iTagCurve1 As Tag
'            Dim iMinLenToCsys As Double = 13042000                  'mảng này để phòng trường hợp có nhiều hơn 1 curve thỏa mãn các điều kiện thì lấy curve gần Csys hơn
'            Dim iRow As DataRow
'            Dim iCheckCL1mm As Boolean = True           'Biến Check xem có CL 1mm hay không
'            'Dim iTagCurveGiao45TG() As Tag, aDem As Integer = 0                  'mảng này để phòng trường hợp có nhiều hơn 1 curve thỏa mãn các điều kiện thì lấy curve gần Csys hơn
'            For Each iDataRow As DataRow In dtView_VuonggocZ.ToTable.Rows
'                'lw.WriteLine("2")
'                Dim iTagCurveTG As Tag = iDataRow("Object Tag").ToString
'                Dim iiGroupTagTG As String = iDataRow("Group Tag").ToString
'                Dim guess1(2) As Double
'                Dim guess2(2) As Double
'                Dim pt1(2) As Double
'                Dim pt2(2) As Double
'                Dim minDist As Double
'                theUfSession.Modl.AskMinimumDist(iTagCurveTG, iTagCurveGiao45(idem - 1), 0, guess1, 0, guess2, minDist, pt1, pt2)

'                Dim iiCurveTG As Curve = NXObjectManager.Get(iTagCurveTG)
'                'iiCurveTG.Highlight()
'                'lw.WriteLine("iiCurveTG: " & iTagCurveTG)
'                'lw.WriteLine("minDist: " & minDist)

'                If Math.Round(minDist, 2) < 0.04 Or Math.Round(minDist, 4) = 0.5 Then     '20231024
'                    'lw.WriteLine("3")
'                    If iListObjTagTG.Contains(iiGroupTagTG) = False Or iiGroupTagTG = iGroupTagTG Then         'điều kiện này để tránh tìm lại curve của buhin cũ     !!!Xử lý tiếp câu này: trường hợp curve không thỏa mãn được xét trước thì curve thỏa mãn phía sau bị trùng Group không vào đc
'                        'lw.WriteLine("4")
'                        If iiGroupTagTG <> iGroupTagTG Then
'                            'lw.WriteLine("5")
'                            iGroupTagTG = iiGroupTagTG
'                            iListObjTagTG.Add(iGroupTagTG)
'                        End If
'                        If iMinLenToCsys > iDataRow("d1") Then          'trong trường hợp nhiều curve thỏa mãn thì lấy curve gần hệ tọa độ hơn
'                            iCheck = True
'                            iMinLenToCsys = iDataRow("d1")
'                            ReDim Preserve iTagCurveGiao45(idem)
'                            iTagCurveGiao45(idem) = iTagCurveTG
'                            iCheckCL1mm = False
'                            'lw.WriteLine("hahahahaha")
'                            iRow = iDataRow

'                            'Add vào List để biết được những Buhin tham gia vào Menatsu => xóa những Buhin KHÔNG tham gia vào Menatsu
'                            If iListBuhinMenatsu.Contains(iDataRow("GroupName")) = False Then
'                                iListBuhinMenatsu.Add(iDataRow("GroupName"))
'                            End If
'                        End If
'                    End If
'                End If
'            Next
'            'Trường hợp không tìm thấy Curve Awase hoặc CL 0.5mm thì tìm xem có Curve nào thỏa mãn điều kiện CL 1mm hay không
'            If iCheckCL1mm = True Then
'                For Each iDataRow As DataRow In dtView_VuonggocZ.ToTable.Rows
'                    'lw.WriteLine("2")
'                    Dim iTagCurveTG As Tag = iDataRow("Object Tag").ToString
'                    Dim iiGroupTagTG As String = iDataRow("Group Tag").ToString
'                    Dim guess1(2) As Double
'                    Dim guess2(2) As Double
'                    Dim pt1(2) As Double
'                    Dim pt2(2) As Double
'                    Dim minDist As Double
'                    theUfSession.Modl.AskMinimumDist(iTagCurveTG, iTagCurveGiao45(idem - 1), 0, guess1, 0, guess2, minDist, pt1, pt2)

'                    Dim iiCurveTG As Curve = NXObjectManager.Get(iTagCurveTG)
'                    ''''''iiCurveTG.Highlight()
'                    ''''''lw.WriteLine("iiCurveTG: " & iTagCurveTG)
'                    ''''''lw.WriteLine("minDist: " & minDist)

'                    If Math.Round(minDist, 4) = 1 Then
'                        'lw.WriteLine("3")
'                        If iListObjTagTG.Contains(iiGroupTagTG) = False Or iiGroupTagTG = iGroupTagTG Then         'điều kiện này để tránh tìm lại curve của buhin cũ     !!!Xử lý tiếp câu này: trường hợp curve không thỏa mãn được xét trước thì curve thỏa mãn phía sau bị trùng Group không vào đc
'                            'lw.WriteLine("4")
'                            If iiGroupTagTG <> iGroupTagTG Then
'                                'lw.WriteLine("5")
'                                iGroupTagTG = iiGroupTagTG
'                                iListObjTagTG.Add(iGroupTagTG)
'                            End If
'                            If iMinLenToCsys > iDataRow("d1") Then          'trong trường hợp nhiều curve thỏa mãn thì lấy curve gần hệ tọa độ hơn
'                                iCheck = True
'                                iMinLenToCsys = iDataRow("d1")
'                                ReDim Preserve iTagCurveGiao45(idem)
'                                iTagCurveGiao45(idem) = iTagCurveTG
'                                iCheckCL1mm = False
'                                'lw.WriteLine("eeeeeeeeeeeeeeeeeeeeeeeeeeeee")
'                                iRow = iDataRow

'                                'Add vào List để biết được những Buhin tham gia vào Menatsu => xóa những Buhin KHÔNG tham gia vào Menatsu
'                                If iListBuhinMenatsu.Contains(iDataRow("GroupName")) = False Then
'                                    iListBuhinMenatsu.Add(iDataRow("GroupName"))
'                                End If
'                            End If
'                        End If
'                    End If
'                Next
'            End If



'            If iCheck = False Then
'                Exit Do
'            Else
'                'Gán giá trị vào dtMenatsu
'                If iCheckAddInfordtMenatsu = 0 Then

'                    Call Add_Infor_dtMenatsu(iRow, iDemMenNo)
'                End If
'                idem = idem + 1
'            End If

'            'If iHoleArea1 >= iHoleArea2 Then
'            '    ReDim Preserve iArrHoleArea(iDemMenNo - 2)
'            '    iArrHoleArea(iDemMenNo - 2) = iHoleArea1
'            'Else
'            '    ReDim Preserve iArrHoleArea(iDemMenNo - 2)
'            '    iArrHoleArea(iDemMenNo - 2) = iHoleArea2
'            'End If

'            iCheck = False
'            'Tìm cạnh còn lại:  Cạnh cần tìm có: 1.Khoảng cách tới cạnh tìm đc ở trên ngắn nhất,     2.Cùng Group với cạnh tìm đc ở trên,       3.Cos của 2 điểm đo và trục Z bằng 0, 
'            Dim iLenTG As Double = 13042000, iTagCurve As Tag
'            iMinLenToCsys = 13042000
'            For Each iDataRow As DataRow In dtView_VuonggocZ.ToTable.Rows
'                If iDataRow("Group Tag").ToString = iGroupTagTG Then
'                    Dim iTagCurveTG As Tag = iDataRow("Object Tag").ToString
'                    Dim guess1(2) As Double
'                    Dim guess2(2) As Double
'                    Dim pt1(2) As Double
'                    Dim pt2(2) As Double
'                    Dim minDist As Double
'                    theUfSession.Modl.AskMinimumDist(iTagCurveTG, iTagCurveGiao45(idem - 1), 0, guess1, 0, guess2, minDist, pt1, pt2)
'                    If Math.Round(iLenTG, 2) >= Math.Round(minDist, 2) And Math.Round(minDist, 2) <> 0 And iMinLenToCsys > iDataRow("d1") Then
'                        Dim a As Double
'                        a = CosOf2Line(New Point3d(0, 0, 0), New Point3d(iVectorZ.X, iVectorZ.Y, iVectorZ.Z), New Point3d(pt1(0), pt1(1), pt1(2)), New Point3d(pt2(0), pt2(1), pt2(2)))
'                        If Math.Abs(Math.Round(a, 2)) = 1 Then
'                            iLenTG = minDist
'                            iTagCurve = iTagCurveTG
'                            iMinLenToCsys = iDataRow("d1")
'                            iRow = iDataRow
'                            iCheck = True

'                            'Add vào List để biết được những Buhin tham gia vào Menatsu => xóa những Buhin KHÔNG tham gia vào Menatsu
'                            If iListBuhinMenatsu.Contains(iDataRow("GroupName")) = False Then
'                                iListBuhinMenatsu.Add(iDataRow("GroupName"))
'                            End If
'                        End If
'                    End If
'                End If
'            Next
'            If iCheck = True Then
'                'Gán giá trị vào dtMenatsu
'                If iCheckAddInfordtMenatsu = 0 Then
'                    Call Add_Infor_dtMenatsu(iRow, iDemMenNo + 1)
'                    'lw.WriteLine("iiiiiidemmenno: " & iDemMenNo)
'                    iDemMenNo = iDemMenNo + 1
'                End If
'            End If
'            ReDim Preserve iTagCurveGiao45(idem)
'            iTagCurveGiao45(idem) = iTagCurve
'            idem = idem + 1
'        Loop While iCheck = True

'        '''Đưa Curve Nut vào mảng iTagCurveGiao45
'        'For Each iNCurve As Curve In iNutCurve
'        '    For Each iTag As Tag In iTagCurveGiao45
'        '        Dim guess1(2) As Double
'        '        Dim guess2(2) As Double
'        '        Dim pt1(2) As Double
'        '        Dim pt2(2) As Double
'        '        Dim minDist As Double
'        '        theUfSession.Modl.AskMinimumDist(iTag, iNCurve.Tag, 0, guess1, 0, guess2, minDist, pt1, pt2)
'        '        If Math.Round(minDist, 2) = 0 Then
'        '            ReDim Preserve iTagCurveGiao45(idem)
'        '            iTagCurveGiao45(idem) = iNCurve.Tag
'        '            idem = idem + 1
'        '        End If
'        '    Next
'        'Next

'        Dim iCheckCurveCuoi As Boolean = False          'Phát sinh trường hợp xuất hiện kanshou, CL dẫn đến Curve cuối không đến được Nut, khi đó set iCheckCorrect = False
'        For i = 0 To 1
'            'For Each iTag As Tag In iTagCurveGiao45
'            Dim guess1(2) As Double
'            Dim guess2(2) As Double
'            Dim pt1(2) As Double
'            Dim pt2(2) As Double
'            Dim minDist As Double
'            theUfSession.Modl.AskMinimumDist(iTagCurveGiao45(idem - 1), iNutCurve(i).Tag, 0, guess1, 0, guess2, minDist, pt1, pt2)
'            If Math.Round(minDist, 2) <= 0.04 Then
'                ReDim Preserve iTagCurveGiao45(idem)
'                iTagCurveGiao45(idem) = iNutCurve(i).Tag
'                idem = idem + 1
'                iCheckCurveCuoi = True
'                Exit For
'            End If
'            'Next
'        Next
'        If iCheckCurveCuoi = False Then
'            lw.WriteLine("Xuat hien 干渉 hoac CL")
'            iCheckCorrect = False
'        End If



'        If iCheckNut_Washer = True Then
'            'Add Curve Washer vào mảng iTagCurveGiao45
'            Dim iminDist As Double = 13072023
'            Dim iCurveTG As Curve
'            For i = 2 To 3
'                Dim guess1(2) As Double
'                Dim guess2(2) As Double
'                Dim pt1(2) As Double
'                Dim pt2(2) As Double
'                Dim minDist As Double
'                theUfSession.Modl.AskMinimumDist(iNutCurve(i).Tag, iTagCurveGiao45(idem - 1), 0, guess1, 0, guess2, minDist, pt1, pt2)
'                If minDist < iminDist Then
'                    iminDist = minDist
'                    iCurveTG = iNutCurve(i)
'                End If
'            Next
'            ReDim Preserve iTagCurveGiao45(idem)
'            iTagCurveGiao45(idem) = iCurveTG.Tag
'        End If

'        'Call iPrintInforLine()

'        '''For Each iTag As Tag In iTagCurveGiao45
'        '''    Dim iObj As NXObject = Nothing
'        '''    iObj = NXObjectManager.Get(iTag)
'        '''    Dim iCurve As Curve = CType(iObj, Curve)
'        '''Next
'    End Sub
'    Sub DoKichThuocTheoPhuong(ByVal iPoint1 As NXOpen.Point, ByVal iPoint2 As NXOpen.Point, ByVal iVector As Vector3d, ByRef giatri As Double)
'        Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display

'        Dim nullNXOpen_NXObject As NXOpen.NXObject = Nothing
'        Dim measureDistanceBuilder1 As NXOpen.MeasureDistanceBuilder = Nothing
'        measureDistanceBuilder1 = workPart.MeasureManager.CreateMeasureDistanceBuilder(nullNXOpen_NXObject)
'        measureDistanceBuilder1.Mtype = NXOpen.MeasureDistanceBuilder.MeasureType.Minimum
'        Dim unit1 As NXOpen.Unit = CType(workPart.UnitCollection.FindObject("MilliMeter"), NXOpen.Unit)
'        Dim expression1 As NXOpen.Expression = Nothing
'        expression1 = workPart.Expressions.CreateSystemExpressionWithUnits("0", unit1)
'        Dim direction1 As NXOpen.Direction = Nothing
'        direction1 = workPart.Directions.CreateDirection(iPoint1, iVector)
'        measureDistanceBuilder1.ProjectionVector = direction1
'        measureDistanceBuilder1.Object1.Value = iPoint1
'        measureDistanceBuilder1.Object2.Value = iPoint2
'        Dim object1 As Object = CType(iPoint1, Object)
'        Dim object2 As Object = CType(iPoint2, Object)
'        Dim measureDistance1 As NXOpen.MeasureDistance = Nothing
'        measureDistance1 = workPart.MeasureManager.NewDistance(unit1, iPoint1, iPoint2, direction1)
'        giatri = measureDistance1.Value
'        Dim datadeleted1 As Boolean = Nothing
'        datadeleted1 = theSession.DeleteTransientDynamicSectionCutData()
'        measureDistanceBuilder1.Destroy()
'        workPart.Expressions.Delete(expression1)
'    End Sub
'    Sub TaoCurve45do(ByVal iWidthBolt As Double, ByVal iWidthNut As Double, ByVal tmpCsys As NXOpen.CartesianCoordinateSystem, ByVal iBaseVecTor As Vector3d, ByVal iTagCurveGiao45() As Tag, ByRef iCurve45() As Curve)
'        Dim theSession As Session = Session.GetSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim theUfSession As UFSession = UFSession.GetUFSession()

'        Dim iVector3dTG As Vector3d, iPoint3dTG As Point3d
'        'Duong 45 do ve tu Bolt
'        Dim iObj As NXObject = Nothing
'        iObj = NXObjectManager.Get(iTagCurveGiao45(0))  '''''''''''''''
'        Dim iCurve As Curve = CType(iObj, Curve)
'        Dim iP1, iP2 As NXOpen.Point, iP13d, iP23d As NXOpen.Point3d, iStartPoint As NXOpen.Point, iStartPoint3d As NXOpen.Point3d
'        Call Start_End_Mid_Point_ForCurve(iCurve, iP1, iP2, Nothing)
'        Call Create_Point3D_From_Point(iP1, iP13d)
'        Call Create_Point3D_From_Point(iP2, iP23d)
'        Dim iDirVector As Vector3d
'        Call Create_DirectionVector_From_2_Point3D(iP13d, iP23d, iDirVector)
'        Dim iPointCsys As NXOpen.Point = workPart.Points.CreatePoint(tmpCsys.Origin)
'        Dim iDis1, iDis2, iDis As Double
'        Call DoKichThuocTheoPhuong(iPointCsys, iP1, iDirVector, iDis1)
'        Call DoKichThuocTheoPhuong(iPointCsys, iP2, iDirVector, iDis2)
'        If iDis1 < iDis2 Then
'            iDis = iDis1
'            iStartPoint = iP1
'            iStartPoint3d = iP13d
'            Call Create_DirectionVector_From_2_Point3D(iP13d, iP23d, iDirVector)
'        Else
'            iDis = iDis2
'            iStartPoint = iP2
'            iStartPoint3d = iP23d
'            Call Create_DirectionVector_From_2_Point3D(iP23d, iP13d, iDirVector)
'        End If
'        Dim iPoint45 As NXOpen.Point, iPoint3d45 As Point3d, iPointTG1, iPointTG2 As NXOpen.Point, iPoint3dTG1, iPoint3dTG2 As Point3d
'        Call Create_LineEquation_From_Point_And_DirectionVector_1(iStartPoint3d, iDirVector, iWidthBolt / 2 - iDis, iPoint3d45)
'        Call Create_LineEquation_From_Point_And_DirectionVector_1(iPoint3d45, iBaseVecTor, 10, iPoint3dTG1)
'        Call Create_LineEquation_From_Point_And_DirectionVector_1(iPoint3dTG1, iDirVector, 10, iPoint3dTG2)
'        ReDim Preserve iCurve45(0)
'        iCurve45(0) = workPart.Curves.CreateLine(iPoint3d45, iPoint3dTG2)
'        'Tìm điểm đặt PMI
'        'iVector3dTG = Create_DirectionVector_From_2_Point3D(iPoint3d45, iPoint3dTG2)
'        Call Create_LineEquation_From_Point_And_DirectionVector_1(iPoint3d45, iDirVector, 30, iPoint3dTG)
'        'Dim ip As NXOpen.Point = workPart.Points.CreatePoint(iPoint3dTG)
'        'ip.SetVisibility(SmartObject.VisibilityOption.Visible)

'        'iCurve.Highlight()
'        'iCurve45(0).Highlight()
'        'tmpCsys.Highlight()
'        'lw.WriteLine("iudsbjcdsnck: " & iPoint3dTG.ToString)
'        Call PMIAngle(tmpCsys, iCurve, iCurve45(0), iPoint3dTG, Nothing)



'        'Duong 45 do ve tu Nut
'        iObj = Nothing
'        iObj = NXObjectManager.Get(iTagCurveGiao45(UBound(iTagCurveGiao45)))
'        iCurve = CType(iObj, Curve)
'        Dim iiP1, iiP2 As NXOpen.Point, iiP13d, iiP23d As NXOpen.Point3d, iiStartPoint As NXOpen.Point, iiStartPoint3d As NXOpen.Point3d
'        Call Start_End_Mid_Point_ForCurve(iCurve, iiP1, iiP2, Nothing)
'        Call Create_Point3D_From_Point(iiP1, iiP13d)
'        Call Create_Point3D_From_Point(iiP2, iiP23d)
'        Dim iiDirVector As Vector3d
'        Call Create_DirectionVector_From_2_Point3D(iiP13d, iiP23d, iiDirVector)
'        Dim iiPointCsys As NXOpen.Point = workPart.Points.CreatePoint(tmpCsys.Origin)
'        Dim iiDis1, iiDis2, iiDis As Double
'        Call DoKichThuocTheoPhuong(iiPointCsys, iiP1, iiDirVector, iiDis1)
'        Call DoKichThuocTheoPhuong(iiPointCsys, iiP2, iiDirVector, iiDis2)
'        If iiDis1 < iiDis2 Then
'            iiDis = iiDis1
'            iiStartPoint = iiP1
'            iiStartPoint3d = iiP13d
'            Call Create_DirectionVector_From_2_Point3D(iiP13d, iiP23d, iiDirVector)
'        Else
'            iiDis = iiDis2
'            iiStartPoint = iiP2
'            iiStartPoint3d = iiP23d
'            Call Create_DirectionVector_From_2_Point3D(iiP23d, iiP13d, iiDirVector)
'        End If
'        Dim iiPoint45 As NXOpen.Point, iiPoint3d45 As Point3d, iiPointTG1, iiPointTG2 As NXOpen.Point, iiPoint3dTG1, iiPoint3dTG2 As Point3d
'        Call Create_LineEquation_From_Point_And_DirectionVector_1(iiStartPoint3d, iiDirVector, iWidthNut / 2 - iiDis, iiPoint3d45)
'        Call Create_LineEquation_From_Point_And_DirectionVector_1(iiPoint3d45, iBaseVecTor, -10, iiPoint3dTG1)
'        Call Create_LineEquation_From_Point_And_DirectionVector_1(iiPoint3dTG1, iiDirVector, 10, iiPoint3dTG2)
'        ReDim Preserve iCurve45(1)
'        iCurve45(1) = workPart.Curves.CreateLine(iiPoint3d45, iiPoint3dTG2)

'        'Tìm điểm đặt PMI
'        'iVector3dTG = Create_DirectionVector_From_2_Point3D(iPoint3d45, iPoint3dTG2)
'        Call Create_LineEquation_From_Point_And_DirectionVector_1(iiPoint3d45, iiDirVector, 30, iPoint3dTG)
'        'Dim iip As NXOpen.Point = workPart.Points.CreatePoint(iPoint3dTG)
'        'iip.SetVisibility(SmartObject.VisibilityOption.Visible)
'        Call PMIAngle(tmpCsys, iCurve, iCurve45(1), iPoint3dTG, Nothing)
'    End Sub

'    Sub TimGiaoDiemVoiDuong45Do(ByVal iTagCurveGiao45() As Tag, ByVal iTagGroupGiao45() As Tag, ByVal iCurve45() As Curve, ByRef iPoint3dGiaoBolt() As Point3d, ByRef iPoint3dGiaoNut() As Point3d)
'        Dim theSession As Session = Session.GetSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim theUfSession As UFSession = UFSession.GetUFSession()

'        Dim i As Integer = 0, iDem As Integer = 0
'        'Dim iListPoint3dGiaoBolt As New List(Of String), iListPoint3dGiaoNut As New List(Of String)
'        'lw.WriteLine("ub: " & UBound(iTagCurveGiao45))

'        'tìm giao của iCurve45(0): Curve vẽ từ phía Bolt
'        'For i = 1 To UBound(iTagCurveGiao45) - 1
'        For i = 0 To UBound(iTagCurveGiao45)
'            Dim iIntersectionPoint3d As Point3d 'Sẽ được chọn làm giao điểm với đường 45 độ nếu khoảng cách minDist = 0

'            Dim guess1(2) As Double
'            Dim guess2(2) As Double
'            Dim pt1(2) As Double
'            Dim pt2(2) As Double
'            Dim minDist As Double
'            theUfSession.Modl.AskMinimumDist(iCurve45(0).Tag, iTagCurveGiao45(i), 0, guess1, 0, guess2, minDist, pt1, pt2)
'            'Dim iP3d As Point3d 'làm tròn rồi đưa vào mảng

'            'trường hợp nếu minDist <> 0 (k giao với đường 45 độ) thì iIntersectionPoint3d được xác định bằng sub Timgiaodiem2duongthang
'            Dim iPoint3d1 As Point3d, iPoint3d2 As Point3d, iPoint3d3 As Point3d, iPoint3d4 As Point3d
'            Dim iCurveGiao45 As Curve = NXObjectManager.Get(iTagCurveGiao45(i))
'            Call Start_End_Mid_Point_ForCurve(iCurveGiao45, iPoint3d1, iPoint3d2, Nothing)
'            'lw.WriteLine("asdkjfnsdakjncsnadkj: " & minDist)
'            If minDist = 0 Then
'                iIntersectionPoint3d = New Point3d(pt1(0), pt1(1), pt1(2))
'                'lw.WriteLine("ip3dnut: " & iPoint3d.ToString)
'                'iP3d = New Point3d(Math.Round(pt1(0), 0), Math.Round(pt1(1), 0), Math.Round(pt1(2), 0))
'            Else
'                Call Start_End_Mid_Point_ForCurve(iCurve45(0), iPoint3d3, iPoint3d4, Nothing)
'                Call Timgiaodiem2duongthang(iPoint3d1, iPoint3d2, iPoint3d3, iPoint3d4, iIntersectionPoint3d)
'                'lw.WriteLine(iIntersectionPoint3d.ToString)
'                'iP3d = New Point3d(Math.Round(iIntersectionPoint3d.X, 0), Math.Round(iIntersectionPoint3d.Y, 0), Math.Round(iIntersectionPoint3d.Z, 0))
'            End If

'            'lw.WriteLine("Intersectb: " & iIntersectionPoint3d.ToString)
'            'lw.WriteLine("iP3dBolt: " & iP3d.ToString)

'            Dim iCheckLikeGroupTag As Boolean = False       'Nếu iTagCurveGiao45(i) và iTagCurveGiao45(i-1) cùng Group Tag (iTagGroupGiao45(i) = iTagGroupGiao45(i - 1)) thì chấp thuận CL 0.5mm và CL 1mm vì khi đó 0.5mm và 1mm là độ dày tấm, không phải CL)
'            If iDem <> 0 Then
'                If iTagGroupGiao45(i) = iTagGroupGiao45(i - 1) Then
'                    iCheckLikeGroupTag = True
'                End If
'            End If
'            'có trường hợp 2 điểm iPoint3dGiaoBolt(iDem) cạnh nhau trùng khít lên nhau hoặc cách nhau 1 đoạn nhỏ. Nếu khoảng cách 2 điểm nhỏ hơn ? thì coi như 2 điểm trùng nhau, chỉ lấy 1,
'            'Nếu khoảng cách 2 điểm > ? thì phải xét thêm điều kiện góc tạo bởi 2 điểm này phải xấp xỉ = 0
'            ''Lỗi này xảy ra do sub Timgiaodiem2duongthang có thể xuất hiện sai số nhỏ do tính toán làm tròn,...

'            Dim iCheckAddNewPoint As Boolean = False
'            Dim iLength As Double
'            If iDem <> 0 Then           'iDem = 0 la điểm đầu tiên của mảng iPoint3dGiaoBolt()
'                Call GetLength2Point3D(iPoint3dGiaoBolt(iDem - 1), iIntersectionPoint3d, iLength)
'            End If
'            If iCheckLikeGroupTag = True Then       'Trường hợp cùng Group Tag
'                If iLength > 0.2 Then
'                    Dim iCos As Double
'                    iCos = CosOf2Line(iPoint3dGiaoBolt(iDem - 1), iIntersectionPoint3d, iPoint3d1, iPoint3d2)
'                    If Math.Abs(Math.Round(iCos, 2)) <> 1 Then
'                        iCheckAddNewPoint = True
'                    End If
'                End If
'            Else                                    'Trường hợp khác Group Tag
'                If iLength > 0.2 And Math.Round(iLength, 4) <> 0.7071 And Math.Round(iLength, 4) <> 1.4142 Then         'Math.Round(iLength, 5) <> 0.70711 là khoảng cách của 2 điểm nếu xuất hiện CL 0.5; Math.Round(iLength, 5) <> 1.41421 là khoảng cách của 2 điểm nếu xuất hiện CL 1
'                    Dim iCos As Double
'                    iCos = CosOf2Line(iPoint3dGiaoBolt(iDem - 1), iIntersectionPoint3d, iPoint3d1, iPoint3d2)
'                    If Math.Abs(Math.Round(iCos, 2)) <> 1 Then
'                        iCheckAddNewPoint = True
'                    End If
'                End If
'            End If
'            'lw.WriteLine("iCos: " & iCos)

'            'If iListPoint3dGiaoBolt.Contains(iP3d.ToString) = False Then
'            '    iListPoint3dGiaoBolt.Add(iP3d.ToString)
'            If iCheckAddNewPoint = True Or iDem = 0 Then
'                'lw.WriteLine("ip3db: " & iP3d.ToString)
'                'lw.WriteLine("iDemBolt:" & iDem)
'                ReDim Preserve iPoint3dGiaoBolt(iDem)
'                iPoint3dGiaoBolt(iDem) = iIntersectionPoint3d
'                iDem = iDem + 1
'                'Dim iPoint As NXOpen.Point = workPart.Points.CreatePoint(iIntersectionPoint3d)
'                'iPoint.SetVisibility(SmartObject.VisibilityOption.Visible)
'                'lw.WriteLine("Bolt: " & iPoint3d.ToString & " _ " & iTagCurveGiao45(i).ToString)
'            End If
'        Next

'        iDem = iDem - 1
'        ReDim Preserve iPoint3dGiaoNut(iDem)
'        'tìm giao của iCurve45(1): Curve vẽ từ phía Nut
'        'For i = UBound(iTagCurveGiao45) - 1 To 1 Step -1
'        For i = UBound(iTagCurveGiao45) To 0 Step -1
'            Dim iIntersectionPoint3d As Point3d

'            Dim guess1(2) As Double
'            Dim guess2(2) As Double
'            Dim pt1(2) As Double
'            Dim pt2(2) As Double
'            Dim minDist As Double
'            theUfSession.Modl.AskMinimumDist(iCurve45(1).Tag, iTagCurveGiao45(i), 0, guess1, 0, guess2, minDist, pt1, pt2)
'            'Dim iP3d As Point3d 'làm tròn rồi đưa vào mảng

'            'trường hợp nếu minDist <> 0 (k giao với đường 45 độ) thì iIntersectionPoint3d được xác định bằng sub Timgiaodiem2duongthang
'            Dim iPoint3d1 As Point3d, iPoint3d2 As Point3d, iPoint3d3 As Point3d, iPoint3d4 As Point3d
'            Dim iCurveGiao45 As Curve = NXObjectManager.Get(iTagCurveGiao45(i))
'            Call Start_End_Mid_Point_ForCurve(iCurveGiao45, iPoint3d1, iPoint3d2, Nothing)
'            If minDist = 0 Then
'                iIntersectionPoint3d = New Point3d(pt1(0), pt1(1), pt1(2))
'                'lw.WriteLine("ip3dnut: " & iPoint3d.ToString)
'                'iP3d = New Point3d(Math.Round(pt1(0), 0), Math.Round(pt1(1), 0), Math.Round(pt1(2), 0))
'            Else
'                Call Start_End_Mid_Point_ForCurve(iCurve45(1), iPoint3d3, iPoint3d4, Nothing)
'                Call Timgiaodiem2duongthang(iPoint3d1, iPoint3d2, iPoint3d3, iPoint3d4, iIntersectionPoint3d)
'                'iP3d = New Point3d(Math.Round(iIntersectionPoint3d.X, 0), Math.Round(iIntersectionPoint3d.Y, 0), Math.Round(iIntersectionPoint3d.Z, 0))
'            End If



'            'lw.WriteLine("TagCurven: " & iTagCurveGiao45(i))
'            'lw.WriteLine("Intersectn: " & iIntersectionPoint3d.ToString)
'            'lw.WriteLine("iP3dNut: " & iP3d.ToString)

'            Dim iCheckLikeGroupTag As Boolean = False       'Nếu iTagCurveGiao45(i) và iTagCurveGiao45(i-1) cùng Group Tag (iTagGroupGiao45(i) = iTagGroupGiao45(i - 1)) thì chấp thuận CL 0.5mm và CL 1mm vì khi đó 0.5mm và 1mm là độ dày tấm, không phải CL)
'            If iDem <> UBound(iPoint3dGiaoNut) Then
'                If iTagGroupGiao45(i) = iTagGroupGiao45(i + 1) Then
'                    iCheckLikeGroupTag = True
'                End If
'            End If

'            Dim iCheckAddNewPoint As Boolean = False
'            Dim iLength As Double
'            If iDem <> UBound(iPoint3dGiaoNut) Then           'iDem = 0 la điểm đầu tiên của mảng iPoint3dGiaoBolt()
'                Call GetLength2Point3D(iPoint3dGiaoNut(iDem + 1), iIntersectionPoint3d, iLength)
'            End If


'            If iCheckLikeGroupTag = True Then       'Trường hợp cùng Group Tag
'                If iLength > 0.2 Then
'                    Dim iCos As Double
'                    iCos = CosOf2Line(iPoint3dGiaoNut(iDem + 1), iIntersectionPoint3d, iPoint3d1, iPoint3d2)
'                    If Math.Abs(Math.Round(iCos, 2)) <> 1 Then
'                        iCheckAddNewPoint = True
'                    End If
'                End If
'            Else
'                If iLength > 0.2 And Math.Round(iLength, 4) <> 0.7071 And Math.Round(iLength, 4) <> 1.4142 Then                 'Math.Round(iLength, 5) <> 0.70711 là khoảng cách của 2 điểm nếu xuất hiện CL 0.5; Math.Round(iLength, 5) <> 1.41421 là khoảng cách của 2 điểm nếu xuất hiện CL 1
'                    Dim iCos As Double
'                    iCos = CosOf2Line(iPoint3dGiaoNut(iDem + 1), iIntersectionPoint3d, iPoint3d1, iPoint3d2)
'                    If Math.Abs(Math.Round(iCos, 2)) <> 1 Then
'                        iCheckAddNewPoint = True
'                    End If
'                End If
'            End If
'            'lw.WriteLine("iCos: " & iCos)

'            'If iListPoint3dGiaoNut.Contains(iP3d.ToString) = False Then
'            '    iListPoint3dGiaoNut.Add(iP3d.ToString)
'            If iCheckAddNewPoint = True Or iDem = UBound(iPoint3dGiaoNut) Then
'                'lw.WriteLine("ip3dn: " & iP3d.ToString)
'                'lw.WriteLine("iDemNut: " & iDem)
'                If iDem = -1 Then
'                    iCheckCorrect = False
'                    lw.WriteLine("Sai khi làm tròn String Point")
'                    Exit Sub
'                End If
'                iPoint3dGiaoNut(iDem) = iIntersectionPoint3d
'                iDem = iDem - 1
'                'Dim iPoint As NXOpen.Point = workPart.Points.CreatePoint(iIntersectionPoint3d)
'                'iPoint.SetVisibility(SmartObject.VisibilityOption.Visible)
'                'lw.WriteLine("Nut: " & iPoint3d.ToString & " _ " & iTagCurveGiao45(i).ToString)
'            End If

'        Next



'    End Sub

'    Sub TimDiemDoPMI_Menatsu(ByVal iPoint3dGiaoBolt() As Point3d, ByVal iPoint3dGiaoNut() As Point3d, ByVal tmpCsys As NXOpen.CartesianCoordinateSystem, ByRef iPoint3dDoPMI() As Point3d)      'So sánh iPoint3DGiaoBolt và iPoint3DGiaoNut, điểm nào gần gốc Csys hơn thì lấy
'        Dim theSession As Session = Session.GetSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim theUfSession As UFSession = UFSession.GetUFSession()


'        Dim iLength() As Double         ', iPoint3dDoPMI2() As Point3d
'        Dim i As Integer = 0
'        'Trục X Theo Csys
'        Dim iXCS(2) As Double
'        Dim iMatrix As Matrix3x3 = tmpCsys.Orientation.Element
'        iXCS(0) = iMatrix.Xx.ToString
'        iXCS(1) = iMatrix.Xy.ToString
'        iXCS(2) = iMatrix.Xz.ToString
'        Dim iVectorX As Vector3d = New Vector3d(iXCS(0), iXCS(1), iXCS(2))
'        Dim iOriginBase As NXOpen.Point = workPart.Points.CreatePoint(tmpCsys.Origin)

'        'Tìm điểm cần đo từ 2 mảng: điểm cần đo là điểm gần Csys hơn
'        For i = 0 To UBound(iPoint3dGiaoBolt)
'            Dim iLenBolt As Double = 0, iLenNut As Double = 0
'            Call DoKichThuocTheoPhuong(iOriginBase, workPart.Points.CreatePoint(iPoint3dGiaoBolt(i)), iVectorX, iLenBolt)
'            Call DoKichThuocTheoPhuong(iOriginBase, workPart.Points.CreatePoint(iPoint3dGiaoNut(i)), iVectorX, iLenNut)
'            ReDim Preserve iPoint3dDoPMI(i)
'            ReDim Preserve iLength(i)
'            If iLenBolt < iLenNut Then
'                iPoint3dDoPMI(i) = iPoint3dGiaoBolt(i)
'                iLength(i) = iLenBolt
'            Else
'                iPoint3dDoPMI(i) = iPoint3dGiaoNut(i)
'                iLength(i) = iLenNut
'            End If
'        Next

'        ''''Tìm Vector chỉ hướng để tạo điểm Mirror
'        '''Dim iVectorMirror As Vector3d
'        '''If CosOf2Vector_1(tmpCsys.Origin, iPoint3dDoPMI1(0), iXCS(0), iXCS(1), iXCS(2)) > 0 Then
'        '''    lw.WriteLine("Cos: " & CosOf2Vector_1(tmpCsys.Origin, iPoint3dDoPMI1(0), iXCS(0), iXCS(1), iXCS(2)))
'        '''    iVectorMirror = New Vector3d(-1 * iXCS(0), -1 * iXCS(1), -1 * iXCS(2))
'        '''Else
'        '''    lw.WriteLine("Cos1: " & CosOf2Vector_1(tmpCsys.Origin, iPoint3dDoPMI1(0), iXCS(0), iXCS(1), iXCS(2)))
'        '''    iVectorMirror = iVectorX
'        '''End If

'        ''''Tìm điểm Mirror
'        '''For i = 0 To UBound(iPoint3dDoPMI1)
'        '''    Dim ip As NXOpen.Point = workPart.Points.CreatePoint(iPoint3dDoPMI1(i))
'        '''    ip.SetVisibility(SmartObject.VisibilityOption.Visible)
'        '''    ReDim Preserve iPoint3dDoPMI2(i)
'        '''    Call Create_LineEquation_From_Point_And_DirectionVector_1(iPoint3dDoPMI1(i), iVectorMirror, iLength(i) * 2, iPoint3dDoPMI2(i))
'        '''    Dim iip As NXOpen.Point = workPart.Points.CreatePoint(iPoint3dDoPMI2(i))
'        '''    iip.SetVisibility(SmartObject.VisibilityOption.Visible)
'        '''Next

'    End Sub

'    Sub PMIAngle(ByVal tmpCsys As NXOpen.CartesianCoordinateSystem, ByVal iCurve1 As Curve, ByVal iCurve2 As Curve, ByVal iPointSetPMI As Point3d, ByVal iNoColor As Integer)
'        'Dim dist(1) As Double, junk(2) As Double, trash As Double
'        Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display

'        Dim iHienthisaudauphay As Integer = 0

'        'Chuyển Curve về Line (Vì sub này chỉ đo được góc giữa Line với Line
'        Dim iiCurve1 As Curve, iiCurve2 As Curve
'        Dim iChangeLinePoint3d1 As Point3d, iChangeLinePoint3d2 As Point3d
'        Call Start_End_Mid_Point_ForCurve(iCurve1, iChangeLinePoint3d1, iChangeLinePoint3d2, Nothing)
'        iiCurve1 = workPart.Curves.CreateLine(iChangeLinePoint3d1, iChangeLinePoint3d2)
'        Call Start_End_Mid_Point_ForCurve(iCurve2, iChangeLinePoint3d1, iChangeLinePoint3d2, Nothing)
'        iiCurve2 = workPart.Curves.CreateLine(iChangeLinePoint3d1, iChangeLinePoint3d2)


'        Dim nullNXOpen_Annotations_BaseAngularDimension As NXOpen.Annotations.BaseAngularDimension = Nothing
'        Dim pmiMinorAngularDimensionBuilder1 As NXOpen.Annotations.PmiMinorAngularDimensionBuilder = Nothing
'        pmiMinorAngularDimensionBuilder1 = workPart.Dimensions.CreatePmiMinorAngularDimensionBuilder(nullNXOpen_Annotations_BaseAngularDimension)
'        pmiMinorAngularDimensionBuilder1.Origin.Plane.PlaneMethod = NXOpen.Annotations.PlaneBuilder.PlaneMethodType.ModelView
'        pmiMinorAngularDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiMinorAngularDimensionBuilder1.Style.DimensionStyle.NarrowDisplayType = NXOpen.Annotations.NarrowDisplayOption.None
'        'Dim ipoint = workPart.Points.CreatePoint(iPt3)
'        Dim nullNXOpen_Direction As NXOpen.Direction = Nothing
'        pmiMinorAngularDimensionBuilder1.FirstVector = nullNXOpen_Direction
'        pmiMinorAngularDimensionBuilder1.SecondVector = nullNXOpen_Direction
'        'Dim iVector As Vector3d = New Vector3d(iPt3.X - iPt2.X, iPt3.Y - iPt2.Y, iPt3.Z - iPt2.Z)


'        Dim Curve1 As NXOpen.Curve = iiCurve1
'        Dim junk1(2) As Double, trash1 As Double
'        Dim EndPt1(2) As Double
'        Dim StrPt1(2) As Double
'        theUFSession.Modl.AskCurveProps(Curve1.Tag, 1, EndPt1, junk1, junk1, junk1, trash1, trash1)
'        theUFSession.Modl.AskCurveProps(Curve1.Tag, 0, StrPt1, junk1, junk1, junk1, trash1, trash1)
'        Dim StrPoint3d1 As Point3d = New Point3d(StrPt1(0), StrPt1(1), StrPt1(2))
'        Dim EndPoint3d1 As Point3d = New Point3d(EndPt1(0), EndPt1(1), EndPt1(2))
'        Dim iLen1 As Double, ilen2 As Double
'        Call GetLength2Point3D(StrPoint3d1, tmpCsys.Origin, iLen1)
'        Call GetLength2Point3D(EndPoint3d1, tmpCsys.Origin, ilen2)
'        Dim point1 As NXOpen.Point3d
'        If iLen1 > ilen2 Then
'            point1 = StrPoint3d1
'        Else
'            point1 = EndPoint3d1
'        End If






'        'Dim strPoint1 As NXOpen.Point = workPart.Points.CreatePoint(StrPoint3d1)
'        'Dim iVector1 As Vector3d = Create_DirectionVector_From_2_Point3D(StrPoint3d1, EndPoint3d1)


'        Dim Curve2 As NXOpen.Curve = iiCurve2
'        Dim junk2(2) As Double, trash2 As Double
'        Dim EndPt2(2) As Double
'        Dim StrPt2(2) As Double
'        theUFSession.Modl.AskCurveProps(Curve2.Tag, 1, EndPt2, junk2, junk2, junk2, trash2, trash2)
'        theUFSession.Modl.AskCurveProps(Curve2.Tag, 0, StrPt2, junk2, junk2, junk2, trash2, trash2)
'        Dim StrPoint3d2 As Point3d = New Point3d(StrPt2(0), StrPt2(1), StrPt2(2))
'        Dim EndPoint3d2 As Point3d = New Point3d(EndPt2(0), EndPt2(1), EndPt2(2))
'        'Dim strPoint2 As NXOpen.Point = workPart.Points.CreatePoint(StrPoint3d2)
'        'Dim iVector2 As Vector3d = Create_DirectionVector_From_2_Point3D(StrPoint3d2, EndPoint3d2)
'        Dim point2 As NXOpen.Point3d = EndPoint3d2


'        pmiMinorAngularDimensionBuilder1.FirstAssociativity.SetValue(Curve1, displayPart.ModelingViews.WorkView, point1)

'        'pmiMinorAngularDimensionBuilder1.FirstVector = workPart.Directions.CreateDirection(strPoint1, iVector1)
'        pmiMinorAngularDimensionBuilder1.FirstVector = nullNXOpen_Direction
'        Dim objects1(0) As NXOpen.NXObject
'        objects1(0) = Curve1
'        pmiMinorAngularDimensionBuilder1.AssociatedObjects.Nxobjects.SetArray(objects1)


'        pmiMinorAngularDimensionBuilder1.SecondAssociativity.SetValue(Curve2, displayPart.ModelingViews.WorkView, point2)

'        'pmiMinorAngularDimensionBuilder1.SecondVector = workPart.Directions.CreateDirection(strPoint2, iVector2)
'        pmiMinorAngularDimensionBuilder1.SecondVector = nullNXOpen_Direction
'        Dim objects2(1) As NXOpen.NXObject
'        objects2(0) = Curve1
'        objects2(1) = Curve2
'        pmiMinorAngularDimensionBuilder1.AssociatedObjects.Nxobjects.SetArray(objects2)

'        Dim nullNXOpen_View As NXOpen.View = Nothing
'        'Dim point1_1 As NXOpen.Point3d = point1
'        'Dim point2_1 As NXOpen.Point3d = point2
'        'pmiMinorAngularDimensionBuilder1.FirstAssociativity.SetValue(NXOpen.InferSnapType.SnapType.None, Curve1, displayPart.ModelingViews.WorkView, point1_1, Nothing, nullNXOpen_View, point2_1)
'        'Dim point1_2 As NXOpen.Point3d = point1
'        'Dim point2_2 As NXOpen.Point3d = point2
'        'pmiMinorAngularDimensionBuilder1.SecondAssociativity.SetValue(NXOpen.InferSnapType.SnapType.None, Curve2, displayPart.ModelingViews.WorkView, point1_2, Nothing, nullNXOpen_View, point2_2)
'        Dim assocOrigin1 As NXOpen.Annotations.Annotation.AssociativeOriginData = Nothing
'        assocOrigin1.OriginType = NXOpen.Annotations.AssociativeOriginType.Drag
'        assocOrigin1.View = nullNXOpen_View
'        assocOrigin1.ViewOfGeometry = nullNXOpen_View
'        Dim nullNXOpen_Point As NXOpen.Point = Nothing

'        assocOrigin1.PointOnGeometry = nullNXOpen_Point
'        Dim nullNXOpen_Annotations_Annotation As NXOpen.Annotations.Annotation = Nothing

'        assocOrigin1.VertAnnotation = nullNXOpen_Annotations_Annotation
'        assocOrigin1.VertAlignmentPosition = NXOpen.Annotations.AlignmentPosition.TopLeft
'        assocOrigin1.HorizAnnotation = nullNXOpen_Annotations_Annotation
'        assocOrigin1.HorizAlignmentPosition = NXOpen.Annotations.AlignmentPosition.TopLeft
'        assocOrigin1.AlignedAnnotation = nullNXOpen_Annotations_Annotation
'        assocOrigin1.DimensionLine = 0
'        assocOrigin1.AssociatedView = nullNXOpen_View
'        assocOrigin1.AssociatedPoint = nullNXOpen_Point
'        assocOrigin1.OffsetAnnotation = nullNXOpen_Annotations_Annotation
'        assocOrigin1.OffsetAlignmentPosition = NXOpen.Annotations.AlignmentPosition.TopLeft
'        assocOrigin1.XOffsetFactor = 0.0
'        assocOrigin1.YOffsetFactor = 0.0
'        assocOrigin1.StackAlignmentPosition = NXOpen.Annotations.StackAlignmentPosition.Above
'        pmiMinorAngularDimensionBuilder1.Origin.SetAssociativeOrigin(assocOrigin1)

'        Dim point3 As NXOpen.Point3d = iPointSetPMI
'        pmiMinorAngularDimensionBuilder1.Origin.Origin.SetValue(Nothing, nullNXOpen_View, point3)
'        pmiMinorAngularDimensionBuilder1.Style.LetteringStyle.DimensionTextSize = 4
'        pmiMinorAngularDimensionBuilder1.Style.LetteringStyle.DimensionTextAspectRatio = 0.6
'        pmiMinorAngularDimensionBuilder1.Style.LetteringStyle.DimensionTextCharSpaceFactor = 0.6
'        'pmiLinearDimensionBuilder1.Style.LetteringStyle.GeneralTextSize = 1.5
'        pmiMinorAngularDimensionBuilder1.Style.LineArrowStyle.ArrowheadLength = 2
'        pmiMinorAngularDimensionBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiMinorAngularDimensionBuilder1.Style.LineArrowStyle.LeaderOrientation = NXOpen.Annotations.LeaderSide.Left
'        pmiMinorAngularDimensionBuilder1.Style.DimensionStyle.TextCentered = True
'        pmiMinorAngularDimensionBuilder1.Style.DimensionStyle.AngularDimensionValuePrecision = iHienthisaudauphay
'        pmiMinorAngularDimensionBuilder1.Style.DimensionStyle.DimensionValuePrecision = iHienthisaudauphay
'        pmiMinorAngularDimensionBuilder1.Style.UnitsStyle.DisplayTrailingZeros = True
'        If iNoColor <> 0 Then
'            Try
'                pmiMinorAngularDimensionBuilder1.Style.LetteringStyle.DimensionTextColor = workPart.Colors.Find(iNoColor)
'                pmiMinorAngularDimensionBuilder1.Style.LetteringStyle.AppendedTextColor = workPart.Colors.Find(iNoColor)
'                pmiMinorAngularDimensionBuilder1.Style.LetteringStyle.ToleranceTextColor = workPart.Colors.Find(iNoColor)
'                pmiMinorAngularDimensionBuilder1.Style.LineArrowStyle.FirstArrowheadColor = workPart.Colors.Find(iNoColor)
'                pmiMinorAngularDimensionBuilder1.Style.LineArrowStyle.FirstArrowLineColor = workPart.Colors.Find(iNoColor)
'                pmiMinorAngularDimensionBuilder1.Style.LineArrowStyle.FirstExtensionLineColor = workPart.Colors.Find(iNoColor)
'                pmiMinorAngularDimensionBuilder1.Style.LineArrowStyle.SecondArrowheadColor = workPart.Colors.Find(iNoColor)
'                pmiMinorAngularDimensionBuilder1.Style.LineArrowStyle.SecondArrowLineColor = workPart.Colors.Find(iNoColor)
'                pmiMinorAngularDimensionBuilder1.Style.LineArrowStyle.SecondExtensionLineColor = workPart.Colors.Find(iNoColor)


'            Catch ex As Exception
'                pmiMinorAngularDimensionBuilder1.Style.LetteringStyle.DimensionTextColor = displayPart.Colors.Find(iNoColor)
'                pmiMinorAngularDimensionBuilder1.Style.LetteringStyle.AppendedTextColor = displayPart.Colors.Find(iNoColor)
'                pmiMinorAngularDimensionBuilder1.Style.LetteringStyle.ToleranceTextColor = displayPart.Colors.Find(iNoColor)
'                pmiMinorAngularDimensionBuilder1.Style.LineArrowStyle.FirstArrowheadColor = displayPart.Colors.Find(iNoColor)
'                pmiMinorAngularDimensionBuilder1.Style.LineArrowStyle.FirstArrowLineColor = displayPart.Colors.Find(iNoColor)
'                pmiMinorAngularDimensionBuilder1.Style.LineArrowStyle.FirstExtensionLineColor = displayPart.Colors.Find(iNoColor)
'                pmiMinorAngularDimensionBuilder1.Style.LineArrowStyle.SecondArrowheadColor = displayPart.Colors.Find(iNoColor)
'                pmiMinorAngularDimensionBuilder1.Style.LineArrowStyle.SecondArrowLineColor = displayPart.Colors.Find(iNoColor)
'                pmiMinorAngularDimensionBuilder1.Style.LineArrowStyle.SecondExtensionLineColor = displayPart.Colors.Find(iNoColor)
'            End Try
'        End If

'        Dim nXObject1 As NXOpen.NXObject = Nothing
'        nXObject1 = pmiMinorAngularDimensionBuilder1.Commit()
'        pmiMinorAngularDimensionBuilder1.Destroy()

'        Dim pmiMinorAngularDimensionBuilder2 As NXOpen.Annotations.PmiMinorAngularDimensionBuilder = Nothing
'        pmiMinorAngularDimensionBuilder2 = workPart.Dimensions.CreatePmiMinorAngularDimensionBuilder(nullNXOpen_Annotations_BaseAngularDimension)
'        pmiMinorAngularDimensionBuilder2.Origin.SetInferRelativeToGeometry(True)

'        pmiMinorAngularDimensionBuilder2.Origin.Anchor = NXOpen.Annotations.OriginBuilder.AlignmentPosition.MidCenter
'        pmiMinorAngularDimensionBuilder2.Style.DimensionStyle.LimitFitDeviation = "H"
'        pmiMinorAngularDimensionBuilder2.Style.DimensionStyle.LimitFitShaftDeviation = "g"
'        pmiMinorAngularDimensionBuilder2.Style.DisplayStyle.ParallelToScreen = False
'        pmiMinorAngularDimensionBuilder2.Style.DisplayStyle.LockSizeAndPosition = False
'        pmiMinorAngularDimensionBuilder2.Origin.Plane.PlaneMethod = NXOpen.Annotations.PlaneBuilder.PlaneMethodType.ModelView

'        pmiMinorAngularDimensionBuilder2.Origin.SetInferRelativeToGeometry(True)
'        Dim dimensionlinearunits11 As NXOpen.Annotations.DimensionUnit = Nothing
'        dimensionlinearunits11 = pmiMinorAngularDimensionBuilder2.Style.UnitsStyle.DimensionLinearUnits
'        pmiMinorAngularDimensionBuilder2.Style.DimensionStyle.NarrowDisplayType = NXOpen.Annotations.NarrowDisplayOption.None
'        'pmiMinorAngularDimensionBuilder2.FirstVector = workPart.Directions.CreateDirection(strPoint1, iVector1)
'        'pmiMinorAngularDimensionBuilder2.SecondVector = workPart.Directions.CreateDirection(strPoint2, iVector2)
'        pmiMinorAngularDimensionBuilder2.FirstVector = nullNXOpen_Direction
'        pmiMinorAngularDimensionBuilder2.SecondVector = nullNXOpen_Direction
'        pmiMinorAngularDimensionBuilder2.Destroy()

'        theSession.CleanUpFacetedFacesAndEdges()
'        iiCurve1.SetVisibility(SmartObject.VisibilityOption.Invisible)
'        iiCurve2.SetVisibility(SmartObject.VisibilityOption.Invisible)
'    End Sub


'    Sub Create_LineEquation_From_Point_And_DirectionVector_1(ByVal iPoint3d As Point3d, ByVal iDirectionVector As Vector3d, ByVal a As Double, ByRef iPoint3d_Line As Point3d)    'Tìm điểm nằm trên đường thẳng theo hướng iDirectionVector cách iPoint 1 khoảng a
'        Dim theSession As Session = Session.GetSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As Part = theSession.Parts.Display
'        Dim TheUFsession As UFSession = UFSession.GetUFSession()
'        lw = theSession.ListingWindow
'        lw.Open()

'        Dim t As Double
'        t = a / Math.Sqrt(iDirectionVector.X ^ 2 + iDirectionVector.Y ^ 2 + iDirectionVector.Z ^ 2)
'        iPoint3d_Line.X = iPoint3d.X + iDirectionVector.X * t
'        iPoint3d_Line.Y = iPoint3d.Y + iDirectionVector.Y * t
'        iPoint3d_Line.Z = iPoint3d.Z + iDirectionVector.Z * t
'    End Sub

'    Sub CheckBoltNutInfor(ByVal iPartNo As String, ByRef iFixType As String, ByRef iDim As Double, ByRef iWasher As Boolean, ByRef iMaterial As String)

'        If InStr(iPartNo, "#") > 0 Then
'            iPartNo = Split(iPartNo, "#")(0)
'        End If
'        If InStr(iPartNo, "_") > 0 Then
'            iPartNo = Split(iPartNo, "_")(0)
'        End If

'        Dim dtDBView As New DataView(iDataBaseBoltNut)
'        dtDBView.RowFilter = String.Format("[PartNo] like '%{0}%'", iPartNo)

'        If dtDBView.ToTable.Rows.Count = 0 Then
'            iFixType = iPartNo & " Khong ton tai trong DataBase"
'            Exit Sub
'        End If

'        'lw.WriteLine("Test: " & dtDBView.ToTable.Rows(0)(3))
'        iFixType = Left(dtDBView.ToTable.Rows(0)(3), 2)

'        'lw.WriteLine("aa: " & dtDBView.ToTable.Rows(0)(3) & "_" & iFixType.ToString)
'        If iFixType = "03" Then
'            iFixType = "Bolt Weld"
'        ElseIf iFixType = "01" Then
'            iFixType = "Bolt Tighten"
'        ElseIf iFixType = "04" Or iFixType = "13" Or iFixType = "15" Then
'            iFixType = "Nut Weld"
'        ElseIf iFixType = "02" Then
'            iFixType = "Nut Tighten"
'        Else
'            lw.WriteLine(iPartNo & " :Database không có thông tin Hàn hoặc Vặn")
'            iCheckCorrect = False
'            Exit Sub
'        End If

'        iMaterial = dtDBView.ToTable.Rows(0)(9)

'        lw.WriteLine("iPartNo + iFixType: " & iPartNo.ToString & "_" & iFixType.ToString)

'        If InStr(dtDBView.ToTable.Rows(0)(13), "有") <> 0 Then       'Nếu có Washer set bằng True
'            iWasher = True
'        Else
'            iWasher = False
'        End If


'        ''''Tùy vào từng loại Head Shape mà giá trị iDim lấy khác nhau. Bolt chia làm 3 loại: 六角,FLG,WELD; Nut cũng chia làm 3 loại tương tự: 六角,FLG,WELD



'        Dim iiHeadShape As String



'        iiHeadShape = dtDBView.ToTable.Rows(0)(17)
'        lw.WriteLine(iiHeadShape)

'        If InStr(iFixType.ToUpper, "WELD") <> 0 Then
'            If InStr(iFixType, "Bolt") <> 0 Then
'                Try
'                    iDim = dtDBView.ToTable.Rows(0)(12)
'                    If iDim = 0 Then
'                        lw.WriteLine(iPartNo & " :Database không có thông tin C.Head or Flange Diameter")
'                        iCheckCorrect = False
'                        Exit Sub
'                    End If
'                    'iHeadShape = "WELD"
'                Catch ex As Exception
'                    lw.WriteLine(iPartNo & " :Database không có thông tin C.Head or Flange Diameter")
'                    iDim = 0
'                End Try
'            ElseIf InStr(iFixType, "Nut") <> 0 Then
'                Try
'                    iDim = dtDBView.ToTable.Rows(0)(19)
'                    If iDim = 0 Then
'                        lw.WriteLine(iPartNo & " :Database không có thông tin I.溶接NUT")
'                        iCheckCorrect = False
'                        Exit Sub
'                    End If
'                    'iHeadShape = "WELD"
'                Catch ex As Exception
'                    lw.WriteLine(iPartNo & " :Database không có thông tin I.溶接NUT")
'                    iDim = 0
'                End Try
'            End If
'        Else
'            If InStr(iiHeadShape, "六角") <> 0 And InStr(iiHeadShape, "フランジ") = 0 Then
'                Try
'                    iDim = dtDBView.ToTable.Rows(0)(10)
'                    If iDim = 0 Then
'                        lw.WriteLine(iPartNo & " :Database không có thông tin A.Width across Flat")
'                        iCheckCorrect = False
'                        Exit Sub
'                    End If
'                    'iDimH = dtDBView.ToTable.Rows(0)(18)
'                    'If iDimH = 0 Then
'                    '    lw.WriteLine(iPartNo & " :Database không có thông tin H.軸太径")
'                    '    iCheckCorrect = False
'                    '    Exit Sub
'                    'End If
'                    'iHeadShape = "ROKKAKU"
'                Catch ex As Exception
'                    lw.WriteLine(iPartNo & " :Database không có thông tin A.Width across Flat")
'                    iDim = 0
'                End Try
'            ElseIf InStr(iiHeadShape.ToUpper, "フランジ付き六角") <> 0 Then
'                If InStr(iFixType, "Bolt") <> 0 Then
'                    Try
'                        'lw.WriteLine("sdfsafasdf: " & dtDBView.ToTable.Rows(0)(20))
'                        iDim = dtDBView.ToTable.Rows(0)(20)
'                        If iDim = 0 Then
'                            lw.WriteLine(iPartNo & " :Database không có thông tin K.有効")
'                            iCheckCorrect = False
'                            Exit Sub
'                        End If
'                        'iHeadShape = "FLANGE"
'                    Catch ex As Exception
'                        lw.WriteLine(iPartNo & " :Database không có thông tin K.有効")
'                        iDim = 0
'                    End Try
'                ElseIf InStr(iFixType, "Nut") <> 0 Then
'                    Try
'                        iDim = dtDBView.ToTable.Rows(0)(12)
'                        If iDim = 0 Then
'                            lw.WriteLine(iPartNo & " :Database không có thông tin C.Head or Flange Diameter")
'                            iCheckCorrect = False
'                            Exit Sub
'                        End If
'                        'iHeadShape = "FLANGE"
'                    Catch ex As Exception
'                        lw.WriteLine(iPartNo & " :Database không có thông tin C.Head or Flange Diameter")
'                        iDim = 0
'                    End Try
'                End If
'            End If
'        End If
'    End Sub

'    Sub GetDatabaseBoltNut(ByVal StrFilePath As String, ByRef dtDataBase As DataTable)

'        Dim iAddColNum As Integer = 0

'        ' インスタンスを作成
'        dtDataBase = New DataTable

'        ' データテーブルに列を追加する
'        'dtTest.Columns.Add("No")
'        dtDataBase.Columns.Add("BoltNut")
'        dtDataBase.Columns.Add("DB0")
'        dtDataBase.Columns.Add("取得元")
'        dtDataBase.Columns.Add("締結タイプ")
'        dtDataBase.Columns.Add("強度区分規格")
'        dtDataBase.Columns.Add("PartNo")
'        dtDataBase.Columns.Add("PartName")
'        dtDataBase.Columns.Add("KindOfPart")
'        dtDataBase.Columns.Add("PartSize")
'        dtDataBase.Columns.Add("Material")
'        dtDataBase.Columns.Add("DimA")
'        dtDataBase.Columns.Add("DimB")
'        dtDataBase.Columns.Add("DimC")
'        dtDataBase.Columns.Add("WasherType")
'        dtDataBase.Columns.Add("DimD")
'        dtDataBase.Columns.Add("DimE")
'        dtDataBase.Columns.Add("DimG")
'        dtDataBase.Columns.Add("HeadShape")
'        dtDataBase.Columns.Add("DimH")
'        dtDataBase.Columns.Add("DimI")
'        dtDataBase.Columns.Add("DimK")

'        ' CSVファイルを読み込む変数の準備
'        Dim sr As System.IO.StreamReader = Nothing

'        '  CSVファイルが存在するかチェック
'        If System.IO.File.Exists(StrFilePath) Then
'            ' CSVファイルがあれば処理を行う
'            ' インスタンス作成
'            'Dim tpText As New FileIO.TextFieldParser(strFileName, System.Text.Encoding.GetEncoding(932))
'            'sr = New System.IO.StreamReader(StrFilePath)
'            sr = New System.IO.StreamReader(StrFilePath, System.Text.Encoding.GetEncoding(932))
'            '  CSVファイルを最後まで読み取り
'            Dim dCnt As Integer = 0  ' カウント変数をデータテーブル用に準備
'            While sr.Peek >= 0
'                'lw.WriteLine(sr.Peek)
'                Try
'                    Dim line As String = sr.ReadLine.ToString.Replace(vbCr, "").Replace(vbLf, "")
'                    'lw.WriteLine(line)
'                    'lw.WriteLine("Line: " & line)
'                    ' データテーブルに値を追加していく
'                    dtDataBase.Rows.Add()
'                    'dtTest.Rows(dCnt).Item("No") = Split(line, ",")(0)
'                    dtDataBase.Rows(dCnt).Item("BoltNut") = Split(line, ",")(2)
'                    dtDataBase.Rows(dCnt).Item("DB0") = Split(line, ",")(3)
'                    dtDataBase.Rows(dCnt).Item("取得元") = Split(line, ",")(10 + iAddColNum)
'                    dtDataBase.Rows(dCnt).Item("締結タイプ") = Split(line, ",")(11 + iAddColNum)
'                    dtDataBase.Rows(dCnt).Item("強度区分規格") = Split(line, ",")(12 + iAddColNum)
'                    dtDataBase.Rows(dCnt).Item("PartNo") = Split(line, ",")(17 + iAddColNum)
'                    dtDataBase.Rows(dCnt).Item("PartName") = Split(line, ",")(18 + iAddColNum)
'                    dtDataBase.Rows(dCnt).Item("KindOfPart") = Split(line, ",")(49 + iAddColNum)
'                    dtDataBase.Rows(dCnt).Item("PartSize") = Split(line, ",")(50 + iAddColNum)
'                    dtDataBase.Rows(dCnt).Item("Material") = Split(line, ",")(54 + iAddColNum)
'                    dtDataBase.Rows(dCnt).Item("DimA") = Split(line, ",")(57 + iAddColNum)
'                    dtDataBase.Rows(dCnt).Item("DimB") = Split(line, ",")(60 + iAddColNum)
'                    dtDataBase.Rows(dCnt).Item("DimC") = Split(line, ",")(63 + iAddColNum)
'                    dtDataBase.Rows(dCnt).Item("WasherType") = Split(line, ",")(68 + iAddColNum)
'                    dtDataBase.Rows(dCnt).Item("DimD") = Split(line, ",")(70 + iAddColNum)
'                    dtDataBase.Rows(dCnt).Item("DimE") = Split(line, ",")(73 + iAddColNum)
'                    dtDataBase.Rows(dCnt).Item("DimG") = Split(line, ",")(76 + iAddColNum)
'                    dtDataBase.Rows(dCnt).Item("HeadShape") = Split(line, ",")(93 + iAddColNum)
'                    dtDataBase.Rows(dCnt).Item("DimH") = Split(line, ",")(97 + iAddColNum)
'                    dtDataBase.Rows(dCnt).Item("DimI") = Split(line, ",")(100 + iAddColNum)
'                    dtDataBase.Rows(dCnt).Item("DimK") = Split(line, ",")(101 + iAddColNum)

'                    dCnt += 1  ' カウント変数を+1していく
'                Catch ex As Exception
'                    Dim line As String = sr.ReadLine.ToString.Replace(vbCr, "").Replace(vbLf, "")
'                    lw.WriteLine("Error: " & line)
'                End Try

'            End While
'        End If

'    End Sub

'    ''''''''''Zentaizu

'    Sub Create_Zentaizu()
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim lw As ListingWindow = theSession.ListingWindow
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        lw = theSession.ListingWindow
'        lw.Open()


'        Dim dtInOut As DataTable

'        Call InputExcel(dtInOut)

'        ''Shagyou top Assy
'        Try
'            theSession.Parts.SetWorkComponent(workPart.ComponentAssembly.RootComponent, partLoadStatus1)
'            workPart = theSession.Parts.Work
'        Catch ex As Exception

'        End Try

'        ''''''Tạo Assy Zentaizu     '20231121
'        '''''Dim iCompAssyZentaizu As NXOpen.Assemblies.Component
'        '''''Call CreateAssyNewLv2("Zentaizu", iCompAssyZentaizu)


'        'Dim dtViewDB As DataTable, dtFunctype As DataTable
'        'Call InputDatabase(dtViewDB)

'        Dim iPoint3DGocPlan() As Point3d, iPoint3DGocBottom() As Point3d, iPoint3DGocLeftSide() As Point3d, iPoint3DGocRightSide() As Point3d, iPoint3DGocFront() As Point3d, iPoint3DGocRear() As Point3d, iPoint3DGocOther() As Point3d
'        Dim iNamePointPlan() As String, iNamePointBottom() As String, iNamePointLeftSide() As String, iNamePointRightSide() As String, iNamePointFront() As String, iNamePointRear() As String, iNamePointOther() As String
'        Dim iKetQuaPlan() As String, iKetQuaBottom() As String, iKetQuaLeftSide() As String, iKetQuaRightSide() As String, iKetQuaFront() As String, iKetQuaRear() As String, iKetQuaOther() As String
'        Dim iDemPlan As Integer, iDemBottom As Integer, iDemLeftSide As Integer, iDemRightSide As Integer, iDemFront As Integer, iDemRear As Integer, iDemOther As Integer
'        Dim iDataPlan As New List(Of String), iDataBottom As New List(Of String), iDataLeftSide As New List(Of String), iDataRightSide As New List(Of String), iDataFront As New List(Of String), iDataRear As New List(Of String), iDataOther As New List(Of String)
'        Dim iCSFunction As String

'        Dim i As Integer = 0
'        Dim iShataiView() As String
'        Call Function_View(dtInOut, iShataiView)
'        'For Each dtrow As DataRow In dtViewDB.Rows
'        '    ReDim Preserve iShataiView(i)
'        '    iShataiView(i) = dtrow("FUNC_NO").ToString & ";" & dtrow("VIEW").ToString
'        '    i += 1
'        'Next

'        i = 0
'        For Each dtRow As DataRow In dtInOut.Rows
'            'iCSFunction = Left(Split(dtRow("CS Function").ToString, "_")(1), 6)
'            iCSFunction = dtRow("CS Function").ToString
'            Dim iView As String
'            For Each iFunc As String In iShataiView
'                If iCSFunction = Split(iFunc, ";")(0) Then
'                    iView = Split(iFunc, ";")(1)
'                    Exit For
'                End If
'            Next
'            If iView = "PLAN" Then
'                ReDim Preserve iNamePointPlan(iDemPlan)
'                iNamePointPlan(iDemPlan) = dtRow("締結位置番号").ToString & ";" & dtRow("CS Part No") & ";" & dtRow("締結物") & ";" & dtRow("結果")
'                ReDim Preserve iKetQuaPlan(iDemPlan)
'                iKetQuaPlan(iDemPlan) = dtRow("結果").ToString
'                ReDim Preserve iPoint3DGocPlan(iDemPlan)
'                iPoint3DGocPlan(iDemPlan).X = dtRow("X").ToString
'                iPoint3DGocPlan(iDemPlan).Y = dtRow("Y").ToString
'                iPoint3DGocPlan(iDemPlan).Z = dtRow("Z").ToString
'                If dtRow("CS Part No").ToString <> "" Then
'                    If iDataPlan.Contains(dtRow("CS Part No").ToString) = False Then
'                        iDataPlan.Add(dtRow("CS Part No").ToString)
'                    End If
'                End If
'                iDemPlan += 1
'            ElseIf iView = "BOTTOM" Then
'                ReDim Preserve iNamePointBottom(iDemBottom)
'                iNamePointBottom(iDemBottom) = dtRow("締結位置番号").ToString & ";" & dtRow("CS Part No") & ";" & dtRow("締結物") & ";" & dtRow("結果")
'                ReDim Preserve iKetQuaBottom(iDemBottom)
'                iKetQuaBottom(iDemBottom) = dtRow("結果").ToString
'                ReDim Preserve iPoint3DGocBottom(iDemBottom)
'                iPoint3DGocBottom(iDemBottom).X = dtRow("X").ToString
'                iPoint3DGocBottom(iDemBottom).Y = dtRow("Y").ToString
'                iPoint3DGocBottom(iDemBottom).Z = dtRow("Z").ToString
'                If dtRow("CS Part No").ToString <> "" Then
'                    If iDataBottom.Contains(dtRow("CS Part No").ToString) = False Then
'                        iDataBottom.Add(dtRow("CS Part No").ToString)
'                    End If
'                End If
'                iDemBottom += 1
'            ElseIf iView = "LEFTSIDE" Then
'                ReDim Preserve iNamePointLeftSide(iDemLeftSide)
'                iNamePointLeftSide(iDemLeftSide) = dtRow("締結位置番号").ToString & ";" & dtRow("CS Part No") & ";" & dtRow("締結物") & ";" & dtRow("結果")
'                ReDim Preserve iKetQuaLeftSide(iDemLeftSide)
'                iKetQuaLeftSide(iDemLeftSide) = dtRow("結果").ToString
'                ReDim Preserve iPoint3DGocLeftSide(iDemLeftSide)
'                iPoint3DGocLeftSide(iDemLeftSide).X = dtRow("X").ToString
'                iPoint3DGocLeftSide(iDemLeftSide).Y = dtRow("Y").ToString
'                iPoint3DGocLeftSide(iDemLeftSide).Z = dtRow("Z").ToString
'                If dtRow("CS Part No").ToString <> "" Then
'                    If iDataLeftSide.Contains(dtRow("CS Part No").ToString) = False Then
'                        iDataLeftSide.Add(dtRow("CS Part No").ToString)
'                    End If
'                End If
'                iDemLeftSide += 1
'            ElseIf iView = "RIGHTSIDE" Then
'                ReDim Preserve iNamePointRightSide(iDemRightSide)
'                iNamePointRightSide(iDemRightSide) = dtRow("締結位置番号").ToString & ";" & dtRow("CS Part No") & ";" & dtRow("締結物") & ";" & dtRow("結果")
'                ReDim Preserve iKetQuaRightSide(iDemRightSide)
'                iKetQuaRightSide(iDemRightSide) = dtRow("結果").ToString
'                ReDim Preserve iPoint3DGocRightSide(iDemRightSide)
'                iPoint3DGocRightSide(iDemRightSide).X = dtRow("X").ToString
'                iPoint3DGocRightSide(iDemRightSide).Y = dtRow("Y").ToString
'                iPoint3DGocRightSide(iDemRightSide).Z = dtRow("Z").ToString
'                If dtRow("CS Part No").ToString <> "" Then
'                    If iDataRightSide.Contains(dtRow("CS Part No").ToString) = False Then
'                        iDataRightSide.Add(dtRow("CS Part No").ToString)
'                    End If
'                End If
'                iDemRightSide += 1
'            ElseIf iView = "FRONT" Then
'                ReDim Preserve iNamePointFront(iDemFront)
'                iNamePointFront(iDemFront) = dtRow("締結位置番号").ToString & ";" & dtRow("CS Part No") & ";" & dtRow("締結物") & ";" & dtRow("結果")
'                ReDim Preserve iKetQuaFront(iDemFront)
'                iKetQuaFront(iDemFront) = dtRow("結果").ToString
'                ReDim Preserve iPoint3DGocFront(iDemFront)
'                iPoint3DGocFront(iDemFront).X = dtRow("X").ToString
'                iPoint3DGocFront(iDemFront).Y = dtRow("Y").ToString
'                iPoint3DGocFront(iDemFront).Z = dtRow("Z").ToString
'                If dtRow("CS Part No").ToString <> "" Then
'                    If iDataFront.Contains(dtRow("CS Part No").ToString) = False Then
'                        iDataFront.Add(dtRow("CS Part No").ToString)
'                    End If
'                End If
'                iDemFront += 1
'            ElseIf iView = "REAR" Then
'                ReDim Preserve iNamePointRear(iDemRear)
'                iNamePointRear(iDemRear) = dtRow("締結位置番号").ToString & ";" & dtRow("CS Part No") & ";" & dtRow("締結物") & ";" & dtRow("結果")
'                ReDim Preserve iKetQuaRear(iDemRear)
'                iKetQuaRear(iDemRear) = dtRow("結果").ToString
'                ReDim Preserve iPoint3DGocRear(iDemRear)
'                iPoint3DGocRear(iDemRear).X = dtRow("X").ToString
'                iPoint3DGocRear(iDemRear).Y = dtRow("Y").ToString
'                iPoint3DGocRear(iDemRear).Z = dtRow("Z").ToString
'                If dtRow("CS Part No").ToString <> "" Then
'                    If iDataRear.Contains(dtRow("CS Part No").ToString) = False Then
'                        iDataRear.Add(dtRow("CS Part No").ToString)
'                    End If
'                End If
'                iDemRear += 1
'            Else
'                ReDim Preserve iNamePointOther(iDemOther)
'                iNamePointOther(iDemOther) = dtRow("締結位置番号").ToString & ";" & dtRow("CS Part No") & ";" & dtRow("締結物") & ";" & dtRow("結果")
'                ReDim Preserve iKetQuaOther(iDemOther)
'                iKetQuaOther(iDemOther) = dtRow("結果").ToString
'                ReDim Preserve iPoint3DGocOther(iDemOther)
'                iPoint3DGocOther(iDemOther).X = dtRow("X").ToString
'                iPoint3DGocOther(iDemOther).Y = dtRow("Y").ToString
'                iPoint3DGocOther(iDemOther).Z = dtRow("Z").ToString
'                If dtRow("CS Part No").ToString <> "" Then
'                    If iDataOther.Contains(dtRow("CS Part No").ToString) = False Then
'                        iDataOther.Add(dtRow("CS Part No").ToString)
'                    End If
'                End If
'                iDemOther += 1
'            End If
'        Next


'        'Đưa về dạng khung dây
'        Try
'            workPart.ModelingViews.WorkView.RenderingStyle = NXOpen.View.RenderingStyleType.WireframeWithDimEdges
'        Catch ex As Exception
'            displayPart.ModelingViews.WorkView.RenderingStyle = NXOpen.View.RenderingStyleType.WireframeWithDimEdges
'        End Try
'        'Hiển thị độ dày nét
'        'Call Hien_thi_do_day_net()
'        '''''Dim iCompTop As Component = iCompAssyZentaizu          '20231121
'        Dim iCompTop As Component
'        Try
'            theSession.Parts.SetWorkComponent(iCompTop, partLoadStatus1)
'        Catch ex As Exception

'        End Try
'        'Dim iCompPLAN As Component, iCompBOTTOM As Component, iCompLEFTSIDE As Component, iCompRIGHTSIDE As Component, iCompFRONT As Component, iCompREAR As Component, iCompOther As Component

'        If IsArray(iPoint3DGocPlan) = True Then
'            Call SagyouComponent(iCompTop)
'            Dim iComp As Component
'            CreateAssyNewLv2("PLAN VIEW", iComp)
'            'Dim iName As String = iComp.GetStringAttribute("DB_PART_NAME").ToString
'            Dim iCompDATA3D As Component, iCompANNO As Component
'            CreateAssyNewLv2("DATA 3D", iCompDATA3D)                                    'Đoạn này là lấy Data đại diện cho View
'            'shagyou và lấy data 3D đại diện cho vào đây
'            Dim iCompDataName As String = iCompDATA3D.GetStringAttribute("DB_PART_NO").ToString & "/AA"
'            ''''''sagyou iCompDATA3D                    '20231121
'            '''''For Each iChild As Component In iCompTop.GetChildren
'            '''''    If iChild.GetStringAttribute("DB_PART_NO").ToString = iCompDATA3D.GetStringAttribute("DB_PART_NO").ToString Then
'            '''''        theSession.Parts.SetWorkComponent(iChild, partLoadStatus1)
'            '''''        workPart = theSession.Parts.Work
'            '''''    End If
'            '''''Next
'            For Each iString As String In iDataPlan
'                Try
'                    AddComponentByNoPDM(iCompDataName, iString & "/" & GetRev(iString))
'                Catch ex As Exception
'                    AddComponentByNoASSY(iCompDataName, iString & "/" & GetRev(iString))
'                End Try
'            Next

'            ''''''sagyou iComp          '20231121
'            '''''For Each iChild As Component In iCompTop.GetChildren
'            '''''    If iChild.GetStringAttribute("DB_PART_NO").ToString = iComp.GetStringAttribute("DB_PART_NO").ToString Then
'            '''''        theSession.Parts.SetWorkComponent(iChild, partLoadStatus1)
'            '''''        workPart = theSession.Parts.Work
'            '''''    End If
'            '''''Next
'            Call SagyouComponent(iComp)

'            CreateAssyNewLv2("ANNOTATION", iCompANNO)                                   'Đoạn này là tạo chỉ thị PMI ANNO cho View
'            theSession.UpdateManager.InterpartDelay = False
'            Dim component2 As NXOpen.Assemblies.Component = CType(iCompANNO, Component)
'            For Each iChild As Component In iComp.GetChildren
'                If iChild.GetStringAttribute("DB_PART_NO").ToString = iCompANNO.GetStringAttribute("DB_PART_NO").ToString Then
'                    component2 = iChild
'                    theSession.Parts.SetWorkComponent(component2, NXOpen.PartCollection.RefsetOption.Entire, NXOpen.PartCollection.WorkComponentOption.Visible, partLoadStatus1)
'                    Exit For
'                End If
'            Next

'            Dim modelingView1 As NXOpen.ModelingView = Nothing
'            Try
'                modelingView1 = workPart.ModelingViews.WorkView
'            Catch ex As Exception
'                modelingView1 = displayPart.ModelingViews.WorkView
'            End Try
'            modelingView1.Orient(NXOpen.View.Canned.Top, NXOpen.View.ScaleAdjustment.Current)
'            i = 0
'            For i = 0 To UBound(iPoint3DGocPlan)
'                Dim ip As NXOpen.Point = workPart.Points.CreatePoint(iPoint3DGocPlan(i))
'                Call Tao_Symbol(ip, iKetQuaPlan(i).ToUpper)
'                Call Create_Point_Features(iPoint3DGocPlan(i), iNamePointPlan(i), iKetQuaPlan(i).ToUpper)
'            Next

'            'Call Gan_PMI_Zentaizu(iPoint3DGocPlan, iNamePointPlan, iKetQuaPlan)
'            Try
'                Call Layout_PMI_Zentaizu(iPoint3DGocPlan, iNamePointPlan, "PLAN")
'            Catch ex As Exception
'                lw.WriteLine("Lỗi khi Layout PMI(PLAN): " & ex.ToString)
'            End Try

'            'Chụp ảnh
'            modelingView1.Orient(NXOpen.View.Canned.Top, NXOpen.View.ScaleAdjustment.Current)
'            Call Take_Picture(iComp.GetStringAttribute("DB_PART_NAME").ToString)
'            'sagyou iComp
'            iComp.Blank()
'        End If

'        If IsArray(iPoint3DGocBottom) = True Then
'            Call SagyouComponent(iCompTop)
'            Dim iComp As Component
'            CreateAssyNewLv2("BOTTOM VIEW", iComp)
'            Dim iCompDATA3D As Component, iCompANNO As Component
'            CreateAssyNewLv2("DATA 3D", iCompDATA3D)                                    'Đoạn này là lấy Data đại diện cho View
'            'shagyou và lấy data 3D đại diện cho vào đây
'            Dim iCompDataName As String = iCompDATA3D.GetStringAttribute("DB_PART_NO").ToString & "/AA"
'            ''sagyou iCompDATA3D
'            'For Each iChild As Component In iCompTop.GetChildren
'            '    If iChild.GetStringAttribute("DB_PART_NO").ToString = iCompDATA3D.GetStringAttribute("DB_PART_NO").ToString Then
'            '        theSession.Parts.SetWorkComponent(iChild, partLoadStatus1)
'            '        workPart = theSession.Parts.Work
'            '    End If
'            'Next
'            For Each iString As String In iDataBottom
'                Try
'                    AddComponentByNoPDM(iCompDataName, iString & "/" & GetRev(iString))
'                Catch ex As Exception
'                    AddComponentByNoASSY(iCompDataName, iString & "/" & GetRev(iString))
'                End Try
'            Next
'            ''sagyou iComp
'            'For Each iChild As Component In iCompTop.GetChildren
'            '    If iChild.GetStringAttribute("DB_PART_NO").ToString = iComp.GetStringAttribute("DB_PART_NO").ToString Then
'            '        theSession.Parts.SetWorkComponent(iChild, partLoadStatus1)
'            '        workPart = theSession.Parts.Work
'            '    End If
'            'Next
'            Call SagyouComponent(iComp)

'            CreateAssyNewLv2("ANNOTATION", iCompANNO)                                   'Đoạn này là tạo chỉ thị PMI ANNO cho View
'            theSession.UpdateManager.InterpartDelay = False
'            Dim component2 As NXOpen.Assemblies.Component = CType(iCompANNO, Component)
'            For Each iChild As Component In iComp.GetChildren
'                If iChild.GetStringAttribute("DB_PART_NO").ToString = iCompANNO.GetStringAttribute("DB_PART_NO").ToString Then
'                    component2 = iChild
'                    theSession.Parts.SetWorkComponent(component2, NXOpen.PartCollection.RefsetOption.Entire, NXOpen.PartCollection.WorkComponentOption.Visible, partLoadStatus1)
'                    Exit For
'                End If
'            Next

'            Dim modelingView1 As NXOpen.ModelingView = Nothing
'            Try
'                modelingView1 = workPart.ModelingViews.WorkView
'            Catch ex As Exception
'                modelingView1 = displayPart.ModelingViews.WorkView
'            End Try
'            modelingView1.Orient(NXOpen.View.Canned.Top, NXOpen.View.ScaleAdjustment.Current)
'            i = 0
'            For i = 0 To UBound(iPoint3DGocBottom)
'                Dim ip As NXOpen.Point = workPart.Points.CreatePoint(iPoint3DGocBottom(i))
'                Call Tao_Symbol(ip, iKetQuaBottom(i).ToUpper)
'                Call Create_Point_Features(iPoint3DGocBottom(i), iNamePointBottom(i), iKetQuaBottom(i).ToUpper)
'            Next
'            'Call Gan_PMI_Zentaizu(iPoint3DGocBottom, iNamePointBottom, iKetQuaBottom)
'            Try
'                Call Layout_PMI_Zentaizu(iPoint3DGocBottom, iNamePointBottom, "PLAN")
'            Catch ex As Exception
'                lw.WriteLine("Lỗi khi Layout PMI(BOTTOM): " & ex.ToString)
'            End Try
'            'Chụp ảnh
'            modelingView1.Orient(NXOpen.View.Canned.Bottom, NXOpen.View.ScaleAdjustment.Current)
'            Call Take_Picture(iComp.GetStringAttribute("DB_PART_NAME").ToString)
'            'sagyou iComp
'            iComp.Blank()
'        End If

'        If IsArray(iPoint3DGocLeftSide) = True Then
'            Call SagyouComponent(iCompTop)
'            Dim iComp As Component
'            CreateAssyNewLv2("LEFT SIDE VIEW", iComp)
'            Dim iCompDATA3D As Component, iCompANNO As Component
'            CreateAssyNewLv2("DATA 3D", iCompDATA3D)                                    'Đoạn này là lấy Data đại diện cho View
'            'shagyou và lấy data 3D đại diện cho vào đây
'            Dim iCompDataName As String = iCompDATA3D.GetStringAttribute("DB_PART_NO").ToString & "/AA"
'            ''sagyou iCompDATA3D
'            'For Each iChild As Component In iCompTop.GetChildren
'            '    If iChild.GetStringAttribute("DB_PART_NO").ToString = iCompDATA3D.GetStringAttribute("DB_PART_NO").ToString Then
'            '        theSession.Parts.SetWorkComponent(iChild, partLoadStatus1)
'            '        workPart = theSession.Parts.Work
'            '    End If
'            'Next
'            For Each iString As String In iDataLeftSide
'                Try
'                    AddComponentByNoPDM(iCompDataName, iString & "/" & GetRev(iString))
'                Catch ex As Exception
'                    AddComponentByNoASSY(iCompDataName, iString & "/" & GetRev(iString))
'                End Try
'            Next
'            ''sagyou iComp
'            'For Each iChild As Component In iCompTop.GetChildren
'            '    If iChild.GetStringAttribute("DB_PART_NO").ToString = iComp.GetStringAttribute("DB_PART_NO").ToString Then
'            '        theSession.Parts.SetWorkComponent(iChild, partLoadStatus1)
'            '        workPart = theSession.Parts.Work
'            '    End If
'            'Next
'            Call SagyouComponent(iComp)

'            CreateAssyNewLv2("ANNOTATION", iCompANNO)                                   'Đoạn này là tạo chỉ thị PMI ANNO cho View
'            theSession.UpdateManager.InterpartDelay = False
'            Dim component2 As NXOpen.Assemblies.Component = CType(iCompANNO, Component)
'            For Each iChild As Component In iComp.GetChildren
'                If iChild.GetStringAttribute("DB_PART_NO").ToString = iCompANNO.GetStringAttribute("DB_PART_NO").ToString Then
'                    component2 = iChild
'                    theSession.Parts.SetWorkComponent(component2, NXOpen.PartCollection.RefsetOption.Entire, NXOpen.PartCollection.WorkComponentOption.Visible, partLoadStatus1)
'                    Exit For
'                End If
'            Next
'            Dim modelingView1 As NXOpen.ModelingView = Nothing
'            Try
'                modelingView1 = workPart.ModelingViews.WorkView
'            Catch ex As Exception
'                modelingView1 = displayPart.ModelingViews.WorkView
'            End Try
'            modelingView1.Orient(NXOpen.View.Canned.Front, NXOpen.View.ScaleAdjustment.Current)
'            i = 0
'            For i = 0 To UBound(iPoint3DGocLeftSide)
'                Dim ip As NXOpen.Point = workPart.Points.CreatePoint(iPoint3DGocLeftSide(i))
'                Call Tao_Symbol(ip, iKetQuaLeftSide(i).ToUpper)
'                Call Create_Point_Features(iPoint3DGocLeftSide(i), iNamePointLeftSide(i), iKetQuaLeftSide(i).ToUpper)
'            Next

'            'Call Gan_PMI_Zentaizu(iPoint3DGocLeftSide, iNamePointLeftSide, iKetQuaLeftSide)
'            Try
'                Call Layout_PMI_Zentaizu(iPoint3DGocLeftSide, iNamePointLeftSide, "LEFTSIDE")
'            Catch ex As Exception
'                lw.WriteLine("Lỗi khi Layout PMI(LEFT): " & ex.ToString)
'            End Try
'            'Chụp ảnh
'            Call Take_Picture(iComp.GetStringAttribute("DB_PART_NAME").ToString)

'            'Call SagyouComponent(iCompTop)
'            iComp.Blank()
'            'sagyou iComp
'            'iComp.Blank()
'            'For Each iChild As Component In iCompTop.GetChildren
'            '    If iChild.GetStringAttribute("DB_PART_NO").ToString = iComp.GetStringAttribute("DB_PART_NO").ToString Then
'            '        theSession.Parts.SetWorkComponent(iChild, partLoadStatus1)
'            '        workPart = theSession.Parts.Work
'            '        lw.WriteLine("snicnisn")
'            '        iComp.Blank()
'            '        lw.WriteLine("snicnisn")
'            '    End If
'            'Next

'            'Exit Sub
'        End If

'        If IsArray(iPoint3DGocRightSide) = True Then
'            Call SagyouComponent(iCompTop)
'            Dim iComp As Component
'            CreateAssyNewLv2("RIGHT SIDE VIEW", iComp)
'            Dim iCompDATA3D As Component, iCompANNO As Component
'            CreateAssyNewLv2("DATA 3D", iCompDATA3D)                                    'Đoạn này là lấy Data đại diện cho View
'            'shagyou và lấy data 3D đại diện cho vào đây
'            Dim iCompDataName As String = iCompDATA3D.GetStringAttribute("DB_PART_NO").ToString & "/AA"
'            ''sagyou iCompDATA3D
'            'For Each iChild As Component In iCompTop.GetChildren
'            '    If iChild.GetStringAttribute("DB_PART_NO").ToString = iCompDATA3D.GetStringAttribute("DB_PART_NO").ToString Then
'            '        theSession.Parts.SetWorkComponent(iChild, partLoadStatus1)
'            '        workPart = theSession.Parts.Work
'            '    End If
'            'Next
'            For Each iString As String In iDataRightSide
'                Try
'                    AddComponentByNoPDM(iCompDataName, iString & "/" & GetRev(iString))
'                Catch ex As Exception
'                    AddComponentByNoASSY(iCompDataName, iString & "/" & GetRev(iString))
'                End Try
'            Next
'            ''sagyou iComp
'            'For Each iChild As Component In iCompTop.GetChildren
'            '    If iChild.GetStringAttribute("DB_PART_NO").ToString = iComp.GetStringAttribute("DB_PART_NO").ToString Then
'            '        theSession.Parts.SetWorkComponent(iChild, partLoadStatus1)
'            '        workPart = theSession.Parts.Work
'            '    End If
'            'Next
'            Call SagyouComponent(iComp)

'            CreateAssyNewLv2("ANNOTATION", iCompANNO)                                   'Đoạn này là tạo chỉ thị PMI ANNO cho View
'            theSession.UpdateManager.InterpartDelay = False
'            Dim component2 As NXOpen.Assemblies.Component = CType(iCompANNO, Component)
'            For Each iChild As Component In iComp.GetChildren
'                If iChild.GetStringAttribute("DB_PART_NO").ToString = iCompANNO.GetStringAttribute("DB_PART_NO").ToString Then
'                    component2 = iChild
'                    theSession.Parts.SetWorkComponent(component2, NXOpen.PartCollection.RefsetOption.Entire, NXOpen.PartCollection.WorkComponentOption.Visible, partLoadStatus1)
'                    Exit For
'                End If
'            Next
'            Dim modelingView1 As NXOpen.ModelingView = Nothing
'            Try
'                modelingView1 = workPart.ModelingViews.WorkView
'            Catch ex As Exception
'                modelingView1 = displayPart.ModelingViews.WorkView
'            End Try
'            modelingView1.Orient(NXOpen.View.Canned.Front, NXOpen.View.ScaleAdjustment.Current)
'            i = 0
'            For i = 0 To UBound(iPoint3DGocRightSide)
'                Dim ip As NXOpen.Point = workPart.Points.CreatePoint(iPoint3DGocRightSide(i))
'                Call Tao_Symbol(ip, iKetQuaRightSide(i).ToUpper)
'                Call Create_Point_Features(iPoint3DGocRightSide(i), iNamePointRightSide(i), iKetQuaRightSide(i).ToUpper)
'            Next
'            Try
'                Call Layout_PMI_Zentaizu(iPoint3DGocRightSide, iNamePointRightSide, "LEFTSIDE")
'            Catch ex As Exception
'                lw.WriteLine("Lỗi khi Layout PMI(RIGHT): " & ex.ToString)
'            End Try

'            'Call Gan_PMI_Zentaizu(iPoint3DGocRightSide, iNamePointRightSide, iKetQuaRightSide)

'            'Chụp ảnh
'            modelingView1.Orient(NXOpen.View.Canned.Back, NXOpen.View.ScaleAdjustment.Current)
'            Call Take_Picture(iComp.GetStringAttribute("DB_PART_NAME").ToString)
'            'sagyou iComp
'            'For Each iChild As Component In iCompTop.GetChildren
'            '    If iChild.GetStringAttribute("DB_PART_NO").ToString = iComp.GetStringAttribute("DB_PART_NO").ToString Then
'            '        theSession.Parts.SetWorkComponent(iChild, partLoadStatus1)
'            '        workPart = theSession.Parts.Work
'            '    End If
'            'Next
'            iComp.Blank()
'        End If

'        If IsArray(iPoint3DGocFront) = True Then
'            Call SagyouComponent(iCompTop)
'            Dim iComp As Component
'            CreateAssyNewLv2("FRONT VIEW", iComp)
'            Dim iCompDATA3D As Component, iCompANNO As Component
'            CreateAssyNewLv2("DATA 3D", iCompDATA3D)                                    'Đoạn này là lấy Data đại diện cho View
'            'shagyou và lấy data 3D đại diện cho vào đây
'            Dim iCompDataName As String = iCompDATA3D.GetStringAttribute("DB_PART_NO").ToString & "/AA"
'            ''sagyou iCompDATA3D
'            'For Each iChild As Component In iCompTop.GetChildren
'            '    If iChild.GetStringAttribute("DB_PART_NO").ToString = iCompDATA3D.GetStringAttribute("DB_PART_NO").ToString Then
'            '        theSession.Parts.SetWorkComponent(iChild, partLoadStatus1)
'            '        workPart = theSession.Parts.Work
'            '    End If
'            'Next
'            For Each iString As String In iDataFront
'                Try
'                    AddComponentByNoPDM(iCompDataName, iString & "/" & GetRev(iString))
'                Catch ex As Exception
'                    AddComponentByNoASSY(iCompDataName, iString & "/" & GetRev(iString))
'                End Try
'            Next
'            ''sagyou iComp
'            'For Each iChild As Component In iCompTop.GetChildren
'            '    If iChild.GetStringAttribute("DB_PART_NO").ToString = iComp.GetStringAttribute("DB_PART_NO").ToString Then
'            '        theSession.Parts.SetWorkComponent(iChild, partLoadStatus1)
'            '        workPart = theSession.Parts.Work
'            '    End If
'            'Next
'            Call SagyouComponent(iComp)

'            CreateAssyNewLv2("ANNOTATION", iCompANNO)                                   'Đoạn này là tạo chỉ thị PMI ANNO cho View
'            theSession.UpdateManager.InterpartDelay = False
'            Dim component2 As NXOpen.Assemblies.Component = CType(iCompANNO, Component)
'            For Each iChild As Component In iComp.GetChildren
'                If iChild.GetStringAttribute("DB_PART_NO").ToString = iCompANNO.GetStringAttribute("DB_PART_NO").ToString Then
'                    component2 = iChild
'                    theSession.Parts.SetWorkComponent(component2, NXOpen.PartCollection.RefsetOption.Entire, NXOpen.PartCollection.WorkComponentOption.Visible, partLoadStatus1)
'                    Exit For
'                End If
'            Next
'            Dim modelingView1 As NXOpen.ModelingView = Nothing
'            Try
'                modelingView1 = workPart.ModelingViews.WorkView
'            Catch ex As Exception
'                modelingView1 = displayPart.ModelingViews.WorkView
'            End Try
'            modelingView1.Orient(NXOpen.View.Canned.Left, NXOpen.View.ScaleAdjustment.Current)
'            i = 0
'            For i = 0 To UBound(iPoint3DGocFront)
'                Dim ip As NXOpen.Point = workPart.Points.CreatePoint(iPoint3DGocFront(i))
'                Call Tao_Symbol(ip, iKetQuaFront(i).ToUpper)
'                Call Create_Point_Features(iPoint3DGocFront(i), iNamePointFront(i), iKetQuaFront(i).ToUpper)
'            Next
'            Try
'                Call Layout_PMI_Zentaizu(iPoint3DGocFront, iNamePointFront, "FRONT")
'            Catch ex As Exception
'                lw.WriteLine("Lỗi khi Layout PMI(FRONT): " & ex.ToString)
'            End Try

'            'Call Gan_PMI_Zentaizu(iPoint3DGocFront, iNamePointFront, iKetQuaFront)
'            'Chụp ảnh
'            Call Take_Picture(iComp.GetStringAttribute("DB_PART_NAME").ToString)
'            'sagyou iComp
'            'For Each iChild As Component In iCompTop.GetChildren
'            '    If iChild.GetStringAttribute("DB_PART_NO").ToString = iComp.GetStringAttribute("DB_PART_NO").ToString Then
'            '        theSession.Parts.SetWorkComponent(iChild, partLoadStatus1)
'            '        workPart = theSession.Parts.Work
'            '    End If
'            'Next
'            iComp.Blank()
'        End If

'        If IsArray(iPoint3DGocRear) = True Then
'            Call SagyouComponent(iCompTop)
'            Dim iComp As Component
'            CreateAssyNewLv2("REAR VIEW", iComp)
'            Dim iCompDATA3D As Component, iCompANNO As Component
'            CreateAssyNewLv2("DATA 3D", iCompDATA3D)                                    'Đoạn này là lấy Data đại diện cho View
'            'shagyou và lấy data 3D đại diện cho vào đây
'            Dim iCompDataName As String = iCompDATA3D.GetStringAttribute("DB_PART_NO").ToString & "/AA"
'            ''sagyou iCompDATA3D
'            'For Each iChild As Component In iCompTop.GetChildren
'            '    If iChild.GetStringAttribute("DB_PART_NO").ToString = iCompDATA3D.GetStringAttribute("DB_PART_NO").ToString Then
'            '        theSession.Parts.SetWorkComponent(iChild, partLoadStatus1)
'            '        workPart = theSession.Parts.Work
'            '    End If
'            'Next
'            For Each iString As String In iDataRear
'                Try
'                    AddComponentByNoPDM(iCompDataName, iString & "/" & GetRev(iString))
'                Catch ex As Exception
'                    AddComponentByNoASSY(iCompDataName, iString & "/" & GetRev(iString))
'                End Try
'            Next
'            ''sagyou iComp
'            'For Each iChild As Component In iCompTop.GetChildren
'            '    If iChild.GetStringAttribute("DB_PART_NO").ToString = iComp.GetStringAttribute("DB_PART_NO").ToString Then
'            '        theSession.Parts.SetWorkComponent(iChild, partLoadStatus1)
'            '        workPart = theSession.Parts.Work
'            '    End If
'            'Next
'            Call SagyouComponent(iComp)

'            CreateAssyNewLv2("ANNOTATION", iCompANNO)                                   'Đoạn này là tạo chỉ thị PMI ANNO cho View
'            theSession.UpdateManager.InterpartDelay = False
'            Dim component2 As NXOpen.Assemblies.Component = CType(iCompANNO, Component)
'            For Each iChild As Component In iComp.GetChildren
'                If iChild.GetStringAttribute("DB_PART_NO").ToString = iCompANNO.GetStringAttribute("DB_PART_NO").ToString Then
'                    component2 = iChild
'                    theSession.Parts.SetWorkComponent(component2, NXOpen.PartCollection.RefsetOption.Entire, NXOpen.PartCollection.WorkComponentOption.Visible, partLoadStatus1)
'                    Exit For
'                End If
'            Next
'            Dim modelingView1 As NXOpen.ModelingView = Nothing
'            Try
'                modelingView1 = workPart.ModelingViews.WorkView
'            Catch ex As Exception
'                modelingView1 = displayPart.ModelingViews.WorkView
'            End Try
'            modelingView1.Orient(NXOpen.View.Canned.Left, NXOpen.View.ScaleAdjustment.Current)

'            i = 0
'            For i = 0 To UBound(iPoint3DGocRear)
'                Dim ip As NXOpen.Point = workPart.Points.CreatePoint(iPoint3DGocRear(i))
'                Call Tao_Symbol(ip, iKetQuaRear(i).ToUpper)
'                Call Create_Point_Features(iPoint3DGocRear(i), iNamePointRear(i), iKetQuaRear(i).ToUpper)
'            Next
'            Try
'                Call Layout_PMI_Zentaizu(iPoint3DGocRear, iNamePointRear, "FRONT")
'            Catch ex As Exception
'                lw.WriteLine("Lỗi khi Layout PMI(REAR): " & ex.ToString)
'            End Try

'            'Call Gan_PMI_Zentaizu(iPoint3DGocRear, iNamePointRear, iKetQuaRear)
'            'Chụp ảnh
'            modelingView1.Orient(NXOpen.View.Canned.Right, NXOpen.View.ScaleAdjustment.Current)
'            Call Take_Picture(iComp.GetStringAttribute("DB_PART_NAME").ToString)
'            'sagyou iComp
'            'For Each iChild As Component In iCompTop.GetChildren
'            '    If iChild.GetStringAttribute("DB_PART_NO").ToString = iComp.GetStringAttribute("DB_PART_NO").ToString Then
'            '        theSession.Parts.SetWorkComponent(iChild, partLoadStatus1)
'            '        workPart = theSession.Parts.Work
'            '    End If
'            'Next
'            iComp.Blank()
'        End If

'        If IsArray(iPoint3DGocOther) = True Then
'            Call SagyouComponent(iCompTop)
'            Dim iComp As Component
'            CreateAssyNewLv2("OTHER", iComp)
'            Dim iCompDATA3D As Component, iCompANNO As Component
'            CreateAssyNewLv2("DATA 3D", iCompDATA3D)                                    'Đoạn này là lấy Data đại diện cho View
'            'shagyou và lấy data 3D đại diện cho vào đây
'            Dim iCompDataName As String = iCompDATA3D.GetStringAttribute("DB_PART_NO").ToString & "/AA"
'            ''sagyou iCompDATA3D
'            'For Each iChild As Component In iCompTop.GetChildren
'            '    If iChild.GetStringAttribute("DB_PART_NO").ToString = iCompDATA3D.GetStringAttribute("DB_PART_NO").ToString Then
'            '        theSession.Parts.SetWorkComponent(iChild, partLoadStatus1)
'            '        workPart = theSession.Parts.Work
'            '    End If
'            'Next
'            For Each iString As String In iDataOther
'                Try
'                    AddComponentByNoPDM(iCompDataName, iString & "/" & GetRev(iString))
'                Catch ex As Exception
'                    AddComponentByNoASSY(iCompDataName, iString & "/" & GetRev(iString))
'                End Try
'            Next
'            ''sagyou iComp
'            'For Each iChild As Component In iCompTop.GetChildren
'            '    If iChild.GetStringAttribute("DB_PART_NO").ToString = iComp.GetStringAttribute("DB_PART_NO").ToString Then
'            '        theSession.Parts.SetWorkComponent(iChild, partLoadStatus1)
'            '        workPart = theSession.Parts.Work
'            '    End If
'            'Next
'            Call SagyouComponent(iComp)

'            CreateAssyNewLv2("ANNOTATION", iCompANNO)                                   'Đoạn này là tạo chỉ thị PMI ANNO cho View
'            theSession.UpdateManager.InterpartDelay = False
'            Dim component2 As NXOpen.Assemblies.Component = CType(iCompANNO, Component)
'            For Each iChild As Component In iComp.GetChildren
'                If iChild.GetStringAttribute("DB_PART_NO").ToString = iCompANNO.GetStringAttribute("DB_PART_NO").ToString Then
'                    component2 = iChild
'                    theSession.Parts.SetWorkComponent(component2, NXOpen.PartCollection.RefsetOption.Entire, NXOpen.PartCollection.WorkComponentOption.Visible, partLoadStatus1)
'                    Exit For
'                End If
'            Next
'            Dim modelingView1 As NXOpen.ModelingView = Nothing
'            Try
'                modelingView1 = workPart.ModelingViews.WorkView
'            Catch ex As Exception
'                modelingView1 = displayPart.ModelingViews.WorkView
'            End Try
'            modelingView1.Orient(NXOpen.View.Canned.Front, NXOpen.View.ScaleAdjustment.Current)
'            i = 0
'            For i = 0 To UBound(iPoint3DGocOther)
'                Dim ip As NXOpen.Point = workPart.Points.CreatePoint(iPoint3DGocOther(i))
'                Call Tao_Symbol(ip, iKetQuaOther(i).ToUpper)
'                Call Create_Point_Features(iPoint3DGocOther(i), iNamePointOther(i), iKetQuaOther(i).ToUpper)
'            Next
'            Try
'                Call Layout_PMI_Zentaizu(iPoint3DGocOther, iNamePointOther, "LEFTSIDE")
'            Catch ex As Exception
'                lw.WriteLine("Lỗi khi Layout PMI(OTHER): " & ex.ToString)
'            End Try

'            'Call Gan_PMI_Zentaizu(iPoint3DGocOther, iNamePointOther, iKetQuaOther)
'            'Chụp ảnh
'            Call Take_Picture(iComp.GetStringAttribute("DB_PART_NAME").ToString)
'            'sagyou iComp
'            'For Each iChild As Component In iCompTop.GetChildren
'            '    If iChild.GetStringAttribute("DB_PART_NO").ToString = iComp.GetStringAttribute("DB_PART_NO").ToString Then
'            '        theSession.Parts.SetWorkComponent(iChild, partLoadStatus1)
'            '        workPart = theSession.Parts.Work
'            '    End If
'            'Next
'            iComp.Blank()
'        End If
'        Call SagyouComponent(iCompTop)

'        'Call Run_AddImgZentaizu()
'    End Sub

'    Sub Run_AddImgZentaizu()
'        objExcelIn.Run("AddZentaizu")
'    End Sub

'    Sub Sap_xep_thu_tu_PMI_theo_duong_bao(ByVal iiNamePoint() As String, ByVal iLinkString() As String, ByRef iPoint3DRiaSapXep() As Point3d, ByRef iPoint3DTrong() As Point3d)
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim lw As ListingWindow = theSession.ListingWindow
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        lw = theSession.ListingWindow
'        lw.Open()

'        Dim i As Integer = 0, j As Integer = 0
'        For i = 0 To UBound(iiNamePoint)
'            For j = 0 To UBound(iLinkString)
'                'lw.WriteLine("iiNamePoint: " & iiNamePoint(i) & " _ " & "iLinkString: " & iLinkString(j))
'                If Split(iiNamePoint(i), "_")(1) = Split(iLinkString(j), "_")(2) Then
'                    ReDim Preserve iPoint3DRiaSapXep(i)
'                    Dim q As Double
'                    'lw.WriteLine(iLinkString(j))
'                    q = Split(Split(Split(iLinkString(j), "_")(0), ",")(0), "=")(1)
'                    iPoint3DRiaSapXep(i).X = q
'                    q = Split(Split(Split(iLinkString(j), "_")(0), ",")(1), "=")(1)
'                    iPoint3DRiaSapXep(i).Y = q
'                    q = Split(Split(Split(Split(iLinkString(j), "_")(0), ",")(2), "=")(1), "]")(0)
'                    iPoint3DRiaSapXep(i).Z = q
'                    'lw.WriteLine(iPoint3DRiaSapXep(i).ToString)

'                    ReDim Preserve iPoint3DTrong(i)
'                    q = Split(Split(Split(iLinkString(j), "_")(1), ",")(0), "=")(1)
'                    iPoint3DTrong(i).X = q
'                    q = Split(Split(Split(iLinkString(j), "_")(1), ",")(1), "=")(1)
'                    iPoint3DTrong(i).Y = q
'                    q = Split(Split(Split(Split(iLinkString(j), "_")(1), ",")(2), "=")(1), "]")(0)
'                    iPoint3DTrong(i).Z = q
'                    'lw.WriteLine(iPoint3DTrong(i).ToString)

'                    Exit For
'                End If
'            Next
'        Next

'    End Sub

'    Sub Ve_duong_bao_quanh_diem(ByVal iPoint() As NXOpen.Point, ByVal iPhamvi As Double, ByVal iView As String, ByRef iiZone() As Double, ByRef iPointLine3D() As Point3d)
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim lw As ListingWindow = theSession.ListingWindow
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        lw = theSession.ListingWindow
'        lw.Open()
'        Dim iPointCS As NXOpen.Point, tempdir As Vector3d
'        Dim iPointXMax As Point3d, iPointXMin As Point3d
'        Dim iXmax As Double = -13042000, iXmin As Double = 13042000, iYmax As Double = -13042000, iYmin As Double = 13042000

'        Dim iTyle As Double
'        'PLAN VIEW
'        If iView = "PLAN" Then
'            For Each iP As NXOpen.Point In iPoint
'                If iP.Coordinates.X > iXmax Then
'                    iXmax = iP.Coordinates.X
'                End If
'                If iP.Coordinates.X < iXmin Then
'                    iXmin = iP.Coordinates.X
'                End If
'                If iP.Coordinates.Y > iYmax Then
'                    iYmax = iP.Coordinates.Y
'                End If
'                If iP.Coordinates.Y < iYmin Then
'                    iYmin = iP.Coordinates.Y
'                End If
'            Next
'            iTyle = (iXmax - iXmin) / (iYmax - iYmin)
'            Dim tempYdir As Vector3d = New Vector3d(0, 1, 0)
'            tempdir = tempYdir
'            iPointXMax.X = iXmax + iPhamvi
'            iPointXMax.Y = (iYmax + iYmin) / 2
'            iPointXMax.Z = 0

'            iPointXMin.X = iXmin - iPhamvi
'            iPointXMin.Y = (iYmax + iYmin) / 2
'            iPointXMin.Z = 0
'        End If
'        'FRONT VIEW
'        If iView = "FRONT" Then
'            For Each iP As NXOpen.Point In iPoint
'                If iP.Coordinates.Y > iXmax Then
'                    iXmax = iP.Coordinates.Y
'                End If
'                If iP.Coordinates.Y < iXmin Then
'                    iXmin = iP.Coordinates.Y
'                End If
'                If iP.Coordinates.Z > iYmax Then
'                    iYmax = iP.Coordinates.Z
'                End If
'                If iP.Coordinates.Z < iYmin Then
'                    iYmin = iP.Coordinates.Z
'                End If
'            Next
'            iTyle = (iXmax - iXmin) / (iYmax - iYmin)
'            Dim tempZdir As Vector3d = New Vector3d(0, 0, 1)
'            tempdir = tempZdir
'            iPointXMax.X = 0
'            iPointXMax.Y = iXmax + iPhamvi
'            iPointXMax.Z = (iYmax + iYmin) / 2

'            iPointXMin.X = 0
'            iPointXMin.Y = iXmin - iPhamvi
'            iPointXMin.Z = (iYmax + iYmin) / 2
'        End If
'        'LEFT SIDE VIEW
'        If iView = "LEFTSIDE" Then
'            For Each iP As NXOpen.Point In iPoint
'                If iP.Coordinates.X > iXmax Then
'                    iXmax = iP.Coordinates.X
'                End If
'                If iP.Coordinates.X < iXmin Then
'                    iXmin = iP.Coordinates.X
'                End If
'                If iP.Coordinates.Z > iYmax Then
'                    iYmax = iP.Coordinates.Z
'                End If
'                If iP.Coordinates.Z < iYmin Then
'                    iYmin = iP.Coordinates.Z
'                End If
'            Next
'            iTyle = (iXmax - iXmin) / (iYmax - iYmin)
'            Dim tempZdir As Vector3d = New Vector3d(0, 0, 1)
'            tempdir = tempZdir
'            iPointXMax.X = iXmax + iPhamvi
'            iPointXMax.Y = 0
'            iPointXMax.Z = (iYmax + iYmin) / 2

'            iPointXMin.X = iXmin - iPhamvi
'            iPointXMin.Y = 0
'            iPointXMin.Z = (iYmax + iYmin) / 2
'        End If


'        Dim iiPointLine(3) As Point3d                       'mảng chứa 4 điểm góc của đường bao quanh tất cả Point
'        'Call Create_LineEquation_From_Point_And_DirectionVector(iPointXMax, tempdir, iYmax + iPhamvi, iiPointLine(0))
'        'Call Create_LineEquation_From_Point_And_DirectionVector(iPointXMax, tempdir, iYmin - iPhamvi, iiPointLine(1))
'        'Call Create_LineEquation_From_Point_And_DirectionVector(iPointXMin, tempdir, iYmax + iPhamvi, iiPointLine(2))
'        'Call Create_LineEquation_From_Point_And_DirectionVector(iPointXMin, tempdir, iYmin - iPhamvi, iiPointLine(3))
'        Call Create_LineEquation_From_Point_And_DirectionVector(iPointXMax, tempdir, ((iXmax - iXmin) / 2 + iPhamvi) / iTyle, iiPointLine(0))
'        Call Create_LineEquation_From_Point_And_DirectionVector(iPointXMax, tempdir, -1 * ((iXmax - iXmin) / 2 + iPhamvi) / iTyle, iiPointLine(1))
'        Call Create_LineEquation_From_Point_And_DirectionVector(iPointXMin, tempdir, ((iXmax - iXmin) / 2 + iPhamvi) / iTyle, iiPointLine(2))
'        Call Create_LineEquation_From_Point_And_DirectionVector(iPointXMin, tempdir, -1 * ((iXmax - iXmin) / 2 + iPhamvi) / iTyle, iiPointLine(3))
'        iPointLine3D = iiPointLine
'        'workPart.Curves.CreateLine(iiPointLine(0), iiPointLine(1))
'        'workPart.Curves.CreateLine(iiPointLine(0), iiPointLine(2))
'        'workPart.Curves.CreateLine(iiPointLine(3), iiPointLine(1))
'        'workPart.Curves.CreateLine(iiPointLine(3), iiPointLine(2))

'        Dim iZone(3) As Double
'        'iZone(0) = iXmax + iPhamvi
'        'iZone(1) = iXmin - iPhamvi
'        'iZone(2) = iYmax + iPhamvi
'        'iZone(3) = iYmin - iPhamvi
'        iZone(0) = iXmax + iPhamvi
'        iZone(1) = iXmin - iPhamvi
'        iZone(2) = (iYmax + iYmin) / 2 + (((iXmax - iXmin) / 2 + iPhamvi) / iTyle)
'        iZone(3) = (iYmax + iYmin) / 2 + (-1 * ((iXmax - iXmin) / 2 + iPhamvi) / iTyle)
'        iiZone = iZone






'    End Sub

'    'Sub Create_LineEquation_From_Point_And_DirectionVector(ByVal iPoint As Point3d, ByVal iDirectionVector As Vector3d, ByVal t As Double, ByRef iPoint_Line As Point3d)
'    '    Dim theSession As Session = Session.GetSession()
'    '    Dim theUFSession As UFSession = UFSession.GetUFSession()
'    '    Dim workPart As Part = theSession.Parts.Work
'    '    Dim displayPart As NXOpen.Part = theSession.Parts.Display
'    '    Dim lw As ListingWindow = theSession.ListingWindow
'    '    Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'    '    lw = theSession.ListingWindow
'    '    lw.Open()
'    '    iPoint_Line.X = iPoint.X + iDirectionVector.X * t
'    '    iPoint_Line.Y = iPoint.Y + iDirectionVector.Y * t
'    '    iPoint_Line.Z = iPoint.Z + iDirectionVector.Z * t
'    'End Sub

'    Sub Xep_thu_tu_PMI_New(ByVal iPoint() As NXOpen.Point, ByVal iPoint3DGoc() As Point3d, ByVal iNamePoint() As String, ByVal iMidPoint3D As Point3d, ByVal iPointLine3D() As Point3d, ByVal iView As String, ByRef iTrucXMaxToaDo() As String, ByRef iTrucXMinToaDo() As String, ByRef iTrucYMaxToaDo() As String, ByRef iTrucYMinToaDo() As String, ByRef iiNamePoint() As String)
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim lw As ListingWindow = theSession.ListingWindow
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        lw = theSession.ListingWindow
'        lw.Open()


'        Dim qXMax As Integer = 0, qXMin As Integer = 0, qYMax As Integer = 0, qYMin As Integer = 0
'        Dim i As Integer = 0
'        For i = 0 To UBound(iPoint)
'            Dim iP3D As Point3d
'            Call Create_Point3D_From_Point(iPoint(i), iP3D)
'            Dim iPointGiao(3) As Point3d
'            Call Timgiaodiem2duongthang(iMidPoint3D, iP3D, iPointLine3D(0), iPointLine3D(1), iPointGiao(0))
'            Call Timgiaodiem2duongthang(iMidPoint3D, iP3D, iPointLine3D(0), iPointLine3D(2), iPointGiao(1))
'            Call Timgiaodiem2duongthang(iMidPoint3D, iP3D, iPointLine3D(3), iPointLine3D(1), iPointGiao(2))
'            Call Timgiaodiem2duongthang(iMidPoint3D, iP3D, iPointLine3D(3), iPointLine3D(2), iPointGiao(3))
'            Dim iLength() As Double
'            Dim a As Integer = 0
'            For Each iP3DLen As Point3d In iPointGiao
'                ReDim Preserve iLength(a)
'                'Call Create_Point_Features(iP3DLen, Nothing, Nothing)
'                Call GetLength2Point3D(iP3D, iP3DLen, iLength(a))
'                If iLength(a).ToString = "NaN" Then
'                    iLength(a) = 13042000
'                End If
'                a = a + 1
'            Next
'            Call Sapxepphantutrongmangtangdan(iLength, iLength)

'            Dim iLen As Double
'            If iView = "PLAN" Then
'                Call GetLength2Point3D(iP3D, iPointGiao(0), iLen)
'                If iLength(0) = iLen Then
'                    ReDim Preserve iTrucXMaxToaDo(qXMax)
'                    iTrucXMaxToaDo(qXMax) = iPointGiao(0).Y & "_" & iPoint3DGoc(i).ToString & "_" & iNamePoint(i)
'                    qXMax = qXMax + 1
'                Else
'                    Call GetLength2Point3D(iP3D, iPointGiao(1), iLen)
'                    If iLength(0) = iLen Then
'                        ReDim Preserve iTrucYMaxToaDo(qYMax)
'                        iTrucYMaxToaDo(qYMax) = iPointGiao(1).X & "_" & iPoint3DGoc(i).ToString & "_" & iNamePoint(i)
'                        qYMax = qYMax + 1
'                    Else
'                        Call GetLength2Point3D(iP3D, iPointGiao(2), iLen)
'                        If iLength(0) = iLen Then
'                            ReDim Preserve iTrucYMinToaDo(qYMin)
'                            iTrucYMinToaDo(qYMin) = iPointGiao(2).X & "_" & iPoint3DGoc(i).ToString & "_" & iNamePoint(i)
'                            qYMin = qYMin + 1
'                        Else
'                            ReDim Preserve iTrucXMinToaDo(qXMin)
'                            iTrucXMinToaDo(qXMin) = iPointGiao(3).Y & "_" & iPoint3DGoc(i).ToString & "_" & iNamePoint(i)
'                            qXMin = qXMin + 1
'                        End If
'                    End If
'                End If
'            End If
'            If iView = "FRONT" Then
'                Call GetLength2Point3D(iP3D, iPointGiao(0), iLen)
'                If iLength(0) = iLen Then
'                    ReDim Preserve iTrucXMaxToaDo(qXMax)
'                    iTrucXMaxToaDo(qXMax) = iPointGiao(0).Z & "_" & iPoint3DGoc(i).ToString & "_" & iNamePoint(i)
'                    qXMax = qXMax + 1
'                Else
'                    Call GetLength2Point3D(iP3D, iPointGiao(1), iLen)
'                    If iLength(0) = iLen Then
'                        ReDim Preserve iTrucYMaxToaDo(qYMax)
'                        iTrucYMaxToaDo(qYMax) = iPointGiao(1).Y & "_" & iPoint3DGoc(i).ToString & "_" & iNamePoint(i)
'                        qYMax = qYMax + 1
'                    Else
'                        Call GetLength2Point3D(iP3D, iPointGiao(2), iLen)
'                        If iLength(0) = iLen Then
'                            ReDim Preserve iTrucYMinToaDo(qYMin)
'                            iTrucYMinToaDo(qYMin) = iPointGiao(2).Y & "_" & iPoint3DGoc(i).ToString & "_" & iNamePoint(i)
'                            qYMin = qYMin + 1
'                        Else
'                            ReDim Preserve iTrucXMinToaDo(qXMin)
'                            iTrucXMinToaDo(qXMin) = iPointGiao(3).Z & "_" & iPoint3DGoc(i).ToString & "_" & iNamePoint(i)
'                            qXMin = qXMin + 1
'                        End If
'                    End If
'                End If
'            End If
'            If iView = "LEFTSIDE" Then
'                Call GetLength2Point3D(iP3D, iPointGiao(0), iLen)
'                If iLength(0) = iLen Then
'                    ReDim Preserve iTrucXMaxToaDo(qXMax)
'                    iTrucXMaxToaDo(qXMax) = iPointGiao(0).Z & "_" & iPoint3DGoc(i).ToString & "_" & iNamePoint(i)
'                    'Call Create_Point_Features(iPointGiao(0), Nothing, Nothing)
'                    qXMax = qXMax + 1
'                Else
'                    Call GetLength2Point3D(iP3D, iPointGiao(1), iLen)
'                    If iLength(0) = iLen Then
'                        ReDim Preserve iTrucYMaxToaDo(qYMax)
'                        iTrucYMaxToaDo(qYMax) = iPointGiao(1).X & "_" & iPoint3DGoc(i).ToString & "_" & iNamePoint(i)
'                        'Call Create_Point_Features(iPointGiao(1), Nothing, Nothing)
'                        qYMax = qYMax + 1
'                    Else
'                        Call GetLength2Point3D(iP3D, iPointGiao(2), iLen)
'                        If iLength(0) = iLen Then
'                            ReDim Preserve iTrucYMinToaDo(qYMin)
'                            iTrucYMinToaDo(qYMin) = iPointGiao(2).X & "_" & iPoint3DGoc(i).ToString & "_" & iNamePoint(i)
'                            'Call Create_Point_Features(iPointGiao(2), Nothing, Nothing)
'                            qYMin = qYMin + 1
'                        Else
'                            ReDim Preserve iTrucXMinToaDo(qXMin)
'                            iTrucXMinToaDo(qXMin) = iPointGiao(3).Z & "_" & iPoint3DGoc(i).ToString & "_" & iNamePoint(i)
'                            'Call Create_Point_Features(iPointGiao(3), Nothing, Nothing)
'                            qXMin = qXMin + 1
'                        End If
'                    End If
'                End If
'            End If
'        Next


'        Dim q As Integer = 0
'        If IsArray(iTrucYMaxToaDo) = True Then
'            Call Sapxepphantutrongmangtangdan(iTrucYMaxToaDo, iTrucYMaxToaDo)
'            For i = 0 To UBound(iTrucYMaxToaDo)
'                'lw.WriteLine("ymax: " & iTrucYMaxToaDo(i).ToString)
'                ReDim Preserve iiNamePoint(q)
'                iiNamePoint(q) = Right(iTrucYMaxToaDo(i), Len(iTrucYMaxToaDo(i)) - InStr(iTrucYMaxToaDo(i), "_"))
'                q = q + 1
'            Next
'        End If
'        If IsArray(iTrucXMaxToaDo) = True Then
'            Call Sapxepphantutrongmangtangdan(iTrucXMaxToaDo, iTrucXMaxToaDo)
'            For i = UBound(iTrucXMaxToaDo) To 0 Step -1
'                'lw.WriteLine("xmax: " & iTrucXMaxToaDo(i).ToString)
'                ReDim Preserve iiNamePoint(q)
'                iiNamePoint(q) = Right(iTrucXMaxToaDo(i), Len(iTrucXMaxToaDo(i)) - InStr(iTrucXMaxToaDo(i), "_"))
'                q = q + 1
'            Next
'        End If
'        If IsArray(iTrucYMinToaDo) = True Then
'            Call Sapxepphantutrongmangtangdan(iTrucYMinToaDo, iTrucYMinToaDo)
'            For i = UBound(iTrucYMinToaDo) To 0 Step -1
'                'lw.WriteLine("ymin: " & iTrucYMinToaDo(i).ToString)
'                ReDim Preserve iiNamePoint(q)
'                iiNamePoint(q) = Right(iTrucYMinToaDo(i), Len(iTrucYMinToaDo(i)) - InStr(iTrucYMinToaDo(i), "_"))
'                q = q + 1
'            Next
'        End If
'        If IsArray(iTrucXMinToaDo) = True Then
'            Call Sapxepphantutrongmangtangdan(iTrucXMinToaDo, iTrucXMinToaDo)
'            For i = 0 To UBound(iTrucXMinToaDo)
'                'lw.WriteLine("xmin: " & iTrucXMinToaDo(i).ToString)
'                ReDim Preserve iiNamePoint(q)
'                iiNamePoint(q) = Right(iTrucXMinToaDo(i), Len(iTrucXMinToaDo(i)) - InStr(iTrucXMinToaDo(i), "_"))
'                q = q + 1
'            Next
'        End If

'    End Sub

'    Sub Sub_CreatePMI_FRONT_VIEW(ByVal iPoint As NXOpen.Point, ByVal iNamePoint As String, ByVal iZone() As Double, ByVal iTrucXMaxToaDo() As String, ByVal iTrucXMinToaDo() As String, ByVal iTrucYMaxToaDo() As String, ByVal iTrucYMinToaDo() As String, ByRef iLinkString As String)                  'tạo chỉ chị PMI tại gốc CS
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim lw As ListingWindow = theSession.ListingWindow
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        lw = theSession.ListingWindow
'        lw.Open()

'        Dim X1 As Double
'        Dim Y1 As Double
'        Dim Z1 As Double

'        Dim modelingView1 As ModelingView
'        modelingView1 = displayPart.ModelingViews.WorkView

'        Dim iLengthZoneX As Double = iZone(0) - iZone(1)
'        Dim iLengthZoneY As Double = iZone(2) - iZone(3)
'        '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'        Dim q As Integer = 0, idem As Integer = 0
'        Dim icheck As Boolean = False
'        If icheck = False Then
'            Try
'                For q = 0 To UBound(iTrucXMaxToaDo)
'                    If Split(iTrucXMaxToaDo(q), "_")(2) = iNamePoint Then
'                        X1 = iZone(0)
'                        Y1 = iZone(3) + (iLengthZoneY / (UBound(iTrucXMaxToaDo) + 2) * (q + 1))
'                        icheck = True
'                        Exit For
'                    End If
'                Next
'            Catch ex As Exception

'            End Try
'        End If
'        If icheck = False Then
'            Try
'                For q = 0 To UBound(iTrucXMinToaDo)
'                    If Split(iTrucXMinToaDo(q), "_")(2) = iNamePoint Then
'                        X1 = iZone(1)
'                        Y1 = iZone(3) + (iLengthZoneY / (UBound(iTrucXMinToaDo) + 2) * (q + 1))
'                        icheck = True
'                        Exit For
'                    End If
'                Next
'            Catch ex As Exception

'            End Try
'        End If
'        If icheck = False Then
'            Try
'                For q = 0 To UBound(iTrucYMaxToaDo)
'                    If Split(iTrucYMaxToaDo(q), "_")(2) = iNamePoint Then
'                        X1 = iZone(1) + (iLengthZoneX / UBound(iTrucYMaxToaDo) * q)
'                        Y1 = iZone(2)
'                        icheck = True
'                        Exit For
'                    End If
'                Next
'            Catch ex As Exception

'            End Try
'        End If
'        If icheck = False Then
'            Try
'                For q = 0 To UBound(iTrucYMinToaDo)
'                    If Split(iTrucYMinToaDo(q), "_")(2) = iNamePoint Then
'                        X1 = iZone(1) + (iLengthZoneX / UBound(iTrucYMinToaDo) * q)
'                        Y1 = iZone(3)
'                        icheck = True
'                        Exit For
'                    End If
'                Next
'            Catch ex As Exception

'            End Try
'        End If
'        Z1 = 0
'        Dim point3 As Point3d = New Point3d(Z1, X1, Y1)
'        iLinkString = point3.ToString & "_" & iPoint.Coordinates.ToString & "_" & iNamePoint
'    End Sub

'    Sub Sub_CreatePMI_PLAN_VIEW(ByVal iPoint As NXOpen.Point, ByVal iNamePoint As String, ByVal iZone() As Double, ByVal iTrucXMaxToaDo() As String, ByVal iTrucXMinToaDo() As String, ByVal iTrucYMaxToaDo() As String, ByVal iTrucYMinToaDo() As String, ByRef iLinkString As String)                  'tạo chỉ chị PMI tại gốc CS
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim lw As ListingWindow = theSession.ListingWindow
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        lw = theSession.ListingWindow
'        lw.Open()

'        Dim X1 As Double
'        Dim Y1 As Double
'        Dim Z1 As Double

'        Dim modelingView1 As ModelingView
'        modelingView1 = displayPart.ModelingViews.WorkView

'        Dim iLengthZoneX As Double = iZone(0) - iZone(1)
'        Dim iLengthZoneY As Double = iZone(2) - iZone(3)
'        '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'        Dim q As Integer = 0, idem As Integer = 0
'        Dim icheck As Boolean = False
'        If icheck = False Then
'            Try
'                For q = 0 To UBound(iTrucXMaxToaDo)
'                    If Split(iTrucXMaxToaDo(q), "_")(2) = iNamePoint Then
'                        X1 = iZone(0)
'                        Y1 = iZone(3) + (iLengthZoneY / (UBound(iTrucXMaxToaDo) + 2) * (q + 1))
'                        icheck = True
'                        Exit For
'                    End If
'                Next
'            Catch ex As Exception

'            End Try
'        End If
'        If icheck = False Then
'            Try
'                For q = 0 To UBound(iTrucXMinToaDo)
'                    If Split(iTrucXMinToaDo(q), "_")(2) = iNamePoint Then
'                        X1 = iZone(1)
'                        Y1 = iZone(3) + (iLengthZoneY / (UBound(iTrucXMinToaDo) + 2) * (q + 1))
'                        icheck = True
'                        Exit For
'                    End If
'                Next
'            Catch ex As Exception

'            End Try
'        End If
'        If icheck = False Then
'            Try
'                For q = 0 To UBound(iTrucYMaxToaDo)
'                    If Split(iTrucYMaxToaDo(q), "_")(2) = iNamePoint Then
'                        X1 = iZone(1) + (iLengthZoneX / UBound(iTrucYMaxToaDo) * q)
'                        Y1 = iZone(2)
'                        icheck = True
'                        Exit For
'                    End If
'                Next
'            Catch ex As Exception

'            End Try
'        End If
'        If icheck = False Then
'            Try
'                For q = 0 To UBound(iTrucYMinToaDo)
'                    If Split(iTrucYMinToaDo(q), "_")(2) = iNamePoint Then
'                        X1 = iZone(1) + (iLengthZoneX / UBound(iTrucYMinToaDo) * q)
'                        Y1 = iZone(3)
'                        icheck = True
'                        Exit For
'                    End If
'                Next
'            Catch ex As Exception

'            End Try
'        End If
'        Z1 = 0
'        Dim point3 As Point3d = New Point3d(X1, Y1, Z1)
'        iLinkString = point3.ToString & "_" & iPoint.Coordinates.ToString & "_" & iNamePoint
'    End Sub

'    Sub Sub_CreatePMI_LEFTSIDE_VIEW(ByVal iPoint As NXOpen.Point, ByVal iNamePoint As String, ByVal iZone() As Double, ByVal iTrucXMaxToaDo() As String, ByVal iTrucXMinToaDo() As String, ByVal iTrucYMaxToaDo() As String, ByVal iTrucYMinToaDo() As String, ByRef iLinkString As String)                  'tạo chỉ chị PMI tại gốc CS
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim lw As ListingWindow = theSession.ListingWindow
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        lw = theSession.ListingWindow
'        lw.Open()

'        Dim X1 As Double
'        Dim Y1 As Double
'        Dim Z1 As Double

'        Dim modelingView1 As ModelingView
'        modelingView1 = displayPart.ModelingViews.WorkView

'        Dim iLengthZoneX As Double = iZone(0) - iZone(1)
'        Dim iLengthZoneY As Double = iZone(2) - iZone(3)
'        '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'        Dim q As Integer = 0, idem As Integer = 0
'        Dim icheck As Boolean = False
'        If icheck = False Then
'            Try
'                For q = 0 To UBound(iTrucXMaxToaDo)
'                    If Split(iTrucXMaxToaDo(q), "_")(2) = iNamePoint Then
'                        X1 = iZone(0)
'                        Y1 = iZone(3) + (iLengthZoneY / (UBound(iTrucXMaxToaDo) + 2) * (q + 1))
'                        icheck = True
'                        Exit For
'                    End If
'                Next
'            Catch ex As Exception

'            End Try
'        End If
'        If icheck = False Then
'            Try
'                For q = 0 To UBound(iTrucXMinToaDo)
'                    If Split(iTrucXMinToaDo(q), "_")(2) = iNamePoint Then
'                        X1 = iZone(1)
'                        Y1 = iZone(3) + (iLengthZoneY / (UBound(iTrucXMinToaDo) + 2) * (q + 1))
'                        icheck = True
'                        Exit For
'                    End If
'                Next
'            Catch ex As Exception

'            End Try
'        End If
'        If icheck = False Then
'            Try
'                For q = 0 To UBound(iTrucYMaxToaDo)
'                    If Split(iTrucYMaxToaDo(q), "_")(2) = iNamePoint Then
'                        X1 = iZone(1) + (iLengthZoneX / UBound(iTrucYMaxToaDo) * q)
'                        Y1 = iZone(2)
'                        icheck = True
'                        Exit For
'                    End If
'                Next
'            Catch ex As Exception

'            End Try
'        End If
'        If icheck = False Then
'            Try
'                For q = 0 To UBound(iTrucYMinToaDo)
'                    If Split(iTrucYMinToaDo(q), "_")(2) = iNamePoint Then
'                        X1 = iZone(1) + (iLengthZoneX / UBound(iTrucYMinToaDo) * q)
'                        Y1 = iZone(3)
'                        icheck = True
'                        Exit For
'                    End If
'                Next
'            Catch ex As Exception

'            End Try
'        End If
'        Z1 = 0

'        Dim point3 As Point3d = New Point3d(X1, Z1, Y1)

'        iLinkString = point3.ToString & "_" & iPoint.Coordinates.ToString & "_" & iNamePoint


'    End Sub

'    'Sub GetLength2Point3D(ByVal iPoint1 As Point3d, ByVal iPoint2 As Point3d, ByRef iLength As Double)
'    '    Dim theSession As Session = Session.GetSession()
'    '    Dim theUFSession As UFSession = UFSession.GetUFSession()
'    '    Dim workPart As Part = theSession.Parts.Work
'    '    Dim displayPart As NXOpen.Part = theSession.Parts.Display
'    '    Dim lw As ListingWindow = theSession.ListingWindow
'    '    Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'    '    lw = theSession.ListingWindow
'    '    lw.Open()
'    '    iLength = Math.Sqrt((iPoint1.X - iPoint2.X) ^ 2 + (iPoint1.Y - iPoint2.Y) ^ 2 + (iPoint1.Z - iPoint2.Z) ^ 2)
'    'End Sub

'    Sub Sapxepphantutrongmangtangdan(ByVal iArray() As Double, ByRef iArrayOut() As Double)                 'bài toán nổi bọt
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim lw As ListingWindow = theSession.ListingWindow
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        lw = theSession.ListingWindow
'        lw.Open()
'        ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'        Dim i As Integer = 0, j As Integer = 0
'        Dim iChua As Double
'        For j = 0 To UBound(iArray)
'            For i = 0 To UBound(iArray)
'                If i < UBound(iArray) Then
'                    If iArray(i) > iArray(i + 1) Then
'                        iChua = iArray(i)
'                        iArray(i) = iArray(i + 1)
'                        iArray(i + 1) = iChua
'                    End If
'                End If
'            Next
'        Next
'        iArrayOut = iArray
'    End Sub

'    Sub Create_Point_Features(ByVal ip3D As Point3d, ByVal iName As String, ByVal iKetQua As String)
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim lw As ListingWindow = theSession.ListingWindow
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        lw = theSession.ListingWindow
'        lw.Open()

'        If ip3D.ToString = "[0,0,0]" Then
'            Exit Sub
'        End If
'        'Tạo features điểm
'        Dim ip As NXOpen.Point = workPart.Points.CreatePoint(ip3D)
'        Dim nullNXOpen_Features_Feature As NXOpen.Features.Feature = Nothing
'        Dim pointFeatureBuilder1 As NXOpen.Features.PointFeatureBuilder = Nothing
'        pointFeatureBuilder1 = workPart.BaseFeatures.CreatePointFeatureBuilder(nullNXOpen_Features_Feature)
'        pointFeatureBuilder1.Point = ip
'        Dim nXObject1 As NXOpen.NXObject = Nothing
'        nXObject1 = pointFeatureBuilder1.Commit()
'        pointFeatureBuilder1.Destroy()
'        'Đặt tên cho features điểm
'        Dim pointFeature1 As NXOpen.Features.PointFeature = CType(nXObject1, NXOpen.Features.PointFeature)
'        'lw.writeline(iName)
'        iName = Trim(iName)
'        pointFeature1.SetName(iName)
'        'Đổi màu điểm
'        Dim displayModification1 As NXOpen.DisplayModification = Nothing
'        displayModification1 = theSession.DisplayManager.NewDisplayModification()
'        displayModification1.ApplyToAllFaces = True
'        displayModification1.ApplyToOwningParts = False
'        If iKetQua = "OK" Then
'            'Call Tao_Symbol(ip, iKetQua)
'            displayModification1.NewColor = OK_Color                         '36 là mã màu xanh trong NX
'        ElseIf iKetQua = "NG" Then
'            'Call Tao_Symbol(ip, iKetQua)
'            displayModification1.NewColor = NG_Color                         '186 là mã màu đỏ trong NX
'        ElseIf iKetQua = "CA" Then
'            'Call Tao_Symbol(ip, iKetQua)
'            displayModification1.NewColor = CA_Color                         '6 là mã màu vàng trong NX
'        Else
'            displayModification1.NewColor = Other_Color
'        End If
'        displayModification1.NewWidth = NXOpen.DisplayableObject.ObjectWidth.Three
'        Dim objects1(0) As NXOpen.DisplayableObject
'        objects1(0) = ip
'        displayModification1.Apply(objects1)
'        displayModification1.Dispose()

'    End Sub

'    Sub Tao_Symbol(ByVal ip As NXOpen.Point, ByVal iKetQua As String)
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim lw As ListingWindow = theSession.ListingWindow
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        lw = theSession.ListingWindow
'        lw.Open()

'        If ip.Coordinates.ToString = "[0,0,0]" Then
'            Exit Sub
'        End If
'        Dim nullNXOpen_Annotations_PmiCustomSymbol As NXOpen.Annotations.PmiCustomSymbol = Nothing
'        Dim pmiCustomSymbolBuilder1 As NXOpen.Annotations.PmiCustomSymbolBuilder = Nothing
'        pmiCustomSymbolBuilder1 = workPart.Annotations.CustomSymbols.CreatePmiCustomSymbolBuilder(nullNXOpen_Annotations_PmiCustomSymbol)
'        If iKetQua.ToUpper = "OK" Then
'            pmiCustomSymbolBuilder1.SelectSymbol("C:\UGS\NAP\v11\symbol\NISSAN Symbols\Circle_Blue.sym.prt")                        'Đường dẫn tới Symbol
'        ElseIf iKetQua = "NG" Then
'            pmiCustomSymbolBuilder1.SelectSymbol("C:\UGS\NAP\v11\symbol\NISSAN Symbols\Striker_Red.sym.prt")                        'Đường dẫn tới Symbol
'        ElseIf iKetQua = "CA" Then
'            pmiCustomSymbolBuilder1.SelectSymbol("C:\UGS\NAP\v11\symbol\NISSAN Symbols\Circle_Blue.sym.prt")                        'Đường dẫn tới Symbol
'            'pmiCustomSymbolBuilder1.SelectSymbol("C:\UGS\NAP\v11\symbol\Identification Symbols\triangleup.sym.prt")                        'Đường dẫn tới Symbol
'            'Dim arbitrarynotetitle1(0) As String
'            'arbitrarynotetitle1(0) = "<D1>!<D>"
'            'pmiCustomSymbolBuilder1.SetArbitraryNoteTitle(arbitrarynotetitle1)
'        Else
'            pmiCustomSymbolBuilder1.SelectSymbol("C:\UGS\NAP\v11\symbol\NISSAN Symbols\Circle_Blue.sym.prt")                        'Đường dẫn tới Symbol
'            'pmiCustomSymbolBuilder1.SelectSymbol("C:\UGS\NAP\v11\symbol\Identification Symbols\triangleup.sym.prt")                        'Đường dẫn tới Symbol
'        End If

'        Dim point3 As NXOpen.Point3d
'        Call Create_Point3D_From_Point(ip, point3)
'        If iKetQua.ToUpper = "CA" Then
'            pmiCustomSymbolBuilder1.Scale.RightHandSide = "2.5"                   'Kích cỡ symbol
'            'pmiCustomSymbolBuilder1.Scale.RightHandSide = "1.2"                   'Kích cỡ symbol
'            'If iView.ToUpper = "LEFT SIDE VIEW" Then
'            '    point3.X = point3.X + 2.8
'            '    point3.Z = point3.Z + 2
'            'ElseIf iView.ToUpper = "PLAN VIEW" Then
'            '    point3.X = point3.X + 2.8
'            '    point3.Y = point3.Y + 2
'            'ElseIf iView.ToUpper = "FRONT VIEW" Then
'            '    point3.Y = point3.Y - 2.8
'            '    point3.Z = point3.Z + 2
'            'End If
'        ElseIf iKetQua.ToUpper = "NG" Then
'            pmiCustomSymbolBuilder1.Scale.RightHandSide = "3"                   'Kích cỡ symbol
'        ElseIf iKetQua.ToUpper = "OK" Then
'            pmiCustomSymbolBuilder1.Scale.RightHandSide = "2"                   'Kích cỡ symbol
'        Else
'            pmiCustomSymbolBuilder1.Scale.RightHandSide = "2.5"                   'Kích cỡ symbol
'            'pmiCustomSymbolBuilder1.Scale.RightHandSide = "1.2"                   'Kích cỡ symbol
'            'If iView.ToUpper = "LEFT SIDE VIEW" Then
'            '    point3.X = point3.X + 2.8
'            '    point3.Z = point3.Z + 2
'            'ElseIf iView.ToUpper = "PLAN VIEW" Then
'            '    point3.X = point3.X + 2.8
'            '    point3.Y = point3.Y + 2
'            'ElseIf iView.ToUpper = "FRONT VIEW" Then
'            '    point3.Y = point3.Y - 2.8
'            '    point3.Z = point3.Z + 2
'            'End If
'        End If


'        ip = workPart.Points.CreatePoint(point3)
'        'Dim ipoint3 As Point3d = New Point3d(point3.X + 2, point3.Y + 2, point3.Z + 2)
'        'Dim iip As Point = workPart.Points.CreatePoint(ipoint3)


'        'pmiCustomSymbolBuilder1.Origin.Plane.PlaneMethod = NXOpen.Annotations.PlaneBuilder.PlaneMethodType.UserDefined              'Hướng đặt Symbol
'        Dim assocOrigin1 As NXOpen.Annotations.Annotation.AssociativeOriginData = Nothing
'        assocOrigin1.OriginType = NXOpen.Annotations.AssociativeOriginType.AtAPoint
'        Dim nullNXOpen_View As NXOpen.View = Nothing
'        assocOrigin1.View = nullNXOpen_View
'        assocOrigin1.ViewOfGeometry = nullNXOpen_View
'        Dim nullNXOpen_Point As NXOpen.Point = Nothing
'        assocOrigin1.PointOnGeometry = nullNXOpen_Point
'        Dim nullNXOpen_Annotations_Annotation As NXOpen.Annotations.Annotation = Nothing
'        assocOrigin1.VertAnnotation = nullNXOpen_Annotations_Annotation
'        assocOrigin1.VertAlignmentPosition = NXOpen.Annotations.AlignmentPosition.TopLeft
'        assocOrigin1.HorizAnnotation = nullNXOpen_Annotations_Annotation
'        assocOrigin1.HorizAlignmentPosition = NXOpen.Annotations.AlignmentPosition.TopLeft
'        assocOrigin1.AlignedAnnotation = nullNXOpen_Annotations_Annotation
'        assocOrigin1.DimensionLine = 0
'        assocOrigin1.AssociatedView = displayPart.ModelingViews.WorkView
'        assocOrigin1.AssociatedPoint = ip
'        assocOrigin1.OffsetAnnotation = nullNXOpen_Annotations_Annotation
'        assocOrigin1.OffsetAlignmentPosition = NXOpen.Annotations.AlignmentPosition.TopLeft
'        assocOrigin1.XOffsetFactor = 0.0
'        assocOrigin1.YOffsetFactor = 0.0
'        assocOrigin1.StackAlignmentPosition = NXOpen.Annotations.StackAlignmentPosition.Above
'        pmiCustomSymbolBuilder1.Origin.SetAssociativeOrigin(assocOrigin1)


'        ''''''''''''''''''''''''''''''''''''''''đoạn này là để chỉ thị hiện theo hướng view nhìn hiện tại''''''''''''''''''''''''''''''
'        Dim modelingView1 As ModelingView
'        modelingView1 = displayPart.ModelingViews.WorkView
'        pmiCustomSymbolBuilder1.Origin.Plane.PlaneMethod = Annotations.PlaneBuilder.PlaneMethodType.UserDefined
'        Dim origin1 As Point3d = New Point3d(point3.X, point3.Y, point3.Z)
'        Dim xDirection1 As Vector3d = New Vector3d(modelingView1.Matrix.Xx, modelingView1.Matrix.Xy, modelingView1.Matrix.Xz)
'        Dim yDirection1 As Vector3d = New Vector3d(modelingView1.Matrix.Yx, modelingView1.Matrix.Yy, modelingView1.Matrix.Yz)
'        Dim xform3 As Xform
'        xform3 = workPart.Xforms.CreateXform(origin1, xDirection1, yDirection1, SmartObject.UpdateOption.AfterModeling, 1.0#)
'        Dim cartesianCoordinateSystem1 As CartesianCoordinateSystem
'        cartesianCoordinateSystem1 = workPart.CoordinateSystems.CreateCoordinateSystem(xform3, SmartObject.UpdateOption.AfterModeling)
'        pmiCustomSymbolBuilder1.Origin.Plane.UserDefinedPlane = xform3
'        pmiCustomSymbolBuilder1.Origin.SetInferRelativeToGeometry(True)
'        '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'        '''''''''''''''''''''
'        'If iView = "FRONT VIEW" Then
'        '    pmiCustomSymbolBuilder1.HorizontalFlip = True
'        'Else
'        '    pmiCustomSymbolBuilder1.HorizontalFlip = False
'        'End If
'        '''''''''''''''''''''

'        pmiCustomSymbolBuilder1.Origin.Origin.SetValue(Nothing, nullNXOpen_View, point3)

'        pmiCustomSymbolBuilder1.Origin.SetInferRelativeToGeometry(True)
'        Dim nXObject1 As NXOpen.NXObject = Nothing
'        nXObject1 = pmiCustomSymbolBuilder1.Commit()
'        pmiCustomSymbolBuilder1.Destroy()


'        Dim displayModification1 As NXOpen.DisplayModification = Nothing
'        displayModification1 = theSession.DisplayManager.NewDisplayModification()
'        displayModification1.ApplyToAllFaces = True
'        displayModification1.ApplyToOwningParts = False
'        If iKetQua.ToUpper = "OK" Then
'            displayModification1.NewColor = OK_Color
'        ElseIf iKetQua = "NG" Then
'            displayModification1.NewColor = NG_Color
'        ElseIf iKetQua = "CA" Then
'            displayModification1.NewColor = CA_Color
'        Else
'            displayModification1.NewColor = Other_Color
'        End If
'        displayModification1.NewWidth = NXOpen.DisplayableObject.ObjectWidth.One
'        Dim objects1(0) As NXOpen.DisplayableObject
'        Dim pmiCustomSymbol1 As NXOpen.Annotations.PmiCustomSymbol = CType(nXObject1, NXOpen.Annotations.PmiCustomSymbol)
'        objects1(0) = pmiCustomSymbol1
'        displayModification1.Apply(objects1)
'        displayModification1.Dispose()

'    End Sub

'    Sub Sapxepphantutrongmangtangdan(ByVal iArray() As String, ByRef iArrayOut() As String)                 'bài toán nổi bọt
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim lw As ListingWindow = theSession.ListingWindow
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        lw = theSession.ListingWindow
'        lw.Open()
'        ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'        Dim a As Double, aa As Double
'        Dim i As Integer = 0, j As Integer = 0
'        Dim iChua As String
'        For j = 0 To UBound(iArray)
'            For i = 0 To UBound(iArray)
'                If i < UBound(iArray) Then
'                    a = Left(iArray(i), (InStr(iArray(i), "_") - 1))
'                    aa = Left(iArray(i + 1), (InStr(iArray(i + 1), "_") - 1))
'                    If a > aa Then
'                        iChua = iArray(i)
'                        iArray(i) = iArray(i + 1)
'                        iArray(i + 1) = iChua
'                    End If
'                End If
'            Next
'        Next
'        iArrayOut = iArray
'    End Sub

'    'Sub Timgiaodiem2duongthang(ByVal A1 As Point3d, ByVal B1 As Point3d, ByVal A2 As Point3d, ByVal B2 As Point3d, ByRef iPointGiao As Point3d)            'mp Oxy
'    '    Dim theSession As Session = Session.GetSession()
'    '    Dim theUFSession As UFSession = UFSession.GetUFSession()
'    '    Dim workPart As Part = theSession.Parts.Work
'    '    Dim displayPart As NXOpen.Part = theSession.Parts.Display
'    '    Dim lw As ListingWindow = theSession.ListingWindow
'    '    Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'    '    lw = theSession.ListingWindow
'    '    lw.Open()

'    '    Dim a As Vector3d
'    '    Dim b As Vector3d
'    '    Dim t As Double

'    '    '''''''''''''''''Thông số của iLine1 : Điểm đầu cuối, vector a chỉ phương''''''''''''''''''''
'    '    'Start_End_Mid_Point_ForCurve(iLine1, A1, B1, C1)
'    '    a.X = B1.X - A1.X                                           'giá trị vector a
'    '    a.Y = B1.Y - A1.Y
'    '    a.Z = B1.Z - A1.Z

'    '    '''''''''''''''''Thông số của iLine2 : Điểm đầu cuối, vector b chỉ phương''''''''''''''''''''
'    '    'Start_End_Mid_Point_ForCurve(iLine2, A2, B2, C2)
'    '    b.X = B2.X - A2.X                                           'giá trị vector b
'    '    b.Y = B2.Y - A2.Y
'    '    b.Z = B2.Z - A2.Z

'    '    '''''''''''''''''Tìm t'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'    '    If (b.X * a.Y - a.X * b.Y) <> 0 Then        'Kiểm tra điều kiện mẫu số của t <> 0
'    '        t = ((A2.Y - A1.Y) * b.X - (A2.X - A1.X) * b.Y) / (b.X * a.Y - a.X * b.Y)
'    '    ElseIf (b.X * a.Z - a.X * b.Z) <> 0 Then
'    '        t = ((A2.Z - A1.Z) * b.X - (A2.X - A1.X) * b.Z) / (b.X * a.Z - a.X * b.Z)
'    '    Else
'    '        t = ((A2.Z - A1.Z) * b.Y - (A2.Y - A1.Y) * b.Z) / (b.Y * a.Z - a.Y * b.Z)
'    '    End If

'    '    ''''''''''''''''Tìm giao điểm dựa vào t''''''''''''''''''''''''''''''''''''''''''''''''''''''
'    '    iPointGiao.X = A1.X + a.X * t
'    '    iPointGiao.Y = A1.Y + a.Y * t
'    '    iPointGiao.Z = A1.Z + a.Z * t

'    'End Sub

'    'Sub Create_Point3D_From_Point(ByVal iPoint As NXOpen.Point, ByRef iPoint3D As Point3d)
'    '    Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'    '    Dim workPart As NXOpen.Part = theSession.Parts.Work
'    '    Dim displayPart As NXOpen.Part = theSession.Parts.Display
'    '    Dim TheUFsession As UFSession = UFSession.GetUFSession()
'    '    theSession = Session.GetSession()
'    '    Dim theUI As UI = UI.GetUI()
'    '    lw = theSession.ListingWindow
'    '    lw.Open()
'    '    iPoint3D.X = iPoint.Coordinates.X
'    '    iPoint3D.Y = iPoint.Coordinates.Y
'    '    iPoint3D.Z = iPoint.Coordinates.Z
'    'End Sub

'    Sub InputExcel(ByRef dtInOut As DataTable)
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim lw As ListingWindow = theSession.ListingWindow
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        lw = theSession.ListingWindow
'        lw.Open()


'        objExcelIn = CreateObject("Excel.Application")
'        objExcelIn.DisplayAlerts = False
'        Dim objWorkbookIn = objExcelIn.Workbooks.Open(ExcelLinkInput)
'        Dim objWorksheetIn = objWorkbookIn.Worksheets("MATOME")
'        objExcelIn.visible = True

'        Dim colVitri As Integer = 3
'        Dim colCSFunction As Integer = 4
'        Dim colCSPartNo As Integer = 5
'        Dim colX As Integer = 6
'        Dim colY As Integer = 7
'        Dim colZ As Integer = 8
'        Dim colTeiketsuMono As Integer = 9
'        Dim colDanmenBangou As Integer = 10
'        Dim colKekka As Integer = 45
'        Dim colComment As Integer = 46

'        Dim i As Integer
'        Dim DataArray(1000000, 9) As Object
'        Dim dtIn As New DataTable
'        dtIn.Columns.Add("締結位置番号")
'        dtIn.Columns.Add("CS Function")
'        dtIn.Columns.Add("CS Part No")
'        dtIn.Columns.Add("X")
'        dtIn.Columns.Add("Y")
'        dtIn.Columns.Add("Z")
'        dtIn.Columns.Add("締結物")
'        dtIn.Columns.Add("断面番号")
'        dtIn.Columns.Add("結果")
'        dtIn.Columns.Add("Comment")
'        Dim row As DataRow
'        Dim lngLastRow As Long
'        lngLastRow = objWorksheetIn.Cells(14, colVitri).End(xlDown).Row

'        For i = 26 To lngLastRow
'            row = dtIn.NewRow
'            Try
'                DataArray(i - 26, 0) = objWorksheetIn.Cells(i, colVitri).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 1) = objWorksheetIn.Cells(i, colCSFunction).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 2) = objWorksheetIn.Cells(i, colCSPartNo).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 3) = objWorksheetIn.Cells(i, colX).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 4) = objWorksheetIn.Cells(i, colY).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 5) = objWorksheetIn.Cells(i, colZ).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 6) = objWorksheetIn.Cells(i, colTeiketsuMono).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 7) = objWorksheetIn.Cells(i, colDanmenBangou).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 8) = objWorksheetIn.Cells(i, colKekka).Value
'            Catch ex As Exception

'            End Try
'            Try
'                DataArray(i - 26, 9) = objWorksheetIn.Cells(i, colComment).Value
'            Catch ex As Exception

'            End Try


'            Try
'                row("締結位置番号") = DataArray(i - 26, 0).ToString
'            Catch ex As Exception

'            End Try
'            Try
'                row("CS Function") = DataArray(i - 26, 1).ToString
'            Catch ex As Exception

'            End Try
'            Try
'                row("CS Part No") = DataArray(i - 26, 2).ToString
'            Catch ex As Exception

'            End Try
'            Try
'                row("X") = DataArray(i - 26, 3).ToString
'            Catch ex As Exception

'            End Try
'            Try
'                row("Y") = DataArray(i - 26, 4).ToString
'            Catch ex As Exception

'            End Try
'            Try
'                row("Z") = DataArray(i - 26, 5).ToString
'            Catch ex As Exception

'            End Try
'            Try
'                row("締結物") = DataArray(i - 26, 6).ToString
'            Catch ex As Exception

'            End Try
'            Try
'                row("断面番号") = DataArray(i - 26, 7).ToString
'            Catch ex As Exception

'            End Try
'            Try
'                row("結果") = DataArray(i - 26, 8).ToString
'            Catch ex As Exception

'            End Try
'            Try
'                row("Comment") = DataArray(i - 26, 9).ToString
'            Catch ex As Exception

'            End Try
'            dtIn.Rows.Add(row)
'        Next
'        dtInOut = dtIn

'        'objWorkbookIn.Save()
'        'objWorkbookIn.Close()
'        'objExcelIn.Quit()

'    End Sub

'    Sub Trong_tam_diem(ByVal iPoint() As NXOpen.Point, ByRef iMidPoint As Point3d)
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim lw As ListingWindow = theSession.ListingWindow
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        lw = theSession.ListingWindow
'        lw.Open()

'        Dim iSumX As Double = 0, iSumY As Double = 0, iSumZ As Double = 0
'        For Each iP As NXOpen.Point In iPoint
'            iSumX = iP.Coordinates.X + iSumX
'            iSumY = iP.Coordinates.Y + iSumY
'            iSumZ = iP.Coordinates.Z + iSumZ
'        Next
'        iMidPoint.X = iSumX / (UBound(iPoint) + 1)
'        iMidPoint.Y = iSumY / (UBound(iPoint) + 1)
'        iMidPoint.Z = iSumZ / (UBound(iPoint) + 1)
'    End Sub
'    ''
'    Sub Sap_xep_tranh_kanshou(ByVal iPoint3DRiaSapXep() As Point3d, ByVal iPoint3DTrong() As Point3d, ByVal iiNamePoint() As String, ByRef iCheckkanshou As Boolean)
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim lw As ListingWindow = theSession.ListingWindow
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        lw = theSession.ListingWindow
'        lw.Open()

'        Dim i As Integer = 0, j As Integer = 0, k As Integer = 0
'        'For k = 0 To UBound(iPoint3DRiaSapXep)
'        For j = 0 To UBound(iPoint3DRiaSapXep)
'            For i = 0 To UBound(iPoint3DRiaSapXep)
'                If i < UBound(iPoint3DRiaSapXep) Then
'                    Dim iPoint3D As Point3d
'                    Call Timgiaodiem2duongthang(iPoint3DRiaSapXep(i), iPoint3DTrong(i), iPoint3DRiaSapXep(i + 1), iPoint3DTrong(i + 1), iPoint3D)
'                    Dim iiCheckKanshou As Boolean = True, iLen1 As Double, iLen2 As Double, iPoint3DTG As Point3d, iiNamePointTG As String
'                    Call GetLength2Point3D(iPoint3DRiaSapXep(i), iPoint3D, iLen1)
'                    Call GetLength2Point3D(iPoint3DRiaSapXep(i), iPoint3DTrong(i), iLen2)
'                    If iLen1 >= iLen2 Then
'                        iiCheckKanshou = False
'                    Else
'                        Call GetLength2Point3D(iPoint3DRiaSapXep(i + 1), iPoint3D, iLen1)
'                        Call GetLength2Point3D(iPoint3DRiaSapXep(i + 1), iPoint3DTrong(i), iLen2)
'                        If iLen1 >= iLen2 Then
'                            iiCheckKanshou = False
'                        End If
'                    End If
'                    If iiCheckKanshou = True Then
'                        iPoint3DTG = iPoint3DTrong(i)
'                        iPoint3DTrong(i) = iPoint3DTrong(i + 1)
'                        iPoint3DTrong(i + 1) = iPoint3DTG
'                        iiNamePointTG = iiNamePoint(i)
'                        iiNamePoint(i) = iiNamePoint(i + 1)
'                        iiNamePoint(i + 1) = iiNamePointTG
'                    End If
'                End If
'            Next
'        Next

'        For j = 0 To UBound(iPoint3DRiaSapXep)
'            For i = 0 To UBound(iPoint3DRiaSapXep)
'                If i < UBound(iPoint3DRiaSapXep) Then
'                    Dim iPoint3D As Point3d
'                    Call Timgiaodiem2duongthang(iPoint3DRiaSapXep(i), iPoint3DTrong(i), iPoint3DRiaSapXep(i + 1), iPoint3DTrong(i + 1), iPoint3D)
'                    Dim iiCheckKanshou As Boolean = True, iLen1 As Double, iLen2 As Double, iPoint3DTG As Point3d, iiNamePointTG As String
'                    Call GetLength2Point3D(iPoint3DRiaSapXep(i), iPoint3D, iLen1)
'                    Call GetLength2Point3D(iPoint3DRiaSapXep(i), iPoint3DTrong(i), iLen2)
'                    If iLen1 >= iLen2 Then
'                        iiCheckKanshou = False
'                    Else
'                        Call GetLength2Point3D(iPoint3DRiaSapXep(i + 1), iPoint3D, iLen1)
'                        Call GetLength2Point3D(iPoint3DRiaSapXep(i + 1), iPoint3DTrong(i), iLen2)
'                        If iLen1 >= iLen2 Then
'                            iiCheckKanshou = False
'                        End If
'                    End If
'                    If iiCheckKanshou = True Then
'                        iCheckkanshou = True
'                        Exit Sub
'                    Else
'                        iCheckkanshou = False
'                    End If
'                End If
'            Next
'        Next
'        'Next

'        'iiPoint3DTrong = iPoint3DTrong
'        'iText = iiNamePoint
'    End Sub

'    'Function CosOf2Line(ByVal iPt1 As Point3d, ByVal iPt2 As Point3d, ByVal iPt3 As Point3d, ByVal iPt4 As Point3d) As Double
'    '    Dim theSession As Session = Session.GetSession()
'    '    Dim theUFSession As UFSession = UFSession.GetUFSession()
'    '    Dim workPart As Part = theSession.Parts.Work
'    '    Dim displayPart As NXOpen.Part = theSession.Parts.Display
'    '    lw = theSession.ListingWindow
'    '    lw.Open()
'    '    Dim v1x As Double, v1y As Double, v1z As Double, v2x As Double, v2y As Double, v2z As Double
'    '    v1x = iPt1.X - iPt2.X
'    '    v1y = iPt1.Y - iPt2.Y
'    '    v1z = iPt1.Z - iPt2.Z

'    '    v2x = iPt3.X - iPt4.X
'    '    v2y = iPt3.Y - iPt4.Y
'    '    v2z = iPt3.Z - iPt4.Z
'    '    CosOf2Line = (v1x * v2x + v1y * v2y + v1z * v2z) / Math.Sqrt((v1x ^ 2 + v1y ^ 2 + v1z ^ 2) * (v2x ^ 2 + v2y ^ 2 + v2z ^ 2))
'    'End Function

'    'Function CreatTopAssyLv1(myName As String, ByRef iSectAuto As Component) As Assemblies.Component
'    '    Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'    '    Dim theSession As Session = Session.GetSession()
'    '    Dim fileNewX As FileNew
'    '    Dim partLoadStatusX As PartLoadStatus
'    '    Dim createNewComponentBuilderX As Assemblies.CreateNewComponentBuilder
'    '    Dim myPart As Assemblies.Component
'    '    Dim nXObjectX As NXObject
'    '    Dim workpart As Part = theSession.Parts.Work
'    '    'fileNewX = CreatPart(myName            ???

'    '    theSession.Parts.SetWorkComponent(myPart, partLoadStatusX)
'    '    workpart = theSession.Parts.Work
'    '    partLoadStatusX.Dispose()
'    '    createNewComponentBuilderX = workpart.AssemblyManager.CreateNewComponentBuilder()
'    '    createNewComponentBuilderX.NewFile = fileNewX

'    '    iSectAuto = createNewComponentBuilderX.Commit()
'    '    Dim component1 As Assemblies.Component = CType(iSectAuto, Assemblies.Component)       'Set workpart sau khi tao
'    '    theSession.Parts.SetWorkComponent(component1, partLoadStatus1)
'    '    workpart = theSession.Parts.Work
'    '    createNewComponentBuilderX.Destroy()
'    '    CreatTopAssyLv1 = myPart
'    'End Function

'    'Sub CreateAssyNewLv2(ByVal iCompName As String, ByRef iOutComp As Component)
'    '    Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'    '    Dim workPart As NXOpen.Part = theSession.Parts.Work
'    '    Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'    '    Dim displayPart As NXOpen.Part = theSession.Parts.Display
'    '    Dim fileNew1 As NXOpen.FileNew = Nothing
'    '    fileNew1 = theSession.Parts.FileNew()
'    '    fileNew1.TemplateFileName = "@DB/assembly-mm-template_NX11/A"
'    '    fileNew1.UseBlankTemplate = False
'    '    fileNew1.ApplicationName = "AssemblyTemplate"
'    '    fileNew1.Units = NXOpen.Part.Units.Millimeters
'    '    fileNew1.RelationType = "master"
'    '    fileNew1.UsesMasterModel = "No"
'    '    fileNew1.TemplateType = NXOpen.FileNewTemplateType.Item
'    '    fileNew1.TemplatePresentationName = "Assembly"
'    '    fileNew1.ItemType = "CAD"
'    '    fileNew1.Specialization = ""
'    '    fileNew1.SetCanCreateAltrep(False)
'    '    fileNew1.MasterFileName = ""
'    '    fileNew1.MakeDisplayedPart = False
'    '    Dim partOperationCreateBuilder1 As NXOpen.PDM.PartOperationCreateBuilder = Nothing
'    '    partOperationCreateBuilder1 = theSession.PdmSession.CreateCreateOperationBuilder(NXOpen.PDM.PartOperationBuilder.OperationType.Create)
'    '    fileNew1.SetPartOperationCreateBuilder(partOperationCreateBuilder1)
'    '    partOperationCreateBuilder1.SetOperationSubType(NXOpen.PDM.PartOperationCreateBuilder.OperationSubType.FromTemplate)
'    '    partOperationCreateBuilder1.SetModelType("master")
'    '    partOperationCreateBuilder1.SetItemType("CAD")

'    '    Dim logicalobjects1() As NXOpen.PDM.LogicalObject
'    '    partOperationCreateBuilder1.CreateLogicalObjects(logicalobjects1)
'    '    Dim sourceobjects1() As NXOpen.NXObject
'    '    sourceobjects1 = logicalobjects1(0).GetUserAttributeSourceObjects()
'    '    Dim sourceobjects2() As NXOpen.NXObject
'    '    sourceobjects2 = logicalobjects1(0).GetUserAttributeSourceObjects()
'    '    partOperationCreateBuilder1.SetOperationSubType(NXOpen.PDM.PartOperationCreateBuilder.OperationSubType.FromTemplate)
'    '    Dim sourceobjects3() As NXOpen.NXObject
'    '    sourceobjects3 = logicalobjects1(0).GetUserAttributeSourceObjects()

'    '    Dim objects1(0) As NXOpen.NXObject
'    '    objects1(0) = logicalobjects1(0)
'    '    Dim errorList1 As NXOpen.ErrorList = Nothing
'    '    errorList1 = partOperationCreateBuilder1.AutoAssignAttributes(objects1)

'    '    errorList1.Dispose()
'    '    Dim errorList2 As NXOpen.ErrorList = Nothing
'    '    errorList2 = partOperationCreateBuilder1.GetOperationFailures()

'    '    Dim objects2(-1) As NXOpen.NXObject
'    '    Dim attributePropertiesBuilder1 As NXOpen.AttributePropertiesBuilder = Nothing
'    '    attributePropertiesBuilder1 = theSession.AttributeManager.CreateAttributePropertiesBuilder(workPart, objects2, NXOpen.AttributePropertiesBuilder.OperationType.None)

'    '    Dim objects3(0) As NXOpen.NXObject
'    '    objects3(0) = sourceobjects1(0)
'    '    attributePropertiesBuilder1.SetAttributeObjects(objects3)
'    '    attributePropertiesBuilder1.Title = "DB_PART_NAME"
'    '    attributePropertiesBuilder1.Category = "CAD"
'    '    attributePropertiesBuilder1.StringValue = iCompName
'    '    Dim changed1 As Boolean = Nothing
'    '    changed1 = attributePropertiesBuilder1.CreateAttribute()

'    '    fileNew1.MasterFileName = ""
'    '    fileNew1.MakeDisplayedPart = False
'    '    partOperationCreateBuilder1.ValidateLogicalObjectsToCommit()
'    '    Dim logicalobjects2(0) As NXOpen.PDM.LogicalObject
'    '    logicalobjects2(0) = logicalobjects1(0)
'    '    partOperationCreateBuilder1.CreateSpecificationsForLogicalObjects(logicalobjects2)
'    '    attributePropertiesBuilder1.Destroy()

'    '    Dim createNewComponentBuilder1 As NXOpen.Assemblies.CreateNewComponentBuilder = Nothing
'    '    createNewComponentBuilder1 = workPart.AssemblyManager.CreateNewComponentBuilder()
'    '    createNewComponentBuilder1.ReferenceSet = NXOpen.Assemblies.CreateNewComponentBuilder.ComponentReferenceSetType.EntirePartOnly
'    '    createNewComponentBuilder1.ReferenceSetName = "Entire Part"
'    '    createNewComponentBuilder1.NewComponentName = iCompName
'    '    createNewComponentBuilder1.NewFile = fileNew1
'    '    Dim nXObject1 As NXOpen.NXObject = Nothing
'    '    nXObject1 = createNewComponentBuilder1.Commit()
'    '    iOutComp = CType(nXObject1, Component)
'    '    createNewComponentBuilder1.Destroy()
'    '    Dim component1 As Assemblies.Component = CType(nXObject1, Assemblies.Component)       'Set workpart sau khi tao
'    '    theSession.Parts.SetWorkComponent(component1, partLoadStatus1)
'    '    partLoadStatus1.Dispose()
'    '    nXObject1 = Nothing
'    '    theSession.CleanUpFacetedFacesAndEdges()

'    'End Sub

'    Public Function GetUnloadOption(ByVal dummy As String) As Integer

'        'Unloads the image immediately after execution within NX
'        GetUnloadOption = NXOpen.Session.LibraryUnloadOption.Immediately

'    End Function

'    Sub SagyouComponent(ByVal iComponent As Component)
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim lw As ListingWindow = theSession.ListingWindow
'        lw = theSession.ListingWindow
'        lw.Open()
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        theSession.Parts.SetWorkComponent(iComponent, NXOpen.PartCollection.RefsetOption.Entire, NXOpen.PartCollection.WorkComponentOption.Visible, partLoadStatus1)
'        workPart = theSession.Parts.Work
'        partLoadStatus1.Dispose()
'    End Sub

'    Sub Take_Picture(ByVal iString As String)

'        Dim theSession As Session = Session.GetSession()
'        Dim theUfSession As UFSession = UFSession.GetUFSession
'        Dim workpart As Part = theSession.Parts.Work
'        Dim disPart As Part = theSession.Parts.Display
'        Dim lw As ListingWindow = theSession.ListingWindow
'        lw = theSession.ListingWindow
'        lw.Open()
'        'Dim iRootComp As Component = workpart.ComponentAssembly.RootComponent
'        'iRootComp.Blank()
'        Dim tmpCs As NXOpen.CartesianCoordinateSystem
'        Dim myGroup As NXObject
'        Dim iRootPath As String = "D:\nxcad\scratch\2022_DB0_069_Picture"

'        'Call iResetFolder(iRootPath)
'        Dim ts As TimeSpan
'        ts = New TimeSpan(0, 0, 1)
'        'Ẩn toàn bộ CSYS
'        theSession.DisplayManager.HideByType("SHOW_HIDE_TYPE_CSYS", NXOpen.DisplayManager.ShowHideScope.AnyInAssembly)
'        theUfSession.Disp.MakeDisplayUpToDate()
'        Call FitView()
'        'theSession.Preferences.ScreenVisualization.ExcludeDatumsFromFit = True
'        'Dim ts1 As TimeSpan
'        'ts1 = New TimeSpan(0, 0, 1)
'        Try
'            workpart.ModelingViews.WorkView.Regenerate()
'            workpart.ModelingViews.WorkView.UpdateDisplay()
'        Catch ex As Exception
'            disPart.ModelingViews.WorkView.Regenerate()
'            disPart.ModelingViews.WorkView.UpdateDisplay()
'        End Try
'        Dim iSavePath As String
'        iSavePath = iRootPath & "\" & iString & ".png"
'        'Try
'        '    workpart.ModelingViews.WorkView.SetScale(workpart.ModelingViews.WorkView.Scale - 0.02)
'        'Catch ex As Exception
'        '    disPart.ModelingViews.WorkView.SetScale(disPart.ModelingViews.WorkView.Scale - 0.02)
'        'End Try
'        Call ChupAnh_Zentaizu(iSavePath)

'    End Sub

'    Sub ChupAnh_Zentaizu(ByVal iSavePath As String)
'        Dim theSession As Session = Session.GetSession()
'        Dim theUfSession As UFSession = UFSession.GetUFSession()
'        If IsNothing(theSession.Parts.BaseWork) Then 'active part required
'            Return
'        End If
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As Part = theSession.Parts.Display

'        Dim tempScreenshot As String
'        Dim tempLocation As String = IO.Path.GetTempPath
'        tempScreenshot = IO.Path.Combine(tempLocation, "NXscreenshot.png")

'        Try
'            workPart.Views.Refresh()
'        Catch ex As Exception
'            displayPart.Views.Refresh()
'        End Try
'        'Try
'        '    workPart.Views.FitAll()
'        'Catch ex As Exception
'        '    displayPart.Views.FitAll()
'        'End Try
'        Try
'            ExpScrShotToImg_Zentaizu(tempScreenshot)
'            'Call FitView()
'        Catch ex As Exception

'            Return
'        End Try
'        'Try
'        '    workPart.ModelingViews.WorkView.Regenerate()
'        '    workPart.ModelingViews.WorkView.UpdateDisplay()
'        'Catch ex As Exception
'        '    displayPart.ModelingViews.WorkView.Regenerate()
'        '    displayPart.ModelingViews.WorkView.UpdateDisplay()
'        'End Try
'        'For i As Integer = 1 To 100
'        '    Call FitView()
'        'Next
'        CropScreenshot_Zentaizu(tempScreenshot, 2, iSavePath)

'    End Sub

'    Sub ExpScrShotToImg_Zentaizu(ByVal fileImageInfo As String)
'        Dim theSession As Session = Session.GetSession()
'        Dim theUfSession As UFSession = UFSession.GetUFSession()
'        Dim wcsVisible As Boolean = theSession.Parts.BaseDisplay.WCS.Visibility
'        Dim triadVisible As Integer = theSession.Preferences.ScreenVisualization.TriadVisibility
'        Dim dispModelViewNames As Boolean = theSession.Parts.BaseDisplay.Preferences.NamesBorderVisualization.ShowModelViewNames
'        Dim dispModelViewimgPlusBorders As Boolean = theSession.Parts.BaseDisplay.Preferences.NamesBorderVisualization.ShowModelViewBorders

'        theSession.Parts.BaseDisplay.WCS.Visibility = False 'turn off the WCS
'        theSession.Preferences.ScreenVisualization.TriadVisibility = 0  'turn off triad
'        theSession.Parts.BaseDisplay.Preferences.NamesBorderVisualization.ShowModelViewBorders = True
'        theSession.Parts.BaseDisplay.Preferences.NamesBorderVisualization.ShowModelViewNames = False


'        Try
'            theUfSession.Disp.CreateImage(fileImageInfo, UFDisp.ImageFormat.Png, UFDisp.BackgroundColor.White)
'        Catch ex As Exception
'            MsgBox(ex.Message & ControlChars.NewLine & "'" & fileImageInfo & "' can not be created")
'            Throw New Exception("Screenshot can not be created")
'        Finally
'            theSession.Parts.BaseDisplay.WCS.Visibility = wcsVisible
'            theSession.Preferences.ScreenVisualization.TriadVisibility = triadVisible
'            theSession.Parts.BaseDisplay.Preferences.NamesBorderVisualization.ShowModelViewBorders = dispModelViewimgPlusBorders
'            theSession.Parts.BaseDisplay.Preferences.NamesBorderVisualization.ShowModelViewNames = dispModelViewNames
'        End Try

'        'theSession.Parts.BaseDisplay.WCS.Visibility = True  'turn off the WCS
'        'theSession.Preferences.ScreenVisualization.TriadVisibility = 1  'turn off triad
'        'theSession.Parts.BaseDisplay.Preferences.NamesBorderVisualization.ShowModelViewBorders = True 'turn off view imgPlusBorder
'        'theSession.Parts.BaseDisplay.Preferences.NamesBorderVisualization.ShowModelViewNames = False  'turn off view name
'    End Sub

'    Sub CropScreenshot_Zentaizu(ByVal fileImageInfo As String, ByVal imgPlusBorderWidth As Integer, ByVal iSavePath As String)
'        Dim theSession As Session = Session.GetSession()
'        Dim theUfSession As UFSession = UFSession.GetUFSession()
'        Dim imgInput As New Bitmap(fileImageInfo)
'        Dim imgPixelMinX As Integer = imgInput.Width
'        Dim imgPixelMinY As Integer = imgInput.Height
'        Dim imgPixelMaxX As Integer = 0
'        Dim imgPixelMaxY As Integer = 0
'        Dim bckgrndColor As Color = Color.White
'        Dim boderColor As Color = Color.White
'        Dim c As Color
'        Dim i As Integer = 0

'        'Do While (i < imgInput.Width)
'        '    Dim j As Integer = 0
'        '    Do While (j < imgInput.Height)
'        '        c = imgInput.GetPixel(i, j)
'        '        Dim r As Integer = 0
'        '        r = Convert.ToInt32(c.R)
'        '        Dim g As Integer = 0
'        '        g = Convert.ToInt32(c.G)
'        '        Dim b As Integer = 0
'        '        b = Convert.ToInt32(c.B)
'        '        Dim ans As Integer = ((r + g + b) / 3)
'        '        If (ans > 254) Then

'        '            r = 255
'        '            g = 255
'        '            b = 255
'        '        Else
'        '            r = 0
'        '            g = 0
'        '            b = 0
'        '        End If
'        '        c = Color.FromArgb(r, g, b)
'        '        imgInput.SetPixel(i, j, c)
'        '        j = (j + 1)
'        '    Loop
'        '    i = (i + 1)
'        'Loop

'        For y As Integer = 0 To imgInput.Height - 1
'            For x As Integer = 0 To imgInput.Width - 1
'                If imgInput.GetPixel(x, y).ToArgb <> bckgrndColor.ToArgb Then
'                    If x < imgPixelMinX Then
'                        imgPixelMinX = x
'                    ElseIf x + 1 > imgPixelMaxX Then
'                        imgPixelMaxX = x + 1
'                    End If
'                    If y < imgPixelMinY Then
'                        imgPixelMinY = y
'                    ElseIf y + 1 > imgPixelMaxY Then
'                        imgPixelMaxY = y + 1
'                    End If
'                End If
'            Next
'        Next
'        Dim rect As New Rectangle
'        Dim croppedZone As Bitmap
'        Try
'            rect = New Rectangle(imgPixelMinX - 5, imgPixelMinY - 5, imgPixelMaxX - imgPixelMinX + 10, imgPixelMaxY - imgPixelMinY + 10)
'            croppedZone = imgInput.Clone(rect, imgInput.PixelFormat)
'        Catch
'            rect = New Rectangle(imgPixelMinX, imgPixelMinY, imgPixelMaxX - imgPixelMinX, imgPixelMaxY - imgPixelMinY)
'            croppedZone = imgInput.Clone(rect, imgInput.PixelFormat)
'        End Try
'        Dim imgPlusBorder As New Bitmap(croppedZone.Width + (2 * imgPlusBorderWidth), croppedZone.Height + (2 * imgPlusBorderWidth), croppedZone.PixelFormat)
'        Dim gr As Graphics = Graphics.FromImage(imgPlusBorder)
'        Using myBrush As Brush = New SolidBrush(boderColor)
'            gr.FillRectangle(myBrush, 0, 0, imgPlusBorder.Width, imgPlusBorder.Height)
'        End Using
'        Dim xImage As Integer = imgPlusBorder.Width - croppedZone.Width - imgPlusBorderWidth
'        Dim yImage As Integer = imgPlusBorder.Height - croppedZone.Height - imgPlusBorderWidth
'        gr.CompositingMode = Drawing2D.CompositingMode.SourceOver
'        gr.DrawImage(croppedZone, New Drawing.Point(xImage, yImage))
'        imgInput.Dispose()
'        croppedZone.Dispose()
'        gr.Dispose()

'        Dim iTextName As String
'        imgPlusBorder.Save(iSavePath, Imaging.ImageFormat.Png)

'    End Sub

'    Sub Layout_PMI_Zentaizu(ByVal iPoint3DGoc() As Point3d, ByVal iNamePoint() As String, ByVal iView As String)
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim lw As ListingWindow = theSession.ListingWindow
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        lw = theSession.ListingWindow
'        lw.Open()

'        Dim i As Integer = 0, j As Integer = 0
'        Dim iPoint() As NXOpen.Point
'        Call Chieu_diem_len_mp_chuan(iPoint3DGoc, iView, iPoint)
'        Dim iZone() As Double                                   'mảng chứa thông tin giới hạn theo trục X,Y
'        Dim iPointLine3D() As Point3d                             'mảng chứa 4 điểm góc của đường bao quanh tất cả Point

'        Dim iMidPoint3D As Point3d
'        Call Trong_tam_diem(iPoint, iMidPoint3D)            'Điểm trọng tâm của View, từ điểm này chia View thành 4図
'        'Call Create_Point_Features(iMidPoint3D, "midpoint", "OK")
'        Dim iPhamvi As Double = 2500                   'Phạm vi chỉ thị PMI bao quanh xe   2500
'        Dim iTrucXMaxToaDo() As String, iTrucXMinToaDo() As String, iTrucYMaxToaDo() As String, iTrucYMinToaDo() As String
'        Dim a As Long, b As Long, c As Long, d As Long      'đề tránh trường hợp có mảng nào đó rỗng
'        Dim iiNamePoint() As String          'mảng điểm đặt đc sắp xếp theo 1 vòng quanh rìa, bên  trong có tọa độ gốc và tên điểm'''''''''''''''''''''
'        Dim iCheckKanshou As Boolean, iDem As Integer = 0
'        Dim iPoint3DRiaSapXep() As Point3d, iPoint3DTrong() As Point3d
'        'Dim iTyle As Double                     'tỷ lệ của Zone, lấy X làm chuẩn, Y theo X

'        Do
'            'Tìm vùng Zone phù hợp sao cho PMI không bị đè lên nhau
'            Do
'                Call Ve_duong_bao_quanh_diem(iPoint, iPhamvi, iView, iZone, iPointLine3D)
'                Call Xep_thu_tu_PMI_New(iPoint, iPoint3DGoc, iNamePoint, iMidPoint3D, iPointLine3D, iView, iTrucXMaxToaDo, iTrucXMinToaDo, iTrucYMaxToaDo, iTrucYMinToaDo, iiNamePoint)
'                'Kích thước của PMI là 130*30
'                Try
'                    a = UBound(iTrucXMaxToaDo)
'                Catch ex As Exception
'                    a = -1
'                End Try
'                Try
'                    b = UBound(iTrucXMinToaDo)
'                Catch ex As Exception
'                    b = -1
'                End Try
'                Try
'                    c = UBound(iTrucYMaxToaDo)
'                    'lw.WriteLine(c)
'                Catch ex As Exception
'                    c = -1
'                End Try
'                Try
'                    d = UBound(iTrucYMinToaDo)
'                Catch ex As Exception
'                    d = -1
'                End Try
'                If (a + 1) * 35 > (iZone(2) - iZone(3)) Or (b + 1) * 35 > (iZone(2) - iZone(3)) Or (c + 1) * 120 > (iZone(0) - iZone(1)) Or (d + 1) * 120 > (iZone(0) - iZone(1)) Then
'                    iPhamvi = iPhamvi + 200
'                Else
'                    Exit Do
'                End If
'            Loop

'            Dim iLinkString() As String
'            Dim iDiemdat() As Point3d
'            If iView = "PLAN" Then
'                For i = 0 To UBound(iPoint)
'                    ReDim Preserve iLinkString(i)
'                    Call Sub_CreatePMI_PLAN_VIEW(iPoint(i), iNamePoint(i), iZone, iTrucXMaxToaDo, iTrucXMinToaDo, iTrucYMaxToaDo, iTrucYMinToaDo, iLinkString(i))
'                Next
'            ElseIf iView = "FRONT" Then
'                For i = 0 To UBound(iPoint)
'                    ReDim Preserve iLinkString(i)
'                    Call Sub_CreatePMI_FRONT_VIEW(iPoint(i), iNamePoint(i), iZone, iTrucXMaxToaDo, iTrucXMinToaDo, iTrucYMaxToaDo, iTrucYMinToaDo, iLinkString(i))
'                Next
'            ElseIf iView = "LEFTSIDE" Then
'                For i = 0 To UBound(iPoint)
'                    ReDim Preserve iLinkString(i)
'                    Call Sub_CreatePMI_LEFTSIDE_VIEW(iPoint(i), iNamePoint(i), iZone, iTrucXMaxToaDo, iTrucXMinToaDo, iTrucYMaxToaDo, iTrucYMinToaDo, iLinkString(i))
'                Next
'            End If


'            'lw.WriteLine(iView & ": " & "iiNamePoint: " & UBound(iiNamePoint) & " _ " & "iLinkString: " & UBound(iLinkString))
'            Call Sap_xep_thu_tu_PMI_theo_duong_bao(iiNamePoint, iLinkString, iPoint3DRiaSapXep, iPoint3DTrong)

'            'Dim iiPoint3DTrong() As Point3d, iText() As String
'            Call Sap_xep_tranh_kanshou(iPoint3DRiaSapXep, iPoint3DTrong, iiNamePoint, iCheckKanshou)
'            If iCheckKanshou = True Then
'                iPhamvi = iPhamvi + 200
'            End If
'            iDem += 1
'            If iDem = 10 Or iCheckKanshou = False Then
'                'lw.WriteLine("iCheckKanshou: " & iCheckKanshou.ToString & " _ " & "iDem: " & iDem.ToString & " _ " & "iPhamvi: " & iPhamvi.ToString)
'                Exit Do
'            End If
'        Loop
'        'Exit Sub

'        'Chia PMI thành 5 hàng, đảm bảo cho hàng dưới cùng các PMI không bị đè lên nhau thì tự khắc hàng trên k đè lên nhau, lấy kích thước PMI là 120*35
'        ''Chia 5 hàng
'        Dim iPoint3DRiaSapXep0() As Point3d, iPoint3DTrong0() As Point3d, iiNamePoint0() As String, iPoint3DRiaSapXep1() As Point3d, iPoint3DTrong1() As Point3d, iiNamePoint1() As String, iPoint3DRiaSapXep2() As Point3d, iPoint3DTrong2() As Point3d, iiNamePoint2() As String, iPoint3DRiaSapXep3() As Point3d, iPoint3DTrong3() As Point3d, iiNamePoint3() As String, iPoint3DRiaSapXep4() As Point3d, iPoint3DTrong4() As Point3d, iiNamePoint4() As String
'        Call Chia_5_hang(iPoint3DRiaSapXep, iPoint3DTrong, iiNamePoint, iPoint3DRiaSapXep0, iPoint3DTrong0, iiNamePoint0, iPoint3DRiaSapXep1, iPoint3DTrong1, iiNamePoint1, iPoint3DRiaSapXep2, iPoint3DTrong2, iiNamePoint2, iPoint3DRiaSapXep3, iPoint3DTrong3, iiNamePoint3, iPoint3DRiaSapXep4, iPoint3DTrong4, iiNamePoint4)

'        'điều kiện Zone để các PMI không đè lên nhau
'        Try
'            a = UBound(iTrucXMaxToaDo)
'        Catch ex As Exception
'            a = -1
'        End Try
'        Try
'            b = UBound(iTrucXMinToaDo)
'        Catch ex As Exception
'            b = -1
'        End Try
'        Try
'            c = UBound(iTrucYMaxToaDo)
'        Catch ex As Exception
'            c = -1
'        End Try
'        Try
'            d = UBound(iTrucYMinToaDo)
'        Catch ex As Exception
'            d = -1
'        End Try
'        Dim iLenLimitTrucXMax As Double = ((a + 1) \ 5 + 1) * 35
'        Dim iLenLimitTrucXMin As Double = ((b + 1) \ 5 + 1) * 35
'        Dim iLenLimitTrucYMax As Double = ((c + 1) \ 5 + 1) * 120
'        Dim iLenLimitTrucYMin As Double = ((d + 1) \ 5 + 1) * 120
'        Dim iLenLimit As Double = 100
'        Dim iZone0() As Double, iZone1() As Double, iZone2() As Double
'        Dim iiCheckKanshou As Boolean
'        '0
'        Do
'            Call Ve_duong_bao_quanh_diem(iPoint, iLenLimit, iView, iZone0, iPointLine3D)
'            If iLenLimitTrucXMax > (iZone0(2) - iZone0(3)) Or iLenLimitTrucXMin > (iZone0(2) - iZone0(3)) Or iLenLimitTrucYMax > (iZone0(0) - iZone0(1)) Or iLenLimitTrucYMin > (iZone0(0) - iZone0(1)) Then
'                iLenLimit = iLenLimit + 100
'            Else
'                Dim iPointRiaNew0() As Point3d
'                Call Dieu_chinh_vi_tri_dat_PMI(iPoint3DRiaSapXep0, iPoint3DTrong0, iPointLine3D, iPointRiaNew0, iiCheckKanshou)
'                If iiCheckKanshou = True Then
'                    iLenLimit = iLenLimit + 120
'                Else
'                    For i = 0 To UBound(iiNamePoint0)
'                        Call CreatePMI_New(iiNamePoint0(i), (Split(iiNamePoint0(i), ";")(3)), iPointRiaNew0(i), iView, iMidPoint3D)
'                    Next
'                    iLenLimit = iLenLimit + 120
'                    Exit Do
'                End If
'            End If
'        Loop
'        '1
'        Do
'            Call Ve_duong_bao_quanh_diem(iPoint, iLenLimit, iView, Nothing, iPointLine3D)
'            Dim iPointRiaNew1() As Point3d
'            Call Dieu_chinh_vi_tri_dat_PMI(iPoint3DRiaSapXep1, iPoint3DTrong1, iPointLine3D, iPointRiaNew1, iiCheckKanshou)
'            If iiCheckKanshou = True Then
'                iLenLimit = iLenLimit + 120
'            Else
'                For i = 0 To UBound(iiNamePoint1)
'                    Call CreatePMI_New(iiNamePoint1(i), (Split(iiNamePoint1(i), ";")(3)), iPointRiaNew1(i), iView, iMidPoint3D)
'                Next
'                iLenLimit = iLenLimit + 120
'                Exit Do
'            End If
'        Loop
'        '2
'        Do
'            Call Ve_duong_bao_quanh_diem(iPoint, iLenLimit, iView, Nothing, iPointLine3D)
'            Dim iPointRiaNew2() As Point3d
'            Call Dieu_chinh_vi_tri_dat_PMI(iPoint3DRiaSapXep2, iPoint3DTrong2, iPointLine3D, iPointRiaNew2, iiCheckKanshou)
'            If iiCheckKanshou = True Then
'                iLenLimit = iLenLimit + 120
'            Else
'                For i = 0 To UBound(iiNamePoint2)
'                    Call CreatePMI_New(iiNamePoint2(i), (Split(iiNamePoint2(i), ";")(3)), iPointRiaNew2(i), iView, iMidPoint3D)
'                Next
'                iLenLimit = iLenLimit + 120
'                Exit Do
'            End If
'        Loop
'        '3
'        Do
'            Call Ve_duong_bao_quanh_diem(iPoint, iLenLimit, iView, Nothing, iPointLine3D)
'            Dim iPointRiaNew3() As Point3d
'            Call Dieu_chinh_vi_tri_dat_PMI(iPoint3DRiaSapXep3, iPoint3DTrong3, iPointLine3D, iPointRiaNew3, iiCheckKanshou)
'            If iiCheckKanshou = True Then
'                iLenLimit = iLenLimit + 120
'            Else
'                For i = 0 To UBound(iiNamePoint3)
'                    Call CreatePMI_New(iiNamePoint3(i), (Split(iiNamePoint3(i), ";")(3)), iPointRiaNew3(i), iView, iMidPoint3D)
'                Next
'                iLenLimit = iLenLimit + 120
'                Exit Do
'            End If
'        Loop
'        '4
'        Do
'            Call Ve_duong_bao_quanh_diem(iPoint, iLenLimit, iView, Nothing, iPointLine3D)
'            Dim iPointRiaNew4() As Point3d
'            Call Dieu_chinh_vi_tri_dat_PMI(iPoint3DRiaSapXep4, iPoint3DTrong4, iPointLine3D, iPointRiaNew4, iiCheckKanshou)
'            If iiCheckKanshou = True Then
'                iLenLimit = iLenLimit + 120
'            Else
'                For i = 0 To UBound(iiNamePoint4)
'                    Call CreatePMI_New(iiNamePoint4(i), (Split(iiNamePoint4(i), ";")(3)), iPointRiaNew4(i), iView, iMidPoint3D)
'                Next
'                iLenLimit = iLenLimit + 120
'                Exit Do
'            End If
'        Loop

'        'For i = 0 To UBound(iiNamePoint)
'        '    Call CreatePMI_New(iiNamePoint(i), (Split(iiNamePoint(i), ";")(3)), iPoint3DRiaSapXep(i), iView, iMidPoint3D)
'        'Next

'    End Sub

'    Sub Chieu_diem_len_mp_chuan(ByVal iiPoint3D() As Point3d, ByVal iView As String, ByRef iiPoint() As NXOpen.Point)
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim lw As ListingWindow = theSession.ListingWindow
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        lw = theSession.ListingWindow
'        lw.Open()
'        Dim i As Integer = 0

'        Dim iiiPoint3D() As Point3d
'        For i = 0 To UBound(iiPoint3D)
'            ReDim Preserve iiiPoint3D(i)
'            iiiPoint3D(i) = iiPoint3D(i)
'        Next

'        'chieu len "PLAN VIEW" (xOy) => Z = 0
'        If iView = "PLAN" Then
'            For i = 0 To UBound(iiiPoint3D)
'                iiiPoint3D(i).Z = 0
'            Next
'        End If

'        'chieu len "FRONT VIEW" (yOz) => X = 0
'        If iView = "FRONT" Then
'            For i = 0 To UBound(iiiPoint3D)
'                iiiPoint3D(i).X = 0
'            Next
'        End If

'        'chieu len "LEFT SIDE VIEW" (xOz) => Y = 0
'        If iView = "LEFTSIDE" Then
'            For i = 0 To UBound(iiiPoint3D)
'                iiiPoint3D(i).Y = 0
'            Next
'        End If

'        For i = 0 To UBound(iiiPoint3D)
'            ReDim Preserve iiPoint(i)
'            iiPoint(i) = workPart.Points.CreatePoint(iiiPoint3D(i))
'        Next
'    End Sub

'    Sub CreatePMI_New(ByVal aContents As String, ByVal iKetqua As String, ByVal iPoint3DRiaSapXep As Point3d, ByVal iView As String, ByVal iMidPoint3D As Point3d)
'        Dim theSession As NXOpen.Session = NXOpen.Session.GetSession()
'        Dim workPart As NXOpen.Part = theSession.Parts.Work
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim modelingView1 As ModelingView
'        modelingView1 = displayPart.ModelingViews.WorkView

'        Dim iPoint3DTrong As Point3d
'        iPoint3DTrong.X = Split(Split(aContents, "=")(1), ",")(0)
'        iPoint3DTrong.Y = Split(Split(aContents, "=")(2), ",")(0)
'        iPoint3DTrong.Z = Split(Split(aContents, "=")(3), "]")(0)
'        If iView = "PLAN" Then
'            iPoint3DRiaSapXep.Z = iPoint3DTrong.Z
'        ElseIf iView = "FRONT" Then
'            iPoint3DRiaSapXep.X = iPoint3DTrong.X
'        ElseIf iView = "LEFTSIDE" Then
'            iPoint3DRiaSapXep.Y = iPoint3DTrong.Y
'        End If
'        Dim nullAnnotations_SimpleDraftingAid As Annotations.SimpleDraftingAid = Nothing
'        Dim pmiNoteBuilder1 As Annotations.PmiNoteBuilder

'        pmiNoteBuilder1 = workPart.Annotations.CreatePmiNoteBuilder(nullAnnotations_SimpleDraftingAid)
'        pmiNoteBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiNoteBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiNoteBuilder1.Origin.Anchor = Annotations.OriginBuilder.AlignmentPosition.MidCenter

'        Dim text1(0) As String
'        text1(0) = Split(Split(aContents, "_")(1), ";")(0)
'        pmiNoteBuilder1.Text.TextBlock.SetText(text1)
'        pmiNoteBuilder1.TextAlignment = Annotations.DraftingNoteBuilder.TextAlign.BelowbottomExtToMax
'        pmiNoteBuilder1.Origin.Plane.PlaneMethod = Annotations.PlaneBuilder.PlaneMethodType.UserDefined
'        Dim leaderData1 As Annotations.LeaderData
'        leaderData1 = workPart.Annotations.CreateLeaderData()
'        leaderData1.StubSize = 2.0#
'        leaderData1.Arrowhead = Annotations.LeaderData.ArrowheadType.OpenArrow
'        pmiNoteBuilder1.Leader.Leaders.Append(leaderData1)
'        ''''''''''''''''''
'        leaderData1.StubSide = Annotations.LeaderSide.Inferred
'        ''''''''''''''''''
'        Dim symbolscale1 As Double
'        symbolscale1 = pmiNoteBuilder1.Text.TextBlock.SymbolScale
'        Dim symbolaspectratio1 As Double
'        symbolaspectratio1 = pmiNoteBuilder1.Text.TextBlock.SymbolAspectRatio
'        pmiNoteBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiNoteBuilder1.Origin.SetInferRelativeToGeometry(True)
'        pmiNoteBuilder1.Origin.Plane.PlaneMethod = Annotations.PlaneBuilder.PlaneMethodType.UserDefined
'        pmiNoteBuilder1.Origin.SetInferRelativeToGeometry(True)

'        Dim unit1 As Unit = CType(workPart.UnitCollection.FindObject("MilliMeter"), Unit)
'        Dim unit2 As Unit = CType(workPart.UnitCollection.FindObject("Degrees"), Unit)
'        Dim origin1 As Point3d = iPoint3DTrong
'        Dim xDirection1 As Vector3d = New Vector3d(modelingView1.Matrix.Xx, modelingView1.Matrix.Xy, modelingView1.Matrix.Xz)
'        Dim yDirection1 As Vector3d = New Vector3d(modelingView1.Matrix.Yx, modelingView1.Matrix.Yy, modelingView1.Matrix.Yz)
'        Dim xform3 As Xform
'        xform3 = workPart.Xforms.CreateXform(origin1, xDirection1, yDirection1, SmartObject.UpdateOption.AfterModeling, 1.0#)
'        Dim cartesianCoordinateSystem1 As CartesianCoordinateSystem
'        cartesianCoordinateSystem1 = workPart.CoordinateSystems.CreateCoordinateSystem(xform3, SmartObject.UpdateOption.AfterModeling)
'        pmiNoteBuilder1.Origin.Plane.UserDefinedPlane = xform3
'        pmiNoteBuilder1.Origin.SetInferRelativeToGeometry(True)
'        Dim coordinates1 As Point3d = iPoint3DTrong
'        Dim point1 As NXOpen.Point
'        point1 = workPart.Points.CreatePoint(coordinates1)
'        Dim point2 As Point3d = iPoint3DTrong
'        Try
'            leaderData1.Leader.SetValue(point1, displayPart.ModelingViews.WorkView, point2)
'        Catch
'            leaderData1.Leader.SetValue(point1, workPart.ModelingViews.WorkView, point2)
'        End Try
'        Dim assocOrigin1 As Annotations.Annotation.AssociativeOriginData
'        assocOrigin1.OriginType = Annotations.AssociativeOriginType.Drag
'        Dim nullView As NXOpen.View = Nothing
'        assocOrigin1.View = nullView
'        assocOrigin1.ViewOfGeometry = nullView
'        Dim nullPoint As NXOpen.Point = Nothing
'        assocOrigin1.PointOnGeometry = nullPoint
'        Dim nullAnnotations_Annotation As Annotations.Annotation = Nothing
'        assocOrigin1.VertAnnotation = nullAnnotations_Annotation
'        assocOrigin1.VertAlignmentPosition = Annotations.AlignmentPosition.TopLeft
'        assocOrigin1.HorizAnnotation = nullAnnotations_Annotation
'        assocOrigin1.HorizAlignmentPosition = Annotations.AlignmentPosition.TopLeft
'        assocOrigin1.AlignedAnnotation = nullAnnotations_Annotation
'        assocOrigin1.DimensionLine = 0
'        assocOrigin1.AssociatedView = nullView
'        assocOrigin1.AssociatedPoint = nullPoint
'        assocOrigin1.OffsetAnnotation = nullAnnotations_Annotation
'        assocOrigin1.OffsetAlignmentPosition = Annotations.AlignmentPosition.TopLeft
'        assocOrigin1.XOffsetFactor = 0.0#
'        assocOrigin1.YOffsetFactor = 0.0#
'        assocOrigin1.StackAlignmentPosition = Annotations.StackAlignmentPosition.Above
'        pmiNoteBuilder1.Origin.SetAssociativeOrigin(assocOrigin1)
'        pmiNoteBuilder1.Style.LetteringStyle.GeneralTextAspectRatio = 0.8
'        pmiNoteBuilder1.Style.LetteringStyle.GeneralTextCharSpaceFactor = 0.8
'        pmiNoteBuilder1.Style.LetteringStyle.GeneralTextSize = 20
'        pmiNoteBuilder1.Style.LineArrowStyle.ArrowheadLength = 1

'        pmiNoteBuilder1.Style.LetteringStyle.GeneralTextLineWidth = NXOpen.Annotations.LineWidth.Thick

'        Dim point3 As Point3d = iPoint3DRiaSapXep
'        pmiNoteBuilder1.Origin.Origin.SetValue(Nothing, nullView, point3)

'        pmiNoteBuilder1.Origin.SetInferRelativeToGeometry(True)

'        If iView = "PLAN" Then
'            If iPoint3DRiaSapXep.X > iMidPoint3D.X Then
'                leaderData1.StubSide = Annotations.LeaderSide.Left
'            Else
'                leaderData1.StubSide = Annotations.LeaderSide.Right
'            End If
'        ElseIf iView = "FRONT" Then
'            If iPoint3DRiaSapXep.Y > iMidPoint3D.Y Then
'                leaderData1.StubSide = Annotations.LeaderSide.Right
'            Else
'                leaderData1.StubSide = Annotations.LeaderSide.Left
'            End If
'        ElseIf iView = "LEFTSIDE" Then
'            If iPoint3DRiaSapXep.X > iMidPoint3D.X Then
'                leaderData1.StubSide = Annotations.LeaderSide.Left
'            Else
'                leaderData1.StubSide = Annotations.LeaderSide.Right
'            End If
'        End If

'        Dim nXObject1 As NXObject
'        nXObject1 = pmiNoteBuilder1.Commit()
'        pmiNoteBuilder1.Destroy()

'        'Đổi màu
'        Dim displayModification1 As NXOpen.DisplayModification = Nothing
'        displayModification1 = theSession.DisplayManager.NewDisplayModification()
'        displayModification1.ApplyToAllFaces = True
'        displayModification1.ApplyToOwningParts = False
'        If iKetqua.ToUpper = "OK" Then
'            displayModification1.NewColor = OK_Color
'        ElseIf iKetqua = "NG" Then
'            displayModification1.NewColor = NG_Color
'        ElseIf iKetqua = "CA" Then
'            displayModification1.NewColor = CA_Color
'        Else
'            displayModification1.NewColor = Other_Color
'        End If
'        displayModification1.NewWidth = NXOpen.DisplayableObject.ObjectWidth.One
'        Dim objects1(0) As NXOpen.DisplayableObject
'        Dim pmiLabel1 As NXOpen.Annotations.PmiLabel = CType(nXObject1, NXOpen.Annotations.PmiLabel)
'        objects1(0) = pmiLabel1
'        displayModification1.Apply(objects1)
'        displayModification1.Dispose()

'        'tăng độ đậm chữ
'        Dim iobjects1(0) As NXOpen.DisplayableObject
'        Dim ipmiLabel1 As NXOpen.Annotations.PmiLabel = CType(nXObject1, NXOpen.Annotations.PmiLabel)
'        iobjects1(0) = ipmiLabel1
'        Dim editSettingsBuilder1 As NXOpen.Annotations.EditSettingsBuilder = Nothing
'        editSettingsBuilder1 = workPart.SettingsManager.CreateAnnotationEditSettingsBuilder(iobjects1)
'        Dim editsettingsbuilders1(0) As NXOpen.Drafting.BaseEditSettingsBuilder
'        editsettingsbuilders1(0) = editSettingsBuilder1
'        workPart.SettingsManager.ProcessForMultipleObjectsSettings(editsettingsbuilders1)
'        Dim fontIndex1 As Integer = Nothing
'        fontIndex1 = workPart.Fonts.AddFont("kanji2", NXOpen.FontCollection.Type.Nx)
'        editSettingsBuilder1.AnnotationStyle.LetteringStyle.GeneralTextLineWidth = NXOpen.Annotations.LineWidth.Thick
'        Dim inXObject1 As NXOpen.NXObject = Nothing
'        inXObject1 = editSettingsBuilder1.Commit()
'        editSettingsBuilder1.Destroy()
'        theSession.CleanUpFacetedFacesAndEdges()





'        '
'    End Sub

'    Sub Function_View(ByVal dtInOut As DataTable, ByRef iFunctionView() As String)
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim lw As ListingWindow = theSession.ListingWindow
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        lw = theSession.ListingWindow
'        lw.Open()
'        Dim i As Integer = 0

'        Dim iDiemChuan As Point3d = New Point3d(1500, 0, 1000)
'        Dim iLinkFunc_View() As String, iiFunc As New List(Of String)
'        For Each dtrow As DataRow In dtInOut.Rows
'            If dtrow("CS Function").ToString <> "" Then
'                If iiFunc.Contains(dtrow("CS Function").ToString) = False Then
'                    iiFunc.Add(dtrow("CS Function").ToString)
'                End If
'            End If
'        Next
'        'xác định View của Function: đóng hộp Function lại, xem function nhìn trên View nào thì diện tích lớn nhất => 2 View có khả năng là của Function => cộng trừ trọng tâm Function so với trọng tâm của Full, xét theo từng View thì sẽ lựa chọn cộng X hoặc Y hoặc Z, so sánh giá trị lớn hơn bé hơn sẽ xác định đc View chính xác
'        For Each iFunc As String In iiFunc
'            Dim iXMax As Double = -13042000, iYMax As Double = -13042000, iZMax As Double = -13042000, iXMin As Double = 13042000, iYMin As Double = 13042000, iZMin As Double = 13042000
'            Dim iSumX As Double = 0, iSumY As Double = 0, iSumZ As Double = 0, iDem As Integer = 0, iTG As Double
'            For Each dtrow As DataRow In dtInOut.Rows
'                If dtrow("CS Function").ToString = iFunc Then
'                    iTG = CType(dtrow("X").ToString, Double)
'                    If iXMax < iTG Then
'                        iXMax = iTG
'                    End If
'                    If iXMin > iTG Then
'                        iXMin = iTG
'                    End If
'                    iSumX = iSumX + iTG

'                    iTG = CType(dtrow("Y").ToString, Double)
'                    If iYMax < iTG Then
'                        iYMax = iTG
'                    End If
'                    If iYMin > iTG Then
'                        iYMin = iTG
'                    End If
'                    iSumY = iSumY + iTG

'                    iTG = CType(dtrow("Z").ToString, Double)
'                    If iZMax < iTG Then
'                        iZMax = iTG
'                    End If
'                    If iZMin > iTG Then
'                        iZMin = iTG
'                    End If
'                    iSumZ = iSumZ + iTG
'                    iDem += 1
'                End If
'            Next
'            Dim iTrongTam As Point3d = New Point3d(iSumX / iDem, iSumY / iDem, iSumZ / iDem)                    'Trọng tâm Function
'            'Xác định Function thuộc hướng nhìn nào
'            Dim S_Side As Double, S_Front As Double, S_Plan As Double
'            S_Side = (iZMax - iZMin) * (iXMax - iXMin)
'            S_Front = (iYMax - iYMin) * (iZMax - iZMin)
'            S_Plan = (iYMax - iYMin) * (iXMax - iXMin)
'            iTG = S_Side
'            If iTG < S_Front Then
'                iTG = S_Front
'            End If
'            If iTG < S_Plan Then
'                iTG = S_Plan
'            End If
'            'Xác định Function thuộc View nào
'            ReDim Preserve iFunctionView(i)
'            If iTG = S_Side Then
'                If iTrongTam.Y - iDiemChuan.Y > 0 Then
'                    iFunctionView(i) = iFunc & ";" & "RIGHTSIDE"
'                Else
'                    iFunctionView(i) = iFunc & ";" & "LEFTSIDE"
'                End If
'            ElseIf iTG = S_Front Then
'                If iTrongTam.X - iDiemChuan.X > 0 Then
'                    iFunctionView(i) = iFunc & ";" & "REAR"
'                Else
'                    iFunctionView(i) = iFunc & ";" & "FRONT"
'                End If
'            ElseIf iTG = S_Plan Then
'                If iTrongTam.Z - iDiemChuan.Z > 0 Then
'                    iFunctionView(i) = iFunc & ";" & "PLAN"
'                Else
'                    iFunctionView(i) = iFunc & ";" & "BOTTOM"
'                End If
'            End If
'            i += 1
'        Next
'    End Sub

'    Sub Chia_5_hang(ByVal iPoint3DRiaSapXep() As Point3d, ByVal iPoint3DTrong() As Point3d, ByVal iiNamePoint() As String, ByRef iPoint3DRiaSapXep0() As Point3d, ByRef iPoint3DTrong0() As Point3d, ByRef iiNamePoint0() As String, ByRef iPoint3DRiaSapXep1() As Point3d, ByRef iPoint3DTrong1() As Point3d, ByRef iiNamePoint1() As String, ByRef iPoint3DRiaSapXep2() As Point3d, ByRef iPoint3DTrong2() As Point3d, ByRef iiNamePoint2() As String, ByRef iPoint3DRiaSapXep3() As Point3d, ByRef iPoint3DTrong3() As Point3d, ByRef iiNamePoint3() As String, ByRef iPoint3DRiaSapXep4() As Point3d, ByRef iPoint3DTrong4() As Point3d, ByRef iiNamePoint4() As String)           'chia số lượng PMI về 3 hàng để dễ nhìn. Điều kiện: các đường chỉ thị PMI có thể đè lên chữ nhưng chữ không được đè lên nhau
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim lw As ListingWindow = theSession.ListingWindow
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        lw = theSession.ListingWindow
'        lw.Open()

'        Dim a As Integer = 0, idem0 As Integer = 0, idem1 As Integer = 0, idem2 As Integer = 0, idem3 As Integer = 0, idem4 As Integer = 0
'        For a = 0 To UBound(iPoint3DTrong)
'            If a Mod 5 = 0 Then
'                ReDim Preserve iPoint3DRiaSapXep0(idem0)
'                iPoint3DRiaSapXep0(idem0) = iPoint3DRiaSapXep(a)
'                ReDim Preserve iPoint3DTrong0(idem0)
'                iPoint3DTrong0(idem0) = iPoint3DTrong(a)
'                ReDim Preserve iiNamePoint0(idem0)
'                iiNamePoint0(idem0) = iiNamePoint(a)
'                idem0 += 1
'            End If
'            If a Mod 5 = 1 Then
'                ReDim Preserve iPoint3DRiaSapXep1(idem1)
'                iPoint3DRiaSapXep1(idem1) = iPoint3DRiaSapXep(a)
'                ReDim Preserve iPoint3DTrong1(idem1)
'                iPoint3DTrong1(idem1) = iPoint3DTrong(a)
'                ReDim Preserve iiNamePoint1(idem1)
'                iiNamePoint1(idem1) = iiNamePoint(a)
'                idem1 += 1
'            End If
'            If a Mod 5 = 2 Then
'                ReDim Preserve iPoint3DRiaSapXep2(idem2)
'                iPoint3DRiaSapXep2(idem2) = iPoint3DRiaSapXep(a)
'                ReDim Preserve iPoint3DTrong2(idem2)
'                iPoint3DTrong2(idem2) = iPoint3DTrong(a)
'                ReDim Preserve iiNamePoint2(idem2)
'                iiNamePoint2(idem2) = iiNamePoint(a)
'                idem2 += 1
'            End If
'            If a Mod 5 = 3 Then
'                ReDim Preserve iPoint3DRiaSapXep3(idem3)
'                iPoint3DRiaSapXep3(idem3) = iPoint3DRiaSapXep(a)
'                ReDim Preserve iPoint3DTrong3(idem3)
'                iPoint3DTrong3(idem3) = iPoint3DTrong(a)
'                ReDim Preserve iiNamePoint3(idem3)
'                iiNamePoint3(idem3) = iiNamePoint(a)
'                idem3 += 1
'            End If
'            If a Mod 5 = 4 Then
'                ReDim Preserve iPoint3DRiaSapXep4(idem4)
'                iPoint3DRiaSapXep4(idem4) = iPoint3DRiaSapXep(a)
'                ReDim Preserve iPoint3DTrong4(idem4)
'                iPoint3DTrong4(idem4) = iPoint3DTrong(a)
'                ReDim Preserve iiNamePoint4(idem4)
'                iiNamePoint4(idem4) = iiNamePoint(a)
'                idem4 += 1
'            End If
'        Next




'    End Sub

'    Sub Dieu_chinh_vi_tri_dat_PMI(ByVal iPoint3DRiaSapXep() As Point3d, ByVal iPoint3DTrong() As Point3d, ByVal iPointLine3D() As Point3d, ByRef iPointRiaNew() As Point3d, ByRef iCheckKanshou As Boolean)                 'điều chỉnh vị trí iPoint3DRiaSapXep theo từng hàng
'        Dim theSession As Session = Session.GetSession()
'        Dim theUFSession As UFSession = UFSession.GetUFSession()
'        Dim workPart As Part = theSession.Parts.Work
'        Dim displayPart As NXOpen.Part = theSession.Parts.Display
'        Dim lw As ListingWindow = theSession.ListingWindow
'        Dim partLoadStatus1 As NXOpen.PartLoadStatus = Nothing
'        lw = theSession.ListingWindow
'        lw.Open()

'        'Dim iDem As Integer = 0
'        Dim i As Integer = 0, j As Integer = 0
'        For i = 0 To UBound(iPoint3DRiaSapXep)

'            Dim iPointGiao(3) As Point3d, iLenTG1 As Double, iLenTG2 As Double, iLenTG3 As Double, iLenTG4 As Double, iLenTG5 As Double, iLenTG6 As Double
'            Call Timgiaodiem2duongthang(iPoint3DRiaSapXep(i), iPoint3DTrong(i), iPointLine3D(0), iPointLine3D(1), iPointGiao(0))
'            Call Timgiaodiem2duongthang(iPoint3DRiaSapXep(i), iPoint3DTrong(i), iPointLine3D(0), iPointLine3D(2), iPointGiao(1))
'            Call Timgiaodiem2duongthang(iPoint3DRiaSapXep(i), iPoint3DTrong(i), iPointLine3D(3), iPointLine3D(1), iPointGiao(2))
'            Call Timgiaodiem2duongthang(iPoint3DRiaSapXep(i), iPoint3DTrong(i), iPointLine3D(3), iPointLine3D(2), iPointGiao(3))

'            Call GetLength2Point3D(iPoint3DRiaSapXep(i), iPoint3DTrong(i), iLenTG1)
'            Call GetLength2Point3D(iPoint3DRiaSapXep(i), iPointGiao(0), iLenTG2)
'            Call GetLength2Point3D(iPoint3DTrong(i), iPointGiao(0), iLenTG3)
'            Call GetLength2Point3D(iPointLine3D(0), iPointLine3D(1), iLenTG4)
'            Call GetLength2Point3D(iPointLine3D(0), iPointGiao(0), iLenTG5)
'            Call GetLength2Point3D(iPointLine3D(1), iPointGiao(0), iLenTG6)
'            'lw.WriteLine(iLenTG1 & " _ " & iLenTG2 + iLenTG3 & " & " & iLenTG4 & " _ " & iLenTG5 + iLenTG6)
'            'lw.WriteLine(Math.Round(iLenTG1, 5) & " _ " & Math.Round(iLenTG2 + iLenTG3, 5) & " & " & Math.Round(iLenTG4, 5) & " _ " & Math.Round(iLenTG5 + iLenTG6, 5))
'            If Math.Round(iLenTG1, 5) = Math.Round(iLenTG2 + iLenTG3, 5) And Math.Round(iLenTG4, 5) = Math.Round(iLenTG5 + iLenTG6, 5) Then
'                'lw.WriteLine("OK")
'                ReDim Preserve iPointRiaNew(i)
'                iPointRiaNew(i) = iPointGiao(0)
'            Else
'                Call GetLength2Point3D(iPoint3DRiaSapXep(i), iPoint3DTrong(i), iLenTG1)
'                Call GetLength2Point3D(iPoint3DRiaSapXep(i), iPointGiao(1), iLenTG2)
'                Call GetLength2Point3D(iPoint3DTrong(i), iPointGiao(1), iLenTG3)
'                Call GetLength2Point3D(iPointLine3D(0), iPointLine3D(2), iLenTG4)
'                Call GetLength2Point3D(iPointLine3D(0), iPointGiao(1), iLenTG5)
'                Call GetLength2Point3D(iPointLine3D(2), iPointGiao(1), iLenTG6)
'                'lw.WriteLine(Math.Round(iLenTG1, 5) & " _ " & Math.Round(iLenTG2 + iLenTG3, 5) & " & " & Math.Round(iLenTG4, 5) & " _ " & Math.Round(iLenTG5 + iLenTG6, 5))
'                If Math.Round(iLenTG1, 5) = Math.Round(iLenTG2 + iLenTG3, 5) And Math.Round(iLenTG4, 5) = Math.Round(iLenTG5 + iLenTG6, 5) Then
'                    'lw.WriteLine("OK")
'                    ReDim Preserve iPointRiaNew(i)
'                    iPointRiaNew(i) = iPointGiao(1)
'                Else

'                    Call GetLength2Point3D(iPoint3DRiaSapXep(i), iPoint3DTrong(i), iLenTG1)
'                    Call GetLength2Point3D(iPoint3DRiaSapXep(i), iPointGiao(2), iLenTG2)
'                    Call GetLength2Point3D(iPoint3DTrong(i), iPointGiao(2), iLenTG3)
'                    Call GetLength2Point3D(iPointLine3D(3), iPointLine3D(1), iLenTG4)
'                    Call GetLength2Point3D(iPointLine3D(3), iPointGiao(2), iLenTG5)
'                    Call GetLength2Point3D(iPointLine3D(1), iPointGiao(2), iLenTG6)
'                    'lw.WriteLine(Math.Round(iLenTG1, 5) & " _ " & Math.Round(iLenTG2 + iLenTG3, 5) & " & " & Math.Round(iLenTG4, 5) & " _ " & Math.Round(iLenTG5 + iLenTG6, 5))
'                    If Math.Round(iLenTG1, 5) = Math.Round(iLenTG2 + iLenTG3, 5) And Math.Round(iLenTG4, 5) = Math.Round(iLenTG5 + iLenTG6, 5) Then
'                        'lw.WriteLine("OK")
'                        ReDim Preserve iPointRiaNew(i)
'                        iPointRiaNew(i) = iPointGiao(2)
'                    Else
'                        ReDim Preserve iPointRiaNew(i)
'                        iPointRiaNew(i) = iPointGiao(3)
'                    End If
'                End If
'            End If
'        Next

'        iCheckKanshou = False
'        For i = 0 To (UBound(iPointRiaNew) - 1)
'            Dim iLen As Double
'            Call GetLength2Point3D(iPointRiaNew(i), iPointRiaNew(i + 1), iLen)
'            If iLen < 120 Then
'                iCheckKanshou = True
'                Exit Sub
'            End If
'        Next



'    End Sub



'End Module



